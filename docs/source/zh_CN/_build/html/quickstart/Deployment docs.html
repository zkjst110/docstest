

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>部署文档 &mdash; hyperchain  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> hyperchain
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">平台介绍:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">平台介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Version%20information.html">版本信息</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">快速入门:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../General%20Concepts.html">通用概念</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Prepare.html">准备工作</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Deployedfile.html">部署运维</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">基础协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../consensus%20mechanism.html">共识机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Networking%20protocol.html">网络协议</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution%20engine.html">执行引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Storage%20model.html">存储模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security%20mechanism.html">加密机制</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">扩展协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Architecture%20development.html">架构拓展</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Digital%20Service.html">数字服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Safe%20Privacy.html">隐私保护</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Governonce%20and%20audit.html">治理与审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data%20management.html">数据管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Operation%20manage.html">运维管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ecological%20components.html">区块链生态组件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../External%20Interface.html">外部接口</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">用户手册:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Chain%20Authority%20Management.html">链级权限管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Node%20and%20zone%20management.html">节点及分区管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Consensus%20related%20user%20manual.html">共识相关使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Cross%20domain%20network%20User%20Manual.html">跨域网络使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data%20storage%20and%20management.html">数据存储使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Password%20related.html">密码学相关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Security%20Audit.html">安全审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data%20Monitor.html">数据监控</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qulian%20blockchain%20browser.html">趣链区块链浏览器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VM%20Related%20User%20Manual.html">（用户）智能合约使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Module.html">（用户）组件库</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">应用场景:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../application.html">应用案例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NFT%20and%20contract%20writing.html">数字藏品合约编写</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">更多资源:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Community_Resources.html">社区与资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperchain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>部署文档</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/quickstart/Deployment docs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="deployment-docs">
<span id="id1"></span><h1>部署文档<a class="headerlink" href="#deployment-docs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>前言<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>该文档将介绍如何部署一个拥有4个节点的Hyperchain集群，用户需要 <strong>分别登录到4台服务器</strong> 上进行操作。</p>
<p>这里假设4台服务器的IP分别为 <cite>node1</cite> 、 <cite>node2</cite> 、 <cite>node3</cite> 和 <cite>node4</cite> ，操作用户都是 <cite>hyperchain</cite> 。</p>
<p><strong>该部署文档是为模拟平台上线部署的场景而编写的，所有的部署操作都只有普通用户权限。不推荐使用root用户部署平台，容易养成不好的操作习惯，也不利于发现操作步骤中的错误。</strong></p>
</div>
<div class="section" id="id3">
<h2>第一章 获取安装包以及用户登录<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3>1.1 获取安装包<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>如果您已通过其他方式获取安装包请忽略此步骤。</p>
<p>【线下获取】对接趣链科技相关人员</p>
<p>【公司外部】登录服务平台官方资源库下载</p>
<ul class="simple">
<li><p><a class="reference external" href="https://baas.hyperchain.cn">https://baas.hyperchain.cn</a></p></li>
<li><p>没有开放权限的，可以找&#64;王炎炎申请支持</p></li>
</ul>
<p><img alt="image1" src="../_images/Deployment1.png" /></p>
<p>【公司内部】登录OA：<a class="reference external" href="https://moffi.hyperchain.cn">https://moffi.hyperchain.cn</a></p>
<ul class="simple">
<li><p>点击签发-&gt;平台组件-&gt;组件列表-&gt;hyperchain-&gt;下载，选择使用您平台的hyperchain版本下载</p></li>
<li><p>点击签发-&gt;证书-&gt;创建证书，选择V1.7+证书体系，按步骤点击后下载得到证书zip文件</p></li>
<li><p>点击签发-&gt;许可-&gt;我的许可，申请适合您需求的LICENSE，审批通过后在许可状态中下载LICENSE文件</p></li>
</ul>
<p>【免费试用版】<a class="reference external" href="https://docs.hyperchain.cn/document/detail?type=1&amp;id=55">https://docs.hyperchain.cn/document/detail?type=1&amp;id=55</a></p>
<p>至此，您已经获得了所有需要的安装包，注意： <strong>证书和LICENSE文件将在hyperchain部署完成时用到，详见3.2节。</strong></p>
</div>
<div class="section" id="id5">
<h3>1.2 创建使用用户及文件权限<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>创建平台部署所需的用户，例如创建如下用户:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>用户名：hyperchain
密码：hyperchain
</pre></div>
</div>
<p>可用如下命令创建新用户:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">useradd</span> <span class="o">-</span><span class="n">m</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">hyperchain</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">k</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">skel</span> <span class="n">hyperchain</span>
<span class="n">sudo</span> <span class="n">passwd</span> <span class="n">hyperchain</span>
</pre></div>
</div>
<p>修改部署路径及数据存放路径的目录权限，例如 <cite>/data/hyperchain</cite></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">hyperchain</span><span class="p">:</span><span class="n">hyperchain</span>  <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">hyperchain</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id6">
<h3>1.3 上传安装包<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>登录服务器前需要上传hyperchain安装包和另外的小工具。</p>
<p>以服务器地址 <cite>node1</cite> ，用户名 <cite>hyperchain</cite> 为例，操作步骤如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#上传hyperchain安装包</span>
<span class="c1">#具体操作时将hyperchain-install.tar.gz换成实际安装包名，将node1换成实际服务器IP地址</span>
<span class="n">scp</span> <span class="n">hyperchain</span><span class="o">-</span><span class="n">installer</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span> <span class="n">hyperchain</span><span class="nd">@node1</span><span class="p">:</span><span class="o">~</span>
<span class="c1">#上传nt工具包（可选）</span>
<span class="c1">#具体操作时将node1换成实际服务器IP地址</span>
<span class="n">scp</span> <span class="n">nt</span><span class="o">-</span><span class="n">linux64</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span> <span class="n">hyperchain</span><span class="nd">@node1</span><span class="p">:</span><span class="o">~</span>
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>1.4 登录操作用户<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#具体操作时将node1换成服务器IP地址</span>
<span class="n">ssh</span> <span class="n">hyperchain</span><span class="nd">@node1</span>
<span class="n">Password</span><span class="p">:</span>
<span class="c1">#输入登录密码</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id8">
<h3>1.5 重复操作<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>请按照<strong>1.2~1.3</strong>中的步骤，再分别登录到 <cite>node2~node4</cite> 上，以继续之后的操作。</p>
</div>
</div>
<div class="section" id="id9">
<h2>第二章 检查系统环境<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>首先以 <cite>node1</cite> 服务器为例，完成以下的检查步骤。</p>
<div class="section" id="id10">
<h3>2.1 检查服务器时间<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>检查Hyperchain节点所在服务器的时间是否与标准时间同步，如果不同步请联络系管理员同步系统时钟。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#查看服务器时间命令</span>
<span class="n">date</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id11">
<h3>2.2 检查服务器配置<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>检查服务器配置是否与预期的配置一致，如果不一致请联系系统管理调整配置。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#查看CPU主频</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">cpuinfo</span> <span class="o">|</span> <span class="n">grep</span> <span class="s1">&#39;model name&#39;</span> <span class="o">|</span> <span class="n">uniq</span>
<span class="c1">#查看CPU核数</span>
<span class="n">cat</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">cpuinfo</span> <span class="o">|</span> <span class="n">grep</span> <span class="s1">&#39;model name&#39;</span> <span class="o">|</span> <span class="n">wc</span> <span class="o">-</span><span class="n">l</span>
<span class="c1">#查看内存大小</span>
<span class="c1">#如果free -h执行失败，可以直接调用free查看</span>
<span class="n">free</span> <span class="o">-</span><span class="n">h</span>
<span class="c1">#查看挂载的文件系统大小</span>
<span class="n">df</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id12">
<h3>2.3 检查端口占用情况<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>检查Hyperchain节点所需的端口是否被其他进程占用，如已被占用请联络系统管理员进行调整或将各节点dynamic.toml
中jsonrpc、grpc的端口改为其他端口即可(详见4.3)</p>
<p>检查端口是否被监听，以查看8001端口为例：</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#查看端口是否被占用的命令</span>
<span class="n">unetstat</span> <span class="o">-</span><span class="n">nap</span> <span class="o">|</span> <span class="n">grep</span> <span class="mi">8001</span>
</pre></div>
</div>
</div></blockquote>
<p>如果存在被占用的情况，上述命令会打印出以下类似信息:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">Not</span> <span class="nb">all</span> <span class="n">processes</span> <span class="n">could</span> <span class="n">be</span> <span class="n">identified</span><span class="p">,</span> <span class="n">non</span><span class="o">-</span><span class="n">owned</span> <span class="n">process</span> <span class="n">info</span>
 <span class="n">will</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">shown</span><span class="p">,</span> <span class="n">you</span> <span class="n">would</span> <span class="n">have</span> <span class="n">to</span> <span class="n">be</span> <span class="n">root</span> <span class="n">to</span> <span class="n">see</span> <span class="n">it</span> <span class="nb">all</span><span class="o">.</span><span class="p">)</span>
<span class="n">tcp6</span>       <span class="mi">0</span>      <span class="mi">0</span> <span class="p">:::</span><span class="mi">8001</span>                 <span class="p">:::</span><span class="o">*</span>                    <span class="n">LISTEN</span>      <span class="mi">30207</span><span class="o">/./</span><span class="n">process1</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<h3>2.4 检查网络连通性<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>检查网络连通性的目的，就是为了检查Hyperchain节点所监听的端口能否被其他节点访问到，如果其他节点访问不到请联络系统管理做处理。</p>
<p>可以使用以下三种方法检查网络连通性， <cite>选择任意一种即可</cite> 。</p>
<ul class="simple">
<li><p>nt工具</p></li>
<li><p>nc命令</p></li>
<li><p>Python HTTP模块</p></li>
</ul>
<div class="section" id="nt">
<h4>2.4.1 使用nt工具测试连通性<a class="headerlink" href="#nt" title="Permalink to this headline">¶</a></h4>
<p>nt是一个专门用于测试网络连通性的工具。</p>
<p>假设Hyperchain节点IP地址node1~node4，需要验证node2~node4与node1上8001端口的连通性，使用方法如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#登录node1</span>
<span class="c1">#具体操作时将node1换成服务器IP地址</span>
<span class="n">ssh</span> <span class="n">hyperchain</span><span class="nd">@node1</span>
<span class="c1">#解压nt工具包</span>
<span class="n">tar</span> <span class="n">xvf</span> <span class="n">nt</span><span class="o">-</span><span class="n">linux64</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">cd</span> <span class="n">nt</span><span class="o">-</span><span class="n">linux64</span>
<span class="c1">#启动nt监听</span>
<span class="o">./</span><span class="n">nt</span> <span class="n">server</span> <span class="o">-</span><span class="n">l</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">8001</span>
<span class="c1">#登录node2</span>
<span class="c1">#具体操作时将node2换成服务器IP地址</span>
<span class="n">ssh</span> <span class="n">hyperchain</span><span class="nd">@node2</span>
<span class="c1">#解压nt工具包</span>
<span class="n">tar</span> <span class="n">xvf</span> <span class="n">nt</span><span class="o">-</span><span class="n">linux64</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="c1">#编辑servers.txt，向servers.txt中加入需要检测的IP:Port，本例中填入一下内容</span>
<span class="c1">#具体操作时将node1换成服务器IP地址</span>
<span class="n">echo</span> <span class="s1">&#39;node1:8001&#39;</span> <span class="o">&gt;</span> <span class="n">servers</span><span class="o">.</span><span class="n">txt</span>
<span class="c1">#检查servers.txt内容是否符合预期</span>
<span class="n">cat</span> <span class="n">servers</span><span class="o">.</span><span class="n">txt</span>
<span class="c1">#启动客户端测试</span>
<span class="o">./</span><span class="n">nt</span> <span class="n">client</span>
<span class="c1">#看到类似如下带SUCCESS字样的输出，即表明测试成功</span>
<span class="p">[</span><span class="n">CLIENT</span><span class="p">]</span> <span class="n">TEST</span> <span class="n">node1</span><span class="p">:</span><span class="mi">8001</span>    <span class="p">[</span><span class="n">SUCCESS</span><span class="p">]</span> <span class="n">RESP</span><span class="p">:</span> <span class="n">s</span><span class="p">:</span> <span class="n">server_resp</span> <span class="p">[</span><span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">8001</span><span class="p">],</span> <span class="n">C</span><span class="o">-&gt;</span><span class="n">S</span><span class="p">:</span> <span class="mi">0</span> <span class="n">ms</span><span class="p">,</span> <span class="n">RTT</span><span class="p">:</span> <span class="mi">0</span> <span class="n">ms</span>
<span class="c1">#在node3、node4上重复在node2上操作即可</span>
<span class="c1">#测试完之后返回到node1</span>
<span class="c1">#按 CTRL-C 结束server监听</span>
<span class="n">CTRL</span><span class="o">-</span><span class="n">C</span>
</pre></div>
</div>
<p><strong>nt工具支持同时检查多个IP:Port的连通性，只要在servers.txt中以每行一个IP:Port的格式填写即可。</strong></p>
</div>
<div class="section" id="nc">
<h4>2.4.2 使用nc命令测试连通性<a class="headerlink" href="#nc" title="Permalink to this headline">¶</a></h4>
<p>还可以用nc命令测试连通性，此方法的优点是操作步骤简单，但缺点是有些系统不会自带安装nc命令。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#安装nc命令如下：</span>
<span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">nc</span>
</pre></div>
</div>
</div></blockquote>
<p>假设Hyperchain节点IP地址node1~node4，需要验证node2~node4与node1上8001端口的连通性，使用方法如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#登录node1</span>
<span class="c1">#具体操作时将node1换成服务器IP地址</span>
<span class="n">ssh</span> <span class="n">hyperchain</span><span class="nd">@node1</span>
<span class="c1">#启动nc监听, -l设置开启监听模式，-k开启支持多客户端同时连接模式，-p指定监听端口</span>
<span class="n">nc</span> <span class="o">-</span><span class="n">l</span> <span class="o">-</span><span class="n">k</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8001</span>
<span class="c1">#登录node2</span>
<span class="c1">#具体操作时将node2换成服务器IP地址</span>
<span class="n">ssh</span> <span class="n">hyperchain</span><span class="nd">@node2</span>
<span class="c1">#使用nc命令测试连通性，-w选项设置3秒等待时间,-i选项设置连接成功后空闲等待时间(空闲超3秒即退出)</span>
<span class="c1">#具体操作时将node1换成服务器IP地址</span>
<span class="n">nc</span> <span class="o">-</span><span class="n">w</span> <span class="mi">3</span> <span class="o">-</span><span class="n">i</span> <span class="mi">3</span> <span class="o">-</span><span class="n">v</span> <span class="n">node1</span> <span class="mi">8001</span>
<span class="c1">#如果出现以下带Connected字样的输出，表示测试成功。</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">node1</span><span class="p">:</span><span class="mf">8001.</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Idle</span> <span class="n">timeout</span> <span class="n">expired</span> <span class="p">(</span><span class="mi">3000</span> <span class="n">ms</span><span class="p">)</span><span class="o">.</span>
<span class="c1">#在node3、node4上重复在node2上操作即可</span>
<span class="c1">#测试完之后返回到node1</span>
<span class="c1">#按 CTRL-C 结束nc监听</span>
<span class="n">CTRL</span><span class="o">-</span><span class="n">C</span>
</pre></div>
</div>
</div>
<div class="section" id="pythonhttp">
<h4>2.4.3 使用Python的HTTP模块测试连通性<a class="headerlink" href="#pythonhttp" title="Permalink to this headline">¶</a></h4>
<p>使用Python自带的HTTP模块也能快速开启对一个端口的监听，如果在使用上述两种方法时遇到问题，可以考虑使用此方法快速测试网络连通性。</p>
<p>假设Hyperchain节点IP地址node1~node4，需要验证node2~node4与node1上8001端口的连通性，使用方法如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#登录node1</span>
<span class="c1">#具体操作时将node1换成服务器IP地址</span>
<span class="n">ssh</span> <span class="n">hyperchain</span><span class="nd">@node1</span>
<span class="c1">#启动Python HTTP模块监听，命令如下(注意大小写)</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">SimpleHTTPServer</span> <span class="mi">8001</span>
<span class="c1">#登录node2</span>
<span class="c1">#具体操作时将node2换成服务器IP地址</span>
<span class="n">ssh</span> <span class="n">hyperchain</span><span class="nd">@node2</span>
<span class="c1">#使用curl命令测试连通性</span>
<span class="c1">#具体操作时将node1换成服务器IP地址</span>
<span class="n">curl</span> <span class="n">node1</span><span class="p">:</span><span class="mi">8001</span> <span class="o">&gt;&amp;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">&amp;&amp;</span> <span class="n">echo</span> <span class="n">yes</span> <span class="o">||</span> <span class="n">echo</span> <span class="n">no</span>
<span class="c1">#如果测试成功就打印yes，否则打印no</span>
<span class="c1">#在node3、node4上重复在node2上操作即可</span>
<span class="c1">#测试完之后返回到node1</span>
<span class="c1">#按 CTRL-C 结束Python监听</span>
<span class="n">CTRL</span><span class="o">-</span><span class="n">C</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id14">
<h3>2.5 检查系统字符集<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p><cite>hyperchain</cite> 节点默认使用的字符集为 <cite>UTF-8</cite>
，请检查 <cite>SDK</cite> 或者应用服务器的默认字符集是否为 <cite>UTF-8</cite> ，如果不是，有可能造成签名非法。</p>
<p><strong>1、首先使用locale命令看看当前系统所使用的字符集，如下可以看到是en英文</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">root</span><span class="nd">@dev</span> <span class="o">~</span><span class="p">]</span><span class="c1"># locale</span>
<span class="n">LANG</span><span class="o">=</span><span class="n">en_US</span><span class="o">.</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<span class="n">LC_CTYPE</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="n">LC_NUMERIC</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="n">LC_TIME</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="n">LC_COLLATE</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="n">LC_MONETARY</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="n">LC_MESSAGES</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="n">LC_PAPER</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="n">LC_NAME</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="n">LC_ADDRESS</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="n">LC_TELEPHONE</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="n">LC_MEASUREMENT</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="n">LC_IDENTIFICATION</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="n">LC_ALL</span><span class="o">=</span>
</pre></div>
</div>
</div></blockquote>
<p><a href="#id15"><span class="problematic" id="id16">**</span></a>2、如上面的命令输出非utf-8字符集则按如下方法修改配置文件并重启系统测试**（在CentOS6里面该文件是/etc/sysconfig/i18n）</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">locale</span><span class="o">.</span><span class="n">conf</span>
<span class="n">LANG</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id17">
<h3>2.6 检查最大文件句柄数<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>启动hyperchain之前，需要保证文件句柄数至少为65535，否则有可能会由于文件句柄数不足引发系统宕机。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">ulimit</span> <span class="o">-</span><span class="n">n</span>
<span class="mi">65535</span>
</pre></div>
</div>
</div></blockquote>
<p>查询到的数值应至少为65535，否则，建议联系当前服务器的管理员进行修改（如有管理员权限则可以使用以下命令修改）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#临时修改</span>
<span class="n">ulimit</span> <span class="o">-</span><span class="n">HSn</span> <span class="mi">65535</span>
<span class="c1">#永久修改</span>
<span class="n">cat</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">security</span><span class="o">/</span><span class="n">limits</span><span class="o">.</span><span class="n">conf</span>
<span class="o">*</span> <span class="n">soft</span> <span class="n">nofile</span> <span class="mi">65535</span>      <span class="c1"># open files  (-n)</span>
<span class="o">*</span> <span class="n">hard</span> <span class="n">nofile</span> <span class="mi">65535</span>

<span class="o">*</span> <span class="n">soft</span> <span class="n">nproc</span> <span class="mi">65565</span>
<span class="o">*</span> <span class="n">hard</span> <span class="n">nproc</span> <span class="mi">65565</span>       <span class="c1"># max user processes   (-u)</span>
<span class="n">EOF</span>
</pre></div>
</div>
<p>查询到的数值应至少为65535，否则，建议联系当前服务器的管理员进行修改。</p>
</div>
<div class="section" id="id18">
<h3>2.7 重复操作<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>在完成以上步骤后， <cite>node1</cite> 服务器的系统环境就检查完毕了。请按照 <strong>2.1~2.5</strong> 中的步骤，再分别登录到 <cite>node2~node4</cite> 上做一次检查。</p>
</div>
</div>
<div class="section" id="id19">
<h2>第三章 安装节点<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h2>
<p>首先以node1服务器为例，完成以下的安装步骤。</p>
<div class="section" id="id20">
<h3>3.1 备份数据<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>在做安装操作之前，需要先检查目标目录是否有数据，如果不是首次安装，请先备份一下历史数据。</p>
</div>
<div class="section" id="id21">
<h3>3.2 安装节点<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p>以下步骤以安装node1上的Hyperchain为例</p>
<p>首先解压安装包</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#回到用户主目录，解压安装包</span>
<span class="n">cd</span>
<span class="c1">#根据实际情况修改hyperchain-install.tar.gz</span>
<span class="n">tar</span> <span class="n">xvf</span> <span class="n">hyperchain</span><span class="o">-</span><span class="n">installer</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="c1">#根据实际情况修改hyperchain-abcdef</span>
<span class="n">cd</span> <span class="n">hyperchain</span><span class="o">-</span><span class="n">abcdef</span>
</pre></div>
</div>
</div></blockquote>
<p>假设目标安装目录是 <cite>/data/hyperchain</cite> ,
请先对照操作步骤 <strong>2.2</strong> 中的文件系统检查结果，再次确认目标目录的大小满足需求。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>注意，在安装之前，一定要确认好目标目录的大小，这点经常会被忽略。请务必仔细检查，以避免不必要的麻烦。</strong></p>
<p>倘若检查结果没有问题，请执行以下命令完成安装：</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">deploy</span><span class="o">-</span><span class="n">local</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">hyperchain</span>
<span class="c1">#如果想直接安装到当前目录，执行以下命令；</span>
<span class="c1">#./deploy-local.sh -d ./</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>注意：确保操作用户对-d指定的安装目录具有可写权限，否则安装将会出错。</strong></p>
<p>部署完成可看到如下信息:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hyperchain</span> <span class="n">has</span> <span class="n">been</span> <span class="n">successfully</span> <span class="n">installed</span> <span class="ow">in</span><span class="p">:</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">hyperchain</span>

<span class="n">Please</span> <span class="n">run</span> <span class="n">these</span> <span class="n">commands</span> <span class="n">to</span> <span class="n">start</span> <span class="n">hyperchain</span> <span class="n">process</span><span class="p">:</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">hyperchain</span>
<span class="o">./</span><span class="n">start</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>然后把之前申请的证书和license文件从本地机器复制到该节点的安装目录下（需要<strong>先退出用户登录在本地终端执行该命令</strong>，执行完毕后再登录）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#在本地解压证书文件</span>
<span class="c1">#根据具体情况替换证书文件名字</span>
<span class="n">unzip</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">31_06_43_59</span><span class="n">_allcerts</span><span class="o">.</span><span class="n">zip</span>
</pre></div>
</div>
<p>解压后的2019-10-31_06_43_59_allcerts文件夹里包含了一个README文件，请先仔细阅读该文件，并按照文件内容进行操作。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#上传LICENSE文件</span>
<span class="c1">#根据具体情况替换LICENSE文件的名字</span>
<span class="n">scp</span> <span class="n">license</span><span class="o">.</span><span class="n">zip</span> <span class="n">hyperchain</span><span class="nd">@node1</span><span class="p">:</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">hyperchain</span>
<span class="c1">#解压license文件</span>
<span class="n">unzip</span> <span class="n">xvf</span> <span class="n">license</span><span class="o">.</span><span class="n">zip</span>
<span class="c1">#解压出的license文件名可能不是LICENSE，需要重命名</span>
<span class="c1">#根据实际情况替换LICENSE_20191031文件的名字</span>
<span class="n">mv</span> <span class="n">LICENSE_20191031</span> <span class="n">LICENSE</span>
</pre></div>
</div>
</div></blockquote>
<p>最后，再执行以下命令，完成Hyperchain节点的安装:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">~/.</span><span class="n">bashrc</span>
</pre></div>
</div>
</div>
<div class="section" id="id22">
<h3>3.3 验证安装是否成功<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>在执行完步骤3.2后，需要验证一下节点是否已经正确安装。请执行以下命令做测试:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#/data/hyperchain为Hyperchain的目标安装目录，可根据实际情况做修改</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">hyperchain</span><span class="o">/</span>
<span class="o">./</span><span class="n">hyperchain</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<p>假如显示正确的版本信息，说明节点安装成功，示例如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./hyperchain --version
Hyperchain Commercial Version: v2.12.0
</pre></div>
</div>
<p>如果出现了以下报错信息，说明openssl的动态链接库没有安装成功</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">error</span> <span class="k">while</span> <span class="n">loading</span> <span class="n">shared</span> <span class="n">libraries</span><span class="p">:</span> <span class="n">libxxx</span><span class="o">.</span> <span class="n">so</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="nb">object</span> <span class="n">file</span><span class="p">:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span>
</pre></div>
</div>
</div></blockquote>
<p>需要向用户目录下的 <cite>.bashrc</cite> 文件添加一行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#添加一个环境变量LD_LIBRARY_PATH，根据实际情况修改/data/hyperchain路径</span>
<span class="n">echo</span> <span class="s1">&#39;export LD_LIBRARY_PATH=/data/hyperchain/tools/lib/&#39;</span> <span class="o">&gt;&gt;</span> <span class="o">~/.</span><span class="n">bashrc</span>
<span class="c1">#导出环境变量</span>
<span class="n">source</span> <span class="o">~/.</span><span class="n">bashrc</span>
</pre></div>
</div>
<p>在完成以上操作之后，再执行一次 <cite>./hyperchain –version</cite> ，应该就可以输出正常的版本信息了。</p>
<p>至此，node1服务器上的Hyperchain节点就算完成了。</p>
</div>
</div>
<div class="section" id="id23">
<h2>第四章 检查、修改配置文件<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<p>安装包中的配置文件只包含了最精简化的配置， <strong>安装包中的配置文件已经足够满足hyperchain的正常使用</strong> 。若您是第一次使用hyperchain，且希望更深入地使用hyperchain时，可以查阅相关功能的使用手册从而知晓配置文件的修改方法；若您以前已经部署过hyperchain的历史版本，那么仍可以沿用原先的全量配置文件，只不过需要参考《配置变更》对一些配置上的变化进行确认。</p>
<p><strong>注意，以下操作都是在Hyperchain的目标安装目录操作的，不是在原先未安装前的目录下操作。本例中，是在/data/hyperchain路径下检查、修改配置文件。</strong></p>
<p>安装包中的文件内容包括：</p>
<p><img alt="image2" src="../_images/Deployment2.png" /></p>
<div class="section" id="license">
<h3>4.1 检查LICENSE文件<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h3>
<p>由于LINCESE文件和Hyperchain安装包不是一起打包分发的，所以在启动节点前，需要检查一下LICENSE文件是否已经更新到正确版本。</p>
<p>LICENSE文件位于Hyperchain节点的根录下，文件名即LICENSE，如果不确定是否是最新版本，可以用原始的LICENSE文件再覆盖一遍。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#解压缩</span>
<span class="n">cd</span> <span class="o">~</span>
<span class="n">unzip</span> <span class="mi">07668027</span><span class="o">-</span><span class="mi">61</span><span class="n">cc</span><span class="o">-</span><span class="mi">4</span><span class="n">cf0</span><span class="o">-</span><span class="mi">950</span><span class="n">b</span><span class="o">-</span><span class="mi">0</span><span class="n">f8a59eaf7b6</span><span class="o">.</span><span class="n">zip</span>
<span class="c1">#解压出来后，LICENSE文件夹的名字可能是20220802@.LICENSE</span>
<span class="c1">#更新所有节点的LICENSE</span>
<span class="c1">#拷贝命令的目标文件名，必须是LICENSE，没有后缀</span>
<span class="n">cp</span> <span class="mi">20220802</span><span class="o">@.</span><span class="n">LICENSE</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">hyperchain</span><span class="o">/</span><span class="n">LICENSE</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>请依次检查4个节点的LICENSE文件。</strong></p>
</div>
<div class="section" id="vi">
<h3>4.2 vi编辑器使用方法<a class="headerlink" href="#vi" title="Permalink to this headline">¶</a></h3>
<p>下面的配置文件的编辑需要使用到vi文本编辑器，在此介绍vi的使用方法</p>
<p>1、使用vi命令加文件名对某个文件进行编辑，进入vi编辑文件的界面</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">anyFile</span><span class="o">.</span><span class="n">txtna</span>
</pre></div>
</div>
</div></blockquote>
<p>2、按下i键进入编辑模式，方向键控制光标移动</p>
<p>3、编辑完成后，按下Esc键进入命令模式，输入:wq保存修改并退出vi</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">:</span><span class="n">wq</span>
</pre></div>
</div>
</div></blockquote>
<p>4、若要放弃本次编辑，按下Esc键进入命令模式,输入:q!放弃修改并退出vi</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>:q!
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id24">
<h3>4.3 修改配置文件<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<div class="section" id="dynamic-toml">
<h4><strong>4.3.1 dynamic.toml</strong><a class="headerlink" href="#dynamic-toml" title="Permalink to this headline">¶</a></h4>
<p>编辑 <cite>dynamic.toml</cite></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">configuration</span><span class="o">/</span><span class="n">dynamic</span><span class="o">.</span><span class="n">toml</span>
</pre></div>
</div>
</div></blockquote>
<p>其内容如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span> <span class="o">=</span> <span class="s2">&quot;node1&quot;</span>

<span class="p">[</span><span class="n">port</span><span class="p">]</span>
<span class="n">jsonrpc</span>     <span class="o">=</span> <span class="mi">8081</span>
<span class="n">grpcApi</span>         <span class="o">=</span> <span class="mi">11001</span> <span class="c1">#rpc</span>
<span class="n">grpc</span>        <span class="o">=</span> <span class="mi">50011</span> <span class="c1"># p2p</span>
<span class="n">baas</span>        <span class="o">=</span> <span class="mi">12001</span>


<span class="p">[</span><span class="n">p2p</span><span class="p">]</span>
     <span class="p">[</span><span class="n">p2p</span><span class="o">.</span><span class="n">ip</span><span class="o">.</span><span class="n">self</span><span class="p">]</span>
        <span class="c1"># domain 用于指定本地节点目前处在的网络域名称，比如本地节点目前</span>
        <span class="c1"># 所处的域名称为“domain1”</span>
         <span class="n">domain</span> <span class="o">=</span> <span class="s2">&quot;domain1&quot;</span>

         <span class="c1"># addrs 用于指定本地节点网络可互通的网络域有哪些，并且指定了这些域</span>
        <span class="c1"># 下的节点应该使用哪个 IP 地址来连自己（即本地节点），这个 IP 地址可能为本地</span>
        <span class="c1"># 节点的 IP 地址，也可能是代理设备的地址</span>
        <span class="n">addrs</span> <span class="o">=</span> <span class="p">[</span>
             <span class="s2">&quot;domain1 127.0.0.1:50011&quot;</span><span class="p">,</span>
             <span class="s2">&quot;domain2 127.0.0.1:50011&quot;</span><span class="p">,</span>
             <span class="s2">&quot;domain3 127.0.0.1:50011&quot;</span><span class="p">,</span>
             <span class="s2">&quot;domain4 127.0.0.1:50011&quot;</span><span class="p">,</span>
         <span class="p">]</span>

<span class="p">[[</span><span class="n">namespace</span><span class="p">]]</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;global&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>修改port配置</strong></p></li>
</ul>
<p>内容为:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">port</span><span class="p">]</span>
<span class="n">jsonrpc</span>     <span class="o">=</span> <span class="mi">8081</span>
<span class="n">grpcApi</span>         <span class="o">=</span> <span class="mi">11001</span>
<span class="n">grpc</span>        <span class="o">=</span> <span class="mi">50011</span>
<span class="n">baas</span>        <span class="o">=</span> <span class="mi">12001</span>
</pre></div>
</div>
<p><strong>因为我们选择4服务器4节点模式，每个节点可以使用默认的port配置，但是为了介绍如何正确修改节点配置，这里还是区别一下各节点的端口，即1~4号节点分别使用为</strong> <cite>xxxx1~xxxx4</cite> <strong>号端口</strong></p>
<p>以2号节点为例，它的port内容如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">port</span><span class="p">]</span>
<span class="n">jsonrpc</span>     <span class="o">=</span> <span class="mi">8082</span>
<span class="n">grpcApi</span>         <span class="o">=</span> <span class="mi">11002</span>
<span class="n">grpc</span>        <span class="o">=</span> <span class="mi">50012</span>
<span class="n">baas</span>        <span class="o">=</span> <span class="mi">12002</span>
</pre></div>
</div>
<p>需要注意的是，在默认配置中除了1号节点不需要修改port配置，其他节点都要修改port配置。请依次配置剩余节点的port配置。</p>
<ul class="simple">
<li><p><strong>修改域配置</strong></p></li>
</ul>
<p>以下是详细的配置说明:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">p2p</span><span class="o">.</span><span class="n">ip</span><span class="o">.</span><span class="n">self</span><span class="p">]</span>
   <span class="c1"># 本节点所在域名的域名</span>
    <span class="n">domain</span> <span class="o">=</span> <span class="s2">&quot;domain1&quot;</span>
        <span class="c1"># 本节点在不同的域中的地址</span>
        <span class="c1"># 举例来说，如果节点2属于域`domain2`，那么节点2访问节点1时需要用节点1声明的在`domain2`域中对外暴露的地址，换句话说，节点2访问本节点时用的地址是`127.0.0.1:50012`。</span>
    <span class="n">addrs</span> <span class="o">=</span> <span class="p">[</span>
     <span class="s2">&quot;domain1 127.0.0.1:50012&quot;</span><span class="p">,</span>
     <span class="s2">&quot;domain2 127.0.0.1:50012&quot;</span><span class="p">,</span>
     <span class="s2">&quot;domain3 127.0.0.1:50012&quot;</span><span class="p">,</span>
     <span class="s2">&quot;domain4 127.0.0.1:50012&quot;</span><span class="p">,</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>这里是配置是比较容易出错的地方，最简单的配置方式就是：</p>
<ul class="simple">
<li><p>所有节点都只使用一个domain1：所有节点都在同一个内网环境，只要配置一个domain和该节点在这个domain里的IP地址</p></li>
</ul>
<p><strong>请按照上述内容格式，依次更新剩余节点的域配置。</strong></p>
<p><strong>更复杂的网络环境下：</strong></p>
<p>在一些加入了类似Nginx代理的网络中，这个文件的配置极其容易出错，一般可以这样理解，服务器node1在domain1中有自己的 <cite>node1_domain1_ip</cite> ；但是在domain2中它的 <cite>node1_domain2_ip</cite> ，是它在domain2中 <cite>最内层的一个Nginx代理上，所分配的服务器node1转发地址</cite> ，domain2中其他的服务器node2、node3是通过连接最内层的Nginx上的 <cite>node1_domain2_ip</cite> 访问处于外部的node1服务器的。所以domain2中最内层Nginx上的 <cite>node1_domain2_ip</cite> ，就是node1服务器dymanic.toml中，该填的 <cite>domain2 node1_domain2_ip</cite> 地址。</p>
</div>
<div class="section" id="ns-dynamic-toml">
<h4>4.3.2 ns_dynamic.toml<a class="headerlink" href="#ns-dynamic-toml" title="Permalink to this headline">¶</a></h4>
<p>编辑 <cite>ns_dynamic.toml</cite></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="n">configuration</span><span class="o">/</span><span class="k">global</span><span class="o">/</span><span class="n">ns_dynamic</span><span class="o">.</span><span class="n">toml</span>
</pre></div>
</div>
</div></blockquote>
<p>其内容如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">consensus</span><span class="p">]</span>
<span class="n">algo</span> <span class="o">=</span> <span class="s2">&quot;RBFT&quot;</span>

<span class="p">[</span><span class="bp">self</span><span class="p">]</span>
<span class="n">n</span>           <span class="o">=</span> <span class="mi">4</span>         <span class="c1"># 运行时修改。表示所连vp节点的个数，该值在网络中有节点加入或退出时会实时变化。</span>
<span class="n">hostname</span>    <span class="o">=</span> <span class="s2">&quot;node1&quot;</span>   <span class="c1"># 本地节点的hostname</span>
<span class="n">new</span>         <span class="o">=</span> <span class="n">false</span>     <span class="c1"># 运行时修改。新节点成功加入网络以后，该值会从true变为false。</span>

<span class="p">[[</span><span class="n">nodes</span><span class="p">]]</span>
<span class="n">hostname</span>    <span class="o">=</span> <span class="s2">&quot;node1&quot;</span>

<span class="p">[[</span><span class="n">nodes</span><span class="p">]]</span>
<span class="n">hostname</span>    <span class="o">=</span> <span class="s2">&quot;node2&quot;</span>

<span class="p">[[</span><span class="n">nodes</span><span class="p">]]</span>
<span class="n">hostname</span>    <span class="o">=</span> <span class="s2">&quot;node3&quot;</span>

<span class="p">[[</span><span class="n">nodes</span><span class="p">]]</span>
<span class="n">hostname</span>    <span class="o">=</span> <span class="s2">&quot;node4&quot;</span>

<span class="n">trustNodes</span> <span class="o">=</span> <span class="n">false</span> <span class="c1">#运行时修改。节点成功加入共识以后，该值会变为false。当需要信任配置当nodes列表时，将此值配为true</span>

<span class="p">[</span><span class="n">p2p</span><span class="p">]</span>
        <span class="p">[</span><span class="n">p2p</span><span class="o">.</span><span class="n">ip</span><span class="o">.</span><span class="n">remote</span><span class="p">]</span>
               <span class="c1"># hosts 用于指定本地节点启动后要向哪些节点发起连接，并且指定了通往</span>
               <span class="c1"># 这些节点的可连通地址，这个地址可能是对端节点的 IP 地址，也可能是</span>
               <span class="c1"># 代理设备的地址。</span>
               <span class="c1"># 如果该列表里指定了本地节点自己的hostname和地址，则自动忽略该项。</span>
                <span class="n">hosts</span> <span class="o">=</span> <span class="p">[</span>
                 <span class="s2">&quot;node1 127.0.0.1:50011&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;node2 127.0.0.1:50012&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;node3 127.0.0.1:50013&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;node4 127.0.0.1:50014&quot;</span><span class="p">,</span>
            <span class="p">]</span>
</pre></div>
</div>
<p>其中需要注意 <cite>[[nodes]]</cite> 配置，本次部署时部署多少个VP节点，就加入多少个 <cite>[[nodes]]</cite> 部分:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">nodes</span><span class="p">]]</span>
  <span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;node4&quot;</span>
</pre></div>
</div>
<p><strong>上面的</strong> <cite>hostname</cite> <strong>必须要与</strong> <cite>dynamic.toml</cite> <strong>文件中的self 配置中保持一致；</strong></p>
<p>在 <cite>self</cite>  <strong>部分需要注意的几个配置项以及配置解释</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="bp">self</span><span class="p">]</span>
<span class="n">n</span>         <span class="o">=</span> <span class="mi">4</span>           <span class="c1"># 运行时修改。表示所连vp节点的个数，该值在有节点新增或退出时实时变化。</span>
<span class="n">hostname</span>    <span class="o">=</span> <span class="s2">&quot;node1&quot;</span>
<span class="n">new</span>         <span class="o">=</span> <span class="n">false</span>     <span class="c1"># 运行时修改。新节点成功加入网络以后，该值会从true变为false。</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>修改host配置</strong></p></li>
</ul>
<p>内容为:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">p2p</span><span class="o">.</span><span class="n">ip</span><span class="o">.</span><span class="n">remote</span><span class="p">]</span>
<span class="n">hosts</span> <span class="o">=</span> <span class="p">[</span>
 <span class="s2">&quot;node1 127.0.0.1:50011&quot;</span><span class="p">,</span>
 <span class="s2">&quot;node2 127.0.0.1:50012&quot;</span><span class="p">,</span>
 <span class="s2">&quot;node3 127.0.0.1:50013&quot;</span><span class="p">,</span>
 <span class="s2">&quot;node4 127.0.0.1:50014&quot;</span><span class="p">,</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>配置规则很简单： <cite>hostname ip_address:port</cite> 将所有的节点的节点名称和IP地址端口配置好即可（port为节点间通讯的端口）。</p>
<p>修改方法为：</p>
<ul class="simple">
<li><p>将每行的 <cite>127.0.0.1</cite> 替换为4台服务器各自的IP地址</p></li>
<li><p>将每行的 <cite>5001x</cite> 端口换成每个Hyperchain节点自己的grpc端口</p></li>
</ul>
<p><strong>因为我们选择单服务器单节点模式，实际上每个节点可以使用默认的50011端口，但是为了介绍如何正确修改节点配置，这里还是将grpc端口定为</strong> <cite>50011~50014</cite></p>
<p>以服务器IP <cite>10.10.10.1~10.10.10.4</cite> 为例，将hosts.toml文件修改为类似以下的内容:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hosts</span> <span class="o">=</span> <span class="p">[</span>
<span class="s2">&quot;node1 10.10.10.1:50011&quot;</span><span class="p">,</span>
<span class="s2">&quot;node2 10.10.10.2:50012&quot;</span><span class="p">,</span>
<span class="s2">&quot;node3 10.10.10.3:50013&quot;</span><span class="p">,</span>
<span class="s2">&quot;node4 10.10.10.4:50014&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>需要注意的是，在同一个网络域中，4个节点的hosts配置都是一致的，请依次配置。</p>
<p><strong>需要注意的是，本例中除了1号节点不需要修改ns_dynamic.toml，其他节点都要修改配置。请依次配置剩余节点的ns_dynamic.toml文件。</strong></p>
</div>
<div class="section" id="id25">
<h4>4.3.3 跨域网络<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<p>跨域网络相关内容请查阅 <strong>《跨域网络使用手册》</strong></p>
</div>
</div>
<div class="section" id="ns-genesis-toml">
<h3>4.4 修改配置文件ns_genesis.toml<a class="headerlink" href="#ns-genesis-toml" title="Permalink to this headline">¶</a></h3>
<div class="section" id="genesis">
<h4>4.4.1 [genesis]模块说明：<a class="headerlink" href="#genesis" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><cite>[genesis]</cite> <strong>配置的是ca证书信息</strong></p>
<ul>
<li><p><cite>ca_mode</cite> <strong>ca模式，配置后不支持修改。支持的ca模式有：中心化ca，即Center，也叫非分布式ca；分布式ca，即Distributed；无ca，即none。</strong></p></li>
<li><p><cite>root_ca</cite> <strong>当ca模式为中心化ca，即Center时，需要配置中心化ca使用的rootca，即root.cert的内容，其他模式下无需配置。</strong></p></li>
</ul>
</li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">genesis</span><span class="p">]</span>  <span class="c1">#以下仅为格式范例，直接使用会导致节点启动失败</span>
<span class="n">ca_mode</span> <span class="o">=</span> <span class="s2">&quot;Center&quot;</span>
<span class="n">root_ca</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
<span class="s2">MIICODCCAeSgAwIBAgIBATAKBggqhkjOPQQDAjB0MQkwBwYDVQQIEwAxCTAHBgNV</span>
<span class="s2">BAcTADEJMAcGA1UECRMAMQkwBwYDVQQREwAxDjAMBgNVBAoTBWZsYXRvMQkwBwYD</span>
<span class="s2">VQQqEwVlY2VydDBWMBAGByqGSM49AgEGBSuBBAAKA0IABDoBjgQsvY4xhyIy3aWh</span>
<span class="s2">4HLOTTY6te1VbmZaH5EZnKzqjU1f436bVsfi9HLE3/MCeZD6ISe1U5giM5NuwF6T</span>
<span class="s2">ZEOjaDBmMA4GA1UdDwEB/wQEAwIChDAmBgNVHSUEHzAdBggrBgEFBQcDAgYIKwYB</span>
<span class="s2">BQUHAwEGAioDBgOBCwEwDwYDVR0TAQH/BAUwAwEB/zANBgNVHQ4EBgQEAQIDBDAM</span>
<span class="s2">VQQLEwAxDjAMBgNVBAMTBW5vZGUxMQswCQYDVQQGEwJaSDEOMAwGA1UEKhMFZWNl</span>
<span class="s2">cnQwIBcNMjAwNTIxMDQyNTQ0WhgPMjEyMDA0MjcwNTI1NDRaMHQxCTAHBgNVBAgT</span>
<span class="s2">ADEJMAcGA1UEBxMAMQkwBwYDVQQJEwAxCTAHBgNVBBETADEOMAwGA1UEChMFZmxh</span>
<span class="s2">dG8xCTAHBgNVBAsTADEOMAwGA1UEAxMFbm9kZTExCzAJBgNVBAYTAlpIMQ4wDAYD</span>
<span class="s2">BgMqVgEEBWVjZXJ0MAoGCCqGSM49BAMCA0IAuVuDqguvjPPveimWruESBYqMJ1qq</span>
<span class="s2">ryhXiMhlYwzH1FgUz0TcayuY+4KebRhFhb14ZDXBBPXcn9CYdtbbSxXTogE=</span>
<span class="s2">-----END CERTIFICATE-----</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="genesis-alloc">
<h4>4.4.2 [genesis.alloc] 模块说明：<a class="headerlink" href="#genesis-alloc" title="Permalink to this headline">¶</a></h4>
<p>在ns_genesis.toml文件中需要配置创世账户以及创世节点，里面没有默认配置，可自行安装当前链的实际情况进行配置。</p>
<ul class="simple">
<li><p><cite>[genesis.alloc]</cite> 配置的是创世账户的 <strong>address</strong> ，这些账户及其对应的余额会在区块链启动时被创建</p></li>
<li><p>链启动时，会将带ns_genesis.toml配置文件中，有余额的账户初始化为链级管理员和合约管理员；链启动后（初始化完成后），只能通过提案管理链级角色，为其他账户授权或回收角色，其他账户有了余额也不会再被初始化为具有角色的账户</p></li>
<li><p><strong>示例如下，要注意的是，以下例子中的账户，它们的私钥并不会对外暴露，因此请您自行创建创世账户，配置相应的address，并妥善保管账户私钥（账户可通过sdk生成）</strong></p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">genesis</span><span class="o">.</span><span class="n">alloc</span><span class="p">]</span> <span class="c1"># 若需要配置多个账户，按以下格式新增即可，数量至少一个</span>
<span class="s2">&quot;0x856e2b9a5fa82fd1b031d1ff6863864dbac7995d&quot;</span> <span class="o">=</span> <span class="s2">&quot;1000000000&quot;</span>
<span class="s2">&quot;0xb18c8575e3284e79b92100025a31378feb8100d6&quot;</span> <span class="o">=</span> <span class="s2">&quot;1000000000&quot;</span>
<span class="s2">&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;</span> <span class="o">=</span> <span class="s2">&quot;1000000000&quot;</span>
<span class="s2">&quot;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&quot;</span> <span class="o">=</span> <span class="s2">&quot;1000000000&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>litesdk</strong> 创建账户举例说明</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">accountService</span><span class="o">.</span><span class="n">genAccount</span><span class="p">(</span><span class="n">Algo</span><span class="o">.</span><span class="n">SMRAW</span><span class="p">);</span>
<span class="c1">#更多加密方式详见litesdk使用手册</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>gosdk</strong> 创建账户举例说明</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ac</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountJson</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">ECDES</span><span class="p">,</span> <span class="s2">&quot;123&quot;</span><span class="p">)</span>
<span class="c1">#更多加密方式详见gosdk使用手册</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="genesis-nodes">
<h4>4.4.3 [[genesis.nodes]] 模块说明：<a class="headerlink" href="#genesis-nodes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><cite>[[genesis.nodes]]</cite> 配置的是创世节点相关的信息</p>
<ul>
<li><p><cite>genesisNode</cite> 是创世节点的名称（hostname），</p></li>
<li><p><cite>certContent</cite>
是此节点的证书信息，可以是本节点的cert证书，也可以是其他节点颁发给本节点的证书(如果是通过OA申请的证书,会是hyperchain2.0目录下对应节点的certs/node$i.cert的内容)</p></li>
<li><p>有多少个创世节点就加多少个对应的 <cite>[[genesis.nodes]]</cite> 配置</p></li>
</ul>
</li>
</ul>
<p><strong>注：</strong>需要确保每个节点启动时，ns_genesis.toml配置相同。</p>
<p>示例如下：</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[</span><span class="nv">genesis</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">ca_mode = &quot;Center&quot;</span> <span class="c1"># ca模式，配置后不支持修改。支持的ca模式有：中心化ca，即Center；分布式ca，即Distributed；无ca，即none</span>
<span class="l l-Scalar l-Scalar-Plain">root_ca = [&quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">-----END CERTIFICATE-----</span>
<span class="l l-Scalar l-Scalar-Plain">&quot;&quot;&quot;]</span> <span class="c1"># 当ca模式问中心化ca，即Center时，需要配置中心化ca使用的root ca，其他模式下无需配置</span>


<span class="p p-Indicator">[</span><span class="nv">genesis.alloc</span><span class="p p-Indicator">]</span> <span class="c1"># 创世账户，用户需用自己生成的账户地址替换创世账户地址，后续妥善保管这些账户的私钥</span>
<span class="s">&quot;0x856e2b9a5fa82fd1b031d1ff6863864dbac7995d&quot;</span> <span class="l l-Scalar l-Scalar-Plain">= &quot;1000000000&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">&quot;0xb18c8575e3284e79b92100025a31378feb8100d6&quot; = &quot;1000000000&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">[[genesis.nodes]]</span> <span class="c1"># 创世节点列表</span>
<span class="l l-Scalar l-Scalar-Plain">genesisNode = &quot;node1&quot;</span> <span class="c1"># 创世节点名称，与hostname对应</span>
<span class="l l-Scalar l-Scalar-Plain">certContent = &quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>  <span class="c1">#注意。此处必须有3个&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">-----END CERTIFICATE-----&quot;&quot;&quot;</span> <span class="c1"># 创世节点证书，即此节点的ecert，注意。此处必须有3个&quot;</span>

<span class="p p-Indicator">[[</span><span class="nv">genesis.nodes</span><span class="p p-Indicator">]]</span>
<span class="l l-Scalar l-Scalar-Plain">genesisNode = &quot;node2&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">certContent = &quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">-----END CERTIFICATE-----&quot;&quot;&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">[[genesis.nodes]]</span>
<span class="l l-Scalar l-Scalar-Plain">genesisNode = &quot;node3&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">certContent = &quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">-----END CERTIFICATE-----&quot;&quot;&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">[[genesis.nodes]]</span>
<span class="l l-Scalar l-Scalar-Plain">genesisNode = &quot;node4&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">certContent = &quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">XXXXX</span>
<span class="l l-Scalar l-Scalar-Plain">-----END CERTIFICATE-----&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>也可以使用以下脚本助你生成 <strong>ns_genesis.toml配置文件</strong></p>
<p><a class="reference external" href="https://upload.filoop.com/RTD-Hyperchain%2Fstructure_genesis.sh">allcerts.zip</a></p>
<p>将脚本和oa上下载的证书压缩包（<em>allcerts.zip结尾的压缩包）放在同一个目录下，依次执行以下命令，脚本会生成一份完整的 **ns_genesis.toml*</em></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sudo yum insstall -y unzip

bash  structure_genesis.sh
</pre></div>
</div>
</div>
<div class="section" id="id26">
<h4>4.4.4注意事项<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p><strong>需要确保每个节点启动时，ns_genesis.toml配置相同（包括新增的节点,nvp,lp,cvp）</strong></p></li>
<li><p><strong>ns_genesis.toml配置文件只在首次部署时需要编辑，后续任何场景下都不再变动</strong></p></li>
<li><p><strong>部署时请不要使用示例中的配置</strong></p></li>
</ol>
</div>
</div>
<div class="section" id="id27">
<h3>4.5 证书配置<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ca">
<h4>4.5.1 非分布式CA证书配置<a class="headerlink" href="#ca" title="Permalink to this headline">¶</a></h4>
<p>证书部署完成后请将root.priv单独保存，不要放在ca目录中，避免安全问题</p>
<p>证书是和节点绑定的，因为证书中写入了hostname的信息，因此node1的证书拷贝到node2是不能正常工作的</p>
<p>当 <cite>genesis.ca_mode</cite> 配置为 <cite>Center</cite>
时，表示使用中心ca，即非分布式ca。此时，需要将下载的ca目录下的root.ca的文件内容配置到 <cite>genesis.root_ca</cite>
这个配置项中。</p>
<p>在OA上下载的V1.7+证书套件解压后会看到ca、hyperchain1.0、hyperchain2.0三个目录，详细使用可见README.md。 <strong>注意下载时需要指明节点对应的节点名称（hostname），名称应该和稍后部署时填写的节点名称一致。</strong></p>
<p>其中hyperchain2.0目录里的证书套件用来部署hyperchain2.7.0，打开hyperchain2.0目录后可以看到一系列node目录，如下图所示。</p>
<p><img alt="image3" src="../_images/Deployment3.png" /></p>
<p>以节点1为例，部署时直接<strong>将证书套件里node1目录下的CA、certs目录（如下图）放到./namespaces/global/certs/目录下</strong>即可。将tls目录下的tlsca.ca
、tls_peer.cert、tls_peer.priv放到hyperchain项目node1的./tls目录下即可，tls相关的配置在system.toml的http.security配置项下。sdkcerts目录下的文件用于sdk平台使用，使用时替换sdk中对应的文件即可，详细使用可以查看Gosdk接口使用文档或Litesdk接口使用文档。</p>
<p><img alt="image4" src="../_images/Deployment4.png" /></p>
<p>注意事项：</p>
<ul class="simple">
<li><p>如果发生找不到证书这类错误，请修改./configuration/global/ns_static.toml文件中添加</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[encryption.root]
ca    = &quot;certs/CA&quot;

[encryption.ecert]
ecert  = &quot;certs/certs&quot;
</pre></div>
</div>
<ul class="simple">
<li><p>如果节点启动报错<strong>“the searched certificate configuration item does
not match hostname : need hostname1, but
hostname2”</strong>此类的错误，请检查（可通过certgen工具）证书生成时是否有误。在OA上申请SDKCERT,ECERT时，节点名称（域名）一栏需要填写每个节点对应的hostname，如下图：</p></li>
</ul>
<p><img alt="image5" src="../_images/Deployment5.png" /></p>
</div>
<div class="section" id="id28">
<h4>4.5.2 分布式CA证书配置<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<p>当<code class="docutils literal notranslate"><span class="pre">genesis.ca_mode</span></code> 配置为<code class="docutils literal notranslate"><span class="pre">Distributed</span></code>
时，表示使用分布式ca。分布式ca模式下不需要配置<code class="docutils literal notranslate"><span class="pre">genesis.root_ca</span></code> 。</p>
<p>目前分布式CA的证书能够通过certgen生成或INFO进行下载，证书放置路径和非分布式CA相同。</p>
<p>通过OA下载分布式CA证书需要选择“分布式CA”选项：</p>
<p><img alt="image6" src="../_images/Deployment6.png" /></p>
<p>通过certgen生成的方式需要借助于如下脚本：</p>
<p><a class="reference external" href="https://upload.filoop.com/RTD-Hyperchain%2Fgencert.sh">gencert.sh</a></p>
<p>下载完成后将其放到和可执行 certgen 二进制文件同一目录下，输入</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./gencert.sh
</pre></div>
</div>
<p>指令运行，按照提示输入相关内容即可完成证书的创建。</p>
<p>该shell脚本是通过调用certgen相关指令来完成创建证书的操作的，能够让操作者选择生成分布式CA或者非分布式CA的证书。无论是分布式CA还是非分布式CA都会选择是否生成国密自签证书和国密公私钥，需要说明的是，选择了生成国密自签证书会自动生成国密公私钥对，选择生成非国密自签证书会生成非国密公私钥对，两者需要配套。</p>
<p>对于分布式CA来说，该脚本默认生成4个CA，需要按照提示输入CA相关信息；并默认生成4个节点的证书，生成顺序为：</p>
<ul class="simple">
<li><p>node1需要生成node2.cert(root2颁发), node3.cert(root3颁发),
node4.cert(root4颁发);</p></li>
<li><p>node2需要生成node1.cert(root1颁发),node3.cert, node4.cert;</p></li>
<li><p>node3需要生成node1.cert, node2.cert, node4.cert;</p></li>
<li><p>node4需要生成node1.cert, node2.cert, node3.cert;</p></li>
</ul>
<p>其中CA1与node1对应按照提示输入信息即可。</p>
<p>对于非分布式CA来说，默认生成一个CA，输入CA相关信息后会提示输入要生成的节点证书的数量，例如如果有5个节点需要生成证书，输入5，然后根据提示输入相关信息即可。</p>
</div>
<div class="section" id="solo">
<h4>4.5.3 SOLO模式的证书说明<a class="headerlink" href="#solo" title="Permalink to this headline">¶</a></h4>
<p>共识算法配置为solo的情况下启动hyperchain时，hyperchain单节点运行的模式称为solo模式。solo模式仅用于单节点功能的演示或者测试，不需要节点间的链接，因而我们不需要额外的证书配置。</p>
<p>当ns_dynamic.toml的[consensus.algo]配置为“SOLO”时，节点工作于solo模式。节点不需要任何证书的配置，故 <cite>genesis.ca_mode</cite>
需要配置为 <cite>None</cite> ，即无ca模式。</p>
</div>
<div class="section" id="id29">
<h4>4.5.4不启用证书功能<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<p>当用户对区块链安全有较高要求时（例如有信息安全等级保护要求时）可能选择使用外部的硬件SSL
VPN网关来保证准入控制和链路安全，这时可以手动关闭准入控制功能。方法是手动将ns_static.toml中的 <strong>[encryption.check.enableT]</strong> 设置为false，且ns_genesis.toml中的 <cite>genesis.ca_mode</cite>
配置为 <cite>None</cite> 。这种情况下节点不需要配置任何证书即可启动。</p>
<p>ns_static.toml:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[encryption.check]
enableT    = false  #enable TCert
</pre></div>
</div>
<p>ns_genesis.toml:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[</span><span class="nv">genesis</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">ca_mode = &quot;None&quot;</span>
</pre></div>
</div>
<p>这时节点关闭准入控制功能，但是仍然会启用链路加密。可以同将 <strong>[encryption.security.algo]</strong> 设置为pure关闭链路加密功能（默认为sm4加密保护）。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[encryption.security]
algo   = &quot;pure&quot;
</pre></div>
</div>
<p>请 <strong>注意</strong> 这种情况下 <strong>请务必采取必要的外部措施保护区块链网络安全</strong> 。</p>
</div>
</div>
<div class="section" id="id30">
<h3>4.6 检查配置文件<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<p>假设服务器IP地址为 <cite>10.10.10.1~10.10.10.4</cite> ，各自使用的端口是 <cite>xxxx1~xxxx4</cite> ，以下是配置文件更新后的样例。</p>
<div class="section" id="id31">
<h4>4.6.1 各节点dynamic.toml<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<p>1号节点：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">self</span> <span class="o">=</span> <span class="s2">&quot;node1&quot;</span>

<span class="p">[</span><span class="nx">port</span><span class="p">]</span>
<span class="nx">jsonrpc</span>     <span class="o">=</span> <span class="mf">8081</span>
<span class="nx">grpc</span>        <span class="o">=</span> <span class="mf">50011</span>
<span class="nx">baas</span>        <span class="o">=</span> <span class="mf">12001</span>
<span class="nx">grpcApi</span>      <span class="o">=</span> <span class="mf">11001</span>


<span class="p">[</span><span class="nx">p2p</span><span class="p">]</span>

     <span class="p">[</span><span class="nx">p2p</span><span class="p">.</span><span class="nx">ip</span><span class="p">.</span><span class="nx">self</span><span class="p">]</span>
         <span class="nx">domain</span> <span class="o">=</span> <span class="s2">&quot;domain1&quot;</span>

         <span class="nx">addrs</span> <span class="o">=</span> <span class="p">[</span>
                  <span class="s2">&quot;domain1 10.10.10.1:50011cd glo&quot;</span><span class="p">,</span>
         <span class="p">]</span>

<span class="p">[[</span><span class="nx">namespace</span><span class="p">]]</span>
    <span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;global&quot;</span>
     <span class="nx">start</span> <span class="o">=</span> <span class="kc">true</span>
</pre></div>
</div>
<p>2号节点：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">self</span> <span class="o">=</span> <span class="s2">&quot;node2&quot;</span>

<span class="p">[</span><span class="nx">port</span><span class="p">]</span>
<span class="nx">jsonrpc</span>     <span class="o">=</span> <span class="mf">8082</span>
<span class="nx">grpc</span>        <span class="o">=</span> <span class="mf">50012</span>
<span class="nx">baas</span>        <span class="o">=</span> <span class="mf">12002</span>
<span class="nx">grpcApi</span>      <span class="o">=</span> <span class="mf">11002</span>

<span class="p">[</span><span class="nx">p2p</span><span class="p">]</span>

     <span class="p">[</span><span class="nx">p2p</span><span class="p">.</span><span class="nx">ip</span><span class="p">.</span><span class="nx">self</span><span class="p">]</span>
         <span class="nx">domain</span> <span class="o">=</span> <span class="s2">&quot;domain1&quot;</span>

         <span class="nx">addrs</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s2">&quot;domain1 10.10.10.2:50012&quot;</span><span class="p">,</span>
         <span class="p">]</span>

<span class="p">[[</span><span class="nx">namespace</span><span class="p">]]</span>
    <span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;global&quot;</span>
     <span class="nx">start</span> <span class="o">=</span> <span class="kc">true</span>
</pre></div>
</div>
<p>3号节点：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">self</span> <span class="o">=</span> <span class="s2">&quot;node3&quot;</span>

<span class="p">[</span><span class="nx">port</span><span class="p">]</span>
<span class="nx">jsonrpc</span>     <span class="o">=</span> <span class="mf">8083</span>
<span class="nx">grpc</span>        <span class="o">=</span> <span class="mf">50013</span>
<span class="nx">baas</span>        <span class="o">=</span> <span class="mf">12003</span>
<span class="nx">grpcApi</span>      <span class="o">=</span> <span class="mf">11003</span>

<span class="p">[</span><span class="nx">p2p</span><span class="p">]</span>

     <span class="p">[</span><span class="nx">p2p</span><span class="p">.</span><span class="nx">ip</span><span class="p">.</span><span class="nx">self</span><span class="p">]</span>
         <span class="nx">domain</span> <span class="o">=</span> <span class="s2">&quot;domain1&quot;</span>

         <span class="nx">addrs</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s2">&quot;domain1 10.10.10.3:50013&quot;</span><span class="p">,</span>
         <span class="p">]</span>

<span class="p">[[</span><span class="nx">namespace</span><span class="p">]]</span>
    <span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;global&quot;</span>
     <span class="nx">start</span> <span class="o">=</span> <span class="kc">true</span>
</pre></div>
</div>
<p>4号节点：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">self</span> <span class="o">=</span> <span class="s2">&quot;node4&quot;</span>

<span class="p">[</span><span class="nx">port</span><span class="p">]</span>
<span class="nx">jsonrpc</span>     <span class="o">=</span> <span class="mf">8084</span>
<span class="nx">grpc</span>        <span class="o">=</span> <span class="mf">50014</span>
<span class="nx">baas</span>        <span class="o">=</span> <span class="mf">12004</span>
<span class="nx">grpcApi</span>      <span class="o">=</span> <span class="mf">11004</span>

<span class="p">[</span><span class="nx">p2p</span><span class="p">]</span>

     <span class="p">[</span><span class="nx">p2p</span><span class="p">.</span><span class="nx">ip</span><span class="p">.</span><span class="nx">self</span><span class="p">]</span>
         <span class="nx">domain</span> <span class="o">=</span> <span class="s2">&quot;domain1&quot;</span>

         <span class="nx">addrs</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s2">&quot;domain1 10.10.10.4:50014&quot;</span><span class="p">,</span>
         <span class="p">]</span>

<span class="p">[[</span><span class="nx">namespace</span><span class="p">]]</span>
    <span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;global&quot;</span>
     <span class="nx">start</span> <span class="o">=</span> <span class="kc">true</span>
</pre></div>
</div>
</div>
<div class="section" id="id32">
<h4>4.5.2 各节点ns_dynamic.toml<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h4>
<p>1号节点：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>[consensus]
algo = &quot;RBFT&quot;

[self]
n         = 4
hostname    = &quot;node1&quot;
new         = false

[[nodes]]
hostname    = &quot;node1&quot;

[[nodes]]
hostname    = &quot;node2&quot;

[[nodes]]
hostname    = &quot;node3&quot;

[[nodes]]
hostname    = &quot;node4&quot;

[p2p]
        [p2p.ip.remote]
                # this node will connect to those peer, if here has self hostname, we will ignore it
                hosts = [
                 &quot;node2 10.10.10.2:50012&quot;,
                 &quot;node3 10.10.10.3:50013&quot;,
                 &quot;node4 10.10.10.4:50014&quot;,
            ]
</pre></div>
</div>
<p>2号节点：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>[consensus]
algo = &quot;RBFT&quot;

[self]
n         = 4
hostname    = &quot;node2&quot;
new         = false

[[nodes]]
hostname    = &quot;node1&quot;

[[nodes]]
hostname    = &quot;node2&quot;

[[nodes]]
hostname    = &quot;node3&quot;

[[nodes]]
hostname    = &quot;node4&quot;

[p2p]
        [p2p.ip.remote]
                # this node will connect to those peer, if here has self hostname, we will ignore it
                hosts = [
                 &quot;node1 10.10.10.1:50011&quot;,
                 &quot;node3 10.10.10.3:50013&quot;,
                 &quot;node4 10.10.10.4:50014&quot;,
            ]
</pre></div>
</div>
<p>3号节点：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>[consensus]
algo = &quot;RBFT&quot;

[self]
n         = 4
hostname    = &quot;node3&quot;
new         = false

[[nodes]]
hostname    = &quot;node1&quot;

[[nodes]]
hostname    = &quot;node2&quot;

[[nodes]]
hostname    = &quot;node3&quot;

[[nodes]]
hostname    = &quot;node4&quot;

[p2p]
        [p2p.ip.remote]
                # this node will connect to those peer, if here has self hostname, we will ignore it
                hosts = [
                 &quot;node1 10.10.10.1:50011&quot;,
                 &quot;node2 10.10.10.2:50012&quot;,
                 &quot;node4 10.10.10.4:50014&quot;,
            ]
</pre></div>
</div>
<p>4号节点：</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>[consensus]
algo = &quot;RBFT&quot;

[self]
n         = 4
hostname    = &quot;node4&quot;
new         = false

[[nodes]]
hostname    = &quot;node1&quot;

[[nodes]]
hostname    = &quot;node2&quot;

[[nodes]]
hostname    = &quot;node3&quot;

[[nodes]]
hostname    = &quot;node4&quot;

[p2p]
        [p2p.ip.remote]
                # this node will connect to those peer, if here has self hostname, we will ignore it
                hosts = [
                 &quot;node1 10.10.10.1:50011&quot;,
                 &quot;node2 10.10.10.2:50012&quot;,
                 &quot;node3 10.10.10.3:50013&quot;,
            ]
</pre></div>
</div>
</div>
</div>
<div class="section" id="id33">
<h3>4.7证书检查<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<p>4.7.1非分布式证书检查</p>
<p>./namespaces/global/certs/目录下文件</p>
<p><img alt="image7" src="../_images/Deployment7.png" /></p>
<p>./tls/目录下文件</p>
<p><img alt="image8" src="../_images/Deployment8.png" /></p>
</div>
</div>
<div class="section" id="id34">
<h2>第五章 启动节点<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id35">
<h3>5.1 保存配置<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h3>
<p>在启动节点前，备份整个/data/hyperchain目录，主要是dynamic.toml和ns_dynamic.toml需要备份。</p>
<p>备份方法如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#根据实际情况修改/data/hyperchain</span>
<span class="nb">cd</span> /data/hyperchain/. ./
tar zcvf ~/hyperchain-backup.tar.gz hyperchain
</pre></div>
</div>
<p><strong>请依次备份4个节点的Hyperchain目标安装目录，本例中就是</strong> <cite>/data/hyperchain</cite> <strong>目录。</strong></p>
</div>
<div class="section" id="id36">
<h3>5.2 启动节点<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p>启动请再按照步骤 <cite>3.3</cite> 检查一次hyperchain二进制程序能否正常执行。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#根据实际情况修改/data/hyperchain</span>
<span class="nb">cd</span> /data/hyperchain/
./hyperchain --version
</pre></div>
</div>
<p>检查完毕后，使用 <cite>start.sh</cite> 启动hyperchain进程:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#根据实际情况修改/data/hyperchain</span>
<span class="nb">cd</span> /data/hyperchain
./start.sh
<span class="c1">#或者如果上面命令失败，尝试下面这个命令，待服务正常后，再使用脚本重启</span>
./hyperchain
</pre></div>
</div>
<p><strong>依次启动4台服务器上的hyperchain进程。</strong></p>
</div>
<div class="section" id="id37">
<h3>5.3 查看日志<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<p>查看hyperchain的日志，查看运行情况。</p>
<p>System级别日志的路径默认为：</p>
<p><cite>/data/hyperchain/system/logs</cite></p>
<p>Namespace级别日志的路径默认(以global为例)：</p>
<p><cite>/data/hyperchain/namespaces/global/data/logsls</cite></p>
<p>若Namespace级别日志显示如下信息，即表示节点正常加入共识网络，hyperchain平台部署启动完成。</p>
<p><img alt="image9" src="../_images/Deployment9.png" /></p>
<p><strong>请依次检查4台服务器上的Hyperchain日志。</strong></p>
</div>
<div class="section" id="id38">
<h3>5.4 停止节点<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h3>
<p>停止某个节点的hyperchain，执行步骤如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /data/hyperchain
./stop.sh
<span class="c1">#或者如果上面命令失败，尝试直接kill进程</span>
</pre></div>
</div>
</div>
<div class="section" id="id39">
<h3>5.5 重启节点<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h3>
<p>重启某个节点的hyperchain，执行步骤如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /data/hyperchain
./restart.sh
<span class="c1">#或者如果上面命令失败，则先stop后start</span>
</pre></div>
</div>
</div>
<div class="section" id="id40">
<h3>5.6 失败恢复<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h3>
<p>若启动失败，需要使用5.1小节当中的备份进行失败恢复</p>
<p>将/data/hyperchain中的dynamic.toml和ns_dynamic.toml两个配置文件替换为备份中的相应配置文件</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>tar xvf ~/hyperchain-backup.tar.gz ~/
cp ~/hyperchain/configuration/dynamic.toml /data/hyperchain/configuration/dynamic.toml
cp ~/hyperchain/configuration/global/ns_dynamic.toml /data/hyperchain/configuration/global/ns_dynamic.toml
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016-2023, Hangzhou Hyperchain Technology Co., Ltd..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>