

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>gosdk 使用手册 &mdash; hyperchain  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> hyperchain
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">平台介绍:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">平台介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="Version%20information.html">版本信息</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">快速入门:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="General%20Concepts.html">通用概念</a></li>
<li class="toctree-l1"><a class="reference internal" href="Prepare.html">准备工作</a></li>
<li class="toctree-l1"><a class="reference internal" href="Deployedfile.html">部署运维</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">基础协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="consensus%20mechanism.html">共识机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="Networking%20protocol.html">网络协议</a></li>
<li class="toctree-l1"><a class="reference internal" href="execution%20engine.html">执行引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="Storage%20model.html">存储模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="security%20mechanism.html">加密机制</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">扩展协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Architecture%20development.html">架构拓展</a></li>
<li class="toctree-l1"><a class="reference internal" href="Digital%20Service.html">数字服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="Safe%20Privacy.html">隐私保护</a></li>
<li class="toctree-l1"><a class="reference internal" href="Governonce%20and%20audit.html">治理与审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data%20management.html">数据管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Operation%20manage.html">运维管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ecological%20components.html">区块链生态组件</a></li>
<li class="toctree-l1"><a class="reference internal" href="External%20Interface.html">外部接口</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">用户手册:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Chain%20Authority%20Management.html">链级权限管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Node%20and%20zone%20management.html">节点及分区管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Consensus%20related%20user%20manual.html">共识相关使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cross%20domain%20network%20User%20Manual.html">跨域网络使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data%20storage%20and%20management.html">数据存储使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="Password%20related.html">密码学相关</a></li>
<li class="toctree-l1"><a class="reference internal" href="Security%20Audit.html">安全审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data%20Monitor.html">数据监控</a></li>
<li class="toctree-l1"><a class="reference internal" href="qulian%20blockchain%20browser.html">趣链区块链浏览器</a></li>
<li class="toctree-l1"><a class="reference internal" href="VM%20Related%20User%20Manual.html">（用户）智能合约使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="Module.html">（用户）组件库</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">应用场景:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="application.html">应用案例</a></li>
<li class="toctree-l1"><a class="reference internal" href="NFT%20and%20contract%20writing.html">数字藏品合约编写</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">更多资源:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Community_Resources.html">社区与资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hyperchain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>gosdk 使用手册</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/GoSDK.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="gosdk">
<span id="id1"></span><h1>gosdk 使用手册<a class="headerlink" href="#gosdk" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>第一章 前言<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>此SDK文档面向Hyperchain和flato的区块链平台的应用开发者，提供Hyperchain和flato GoSDK的使用指南。</p>
<p><a class="reference external" href="https://upload.filoop.com/RTD-Hyperchain%2FGosdk%20rpc%20%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3.pdf">Gosdk rpc 接口文档</a></p>
<p><a class="reference external" href="https://upload.filoop.com/RTD-Hyperchain%2FGosdk%20grpc%20%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3.pdf">Gosdk grpc 接口文档</a></p>
<div class="section" id="id3">
<h3>1.1 配置<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id4">
<h4>1.1.1 目录结构<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>所有配置文件、证书都应放在一个文件夹下，默认配置文件夹名为 <cite>conf</cite> ，<cite>hpc.toml</cite> 在配置文件夹下根目录，所有配置为文件路径都应相对于配置文件夹存放，例如我们以默认文件夹名 <cite>conf</cite> 为例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>conf
├── certs
│   ├── sdkcert.cert
│   ├── sdkcert.priv
│   ├── unique.priv
│   └── unique.pub
│   ├── tls
│   │   ├── tls_peer.cert
│   │   ├── tls_peer.priv
│   │   └── tlsca.ca
└── hpc.toml
</pre></div>
</div>
<p>certs目录下的证书需要对应于Flato或Hyperchain节点，在Flato或Hyperchain部署文档的 <strong>证书配置</strong> 一章节中，我们可以获得 <strong>证书套件</strong> ，证书套件目录图如下图所示（以flato为例）。其中sdkcerts中的四个文件对应于上述conf/certs目录下的四个文件，需要向几号节点发送交易，则选用几号节点的证书进行替换。</p>
<img alt="证书套件目录" class="align-center" src="_images/GoSDK1.png" />
</div>
<div class="section" id="id5">
<h4>1.1.2 配置文件<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>我们通过读取hpc.toml文件来加载配置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;GoSDK configuratoin file&quot;</span>

<span class="n">namespace</span> <span class="o">=</span> <span class="s2">&quot;global&quot;</span>

<span class="c1">#发送重新连接请求间隔(/ms)</span>
<span class="n">reConnectTime</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="p">[</span><span class="n">jsonRPC</span><span class="p">]</span>
    <span class="c1"># local environment</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span><span class="s2">&quot;localhost&quot;</span><span class="p">]</span>

    <span class="c1"># JsonRpc connect port</span>
    <span class="c1"># local ports</span>
  <span class="n">ports</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;8081&quot;</span><span class="p">,</span> <span class="s2">&quot;8082&quot;</span><span class="p">,</span> <span class="s2">&quot;8083&quot;</span><span class="p">,</span> <span class="s2">&quot;8084&quot;</span><span class="p">]</span>

<span class="p">[</span><span class="n">webSocket</span><span class="p">]</span>
    <span class="c1"># webSocket connect port</span>
    <span class="n">ports</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;10001&quot;</span><span class="p">,</span> <span class="s2">&quot;10002&quot;</span><span class="p">,</span> <span class="s2">&quot;10003&quot;</span><span class="p">,</span> <span class="s2">&quot;10004&quot;</span><span class="p">]</span>
<span class="p">[</span><span class="n">grpc</span><span class="p">]</span>
    <span class="n">ports</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;11001&quot;</span><span class="p">,</span> <span class="s2">&quot;11002&quot;</span><span class="p">,</span> <span class="s2">&quot;11003&quot;</span><span class="p">,</span> <span class="s2">&quot;11004&quot;</span><span class="p">]</span>

<span class="p">[</span><span class="n">polling</span><span class="p">]</span>
    <span class="c1">#重发次数</span>
    <span class="n">resendTime</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="c1">#第一次轮训时间间隔 unit /ms</span>
    <span class="n">firstPollingInterval</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="c1">#发送一次,第一次轮训的次数</span>
    <span class="n">firstPollingTimes</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="c1">#第二次轮训时间间隔 unit /ms</span>
    <span class="n">secondPollingInterval</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="c1">#发送一次,第二次轮训的次数</span>
    <span class="n">secondPollingTimes</span> <span class="o">=</span> <span class="mi">10</span>

<span class="p">[</span><span class="n">privacy</span><span class="p">]</span>
    <span class="c1">#send Tcert during the request or not</span>
    <span class="n">sendTcert</span> <span class="o">=</span> <span class="n">true</span>
    <span class="c1">#if sendTcert is true , you should add follow path.</span>
    <span class="c1">#the paths followed are relative to conf root path</span>
    <span class="n">sdkcertPath</span> <span class="o">=</span> <span class="s2">&quot;certs/sdkcert.cert&quot;</span>
    <span class="n">sdkcertPrivPath</span> <span class="o">=</span> <span class="s2">&quot;certs/sdkcert.priv&quot;</span>
<span class="c1">#    sdkcertPath = &quot;certs/sdkcert_cfca.cert&quot;</span>
<span class="c1">#    sdkcertPrivPath = &quot;certs/sdkcert_cfca.priv&quot;</span>
    <span class="n">uniquePubPath</span> <span class="o">=</span> <span class="s2">&quot;certs/unique.pub&quot;</span>
    <span class="n">uniquePrivPath</span> <span class="o">=</span> <span class="s2">&quot;certs/unique.priv&quot;</span>
    <span class="n">cfca</span> <span class="o">=</span> <span class="n">true</span>

<span class="p">[</span><span class="n">security</span><span class="p">]</span>
    <span class="c1">#Use Https</span>
    <span class="n">https</span> <span class="o">=</span> <span class="n">false</span>
    <span class="c1">#If https is true, you shoule add follow properties</span>
    <span class="c1">#the paths followed are relative to conf root path</span>
    <span class="n">tlsca</span> <span class="o">=</span> <span class="s2">&quot;certs/tls/tlsca.ca&quot;</span>
    <span class="n">tlspeerCert</span> <span class="o">=</span> <span class="s2">&quot;certs/tls/tls_peer.cert&quot;</span>
    <span class="n">tlspeerPriv</span> <span class="o">=</span> <span class="s2">&quot;certs/tls/tls_peer.priv&quot;</span>

<span class="p">[</span><span class="n">log</span><span class="p">]</span>
    <span class="c1">#设置日志输出门槛</span>
    <span class="c1">#&quot;CRITICAL&quot;,&quot;ERROR&quot;,&quot;WARNING&quot;,&quot;NOTICE&quot;,&quot;INFO&quot;,&quot;DEBUG&quot;,</span>
    <span class="n">log_level</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span>
    <span class="c1">#存放日志文件夹</span>
    <span class="n">log_dir</span> <span class="o">=</span> <span class="s2">&quot;../logs&quot;</span>

<span class="p">[</span><span class="n">transport</span><span class="p">]</span>
    <span class="c1"># MaxIdleConns controls the maximum number of idle (keep-alive)</span>
  <span class="c1"># connections across all hosts. Zero means no limit.</span>
    <span class="n">maxIdleConns</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="c1"># MaxIdleConnsPerHost, if non-zero, controls the maximum idle</span>
  <span class="c1"># (keep-alive) connections to keep per-host. If zero,</span>
  <span class="c1"># DefaultMaxIdleConnsPerHost is used.</span>
  <span class="n">maxIdleConnsPerHost</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="c1"># MaxRecvMsgSize, set max recv msg size for grpc /b</span>
  <span class="n">maxRecvMsgSize</span> <span class="o">=</span> <span class="mi">51200</span>
  <span class="c1"># MaxSendMsgSize, set max sendMsg size for grpc /b</span>
  <span class="n">maxSendMsgSize</span> <span class="o">=</span> <span class="mi">51200</span>
  <span class="c1">#DailTimeout dail time out</span>
  <span class="n">dailTimeout</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="c1"># MaxLifetime(unused), set the connections max life time, if zero, use default value, /s</span>
  <span class="n">maxLifetime</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="c1"># MaxStreamLifeTime, set the stream max life time, if zero, no limit, /s</span>
  <span class="n">maxStreamLifeTime</span> <span class="o">=</span> <span class="mi">5</span>

<span class="p">[</span><span class="n">inspector</span><span class="p">]</span>
    <span class="n">enable</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">defaultAccount</span> <span class="o">=</span> <span class="s2">&quot;keystore/0xfc546753921c1d1bc2d444c5186a73ab5802a0b4&quot;</span>
    <span class="n">accountType</span> <span class="o">=</span> <span class="s2">&quot;ecdsa&quot;</span>

<span class="p">[</span><span class="n">tx</span><span class="p">]</span>
    <span class="c1"># if it is use for hyperchain, please use 1.0 to replace default</span>
    <span class="c1"># if use for flato, please use 2.0 to replace default</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;2.5&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>1.1.3 配置项释义<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<table class="colwidths-given docutils align-center">
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>一级</p></th>
<th class="head"><p>二级</p></th>
<th class="head"><p>释义</p></th>
<th class="head"><p>默认值</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>namespace</p></td>
<td></td>
<td><p>为初始化时传入的namespace</p></td>
<td><p>“global”</p></td>
</tr>
<tr class="row-odd"><td><p>jsonRP</p></td>
<td><p>nodes</p></td>
<td><p>表示平台各节点的IP</p></td>
<td><p>[“localhost”,”localhost”,”localhost”,”localhost”]</p></td>
</tr>
<tr class="row-even"><td><p>jsonRP</p></td>
<td><p>ports</p></td>
<td><p>各节点rpc服务的端口</p></td>
<td><p>[“8081”, “8082”, “8083”, “8084”]</p></td>
</tr>
<tr class="row-odd"><td><p>webSocket</p></td>
<td><p>ports</p></td>
<td><p>为事件订阅服务的端口</p></td>
<td><p>[“10001”, “10002”, “10003”, “10004”]</p></td>
</tr>
<tr class="row-even"><td><p>grpc</p></td>
<td><p>ports</p></td>
<td><p>各节点grpc服务端口</p></td>
<td><p>[“11001”, “11002”, “11003”, “11004”]</p></td>
</tr>
<tr class="row-odd"><td><p>polling</p></td>
<td><p>resendTime</p></td>
<td><p>重发次数</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>polling</p></td>
<td><p>firstPollingInterval</p></td>
<td><p>第一次轮询的间隔，单位 ms</p></td>
<td><p>100</p></td>
</tr>
<tr class="row-odd"><td><p>polling</p></td>
<td><p>firstPollingTimes</p></td>
<td><p>第一次轮询的次数</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>polling</p></td>
<td><p>secondPollingInterval</p></td>
<td><p>第二次轮询的间隔，单位 ms</p></td>
<td><p>1000</p></td>
</tr>
<tr class="row-odd"><td><p>polling</p></td>
<td><p>secondPollingTimes</p></td>
<td><p>第二次轮询的次数</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>privacy</p></td>
<td><p>sendTcert</p></td>
<td><p>是否开启Tcert认证， 布尔值</p></td>
<td><p>true                            |</p></td>
</tr>
<tr class="row-odd"><td><p>privacy</p></td>
<td><p>sdkcertPath</p></td>
<td><p>开启Tcert认证时签名用的公钥路径</p></td>
<td><p>“certs/sdkcert.cert”</p></td>
</tr>
<tr class="row-even"><td><p>privacy</p></td>
<td><p>sdkcertPrivPath</p></td>
<td><p>开启Tcert认证时签名用的私钥路径</p></td>
<td><p>“certs/sdkcert.priv”</p></td>
</tr>
<tr class="row-odd"><td><p>privacy</p></td>
<td><p>uniquePubPath</p></td>
<td><p>表示请求tcert时所使用的请求体公钥路径</p></td>
<td><p>“certs/unique.pub”</p></td>
</tr>
<tr class="row-even"><td><p>privacy</p></td>
<td><p>uniquePrivPath</p></td>
<td><p>表示请求tcert时所使用的请求体私钥路径</p></td>
<td><p>“certs/unique.priv”</p></td>
</tr>
<tr class="row-odd"><td><p>privacy</p></td>
<td><p>cfca</p></td>
<td><p>是否开启ca证书， 布尔值</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>log</p></td>
<td><p>log_level</p></td>
<td><p>日志等级， 分为”CRITICAL”,”ERROR”,”WARNING”,”NOTICE”,”INFO”,”DEBUG”</p></td>
<td><p>“INFO”</p></td>
</tr>
<tr class="row-odd"><td><p>log</p></td>
<td><p>log_dir</p></td>
<td><p>存放日志文件的目录</p></td>
<td><p>“../logs”</p></td>
</tr>
<tr class="row-even"><td><p>transport</p></td>
<td><p>maxIdleConns</p></td>
<td><p>所有节点一共最大空闲活跃rpc连接数，如果为0，表示不设限制</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>transport</p></td>
<td><p>maxIdleConnsPerHost</p></td>
<td><p>每个节点最大空闲活跃rpc连接数， 如果为0，表示使用系统默认配置</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>transport</p></td>
<td><p>maxRecvMsgSize</p></td>
<td><p>grpc双向流从节点接受的信息最大size，此处配置必须小于等于节点配置的值，单位是比特</p></td>
<td><p>51200</p></td>
</tr>
<tr class="row-odd"><td><p>transport</p></td>
<td><p>maxSendMsgSize</p></td>
<td><p>通过grpc双向流发送到节点的信息最大size，此处配置必须小于等于节点配置的值，单位是比特</p></td>
<td><p>51200</p></td>
</tr>
<tr class="row-even"><td><p>transport</p></td>
<td><p>dailTimeout</p></td>
<td><p>建立grpc连接的超时时间，单位s</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>transport</p></td>
<td><p>maxLifetime</p></td>
<td><p>判定接收不到grpc心跳多久后表示连接已失效，单位s， 如果为0，表示使用默认值</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>transport</p></td>
<td><p>maxStreamLifeTime</p></td>
<td><p>grpc双向流的存活时间，此处配置必须小于等于节点配置的值，0表示默认（即依靠节点配置的时间），单位秒</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>tx</p></td>
<td><p>version</p></td>
<td><p>sdk所对应的平台版本号</p></td>
<td><p>2.5</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p><cite>namespace</cite> 为初始化时传入的namespace；</p></li>
<li><p>[jspnRPC]模块：<cite>nodes</cite> 表示平台各节点的IP；<cite>ports</cite> 也就是平台发送消息的端口。</p></li>
<li><p>webSocket模块：<cite>ports</cite> 为事件订阅连接的端口，他们分别对应着node中配置的IP。</p></li>
<li><p>grpc 模块: <cite>ports</cite> 为grpc连接的端口</p></li>
<li><p>polling模块：<cite>resendTime</cite> 参数表示重发次数； <cite>pollingInterval</cite> 表示轮训去获取交易的时间间隔（分为第一次和第二次），单位为毫秒； <cite>pollingTimes</cite> 表示发送一次交易的轮训次数（分为第一次和第二次）。</p></li>
<li><p>privacy模块： <cite>sendTcert</cite> 表示开启Tcert，请配合平台一起使用； <cite>sdkcertPath</cite> 和 <cite>sdkcertPrivPath</cite> 表示请求tcert时需要用来签名的公私钥对； <cite>uniquePubPath</cite> 和 <cite>uniquePrivPath</cite> 表示请求tcert时所使用的请求体公私钥对； <cite>cfca</cite> 表示开启cfca证书。 <strong>需要注意证书路径均相对于</strong> <cite>hpc.toml</cite> <strong>文件</strong> 。</p></li>
<li><p>security模块： <cite>https</cite> 开启后则请求都会使用https来发送，<cite>tlsca</cite> 表示客户端需要验证的服务器ca，<cite>tlspeerCert</cite> 表示服务器需要验证的SDK的ca的公钥， <cite>tlspeerPriv</cite> 则为对应的ca公钥的私钥。</p></li>
<li><p>log模块： <cite>log_level</cite> 表示输出的日志级别。 <cite>log_dir</cite> 表示存放日志的文件夹路径。</p></li>
<li><p>【transport】模块： <cite>maxRecvMsgSize</cite> ： 通过grpc双向流从节点接受的信息最大size，此处配置必须小于等于节点配置的值，单位是比特</p></li>
<li><p>txVersion 需要和平台版本对应</p></li>
<li><p>maxRecvMsgSize： 通过grpc双向流从节点接受的信息最大size，此处配置必须小于等于节点配置的值，单位是比特</p></li>
<li><p>maxSendMsgSize： 通过grpc双向流发送到节点的信息最大size，此处配置必须小于等于节点配置的值，单位是比特</p></li>
<li><p>dailTimeout： grpc连接创建超时时间</p></li>
<li><p>maxStreamLifeTime： grpc双向流的存活时间，此处配置必须小于等于节点配置的值，0表示默认（即依靠节点配置的时间），单位秒</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="id7">
<h2>第二章 账户<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>账户分为普通账户和DID账户，而根据加密方式可分为国密和非国密类型。目前根据加密方式不同一共有19种类型账户</p>
<p>非国密账户有：</p>
<table class="colwidths-given docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>参数名</p></th>
<th class="head"><p>编码</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ECKDF2</p></td>
<td><p>0x01(暂不支持)</p></td>
</tr>
<tr class="row-odd"><td><p>ECDES</p></td>
<td><p>0x02</p></td>
</tr>
<tr class="row-even"><td><p>ECRAW</p></td>
<td><p>0x03</p></td>
</tr>
<tr class="row-odd"><td><p>ECAES</p></td>
<td><p>0x04</p></td>
</tr>
<tr class="row-even"><td><p>EC3DES</p></td>
<td><p>0x05</p></td>
</tr>
<tr class="row-odd"><td><p>ED25519DES</p></td>
<td><p>0x21</p></td>
</tr>
<tr class="row-even"><td><p>ED25519RAW</p></td>
<td><p>0x22</p></td>
</tr>
<tr class="row-odd"><td><p>ED25519AES</p></td>
<td><p>0x23</p></td>
</tr>
<tr class="row-even"><td><p>ED255193DES</p></td>
<td><p>0x24</p></td>
</tr>
<tr class="row-odd"><td><p>ECKDF2R1</p></td>
<td><p>0x011(暂不支持)</p></td>
</tr>
<tr class="row-even"><td><p>ECDESR1</p></td>
<td><p>0x021</p></td>
</tr>
<tr class="row-odd"><td><p>ECRAWR1</p></td>
<td><p>0x031</p></td>
</tr>
<tr class="row-even"><td><p>ECAESR1</p></td>
<td><p>0x041</p></td>
</tr>
<tr class="row-odd"><td><p>EC3DESR1</p></td>
<td><p>0x051</p></td>
</tr>
</tbody>
</table>
<p>国密账户有：</p>
<table class="colwidths-given docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>参数名</p></th>
<th class="head"><p>编码</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SMSM4</p></td>
<td><p>0x11</p></td>
</tr>
<tr class="row-odd"><td><p>SMDES</p></td>
<td><p>0x12</p></td>
</tr>
<tr class="row-even"><td><p>SMRAW</p></td>
<td><p>0x13</p></td>
</tr>
<tr class="row-odd"><td><p>SMAES</p></td>
<td><p>0x14</p></td>
</tr>
<tr class="row-even"><td><p>SM3DES</p></td>
<td><p>0x15</p></td>
</tr>
</tbody>
</table>
<div class="section" id="id8">
<h3>2.1 普通账户<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id9">
<h4>2.1.1 创建账户<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p><strong>2.1.1.1 通过账户类型创建账户</strong></p>
<p>方法签名：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func NewAccountJson(acType, password string) (string, error)`
</pre></div>
</div>
<table class="colwidths-given docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>释义</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>参数1 （acType）</p></td>
<td><p>加密方式</p></td>
</tr>
<tr class="row-odd"><td><p>参数2 （password）</p></td>
<td><p>账户密码</p></td>
</tr>
<tr class="row-even"><td><p>返回值1</p></td>
<td><p>账户JSON串</p></td>
</tr>
<tr class="row-odd"><td><p>返回值2</p></td>
<td><p>error， 详情见第七章</p></td>
</tr>
</tbody>
</table>
<p>应用实例:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ac</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountJson</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">ECDES</span><span class="p">,</span> <span class="s2">&quot;123&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>2.1.1.2 创建国密账户</strong></p>
<p>方法签名：</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func NewAccountSm2(password string) (string, error)`
</pre></div>
</div>
</div></blockquote>
<p>说明： 创建sm2国密算法的accountJSON</p>
<table class="colwidths-given docutils align-center">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>参数</p></th>
<th class="head"><p>释义</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>参数 password</p></td>
<td><p>账户密码，不为空则采用SMDES方式加密，为空则采用SMRAW方式加密（即不加密）</p></td>
</tr>
<tr class="row-odd"><td><p>返回值1</p></td>
<td><p>账户JSON串</p></td>
</tr>
<tr class="row-even"><td><p>返回值2</p></td>
<td><p>error， 详情见第七章</p></td>
</tr>
</tbody>
</table>
<p>应用实例:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ac</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountSm2</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>2.1.1.3  通过pfx格式的证书创建账户</strong></p>
<p>方法签名:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`NewAccountJsonFromPfx(password string, pfx []byte) (string, error)`
</pre></div>
</div>
<ul class="simple">
<li><p>参数1 : 账户密码</p></li>
<li><p>参数2 : pfx格式证书</p></li>
<li><p>返回值1 : 账户JSON串</p></li>
<li><p>返回值2 : error， 详情见第七章</p></li>
</ul>
<p>应用实例:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">temp</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="s2">&quot;idcert.pfx&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
  <span class="k">return</span>
<span class="p">}</span>
<span class="n">ac</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountJsonFromPfx</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
  <span class="k">return</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>2.1.1.4 创建ed25519类型账户</strong></p>
<p>方法签名：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func NewAccountED25519(password string) (string, error)`
</pre></div>
</div>
<ul class="simple">
<li><p>参数1 （password） : 账户密码，若为空，则采用ED25519RAW方式加密, 否则采用ED25519DES方式加密</p></li>
<li><p>返回值1     : 账户JSON串</p></li>
<li><p>返回值2     : error， 详情见第七章</p></li>
</ul>
<p>应用实例:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ac</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountED25519</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>2.1.1.5 创建ecdsa账户</strong></p>
<p>方法签名：</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>` func NewAccount(password string) (string, error)`
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （password） : 账户密码，若为空，则采用ECRAW方式加密, 否则采用ECDES方式加密</p></li>
<li><p>返回值           :</p></li>
<li><p>返回值1          : 账户JSON串</p></li>
<li><p>返回值2          :| error， 详情见第七章</p></li>
</ul>
<p>应用实例:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ac</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccount</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>2.1.1.6 创建R1账户</strong></p>
<p>方法签名：</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func NewAccountR1(password string) (string, error)`
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （password） : 账户密码，若为空，则采用ECRAWR1方式加密, 否则采用ECDESR1方式加密</p></li>
<li><p>返回值1           : 账户JSON串</p></li>
<li><p>返回值2           : error， 详情见第七章</p></li>
</ul>
<p>应用实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ac</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountR1</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>### 2.1.2 生成key</p>
<p>方法签名：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func GenKeyFromAccountJson(accountJson, password string) (key interface{}, err error)`
</pre></div>
</div>
<ul class="simple">
<li><p>参数1 （accountJson） : 账户json串</p></li>
<li><p>参数2 （password）    : 账户密码</p></li>
<li><p>返回值               :</p></li>
<li><p>返回值1              : 账户key</p></li>
<li><p>返回值2              :| error， 详情见第七章</p></li>
</ul>
<p>应用实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>accountJson := `{&quot;address&quot;:&quot;0x4037f0011a9a5db6e426d702b14861e65b4f2a46&quot;,&quot;algo&quot;:&quot;0x12&quot;,&quot;version&quot;:&quot;4.0&quot;,&quot;publicKey&quot;:&quot;0x040e15655c836ce58be6b5b3da93bd257d817809ec5a621b01d1024e1b6de7b38d0f12309accb6cd1a91faadffeabda0f8d2b835606daf01022e0b26ea0b9a3125&quot;,&quot;privateKey&quot;:&quot;9de41e04445dc3024c3713a9cf043d55f6d8509fbfe6b3ebb108b89d83669328feb959b7d4642fcb&quot;}`
password := &quot;12345678&quot;
key, err := account.GenKeyFromAccountJson(accountJson, password)
</pre></div>
</div>
</div>
</div>
<div class="section" id="did">
<h3>2.2 did账户<a class="headerlink" href="#did" title="Permalink to this headline">¶</a></h3>
<p>did账户与普通账户在国密场景一致，仅需要对非国密情况进行区分，由此带来的变化如下</p>
<div class="section" id="id10">
<h4>2.2.1 创建账户<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p><strong>2.2.1.1 通过ecdsa创建账户</strong></p>
<p>方法签名:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func NewAccountDID(password string) (string, error)`
</pre></div>
</div>
<ul class="simple">
<li><p>参数1 （password） : 账户密码，若为空，则采用ECRAW方式加密, 否则采用ECDES方式加密</p></li>
<li><p>返回值            :</p></li>
<li><p>返回值1           : 账户JSON串</p></li>
<li><p>返回值2           : error， 详情见第七章</p></li>
</ul>
<p>应用实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ac</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountDID</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>2.2.1.2 通过加密类型创建账户</strong></p>
<p>方法签名：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func NewDIDAccountJson(acType, password string) (string, error)`
</pre></div>
</div>
<ul class="simple">
<li><p>参数1 （acType）   : 加密方式</p></li>
<li><p>参数2 （password） : 账户密码</p></li>
<li><p>返回值            :</p></li>
<li><p>返回值1           : 账户JSON串</p></li>
<li><p>返回值2           : error， 详情见第七章</p></li>
</ul>
<p>应用实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ac</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewDIDAccountJson</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">ECDES</span><span class="p">,</span> <span class="s2">&quot;123&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>2.2.1.2 通过key生成DID账户</strong></p>
<p>方法签名：</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewDIDAccount</span><span class="p">(</span><span class="n">key</span> <span class="n">Key</span><span class="p">,</span> <span class="n">chainID</span><span class="p">,</span> <span class="n">suffix</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="n">didKey</span> <span class="o">*</span><span class="n">DIDKey</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : 账户key</p></li>
<li><p>参数2  : 链唯一的chainId</p></li>
<li><p>参数3  : DID账户的后缀，用于构成did账户的地址</p></li>
<li><p>返回值1 : DID账户</p></li>
</ul>
<p>应用实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">password</span> <span class="o">:=</span> <span class="s2">&quot;hyper&quot;</span>
<span class="n">accountJson</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountSm2</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
<span class="n">chainId</span> <span class="o">:=</span> <span class="s2">&quot;chainId_01&quot;</span>
<span class="o">//</span><span class="n">生成普通账户key</span>
<span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">GenKeyFromAccountJson</span><span class="p">(</span><span class="n">accountJson</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="n">suffix</span> <span class="o">:=</span> <span class="s2">&quot;didAddr_suffix&quot;</span>
<span class="n">didKey</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewDIDAccount</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">Key</span><span class="p">),</span> <span class="n">chainId</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="key">
<h4>2.2.2 生成key<a class="headerlink" href="#key" title="Permalink to this headline">¶</a></h4>
<p><strong>2.2.2.1 通过账户json生成key</strong></p>
<p>方法签名：</p>
<blockquote>
<div><p><cite>func GenDIDKeyFromAccountJson(accountJson, password string) (key interface{}, err error)</cite></p>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （accountJson） : 账户json串</p></li>
<li><p>参数2 （password）    : 账户密码</p></li>
<li><p>返回值1              : 账户key</p></li>
<li><p>返回值2              : error， 详情见第七章</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>accountJson := `{&quot;address&quot;:&quot;0x4037f0011a9a5db6e426d702b14861e65b4f2a46&quot;,&quot;algo&quot;:&quot;0x12&quot;,&quot;version&quot;:&quot;4.0&quot;,&quot;publicKey&quot;:&quot;0x040e15655c836ce58be6b5b3da93bd257d817809ec5a621b01d1024e1b6de7b38d0f12309accb6cd1a91faadffeabda0f8d2b835606daf01022e0b26ea0b9a3125&quot;,&quot;privateKey&quot;:&quot;9de41e04445dc3024c3713a9cf043d55f6d8509fbfe6b3ebb108b89d83669328feb959b7d4642fcb&quot;}`
password := &quot;12345678&quot;
key, err := account.GenDIDKeyFromAccountJson(accountJson, password)
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="id11">
<h2>第三章 交易体<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id12">
<h3>3.1 交易体结构<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>交易是与hyperchain交互的重要形式，在GoSDK中，交易由 <strong>Transaction</strong> 结构体代表。GoSDK中交易体用户可配置参数共有如下（以下字段名首字母大写即为该字段的设值函数）：</p>
<p>【from】：交易发起方账户地址。 <strong>必填</strong> 。</p>
<p>【to】：交易接收方地址，合约调用时为合约地址。默认 <strong>0x0</strong> 。</p>
<p>【value】：转账金额。默认为**0**。</p>
<p>【payload】：交易荷载，在部署、调用、更新合约时使用。默认为 <strong>空字符串</strong> 。</p>
<p>【opcode】：操作码，在合约管理时使用， <strong>1</strong> 代表 <em>更新合约</em> ， <strong>2</strong> 代表 <em>冻结合约</em> ， <strong>3</strong> 代表 <em>解冻合约</em> 。默认为 <strong>0</strong> 。</p>
<p>【extra】：存证信息，可以在交易中附带一些信息。默认为 <strong>空字符串</strong> 。</p>
<p>【simulate】：配置当前交易是否为模拟交易。若为true，则交易数据不会存入链上数据库。默认为 <strong>false</strong> 。</p>
<p>【vmType】：当前交易针对的虚拟机，目前支持配置EVM、HVM、KVSQL、BVM、TRANSFER、FVM六种。默认为 <strong>EVM</strong> 。</p>
<p>【GasPrice】： gasPrice 默认为0，初始化 <strong>rpc</strong> 会从节点获取</p>
<p>【GasLimit】： gasLimit 默认 <strong>1000000000</strong></p>
<p>【Participant】: participant 聚合签名相关</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// TransactionInfo is packaged result of TransactionInfo
type TransactionInfo struct {
  Version        string
  Hash           string
  BlockNumber    uint64
  BlockHash      string
  TxIndex        uint64
  From           string
  To             string
  CName          string
  Amount         uint64
  Timestamp      uint64
  Nonce          uint64
  ExecuteTime    int64
  Payload        string
  Extra          string
  Invalid        bool
  InvalidMsg     string
  BlockTimestamp int64
  BlockWriteTime int64
    ExtraIdString       []interface{}
  Op                  int
  VmType              string
  GasPrice            int64
  GasLimit            int64
  ExpirationTimestamp int64
  Participant         Participant
}

type Participant struct {
  Initiator   []byte   `json:&quot;initiator&quot;`
  Withholding [][]byte `json:&quot;withholding&quot;`
}

// Oracle is packaged result of oracle event
type Oracle struct {
  Url             string
  Method          string
  Header          map[string]string
  Body            string
  TxHash          string
  BizId           string
  CallBackAddress string
  CallBackMethod  string
  Uuid            string
  ContractAddress string
}


// TxReceipt is packaged result of transaction receipt
type TxReceipt struct {
  TxHash          string
  PrivTxHash      string
  ContractAddress string
  ContractName    string
  Ret             string
  Log             []TxLog
  VMType          string
  Version         string
  Valid           bool
  ErrorMsg        string
  GasUsed         int64
  Oracles         Oracle
}
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id13">
<h3>3.2 交易体构造<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>方法签名：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func NewTransaction(from string) *Transaction`
</pre></div>
</div>
<ul class="simple">
<li><p>参数1  : 交易发起方地址</p></li>
<li><p>返回值1 : 交易体</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">NewTransaction</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<div class="section" id="nonce">
<h4>3.2.1 设置nonce<a class="headerlink" href="#nonce" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">Nonce</span><span class="p">(</span><span class="n">nonce</span> <span class="n">int64</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
<span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">SetNonce</span><span class="p">(</span><span class="n">nonce</span> <span class="n">int64</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span><span class="o">.</span><span class="n">Nonce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="o">//</span> <span class="ow">or</span>
<span class="n">trans</span><span class="o">.</span><span class="n">SetNonce</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id14">
<h4>3.2.2 设置交易体时间戳<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>方法签名：</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">Timestamp</span><span class="p">(</span><span class="n">timestamp</span> <span class="n">int64</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">Unix</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="simulate">
<h4>3.2.3 设置是否为Simulate交易<a class="headerlink" href="#simulate" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">Simulate</span><span class="p">(</span><span class="n">simulate</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span><span class="o">.</span><span class="n">Simulate</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id15">
<h4>3.2.4  设置交易对应虚拟机类型<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>方法签名：</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">VMType</span><span class="p">(</span><span class="n">vmType</span> <span class="n">VMType</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1（vmType） : 虚拟机类型，EVM, HVM, BVM, TRANSFER, KVSQL</p></li>
<li><p>返回值1        : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">rpc</span><span class="o">.</span><span class="n">KVSQL</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id16">
<h4>3.2.5 转账交易构造<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">Transfer</span><span class="p">(</span><span class="n">to</span> <span class="n">string</span><span class="p">,</span> <span class="n">value</span> <span class="n">int64</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1（to）     : 收款方地址</p></li>
<li><p>参数2 （value） : 转账数</p></li>
<li><p>返回值1        : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span><span class="o">.</span><span class="n">Transfer</span><span class="p">(</span><span class="s2">&quot;bfa5bd992e3eb123c8b86ebe892099d4e9efb783&quot;</span><span class="p">,</span> <span class="n">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id17">
<h4>3.2.6 合约管理交易构造<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">Maintain</span><span class="p">(</span><span class="n">op</span> <span class="n">int64</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">payload</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1（op）       : 操作码， 1 合约升级， 2 冻结合约， 3 解冻合约</p></li>
<li><p>参数2 （to）      : 操作的合约地址</p></li>
<li><p>参数3 （payload） : 合约bin， 可为空字符串</p></li>
<li><p>返回值1          : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">contractAddress</span> <span class="o">:=</span> <span class="s2">&quot;0x421a1fb06bd9c9fae9b8cdaf8a662cf3c41ffa10&quot;</span> <span class="o">//</span> <span class="n">合约部署后地址</span>
<span class="n">trans</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">Maintain</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">contractAddress</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id18">
<h4>3.2.7 通过合约名管理合约的交易构造<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">MaintainByName</span><span class="p">(</span><span class="n">op</span> <span class="n">int64</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">payload</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （op）      : 操作码， 1 合约升级， 2 冻结合约， 3 解冻合约</p></li>
<li><p>参数2 （name）    : 合约名</p></li>
<li><p>参数3 （payload） : 合约bin， 可为空字符串</p></li>
<li><p>返回值1          : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">绑定合约名</span>
<span class="n">contractAddr</span> <span class="o">:=</span> <span class="s2">&quot;0x421a1fb06bd9c9fae9b8cdaf8a662cf3c41ffa10&quot;</span>
<span class="n">contractName</span> <span class="o">:=</span> <span class="s2">&quot;demo&quot;</span>
<span class="o">//</span> <span class="n">setCName方法定义在下面</span>
<span class="n">setCName</span><span class="p">(</span><span class="n">contractAddr</span><span class="p">,</span> <span class="n">contractName</span><span class="p">)</span>
<span class="n">trans</span><span class="o">.</span><span class="n">MaintainByName</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">contractName</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">setCName</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">cName</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">bvm</span><span class="o">.</span><span class="n">Result</span> <span class="p">{</span>
  <span class="n">re</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">createProposalForSetCName</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">cName</span><span class="p">)</span>
  <span class="n">var</span> <span class="n">proposal</span> <span class="n">bvm</span><span class="o">.</span><span class="n">ProposalData</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">NoError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">Ret</span><span class="p">)</span>
  <span class="k">assert</span><span class="o">.</span><span class="kc">True</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">Success</span><span class="p">)</span>
  <span class="n">_</span> <span class="o">=</span> <span class="n">proto</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">([]</span><span class="n">byte</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">Ret</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">proposal</span><span class="p">)</span>

  <span class="n">voteProposal</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">proposal</span><span class="o">.</span><span class="n">Id</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">executeProposal</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">proposal</span><span class="o">.</span><span class="n">Id</span><span class="p">))</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">createProposalForSetCName</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">cName</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">TxReceipt</span><span class="p">,</span> <span class="n">StdError</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountFromAccountJSON</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">pwd</span><span class="p">)</span>
  <span class="n">setCNameOpt</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewCNSSetCNameOperation</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">cName</span><span class="p">)</span>
  <span class="n">cnsOpt</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalCreateOperationForCNS</span><span class="p">(</span><span class="n">setCNameOpt</span><span class="p">)</span>
  <span class="n">payload</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">EncodeOperation</span><span class="p">(</span><span class="n">cnsOpt</span><span class="p">)</span>
  <span class="n">tx</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">cnsOpt</span><span class="o">.</span><span class="n">Address</span><span class="p">(),</span> <span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">BVM</span><span class="p">)</span>
  <span class="n">tx</span><span class="o">.</span><span class="n">Sign</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">rpc</span><span class="o">.</span><span class="n">InvokeContract</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">voteProposal</span><span class="p">(</span><span class="nb">id</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">key</span> <span class="n">account</span><span class="o">.</span><span class="n">Key</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="p">{</span>
      <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountFromAccountJSON</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">pwd</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountSm2FromAccountJSON</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">pwd</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">opt</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalVoteOperation</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">true</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">EncodeOperation</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
    <span class="n">tx</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">Address</span><span class="p">(),</span> <span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">BVM</span><span class="p">)</span>
    <span class="n">tx</span><span class="o">.</span><span class="n">Sign</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">re</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">InvokeContract</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
    <span class="k">assert</span><span class="o">.</span><span class="n">NoError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">Ret</span><span class="p">)</span>
    <span class="k">assert</span><span class="o">.</span><span class="kc">True</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">Success</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">executeProposal</span><span class="p">(</span><span class="nb">id</span> <span class="nb">int</span><span class="p">)</span> <span class="o">*</span><span class="n">bvm</span><span class="o">.</span><span class="n">Result</span> <span class="p">{</span>
  <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountFromAccountJSON</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">pwd</span><span class="p">)</span>
  <span class="n">opt</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalExecuteOperation</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
  <span class="n">payload</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">EncodeOperation</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
  <span class="n">tx</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">Address</span><span class="p">(),</span> <span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">BVM</span><span class="p">)</span>
  <span class="n">tx</span><span class="o">.</span><span class="n">Sign</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
  <span class="n">re</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">InvokeContract</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">NoError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">Ret</span><span class="p">)</span>
  <span class="n">t</span><span class="o">.</span><span class="n">Log</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">result</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id19">
<h4>3.2.8 部署合约交易构造<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">Deploy</span><span class="p">(</span><span class="n">payload</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （payload） : 编码后的合约。根据合约类型不同，传不同的值，具体参照第四章部分。（例如：若为solidity合约，该字段为合约编译后的bin，参照4.1部分；若为hvm合约，该字段为jar包处理后的值，参照4.3部分）                                                                                             |</p></li>
<li><p>返回值1          : 交易体实例                                                                                                 |</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span><span class="o">.</span><span class="n">Deploy</span><span class="p">(</span><span class="s2">&quot;0x60606040526000805463ffffffff19169055341561001957fe5b5b61012a806100296000396000f300606060405263ffffffff60e060020a6000350416633ad14af38114603e57806348fe842114605c578063569c5f6d14606b578063d09de08a146091575bfe5b3415604557fe5b605a63ffffffff6004358116906024351660a0565b005b3415606357fe5b605a60c2565b005b3415607257fe5b607860d2565b6040805163ffffffff9092168252519081900360200190f35b3415609857fe5b605a60df565b005b6000805463ffffffff808216850184011663ffffffff199091161790555b5050565b6000805463ffffffff191690555b565b60005463ffffffff165b90565b6000805463ffffffff8082166001011663ffffffff199091161790555b5600a165627a7a72305820caa934a33fe993d03f87bdf39706fada68ddde78182e0110fd43e8c323d5984a0029&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id20">
<h4>3.2.9 带初始化参数的部署合约交易体构造<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">DeployArgs</span><span class="p">(</span><span class="n">abiString</span> <span class="n">string</span><span class="p">,</span> <span class="n">args</span> <span class="o">...</span><span class="n">interface</span><span class="p">{})</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （abiString） : 合约abi对应构造函数的字符串</p></li>
<li><p>参数2 （args）      : 合约初始化参数</p></li>
<li><p>返回值1            : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>abi := `[
  {
    &quot;inputs&quot;: [
      {
        &quot;internalType&quot;: &quot;uint32&quot;,
        &quot;name&quot;: &quot;a&quot;,
        &quot;type&quot;: &quot;uint32&quot;
      },
      {
        &quot;internalType&quot;: &quot;uint32&quot;,
        &quot;name&quot;: &quot;b&quot;,
        &quot;type&quot;: &quot;uint32&quot;
      }
    ],
    &quot;stateMutability&quot;: &quot;nonpayable&quot;,
    &quot;type&quot;: &quot;constructor&quot;
  },
  {
    &quot;inputs&quot;: [
      {
        &quot;internalType&quot;: &quot;int256&quot;,
        &quot;name&quot;: &quot;a&quot;,
        &quot;type&quot;: &quot;int256&quot;
      },
      {
        &quot;internalType&quot;: &quot;int256&quot;,
        &quot;name&quot;: &quot;b&quot;,
        &quot;type&quot;: &quot;int256&quot;
      }
    ],
    &quot;name&quot;: &quot;add&quot;,
    &quot;outputs&quot;: [
      {
        &quot;internalType&quot;: &quot;int256&quot;,
        &quot;name&quot;: &quot;&quot;,
        &quot;type&quot;: &quot;int256&quot;
      }
    ],
    &quot;stateMutability&quot;: &quot;pure&quot;,
    &quot;type&quot;: &quot;function&quot;
  }
]

`
trans.DeployArgs(abi[0], 1, 2)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id21">
<h4>3.2.10 带字符串初始化参数的部署合约交易体构造<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">DeployStringArgs</span><span class="p">(</span><span class="n">abiString</span> <span class="n">string</span><span class="p">,</span> <span class="n">args</span> <span class="o">...</span><span class="n">interface</span><span class="p">{})</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （abiString） : 合约abi对应构造函数的字符串</p></li>
<li><p>参数2 （args）      : 参数列表</p></li>
<li><p>返回值1            : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>abi := `[
  {
    &quot;inputs&quot;: [
      {
        &quot;internalType&quot;: &quot;address&quot;,
        &quot;name&quot;: &quot;a&quot;,
        &quot;type&quot;: &quot;address&quot;
      },
      {
        &quot;internalType&quot;: &quot;uint32&quot;,
        &quot;name&quot;: &quot;b&quot;,
        &quot;type&quot;: &quot;uint32&quot;
      }
    ],
    &quot;stateMutability&quot;: &quot;nonpayable&quot;,
    &quot;type&quot;: &quot;constructor&quot;
  },
  {
    &quot;inputs&quot;: [
      {
        &quot;internalType&quot;: &quot;int256&quot;,
        &quot;name&quot;: &quot;a&quot;,
        &quot;type&quot;: &quot;int256&quot;
      },
      {
        &quot;internalType&quot;: &quot;int256&quot;,
        &quot;name&quot;: &quot;b&quot;,
        &quot;type&quot;: &quot;int256&quot;
      }
    ],
    &quot;name&quot;: &quot;add&quot;,
    &quot;outputs&quot;: [
      {
        &quot;internalType&quot;: &quot;int256&quot;,
        &quot;name&quot;: &quot;&quot;,
        &quot;type&quot;: &quot;int256&quot;
      }
    ],
    &quot;stateMutability&quot;: &quot;pure&quot;,
    &quot;type&quot;: &quot;function&quot;
  }
]
`
trans.DeployStringArgs(abi[0], &quot;1&quot;, 1)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id22">
<h4>3.2.11 调用合约交易体构造<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">Invoke</span><span class="p">(</span><span class="n">to</span> <span class="n">string</span><span class="p">,</span> <span class="n">payload</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数 1 （to）     : 合约地址</p></li>
<li><p>参数2 （payload） : 合约负载，根据合约类型不同传入的值不同，具体参照第4章节（例如： 若为solidity合约，则为abi.Pack编码后的值；若为hvm合约则为hvm.GenPayload编码之后的值）                                                                                  |</p></li>
<li><p>返回值1          : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">contractAddr</span> <span class="o">:=</span> <span class="s2">&quot;0x421a1fb06bd9c9fae9b8cdaf8a662cf3c41ffa10&quot;</span>
<span class="o">//</span><span class="n">abiContract为合约的abi</span>
<span class="n">ABI</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">abi</span><span class="o">.</span><span class="n">JSON</span><span class="p">(</span><span class="n">strings</span><span class="o">.</span><span class="n">NewReader</span><span class="p">(</span><span class="n">abiContract</span><span class="p">))</span>
<span class="n">packed</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">ABI</span><span class="o">.</span><span class="n">Pack</span><span class="p">(</span><span class="s2">&quot;getMul&quot;</span><span class="p">)</span>
<span class="n">trans</span><span class="o">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">contractAddr</span><span class="p">,</span> <span class="n">packed</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="kvsql">
<h4>3.2.12 调用kvsql合约交易体构造<a class="headerlink" href="#kvsql" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">InvokeSql</span><span class="p">(</span><span class="n">to</span> <span class="n">string</span><span class="p">,</span> <span class="n">payload</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : 合约地址</p></li>
<li><p>参数2  : sql语句的byte数组</p></li>
<li><p>返回值1 : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">str</span> <span class="o">:=</span> <span class="s2">&quot;CREATE TABLE IF NOT EXISTS testTable (id bigint(20) NOT NULL, name varchar(32) NOT NULL, exp bigint(20), money double(16,2) NOT NULL DEFAULT &#39;99&#39;, primary key (id), unique key name (name));&quot;</span>
<span class="n">trans</span><span class="o">.</span><span class="n">InvokeSql</span><span class="p">(</span><span class="n">contractAddr</span><span class="p">,</span> <span class="p">[]</span><span class="n">byte</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id23">
<h4>3.2.13 通过合约名字调用合约交易体构造<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">InvokeByName</span><span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">,</span> <span class="n">payload</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : 合约名字</p></li>
<li><p>参数2  : 合约负载，设定规则与3.2.11部分相同</p></li>
<li><p>返回值1 : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">:=</span> <span class="s2">&quot;demo&quot;</span>
<span class="n">contractAddr</span> <span class="o">:=</span> <span class="s2">&quot;0x421a1fb06bd9c9fae9b8cdaf8a662cf3c41ffa10&quot;</span>
<span class="o">//</span> <span class="n">省略绑定过程</span>
<span class="n">ABI</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">abi</span><span class="o">.</span><span class="n">JSON</span><span class="p">(</span><span class="n">strings</span><span class="o">.</span><span class="n">NewReader</span><span class="p">(</span><span class="n">abiContract</span><span class="p">))</span>
<span class="n">packed</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">ABI</span><span class="o">.</span><span class="n">Pack</span><span class="p">(</span><span class="s2">&quot;getMul&quot;</span><span class="p">)</span>
<span class="n">trans</span><span class="o">.</span><span class="n">InvokeByName</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">packed</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="extra">
<h4>3.2.14 设置extra<a class="headerlink" href="#extra" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">Extra</span><span class="p">(</span><span class="n">extra</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span><span class="o">.</span><span class="n">Extra</span><span class="p">(</span><span class="s2">&quot;demo extra&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="kvextra">
<h4>3.2.15 设置kvextra<a class="headerlink" href="#kvextra" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">KVExtra</span><span class="p">(</span><span class="n">kvExtra</span> <span class="o">*</span><span class="n">KVExtra</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : KVExtra， kv类型的extra</p></li>
<li><p>返回值1 : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kvExtra</span> <span class="o">:=</span> <span class="n">NewKVExtra</span><span class="p">()</span>
<span class="n">kvExtra</span><span class="o">.</span><span class="n">AddKV</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;ice&quot;</span><span class="p">)</span>
<span class="n">kvExtra</span><span class="o">.</span><span class="n">AddKV</span><span class="p">(</span><span class="s2">&quot;friend&quot;</span><span class="p">,</span> <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">string</span><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ice&quot;</span><span class="p">,</span>
  <span class="s2">&quot;age&quot;</span><span class="p">:</span>  <span class="s2">&quot;24&quot;</span><span class="p">,</span>
<span class="p">})</span>
<span class="n">trans</span><span class="o">.</span><span class="n">KVExtra</span><span class="p">(</span><span class="n">kvExtra</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="to">
<h4>3.2.16 设置to<a class="headerlink" href="#to" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">To</span><span class="p">(</span><span class="n">to</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span><span class="o">.</span><span class="n">To</span><span class="p">(</span><span class="s2">&quot;0x421a1fb06bd9c9fae9b8cdaf8a662cf3c41ffa10&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="payload">
<h4>3.2.17 设置payload<a class="headerlink" href="#payload" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">Payload</span><span class="p">(</span><span class="n">payload</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span><span class="o">.</span><span class="n">Payload</span><span class="p">(</span><span class="s2">&quot;demo payload&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="value">
<h4>3.2.18 设置value<a class="headerlink" href="#value" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">Value</span><span class="p">(</span><span class="n">value</span> <span class="n">int64</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="opcode">
<h4>3.2.19 设置opcode<a class="headerlink" href="#opcode" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">OpCode</span><span class="p">(</span><span class="n">op</span> <span class="n">int64</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : 设定交易体的操作码，目前的操作码如下</p></li>
<li><p>返回值1 : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span><span class="o">.</span><span class="n">OpCode</span><span class="p">(</span><span class="n">rpc</span><span class="o">.</span><span class="n">UPDATE</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id24">
<h4>3.2.20 注册DID账户的交易体构造<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">Register</span><span class="p">(</span><span class="n">document</span> <span class="o">*</span><span class="n">DIDDocument</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : did账户结构</p></li>
<li><p>返回值1 : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>password := &quot;&quot;
chainID := &quot;chainID_01&quot;
accountJson, _ := account.NewAccountED25519(password)
key, _ := account.GenKeyFromAccountJson(accountJson, password)
suffix := common.RandomString(10)
didKey := account.NewDIDAccount(key.(account.Key), chainID, suffix)
puKey, _ := rpc.GenDIDPublicKeyFromDIDKey(didKey)
//admin是did账户的列表，第一次为nil;后续如果再新建就填之前的账户；
document := rpc.NewDIDDocument(didKey.GetAddress(), puKey, admins)
trans.Register(document)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id25">
<h4>3.2.21 管理DID账户生命周期的交易体构造<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">MaintainDID</span><span class="p">(</span><span class="n">to</span> <span class="n">string</span><span class="p">,</span> <span class="n">op</span> <span class="n">int64</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 : did账户地址</p></li>
<li><p>参数2 : 操作码</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">password</span> <span class="o">:=</span> <span class="s2">&quot;&quot;</span>
<span class="n">chainID</span> <span class="o">:=</span> <span class="s2">&quot;chainID_01&quot;</span>
<span class="n">accountJson</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountED25519</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
<span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">GenKeyFromAccountJson</span><span class="p">(</span><span class="n">accountJson</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="n">suffix</span> <span class="o">:=</span> <span class="n">common</span><span class="o">.</span><span class="n">RandomString</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ac</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewDIDAccount</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">Key</span><span class="p">),</span> <span class="n">chainID</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
<span class="o">//</span><span class="n">这里省略了将did账户ac注册的步骤</span>
<span class="n">trans</span><span class="o">.</span><span class="n">MaintainDID</span><span class="p">(</span><span class="n">ac</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">,</span> <span class="n">rpc</span><span class="o">.</span><span class="n">DID_FREEZE</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>3.2.22 更新DID账户publickey的交易体构造
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;.</p>
<p>方法签名：</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">UpdatePublicKey</span><span class="p">(</span><span class="n">to</span> <span class="n">string</span><span class="p">,</span> <span class="n">puKey</span> <span class="o">*</span><span class="n">DIDPublicKey</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : did账户地址</p></li>
<li><p>参数   : did账户公钥</p></li>
<li><p>返回值1 : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// 注册DID账户ac， 然后重新生成新的did账户tempAc
newPubkey, _ := rpc.GenDIDPublicKeyFromDIDKey(tempAc)
trans.UpdatePublicKey(ac.GetAddress(). newPubkey)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id26">
<h4>3.2.23 更新DID账户的管理员账户交易体构造<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">UpdateAdmins</span><span class="p">(</span><span class="n">to</span> <span class="n">string</span><span class="p">,</span> <span class="n">admins</span> <span class="p">[]</span><span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : did账户地址</p></li>
<li><p>参数2  : 管理员地址列表</p></li>
<li><p>返回值1 : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// 注册一个DID账户ac， 更改其管理员为admin1， admin2， ac
trans.UpdateAdmins(ac.GetAddress(), []string{
  admin1.GetAddress(),
  admin2.GetAddress(),
  ac.GetAddress(),
})
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id27">
<h4>3.2.24 上传DID账户凭证交易体构造<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">UploadCredential</span><span class="p">(</span><span class="n">credential</span> <span class="o">*</span><span class="n">DIDCredential</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : 签名后的凭证结构体</p></li>
<li><p>返回值1 : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>//按照上文DID账户注册的步骤，注册DID账户issuer和holder
//issuer为签发者，holder为持有者
cred := rpc.NewDIDCredential(&quot;type&quot;, issuer.GetAddress(), holder.GetAddress(), &quot;credential message&quot;, time.Now().UnixNano(), time.Now().UnixNano()+1e11)
//签发者签发凭证，即给凭证签名
cred.Sign(issuer)
//构建凭证上传的交易
tx := rpc.NewTransaction(holder.GetAddress()).UploadCredential(cred)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id28">
<h4>3.2.25 下载DID账户凭证交易体构造<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">DownloadCredential</span><span class="p">(</span><span class="n">credentialID</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : 凭证id</p></li>
<li><p>返回值1 : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>//issuer 为签发者账户，credID为凭证id
tx := rpc.NewTransaction(issuer.GetAddress()).DownloadCredential(credID)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id29">
<h4>3.2.26 销毁DID账户凭证交易体构造<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">DestroyCredential</span><span class="p">(</span><span class="n">credentialID</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : 凭证id</p></li>
<li><p>返回值1 : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>//issuer 为签发者账户，credID为凭证id
tx := rpc.NewTransaction(issuer.GetAddress()).DestroyCredential(credID)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="hash">
<h4>3.2.27 本地计算交易体hash<a class="headerlink" href="#hash" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">GetTransactionHash</span><span class="p">(</span><span class="n">gasLimit</span> <span class="n">int64</span><span class="p">)</span> <span class="n">string</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : gas消耗上限</p></li>
<li><p>返回值1 : 交易体hash</p></li>
</ul>
<blockquote>
<div><p>应用实例</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tx</span><span class="o">.</span><span class="n">GetTransactionHash</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="didextra">
<h4>3.2.28 设置DID账户的Extra交易体构造<a class="headerlink" href="#didextra" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">DIDSetExtra</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : did账户地址</p></li>
<li><p>参数2  : extra信息的key</p></li>
<li><p>参数3  : extra信息value</p></li>
<li><p>返回值1 : 交易体</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>rpc := NewRPC()
//registerDIDAccount函数详细在下面，主要作用是生成一个账户，注册成did账户；
from := registerDIDAccount(rpc, nil)
to := registerDIDAccount(rpc, []string{from.GetAddress()})
key := &quot;key_test&quot;
value := &quot;value_test&quot;

tx := NewTransaction(from.GetAddress()).DIDSetExtra(to.GetAddress(), key, value)
_, err := rpc.SendDIDTransaction(tx, from)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">registerDIDAccount</span><span class="p">(</span><span class="n">rpc</span> <span class="o">*</span><span class="n">RPC</span><span class="p">,</span> <span class="n">admins</span> <span class="p">[]</span><span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">account</span><span class="o">.</span><span class="n">DIDKey</span> <span class="p">{</span>
  <span class="n">rpc</span><span class="o">.</span><span class="n">SetLocalChainID</span><span class="p">()</span>
  <span class="n">randNum</span> <span class="o">:=</span> <span class="n">common</span><span class="o">.</span><span class="n">RandInt</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
  <span class="n">var</span> <span class="n">accountJson</span> <span class="n">string</span>
  <span class="n">password</span> <span class="o">:=</span> <span class="s2">&quot;hyper&quot;</span>
  <span class="n">switch</span> <span class="n">randNum</span> <span class="o">%</span> <span class="mi">3</span> <span class="p">{</span>
  <span class="n">case</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">accountJson</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountED25519</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
  <span class="n">case</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">accountJson</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountSm2</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
  <span class="n">case</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">accountJson</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccount</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">GenKeyFromAccountJson</span><span class="p">(</span><span class="n">accountJson</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
  <span class="n">suffix</span> <span class="o">:=</span> <span class="n">common</span><span class="o">.</span><span class="n">RandomString</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="n">didKey</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewDIDAccount</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">Key</span><span class="p">),</span> <span class="n">rpc</span><span class="o">.</span><span class="n">chainID</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>

  <span class="n">puKey</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">GenDIDPublicKeyFromDIDKey</span><span class="p">(</span><span class="n">didKey</span><span class="p">)</span>
  <span class="n">document</span> <span class="o">:=</span> <span class="n">NewDIDDocument</span><span class="p">(</span><span class="n">didKey</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">(),</span> <span class="n">puKey</span><span class="p">,</span> <span class="n">admins</span><span class="p">)</span>
  <span class="n">tx</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">didKey</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">())</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">SendDIDTransaction</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">didKey</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">didKey</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">nil</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id30">
<h4>3.2.29 获取DID账户的Extra交易体构造<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">DIDGetExtra</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">key</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : did账户地址</p></li>
<li><p>参数2  : extra信息的key</p></li>
<li><p>返回值1 : 交易体</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rpc</span> <span class="o">:=</span> <span class="n">NewRPC</span><span class="p">()</span>
<span class="kn">from</span> <span class="o">:=</span> <span class="n">registerDIDAccount</span><span class="p">(</span><span class="n">rpc</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
<span class="n">to</span> <span class="o">:=</span> <span class="n">registerDIDAccount</span><span class="p">(</span><span class="n">rpc</span><span class="p">,</span> <span class="p">[]</span><span class="n">string</span><span class="p">{</span><span class="n">from</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()})</span>
<span class="n">key</span> <span class="o">:=</span> <span class="s2">&quot;key_test&quot;</span>
<span class="n">tx</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">from</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">())</span><span class="o">.</span><span class="n">DIDGetExtra</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">(),</span> <span class="n">key</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">SendDIDTransaction</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">from</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="bvm">
<h4>3.2.30 调用bvm合约交易体构造<a class="headerlink" href="#bvm" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">InvokeBVM</span><span class="p">(</span><span class="n">to</span> <span class="n">string</span><span class="p">,</span> <span class="n">opt</span> <span class="n">bvm</span><span class="o">.</span><span class="n">BuiltinOperation</span><span class="p">)</span> <span class="o">*</span><span class="n">Transaction</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : 合约地址</p></li>
<li><p>参数2  : 内置合约操作BuiltinOperation</p></li>
<li><p>返回值1 : 交易体实例</p></li>
</ul>
<p>应用实例</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">GenKeyFromAccountJson</span><span class="p">(</span><span class="n">accountJson</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">opt</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewDIDSetChainIDOperation</span><span class="p">(</span><span class="s2">&quot;chainID_01&quot;</span><span class="p">)</span>
<span class="n">tx</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">Key</span><span class="p">)</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">InvokeBVM</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">Address</span><span class="p">(),</span> <span class="n">opt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id31">
<h3>3.3 交易体签名<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id32">
<h4>3.3.1 签名<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h4>
<p>方法签名：</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">Sign</span><span class="p">(</span><span class="n">key</span> <span class="n">interface</span><span class="p">{})</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 : 账户key</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trans</span><span class="o">.</span><span class="n">Sign</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id33">
<h4>3.3.2 批量签名<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h4>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">Transaction</span><span class="p">)</span> <span class="n">SignWithBatchFlag</span><span class="p">(</span><span class="n">key</span> <span class="n">interface</span><span class="p">{})</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 : 原始账户</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">key</span> <span class="n">账户</span>
<span class="n">tx</span><span class="o">.</span><span class="n">SignWithBatchFlag</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id34">
<h4>3.3.3 聚合签名<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<p><strong>3.3.3.1 通过普通账户生成聚合账户</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewAggSignerFromAccount</span><span class="p">(</span><span class="n">key</span> <span class="n">Key</span><span class="p">,</span> <span class="n">publicKeys</span> <span class="p">[]</span><span class="n">gm</span><span class="o">.</span><span class="n">PubKey</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">AggSigner</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : 原始账户</p></li>
<li><p>参数2  : 参与聚合签名的用户的公钥列表</p></li>
<li><p>返回值1 : 聚合账户</p></li>
<li><p>返回值2 : error</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">k1</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="nb">hex</span><span class="o">.</span><span class="n">DecodeString</span><span class="p">(</span><span class="s2">&quot;04a642d77b4c8688124e343af9531de801813f1a880b664ce38a78d76ed128d07b1815004fe1de9c903b349afba9c74775ecc1692a6dd230689ea096521402e834&quot;</span><span class="p">)</span>
<span class="n">k2</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="nb">hex</span><span class="o">.</span><span class="n">DecodeString</span><span class="p">(</span><span class="s2">&quot;042837e98f62ce38e93d41c949425b8e9a5b46107f2bd8725cc7db91b317c6d3199fd87f51883f9cc76a5535ec3b52dac4778597d26e0bc4a0b164cb4b6e87a3d5&quot;</span><span class="p">)</span>
<span class="n">k3</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="nb">hex</span><span class="o">.</span><span class="n">DecodeString</span><span class="p">(</span><span class="s2">&quot;0445a79c4d689b9f19dbf19d58d1cb1952a8b557399f2c3a94a1e52fa21fa47c1acf7bc909e76449914a61a7ada1a855c3d3142181ce35b65cc172e5388dc494d6&quot;</span><span class="p">)</span>

<span class="n">kb</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">gm</span><span class="o">.</span><span class="n">PubKey</span><span class="p">{</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">}</span>
<span class="n">user2</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountSm2FromPriv</span><span class="p">(</span><span class="s2">&quot;5fa355d98ba611d56b05d18a3b665a9e276f21487043c2c88e8a0ce84c0249cb&quot;</span><span class="p">)</span>
<span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<span class="n">signer2</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAggSignerFromAccount</span><span class="p">(</span><span class="n">user2</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>3.3.3.2 通过DID账户生成聚合账户</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewAggSignerFromDIDAccount</span><span class="p">(</span><span class="n">did</span> <span class="o">*</span><span class="n">DIDKey</span><span class="p">,</span> <span class="n">publicKeys</span> <span class="p">[]</span><span class="n">gm</span><span class="o">.</span><span class="n">PubKey</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">AggSigner</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : 原始账户</p></li>
<li><p>参数2  : 参与聚合签名的用户的公钥列表</p></li>
<li><p>返回值1 ： 聚合账户</p></li>
<li><p>返回值2 ： error</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">k1</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="nb">hex</span><span class="o">.</span><span class="n">DecodeString</span><span class="p">(</span><span class="s2">&quot;04a642d77b4c8688124e343af9531de801813f1a880b664ce38a78d76ed128d07b1815004fe1de9c903b349afba9c74775ecc1692a6dd230689ea096521402e834&quot;</span><span class="p">)</span>
<span class="n">k2</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="nb">hex</span><span class="o">.</span><span class="n">DecodeString</span><span class="p">(</span><span class="s2">&quot;042837e98f62ce38e93d41c949425b8e9a5b46107f2bd8725cc7db91b317c6d3199fd87f51883f9cc76a5535ec3b52dac4778597d26e0bc4a0b164cb4b6e87a3d5&quot;</span><span class="p">)</span>
<span class="n">k3</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="nb">hex</span><span class="o">.</span><span class="n">DecodeString</span><span class="p">(</span><span class="s2">&quot;0445a79c4d689b9f19dbf19d58d1cb1952a8b557399f2c3a94a1e52fa21fa47c1acf7bc909e76449914a61a7ada1a855c3d3142181ce35b65cc172e5388dc494d6&quot;</span><span class="p">)</span>
<span class="n">kb</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">gm</span><span class="o">.</span><span class="n">PubKey</span><span class="p">{</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">}</span>
<span class="n">suffix</span> <span class="o">:=</span> <span class="n">common</span><span class="o">.</span><span class="n">RandomString</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">user1</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountSm2FromPriv</span><span class="p">(</span><span class="s2">&quot;14f02ad2f0fc12f25b9a233fb182fa064679c1077fdbbc77d1a945806ebfee35&quot;</span><span class="p">)</span>
<span class="n">did1</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewDIDAccount</span><span class="p">(</span><span class="n">user1</span><span class="p">,</span> <span class="s2">&quot;chainID_01&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
<span class="n">signer</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAggSignerFromDIDAccount</span><span class="p">(</span><span class="n">did1</span><span class="p">,</span> <span class="n">kb</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>3.3.3.3 聚合随机承诺</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span><span class="n">AggSigner</span><span class="p">)</span> <span class="n">AggCommitment</span><span class="p">(</span><span class="ow">in</span> <span class="o">...</span><span class="n">gm</span><span class="o">.</span><span class="n">Commitment</span><span class="p">)</span> <span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">Commitment</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数   ： 参与聚合签名的所有用户的承诺</p></li>
<li><p>返回值1 ： 聚合承诺</p></li>
<li><p>返回值2 ： error</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aggCommitment</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">first</span><span class="o">.</span><span class="n">AggCommitment</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">Commitment</span><span class="p">(),</span> <span class="n">second</span><span class="o">.</span><span class="n">Commitment</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>3.3.3.4 部分签名</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span><span class="n">AggSigner</span><span class="p">)</span> <span class="n">PartSign</span><span class="p">(</span><span class="n">msg</span> <span class="p">[]</span><span class="n">byte</span><span class="p">,</span> <span class="n">aggCommitment</span> <span class="n">gm</span><span class="o">.</span><span class="n">Commitment</span><span class="p">)</span> <span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">Signature</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： message</p></li>
<li><p>参数2  ： 聚合承诺</p></li>
<li><p>返回值1 ： 部分签名</p></li>
<li><p>返回值2 ： error</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s1</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">first</span><span class="o">.</span><span class="n">PartSign</span><span class="p">([]</span><span class="n">byte</span><span class="p">(</span><span class="n">transaction</span><span class="o">.</span><span class="n">NeedHashString</span><span class="p">()),</span> <span class="n">aggCommitment</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>3.3.3.5 聚合签名</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span><span class="n">AggSigner</span><span class="p">)</span> <span class="n">AggSign</span><span class="p">(</span><span class="n">signs</span> <span class="o">...</span><span class="n">gm</span><span class="o">.</span><span class="n">Signature</span><span class="p">)</span> <span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">Signature</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： 参与聚合签名用户的部分签名</p></li>
<li><p>返回值1 ： 聚合签名签名</p></li>
<li><p>返回值2 ： error</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aggSign</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">first</span><span class="o">.</span><span class="n">AggSign</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>3.3.3.6 完整实例</strong></p>
<p><strong>*</strong> 注意 <strong>**</strong></p>
<p><strong>如果最后调用AggSign的用户是DID账户，那么transaction的Participant的第一个属性initiator的值可以为以下两种</strong></p>
<ol class="arabic simple">
<li><p><strong>initiator为DID账户的address</strong></p></li>
</ol>
<ol class="arabic simple">
<li><p><strong>initiator为DID账户的publickey，那这样调用AggSign前必须先调用SetHasDID将hasDID设置为false</strong></p></li>
</ol>
<p><strong>如果最后调用AggSign的用户是非DID账户，那么transaction的Participant的第一个属性initiator的值为账户的publicKey</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">TestAggSign</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">rp</span> <span class="o">:=</span> <span class="n">NewRPC</span><span class="p">()</span>
  <span class="n">user1</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountSm2FromPriv</span><span class="p">(</span><span class="s2">&quot;14f02ad2f0fc12f25b9a233fb182fa064679c1077fdbbc77d1a945806ebfee35&quot;</span><span class="p">)</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

  <span class="n">user2</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountSm2FromPriv</span><span class="p">(</span><span class="s2">&quot;5fa355d98ba611d56b05d18a3b665a9e276f21487043c2c88e8a0ce84c0249cb&quot;</span><span class="p">)</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
  <span class="n">pk1</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">user1</span><span class="o">.</span><span class="n">PublicBytes</span><span class="p">()</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
  <span class="n">pk2</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">user2</span><span class="o">.</span><span class="n">PublicBytes</span><span class="p">()</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
  <span class="n">pks</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">gm</span><span class="o">.</span><span class="n">PubKey</span><span class="p">{</span><span class="n">pk1</span><span class="p">,</span> <span class="n">pk2</span><span class="p">}</span>

  <span class="n">first</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAggSignerFromAccount</span><span class="p">(</span><span class="n">user1</span><span class="p">,</span> <span class="n">pks</span><span class="p">)</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

  <span class="n">second</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAggSignerFromAccount</span><span class="p">(</span><span class="n">user2</span><span class="p">,</span> <span class="n">pks</span><span class="p">)</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

  <span class="n">aggCommitment</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">first</span><span class="o">.</span><span class="n">AggCommitment</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">Commitment</span><span class="p">(),</span> <span class="n">second</span><span class="o">.</span><span class="n">Commitment</span><span class="p">())</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

  <span class="n">transaction</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">Address</span><span class="p">()</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">Participant</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Participant</span><span class="p">{</span>
      <span class="n">Initiator</span><span class="p">:</span>   <span class="n">pk1</span><span class="p">,</span>
      <span class="n">Withholding</span><span class="p">:</span> <span class="p">[][]</span><span class="n">byte</span><span class="p">{</span><span class="n">pk2</span><span class="p">},</span>
  <span class="p">})</span><span class="o">.</span><span class="n">Transfer</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
  <span class="n">s1</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">first</span><span class="o">.</span><span class="n">PartSign</span><span class="p">([]</span><span class="n">byte</span><span class="p">(</span><span class="n">transaction</span><span class="o">.</span><span class="n">NeedHashString</span><span class="p">()),</span> <span class="n">aggCommitment</span><span class="p">)</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
  <span class="n">s2</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">second</span><span class="o">.</span><span class="n">PartSign</span><span class="p">([]</span><span class="n">byte</span><span class="p">(</span><span class="n">transaction</span><span class="o">.</span><span class="n">NeedHashString</span><span class="p">()),</span> <span class="n">aggCommitment</span><span class="p">)</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>

  <span class="n">aggSign</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">first</span><span class="o">.</span><span class="n">AggSign</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
  <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">Bytes2Hex</span><span class="p">(</span><span class="n">aggSign</span><span class="p">))</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">first</span><span class="o">.</span><span class="n">Verify</span><span class="p">([]</span><span class="n">byte</span><span class="p">(</span><span class="n">transaction</span><span class="o">.</span><span class="n">NeedHashString</span><span class="p">()),</span> <span class="n">aggSign</span><span class="p">))</span>
  <span class="n">transaction</span><span class="o">.</span><span class="n">Signature</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">Bytes2Hex</span><span class="p">(</span><span class="n">aggSign</span><span class="p">))</span>

  <span class="n">resp</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">rp</span><span class="o">.</span><span class="n">SignAndInvokeContract</span><span class="p">(</span><span class="n">transaction</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
  <span class="k">assert</span><span class="o">.</span><span class="n">Nil</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
  <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>

<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="id35">
<h2>第四章 虚拟机<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h2>
<div class="section" id="evm">
<h3>4.1 EVM<a class="headerlink" href="#evm" title="Permalink to this headline">¶</a></h3>
<div class="section" id="abi">
<h4>4.1.1 abi解析<a class="headerlink" href="#abi" title="Permalink to this headline">¶</a></h4>
<p>EVM对应的合约为solidity，解析合约abi为如下struct</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">ABI</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">Constructor</span> <span class="n">Method</span>
  <span class="n">Methods</span>     <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">Method</span>
  <span class="n">Events</span>      <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">Event</span>

  <span class="o">//</span> <span class="n">Fields</span> <span class="n">that</span> <span class="n">record</span> <span class="n">overloaded</span> <span class="n">methods</span> <span class="ow">and</span> <span class="n">events</span>
  <span class="n">allMethods</span> <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">Method</span>
  <span class="n">allEvents</span>  <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">Event</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>方法签名：</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">JSON</span><span class="p">(</span><span class="n">reader</span> <span class="n">io</span><span class="o">.</span><span class="n">Reader</span><span class="p">)</span> <span class="p">(</span><span class="n">ABI</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： 合约的io流</p></li>
<li><p>返回值1 ： ABI结构体</p></li>
<li><p>返回值2 ： error，详见第七章</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">abiContract</span> <span class="n">合约编码后的abi</span>
<span class="n">ABI</span><span class="p">,</span> <span class="n">serr</span> <span class="o">:=</span> <span class="n">abi</span><span class="o">.</span><span class="n">JSON</span><span class="p">(</span><span class="n">strings</span><span class="o">.</span><span class="n">NewReader</span><span class="p">(</span><span class="n">abiContract</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.1.1.1 合约方法获取</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">abi</span> <span class="n">ABI</span><span class="p">)</span> <span class="n">GetMethod</span><span class="p">(</span><span class="n">methodSig</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">Method</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.1.1.2 合约event获取</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">abi</span> <span class="n">ABI</span><span class="p">)</span> <span class="n">GetEvent</span><span class="p">(</span><span class="n">eventSig</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">Event</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.1.1.3 将方法以及参数转为binary</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">abi</span> <span class="n">ABI</span><span class="p">)</span> <span class="n">GetPayload</span><span class="p">(</span><span class="n">funcName</span> <span class="n">string</span><span class="p">,</span> <span class="n">args</span> <span class="o">...</span><span class="n">string</span><span class="p">)</span> <span class="n">string</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.1.1.4 编码调用的方法和参数</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">abi</span> <span class="n">ABI</span><span class="p">)</span> <span class="n">Pack</span><span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">,</span> <span class="n">args</span> <span class="o">...</span><span class="n">interface</span><span class="p">{})</span> <span class="p">([]</span><span class="n">byte</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">packed</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ABI</span><span class="o">.</span><span class="n">Pack</span><span class="p">(</span><span class="s2">&quot;testOverload&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">...</span><span class="p">)</span>

<span class="n">packed</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ABI</span><span class="o">.</span><span class="n">Pack</span><span class="p">(</span><span class="s2">&quot;testOverload(int24,bool[])&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>说明：</p>
<ol class="arabic simple">
<li><p>若调用时仅仅使用方法名称，则默认调用无参同名方法，若未找到无参同名方法，则调用最后一个匹配到的方法，即最后声明的同名方法；</p></li>
<li><p>方法签名的构造方式为：</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;MethodName(inputType1,inputType2,...inputTypeN)&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>即在方法名称之后使用括号将传参类型统一包括，类型之间以逗号分隔。</p>
<ol class="arabic simple">
<li><p>方法签名括号中规定了方法传参类型，传参类型之间必须使用“,”分隔，传参类型必须与abi中inputs里对应的type一致，且数量和顺序必须保持一致。</p></li>
<li><p>事件签名构造同理：</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;EventName(inputType1,inputType2,...inputTypeN)&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.1.1.5 返回值解析</strong></p>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">abi</span> <span class="o">*</span><span class="n">ABI</span><span class="p">)</span> <span class="n">UnpackResult</span><span class="p">(</span><span class="n">v</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="n">err</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>得到返回值结果后，获得状态码可以判断是否调用成功，若调用成功，解析返回值可看到调用之后的结果。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">decode</span>
<span class="o">//</span><span class="n">返回值解析</span>
<span class="n">var</span> <span class="n">result</span> <span class="n">string</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ABI</span><span class="o">.</span><span class="n">UnpackResult</span><span class="p">(</span><span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="n">txInvoke1</span><span class="o">.</span><span class="n">Ret</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
  <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
  <span class="k">return</span>
<span class="p">}</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;get返回值:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.1.1.6 反序列化</strong></p>
<blockquote>
<div><p>func (abi <a href="#id36"><span class="problematic" id="id37">*</span></a>ABI) UnmarshalJSON(data []byte) error</p>
</div></blockquote>
<p><strong>4.1.1.7 通过方法的id获取方法</strong></p>
<blockquote>
<div><p>func (abi <a href="#id38"><span class="problematic" id="id39">*</span></a>ABI) MethodById(sigdata []byte) (<a href="#id40"><span class="problematic" id="id41">*</span></a>Method, error)</p>
</div></blockquote>
</div>
<div class="section" id="abi-v2">
<h4>4.1.2 abi v2<a class="headerlink" href="#abi-v2" title="Permalink to this headline">¶</a></h4>
<p>abiv2 与 abi 在abi的结构上有了较大的变化，如下以结构ABI为例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">abi</span>
</pre></div>
</div>
<dl>
<dt>type ABI struct {</dt><dd><p>Constructor Method
Methods     map[string]Method
Events      map[string]Event</p>
<p>// Fields that record overloaded methods and events
allMethods map[string]Method
allEvents  map[string]Event</p>
</dd>
</dl>
<p>}</p>
<p>// abiv2
type ABI struct {</p>
<blockquote>
<div><p>Constructor Method
Methods     map[string]Method
Events      map[string]Event</p>
<p>// Additional “special” functions introduced in solidity v0.6.0.
// It’s separated from the original default fallback. Each contract
// can only define one fallback and receive function.
Fallback Method // Note it’s also used to represent legacy fallback before v0.6.0
Receive  Method</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>因此，abiv2 独立于原先的abi目录，新增abi2目录。下面列出常用的方法</p>
<p><strong>4.1.2.1 编码</strong></p>
<blockquote>
<div><p>func (abi ABI) Pack(name string, args …interface{}) ([]byte, error)</p>
</div></blockquote>
<p><strong>4.1.2.2 解码</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">abi</span> <span class="o">*</span><span class="n">ABI</span><span class="p">)</span> <span class="n">UnpackResult</span><span class="p">(</span><span class="n">v</span> <span class="n">interface</span><span class="p">{},</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="n">err</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="id42">
<h3>4.2 BVM<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h3>
<p>BVM全称是 <strong>built-in virtual machine</strong> ，是用于处理内置合约的虚拟机类型。BVM的出现使得开发者可以自定义一些内置合约，提供一些固定的功能。</p>
<p><strong>内置合约</strong>，即是合约代码由开发人员预先写好，在平台启动时就直接创建对象加载，不需要用户手动部署的合约。由于合约随着平台预先创建加载， 所以合约地址固定不变，且相比普通合约有以下特性：</p>
<ul class="simple">
<li><p><strong>不需部署</strong> （也可以理解为平台刚启动就被 <strong>”部署“</strong> 在某个固定地址上）。</p></li>
<li><p><strong>目前功能单一</strong> （只支持两份），但之后可以不断地进行扩展。</p></li>
<li><p>做合约修改或增加新的内置合约需要 <strong>平台兼容</strong> 做调整。</p></li>
<li><p><strong>不属于任何人</strong> ，及任何用户都不可以对该合约进行升级或冻结、解冻的相关操作。</p></li>
</ul>
<p>目前支持以下几种种内置合约</p>
<ol class="arabic simple">
<li><p><strong>提案相关</strong> ,ProposalContract 合约地址为 <cite>0x0000000000000000000000000000000000ffff02</cite></p></li>
<li><p><strong>hash相关</strong> ,HashContract合约地址为  <cite>0x0000000000000000000000000000000000ffff01</cite></p></li>
<li><p><strong>did相关</strong> ，合约地址为 <cite>0x0000000000000000000000000000000000ffff06</cite></p></li>
<li><p><strong>证书相关</strong> ，合约地址为 <cite>0x0000000000000000000000000000000000ffff05</cite></p></li>
<li><p><strong>账户相关</strong> ，合约地址为 <cite>0x0000000000000000000000000000000000ffff04</cite></p></li>
<li><p><strong>mpc(多方安全计算)合约相关</strong> 合约地址为 <cite>0x0000000000000000000000000000000000ffff09</cite></p></li>
<li><p><strong>Root CA相关</strong> ，合约地址为 <cite>0x0000000000000000000000000000000000ffff0b</cite></p></li>
<li><p><strong>跨分区相关</strong> ,合约地址为 <cite>0x0000000000000000000000000000000000ffff0a</cite></p></li>
<li><p><strong>hash类型查询</strong> ，合约地址为 <cite>0x0000000000000000000000000000000000ffff0d</cite></p></li>
<li><p><strong>balanceManager相关</strong> ，合约地址为 <cite>0x0000000000000000000000000000000000ffff0e</cite></p></li>
</ol>
<div class="section" id="id43">
<h4>4.2.1 编解码<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h4>
<p><strong>4.2.1.1 将操作编码成payload</strong></p>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">EncodeOperation</span><span class="p">(</span><span class="n">ope</span> <span class="n">Operation</span><span class="p">)</span> <span class="p">[]</span><span class="n">byte</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： 操作</p></li>
<li><p>返回值1 ： 对应交易体的payload</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">opt</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewDIDSetChainIDOperation</span><span class="p">(</span><span class="s2">&quot;chainID_01&quot;</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">EncodeOperation</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.1.2 返回值解码</strong></p>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">Decode</span><span class="p">(</span><span class="n">ret</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">Result</span>

<span class="o">//</span> <span class="n">Result</span> <span class="n">represent</span> <span class="n">the</span> <span class="n">execute</span> <span class="n">result</span> <span class="n">of</span> <span class="n">BVM</span>
<span class="nb">type</span> <span class="n">Result</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">Success</span> <span class="nb">bool</span>
  <span class="n">Ret</span> <span class="p">[]</span><span class="n">byte</span>
  <span class="n">Err</span> <span class="n">string</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： 交易回执里面的Ret</p></li>
<li><p>返回值1 ： Result结构体</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// 发送交易拿到回执后，取ret字段
retStr := `0x7b2253756363657373223a747275652c22526574223a22573373695932396b5a5349364d6a417766537837496d4e765a4755694f6a49774d48307365794a6a6232526c496a6f794d4442394c4873695932396b5a5349364d6a41776656303d222c22457272223a22227d`
res := bvm.Decode(retStr)
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.1.3 提案code解码</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>type ProposalData struct {
  Id        uint64              `protobuf:&quot;varint,1,opt,name=id,proto3&quot; json:&quot;id,omitempty&quot;`
  Code      []byte              `protobuf:&quot;bytes,2,opt,name=code,proto3&quot; json:&quot;code,omitempty&quot;`
  Timestamp int64               `protobuf:&quot;varint,3,opt,name=timestamp,proto3&quot; json:&quot;timestamp,omitempty&quot;`
  Timeout   int64               `protobuf:&quot;varint,4,opt,name=timeout,proto3&quot; json:&quot;timeout,omitempty&quot;`
  Status    ProposalData_Status `protobuf:&quot;varint,5,opt,name=status,proto3,enum=bvm.ProposalData_Status&quot; json:&quot;status,omitempty&quot;`
  Assentor  []*VoteInfo         `protobuf:&quot;bytes,6,rep,name=assentor,proto3&quot; json:&quot;assentor,omitempty&quot;`
  Objector  []*VoteInfo         `protobuf:&quot;bytes,7,rep,name=objector,proto3&quot; json:&quot;objector,omitempty&quot;`
  Threshold uint32              `protobuf:&quot;varint,8,opt,name=threshold,proto3&quot; json:&quot;threshold,omitempty&quot;`
  Score     uint32              `protobuf:&quot;varint,9,opt,name=score,proto3&quot; json:&quot;score,omitempty&quot;`
  Creator   string              `protobuf:&quot;bytes,10,opt,name=creator,proto3&quot; json:&quot;creator,omitempty&quot;`
  Version   string              `protobuf:&quot;bytes,11,opt,name=version,proto3&quot; json:&quot;version,omitempty&quot;`
  Type      ProposalData_PType  `protobuf:&quot;varint,12,opt,name=type,proto3,enum=bvm.ProposalData_PType&quot; json:&quot;type,omitempty&quot;`
  Completed []byte              `protobuf:&quot;bytes,13,opt,name=completed,proto3&quot; json:&quot;completed,omitempty&quot;`
  Cancel    []byte              `protobuf:&quot;bytes,14,opt,name=cancel,proto3&quot; json:&quot;cancel,omitempty&quot;`
}
</pre></div>
</div>
</div></blockquote>
<p>解码提案数据的code字段</p>
<p>方法签名</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">DecodeProposalCode</span><span class="p">(</span><span class="n">code</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proposalHexString</span> <span class="o">:=</span> <span class="s2">&quot;08011284030000000a0000000f53657446696c746572456e61626c65000000010000000566616c73650000000e53657446696c74657252756c6573000000010000001f5b7b22616c6c6f775f616e796f6e65223a66616c73652c226964223a307d5d00000015536574436f6e73656e737573426174636853697a65000000010000000331303000000014536574436f6e73656e737573506f6f6c53697a65000000010000000332303000000013536574436f6e73656e73757353657453697a65000000010000000235300000001453657450726f706f73616c5468726573686f6c640000000100000001340000001253657450726f706f73616c54696d656f7574000000010000000c3438303030303030303030300000001253657450726f706f73616c54696d656f7574000000010000000c34383030303030303030303000000018536574436f6e7472616374566f74655468726573686f6c6400000001000000013300000015536574436f6e7472616374566f7465456e61626c6500000001000000047472756518d0bbb4bbebcec4d11620d0abc786c9d7c4d116280132720a2a3078303030663161376130386363633438653564333066383038353063663163663238336161336162641242307831366133313237363930393565323832633130323861376138376634336563623864623937653765643166386234663466626438393435356363353266386666180140064801522a3078303030663161376130386363633438653564333066383038353063663163663238336161336162645a05302e312e30&quot;</span>
<span class="n">a</span> <span class="o">:=</span> <span class="n">common</span><span class="o">.</span><span class="n">Hex2Bytes</span><span class="p">(</span><span class="n">proposalHexString</span><span class="p">)</span>
<span class="n">var</span> <span class="n">pro</span> <span class="n">bvm</span><span class="o">.</span><span class="n">ProposalData</span>
<span class="n">proto</span><span class="o">.</span><span class="n">Unmarshal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pro</span><span class="p">)</span> <span class="o">//</span> <span class="n">提案数据解码</span>
<span class="n">code</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">DecodeProposalCode</span><span class="p">(</span><span class="n">pro</span><span class="o">.</span><span class="n">Code</span><span class="p">)</span> <span class="o">//</span> <span class="n">提案code字段解码</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id44">
<h4>4.2.2 提案的使用<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li><p>提案总共有六个状态：等待投票、驳回、等待执行、已完成、取消和超时。</p></li>
<li><p>只有创建者有权取消提案</p></li>
<li><p>提案创建后通过投票可进入等待执行、驳回状态</p></li>
<li><p>处于等待执行的提案可有发起者发起执行操作，执行完成进入已完成状态</p></li>
<li><p>提案处于等待投票、等待执行状态时无法创建新的提案</p></li>
<li><p>目前提案的默认阈值为链级管理员的总个数，每个链级管理员均可以对此提案进行投票，若此提案获得的票数大于等于阈值则通过投票</p></li>
<li><p>目前提案的默认超时时间为5分钟（当设置当超时时间小于5分钟时，会设置为5分钟），即创建提案的交易打包时间+5分钟则为提案超时时间</p></li>
<li><p>每次执行提案交易都会拿到当前系统中最新的提案，将当前执行的交易的打包时间与提案的超时时间进行对比，如果大于超时时间，则将提案状态置为超时。（不能单纯的认为提案创建后，过了超时时长就一定超时了，没过超时时长就一定没超时。交易的打包时间是主节点中打包交易时取的当前系统时间，主节点的系统时间可能不是正常的时间序列，例如：如果提案创建后发生了viewchange，viewchange之前的主节点在当前时刻的系统时间为1:00，viewchange之后的主节点中当前时刻的系统时间为1:30，这时即使提案创建之后没有超过超时时长，对提案进行投票，由于新的主节点的时间为1:30，打包的时间戳也为1:30对应的时间戳，在执行提案对比是否超时时，判断的结果就为超时。目前主节点时间变更除了viewchange之外，还有主节点主动作恶、或根据需要主动变更系统时间。）</p></li>
</ul>
</div></blockquote>
<p>根据提案的状态以及对提案的操作，可得出一个提案的状态迁移如下图所示：</p>
<img alt="提案状态迁移示意图" class="align-center" src="../../images/GoSDK/GoSDK2.png" />
<p>对于提案可根据提案内容划分为以下几类：</p>
<blockquote>
<div><ul class="simple">
<li><p>配置类， ptype为 <cite>config</cite> ，data则为配置项操作列表；</p></li>
<li><p>权限类，ptype为 <cite>permission</cite> ，data为权限操作列表；</p></li>
<li><p>节点类，ptype为 <cite>node</cite> ，data为节点操作列表；</p></li>
<li><p>合约命名类，ptype为 <cite>cns</cite> ，data为合约命名操作列表；</p></li>
<li><p>合约生命周期管理类，ptype为 <cite>contract</cite> ，data为合约生命周期管理操作列表；</p></li>
<li><p>ca模式类，ptype为 <cite>ca</cite> ，data为ca操作列表；</p></li>
</ul>
</div></blockquote>
<p><strong>4.2.2.1 合约提案创建</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewProposalCreateOperationForContract</span><span class="p">(</span><span class="n">ops</span> <span class="o">...</span><span class="n">ContractOperation</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （opts） ： 一组合约类型的操作</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ope</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewContractDeployContractOperation</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">Hex2Bytes</span><span class="p">(</span><span class="nb">bin</span><span class="p">),</span> <span class="s2">&quot;evm&quot;</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
<span class="n">contractOpt</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalCreateOperationForContract</span><span class="p">(</span><span class="n">ope</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.2 命名提案创建</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewProposalCreateOperationForCNS</span><span class="p">(</span><span class="n">ops</span> <span class="o">...</span><span class="n">CNSOperation</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （opts） ： 一组合约命名类型的操作</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">addr</span> <span class="n">合约地址</span>
<span class="o">//</span> <span class="n">name</span> <span class="n">命名</span>
<span class="n">setCNameOpt</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewCNSSetCNameOperation</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="n">cnsOpt</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalCreateOperationForCNS</span><span class="p">(</span><span class="n">setCNameOpt</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.3 节点类型的提案创建</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewProposalCreateOperationForNode</span><span class="p">(</span><span class="n">ops</span> <span class="o">...</span><span class="n">NodeOperation</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （opts） ： 一组节点类型的操作</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">operations</span> <span class="p">[]</span><span class="n">bvm</span><span class="o">.</span><span class="n">NodeOperation</span>
<span class="n">operations</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">operations</span><span class="p">,</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewNodeAddNodeOperation</span><span class="p">([]</span><span class="n">byte</span><span class="p">(</span><span class="s2">&quot;pub&quot;</span><span class="p">),</span> <span class="s2">&quot;node1&quot;</span><span class="p">,</span> <span class="s2">&quot;vp&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">))</span>
<span class="n">operations</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">operations</span><span class="p">,</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewNodeAddVPOperation</span><span class="p">(</span><span class="s2">&quot;node1&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">))</span>
<span class="n">operations</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">operations</span><span class="p">,</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewNodeRemoveVPOperation</span><span class="p">(</span><span class="s2">&quot;node1&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">))</span>
<span class="n">proposalCreateOperation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalCreateOperationForNode</span><span class="p">(</span><span class="n">operations</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.4 权限类型的提案创建</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewProposalCreateOperationForPermission</span><span class="p">(</span><span class="n">ops</span> <span class="o">...</span><span class="n">PermissionOperation</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （opts） ： 一组权限类型的操作</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">operations</span> <span class="p">[]</span><span class="n">bvm</span><span class="o">.</span><span class="n">PermissionOperation</span>
<span class="n">operations</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">operations</span><span class="p">,</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewPermissionCreateRoleOperation</span><span class="p">(</span><span class="n">managerRole</span><span class="p">))</span>
<span class="n">operations</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">operations</span><span class="p">,</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewPermissionGrantOperation</span><span class="p">(</span><span class="n">managerRole</span><span class="p">,</span> <span class="n">notAdminAddress</span><span class="p">))</span>
<span class="n">operations</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">operations</span><span class="p">,</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewPermissionRevokeOperation</span><span class="p">(</span><span class="n">managerRole</span><span class="p">,</span> <span class="n">notAdminAddress</span><span class="p">))</span>
<span class="n">operations</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">operations</span><span class="p">,</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewPermissionDeleteRoleOperation</span><span class="p">(</span><span class="n">managerRole</span><span class="p">))</span>
<span class="n">proposalCreateOperation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalCreateOperationForPermission</span><span class="p">(</span><span class="n">operations</span><span class="o">...</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">EncodeOperation</span><span class="p">(</span><span class="n">proposalCreateOperation</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.5 通过配置内容创建配置提案</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewProposalCreateOperationForConfig</span><span class="p">(</span><span class="n">config</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="p">(</span><span class="n">BuiltinOperation</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 配置内容</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>var config = `
[filter]
    enable = false
    [[filter.rules]]
    allow_anyone = false
    authorized_roles = [&quot;admin&quot;]
    forbidden_roles = [&quot;20&quot;]
    id = 0
    name = &quot;bvm auth&quot;
    to = [&quot;0x0000000000000000000000000000000000ffff02&quot;]
    vm = [&quot;bvm&quot;]
[consensus]
  algo = &quot;RBFT&quot;

  [consensus.pool]
    batch_size = 20
    pool_size = 3000

  [consensus.set]
    set_size = 20

[proposal]
  timeout   = &quot;15m&quot;
  threshold = 3
`

operation, _ := bvm.NewProposalCreateOperationForConfig([]byte(config))
payload := bvm.EncodeOperation(operation)
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.6 通过配置类型操作创建配置提案</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewProposalCreateOperationByConfigOps</span><span class="p">(</span><span class="n">ops</span> <span class="o">...</span><span class="n">ConfigOperation</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 一组配置类型的操作</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalCreateOperationByConfigOps</span><span class="p">(</span><span class="n">bvm</span><span class="o">.</span><span class="n">NewSetProposalThreshold</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.7 提案投票</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewProposalVoteOperation</span><span class="p">(</span><span class="n">proposalID</span> <span class="nb">int</span><span class="p">,</span> <span class="n">vote</span> <span class="nb">bool</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 提案id</p></li>
<li><p>参数2 ： 是否开启投票</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">operation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalVoteOperation</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">proposal</span><span class="o">.</span><span class="n">Id</span><span class="p">),</span> <span class="n">false</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.8 提案取消</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewProposalCancelOperation</span><span class="p">(</span><span class="n">proposalID</span> <span class="nb">int</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 提案id</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">operation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalCancelOperation</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.9 提案执行</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewProposalExecuteOperation</span><span class="p">(</span><span class="n">proposalID</span> <span class="nb">int</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 提案id</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">operation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalExecuteOperation</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.10  权限类型的操作—-创建角色</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewPermissionCreateRoleOperation</span><span class="p">(</span><span class="n">role</span> <span class="n">string</span><span class="p">)</span> <span class="n">PermissionOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 角色名</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>managerRole ：= &quot;manager&quot;
bvm.NewPermissionCreateRoleOperation(managerRole)
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.11 权限类型的操作—-删除角色</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewPermissionDeleteRoleOperation</span><span class="p">(</span><span class="n">role</span> <span class="n">string</span><span class="p">)</span> <span class="n">PermissionOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 角色名</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>managerRole ：= &quot;manager&quot;
bvm.NewPermissionDeleteRoleOperation(managerRole)
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.12  权限类型的操作—-权限授予</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewPermissionGrantOperation</span><span class="p">(</span><span class="n">role</span> <span class="n">string</span><span class="p">,</span> <span class="n">address</span> <span class="n">string</span><span class="p">)</span> <span class="n">PermissionOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 角色名</p></li>
<li><p>参数2 ： 账户地址</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pwd</span> <span class="o">:=</span> <span class="s2">&quot;12345678&quot;</span>
<span class="n">nonAdminAcc</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccount</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>
<span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">GenKeyFromAccountJson</span><span class="p">(</span><span class="n">nonAdminAcc</span><span class="p">,</span> <span class="n">pwd</span><span class="p">)</span>
<span class="n">addr</span> <span class="o">:=</span> <span class="n">key</span><span class="o">.</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">Key</span><span class="p">)</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span><span class="o">.</span><span class="n">Hex</span><span class="p">()</span>
<span class="n">createRole</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewPermissionGrantOperation</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
<span class="n">operation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalCreateOperationForPermission</span><span class="p">(</span><span class="n">createRole</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">EncodeOperation</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.13 权限类型的操作—-删除权限</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewPermissionRevokeOperation</span><span class="p">(</span><span class="n">role</span> <span class="n">string</span><span class="p">,</span> <span class="n">address</span> <span class="n">string</span><span class="p">)</span> <span class="n">PermissionOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 角色名</p></li>
<li><p>参数2 ： 账户地址</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pwd</span> <span class="o">:=</span> <span class="s2">&quot;12345678&quot;</span>
<span class="n">nonAdminAcc</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccount</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span>
<span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">GenKeyFromAccountJson</span><span class="p">(</span><span class="n">nonAdminAcc</span><span class="p">,</span> <span class="n">pwd</span><span class="p">)</span>
<span class="n">addr</span> <span class="o">:=</span> <span class="n">key</span><span class="o">.</span><span class="p">(</span><span class="n">account</span><span class="o">.</span><span class="n">Key</span><span class="p">)</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span><span class="o">.</span><span class="n">Hex</span><span class="p">()</span>
<span class="n">revokeRole</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewPermissionRevokeOperation</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
<span class="n">operation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalCreateOperationForPermission</span><span class="p">(</span><span class="n">revokeRole</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">EncodeOperation</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.14 节点类型的操作—-添加节点</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewNodeAddNodeOperation</span><span class="p">(</span><span class="n">pub</span> <span class="p">[]</span><span class="n">byte</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">namespace</span> <span class="n">string</span><span class="p">)</span> <span class="n">NodeOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 对应节点公钥或者证书的byte数组</p></li>
<li><p>参数2 ： 节点名</p></li>
<li><p>参数3 ： 节点角色</p></li>
<li><p>参数4 ： 节点namespace</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bvm</span><span class="o">.</span><span class="n">NewNodeAddNodeOperation</span><span class="p">([]</span><span class="n">byte</span><span class="p">(</span><span class="s2">&quot;pub&quot;</span><span class="p">),</span> <span class="s2">&quot;node1&quot;</span><span class="p">,</span> <span class="s2">&quot;vp&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.15  节点类型的操作—-启动vp</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewNodeAddVPOperation</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">namespace</span> <span class="n">string</span><span class="p">)</span> <span class="n">NodeOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 : 节点名</p></li>
<li><p>参数2 : 节点namespace</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bvm</span><span class="o">.</span><span class="n">NewNodeAddVPOperation</span><span class="p">(</span><span class="s2">&quot;node1&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.16 节点类型的操作—-删除vp</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewNodeRemoveVPOperation</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">namespace</span> <span class="n">string</span><span class="p">)</span> <span class="n">NodeOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 - 节点名</p></li>
<li><p>参数2 - 节点namespace</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bvm</span><span class="o">.</span><span class="n">NewNodeRemoveVPOperation</span><span class="p">(</span><span class="s2">&quot;node1&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.17 合约命名类型的操作—-设定合约名</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewCNSSetCNameOperation</span><span class="p">(</span><span class="n">address</span> <span class="n">string</span><span class="p">,</span> <span class="n">cnsName</span> <span class="n">string</span><span class="p">)</span> <span class="n">CNSOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 合约地址</p></li>
<li><p>参数2 ： 合约名</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">addr</span> <span class="o">:=</span> <span class="s2">&quot;0x0000000000000000000000000000000000ffff01&quot;</span>
<span class="n">name</span> <span class="o">:=</span> <span class="s2">&quot;HashContract&quot;</span>
<span class="n">setCNameOpt</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewCNSSetCNameOperation</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.18 合约类型的操作—-部署合约</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewContractDeployContractOperation</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">bin</span> <span class="p">[]</span><span class="n">byte</span><span class="p">,</span> <span class="n">vmType</span> <span class="n">string</span><span class="p">,</span> <span class="n">compileOpts</span> <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">string</span><span class="p">)</span> <span class="n">ContractOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 合约源文件</p></li>
<li><p>参数2 ： 合约编译后bin</p></li>
<li><p>参数3 ： 虚拟机类型</p></li>
<li><p>参数4 ： 编译选项</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="s2">&quot;../conf/contract/Accumulator.sol&quot;</span><span class="p">)</span>
<span class="n">ope</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewContractDeployContractOperation</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">Hex2Bytes</span><span class="p">(</span><span class="n">binContract</span><span class="p">),</span> <span class="s2">&quot;evm&quot;</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.19 合约类型的操作—-升级合约</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewContractUpgradeContractOperation</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">bin</span> <span class="p">[]</span><span class="n">byte</span><span class="p">,</span> <span class="n">vmType</span><span class="p">,</span> <span class="n">contractAddress</span> <span class="n">string</span><span class="p">,</span> <span class="n">compileOpts</span> <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">string</span><span class="p">)</span> <span class="n">ContractOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 - 合约源文件</p></li>
<li><p>参数2 - 合约编译后bin</p></li>
<li><p>参数3 - 虚拟机类型</p></li>
<li><p>参数4 - 已部署的合约地址</p></li>
<li><p>参数5 - 编译选项</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="s2">&quot;../conf/contract/Accumulator.sol&quot;</span><span class="p">)</span>
<span class="o">//</span> <span class="n">contractAddress</span> <span class="n">已部署合约地址</span>
<span class="n">ope</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewContractUpgradeContractOperation</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">Hex2Bytes</span><span class="p">(</span><span class="n">binContract</span><span class="p">),</span> <span class="s2">&quot;evm&quot;</span><span class="p">,</span> <span class="n">contractAddr</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.20 合约类型的操作—-通过合约名升级合约</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewContractUpgradeOperationByName</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">bin</span> <span class="p">[]</span><span class="n">byte</span><span class="p">,</span> <span class="n">vmType</span><span class="p">,</span> <span class="n">contractName</span> <span class="n">string</span><span class="p">,</span> <span class="n">compileOpts</span> <span class="nb">map</span><span class="p">[</span><span class="n">string</span><span class="p">]</span><span class="n">string</span><span class="p">)</span> <span class="n">ContractOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 合约源文件</p></li>
<li><p>参数2 ： 合约编译后bin</p></li>
<li><p>参数3 ： 虚拟机类型</p></li>
<li><p>参数4 ： 已部署的合约名</p></li>
<li><p>参数5 ： 编译选项</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="s2">&quot;../conf/contract/Accumulator.sol&quot;</span><span class="p">)</span>
<span class="o">//</span> <span class="n">contractName</span> <span class="n">已部署合约名</span>
<span class="n">ope</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewContractUpgradeOperationByName</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">Hex2Bytes</span><span class="p">(</span><span class="n">binContract</span><span class="p">),</span> <span class="s2">&quot;evm&quot;</span><span class="p">,</span> <span class="n">contractName</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.21 合约类型的操作—-管理合约</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewContractMaintainContractOperation</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">vmType</span> <span class="n">string</span><span class="p">,</span> <span class="n">opcode</span> <span class="nb">int</span><span class="p">)</span> <span class="n">ContractOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 合约地址</p></li>
<li><p>参数2 ： 虚拟机类型</p></li>
<li><p>参数3 ： 操作码， 1 合约升级， 2 冻结合约， 3 解冻合约</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">contractAddr</span> <span class="n">合约地址</span>
<span class="n">bvm</span><span class="o">.</span><span class="n">NewContractMaintainContractOperation</span><span class="p">(</span><span class="n">contractAddr</span><span class="p">,</span> <span class="s2">&quot;evm&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.22 合约类型的操作—-通过合约名管理合约</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewContractMaintainOperationByName</span><span class="p">(</span><span class="n">contractName</span><span class="p">,</span> <span class="n">vmType</span> <span class="n">string</span><span class="p">,</span> <span class="n">opcode</span> <span class="nb">int</span><span class="p">)</span> <span class="n">ContractOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 : 合约名</p></li>
<li><p>参数2 : 虚拟机类型</p></li>
<li><p>参数3 : 操作码， 1 合约升级， 2 冻结合约， 3 解冻合约</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">contractName</span> <span class="n">合约名</span>
<span class="n">bvm</span><span class="o">.</span><span class="n">NewContractMaintainOperationByName</span><span class="p">(</span><span class="n">contractName</span><span class="p">,</span> <span class="s2">&quot;evm&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.23 ca模式类型的提案创建</strong></p>
<p>当没有设置链上的ca模式时，可以通过提案设置ca模式，如果设置的ca模式与当前运行的ca模式不一致，则会停止当前链的运行。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewProposalCreateOperationForCA</span><span class="p">(</span><span class="n">ops</span> <span class="o">...</span><span class="n">CAOperation</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （opts） : 一组ca模式类型的操作</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mode</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewCASetCAModeOperation</span><span class="p">(</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">proposalCreateOperation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalCreateOperationForCA</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.24 直接执行ca模式类型的操作</strong></p>
<p>查询ca模式操作可以直接执行。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewProposalDirectOperationForCA</span><span class="p">(</span><span class="n">ops</span> <span class="o">...</span><span class="n">CAOperation</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （opts） : 一组ca模式类型的操作</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proposalDirectOperation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalDirectOperationForCA</span><span class="p">(</span><span class="n">bvm</span><span class="o">.</span><span class="n">NewCAGetCAModeOperation</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.2.25 直接执行节点类型的操作</strong></p>
<p>当ca模式为`center` 或`none` 时，可以直接执行节点类型的操作。</p>
<ul class="simple">
<li><p>新增节点时，节点类型的操作无需用户手动进行，即新增节点时，配置好了启动节点新增的相应操作会自动完成。</p></li>
<li><p>当ca模式为`center` 时，只有链级管理员可以直接执行节点类型的操作。</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewProposalDirectOperationForNode</span><span class="p">(</span><span class="n">ops</span> <span class="o">...</span><span class="n">NodeOperation</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 （opts） : 一组节点类型的操作</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">operations</span> <span class="p">[]</span><span class="n">bvm</span><span class="o">.</span><span class="n">NodeOperation</span>
<span class="n">operations</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">operations</span><span class="p">,</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewNodeRemoveVPOperation</span><span class="p">(</span><span class="s2">&quot;node1&quot;</span><span class="p">,</span> <span class="s2">&quot;global&quot;</span><span class="p">))</span>
<span class="n">proposalDirectOperation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewProposalDirectOperationForNode</span><span class="p">(</span><span class="n">operations</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id45">
<h4>4.2.3 hash的使用<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h4>
<p><strong>4.2.3.1 set</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewHashSetOperation</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="n">string</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： 存储的键</p></li>
<li><p>参数2  ： 存储的值</p></li>
<li><p>返回值1 ： BuiltinOperation</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>operation := bvm.NewHashSetOperation(&quot;0x1231&quot;, &quot;0x456&quot;)
payload := bvm.EncodeOperation(operation）
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.3.2 get</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewHashGetOperation</span><span class="p">(</span><span class="n">key</span> <span class="n">string</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : 存储的键</p></li>
<li><p>返回值1 : BuiltinOperation</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>operation := bvm.NewHashGetOperation(&quot;0x1231&quot;)
payload := bvm.EncodeOperation(operation）
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.3.3</strong> <strong>GenesisInfo</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>type GenesisInfo struct {
  GenesisAccount map[string]string `json:&quot;genesisAccount,omitempty&quot;`
  GenesisNodes   []*GenesisNode    `json:&quot;genesisNodes,omitempty&quot;`
}
// GenesisNode define the filed for genesis node.
type GenesisNode struct {
  Hostname    string `json:&quot;genesisNode&quot; mapstructure:&quot;genesisNode&quot;`
  CertContent string `json:&quot;certContent&quot; mapstructure:&quot;certContent&quot;`
}

func NewSetGenesisInfoForHpcOperation(genesisInfo *GenesisInfo) BuiltinOperation
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  - genesisInfo</p></li>
<li><p>返回值1 - BuiltinOperation</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>operation := bvm.NewSetGenesisInfoForHpcOperation(&amp;bvm.GenesisInfo{
      GenesisAccount: map[string]string{
        &quot;0x000f1a7a08ccc48e5d30f80850cf1cf283aa3abd&quot;: &quot;10000&quot;,
      },
      GenesisNodes: []*bvm.GenesisNode{
        {
            Hostname: &quot;node1&quot;,
            CertContent: `-----BEGIN CERTIFICATE-----
MIICSTCCAfWgAwIBAgIBATAKBggqhkjOPQQDAjB0MQkwBwYDVQQIEwAxCTAHBgNV
BAcTADEJMAcGA1UECRMAMQkwBwYDVQQREwAxDjAMBgNVBAoTBWZsYXRvMQkwBwYD
VQQLEwAxDjAMBgNVBAMTBW5vZGUxMQswCQYDVQQGEwJaSDEOMAwGA1UEKhMFZWNl
cnQwIBcNMjAwNTIxMDU1MzU2WhgPMjEyMDA0MjcwNjUzNTZaMHQxCTAHBgNVBAgT
ADEJMAcGA1UEBxMAMQkwBwYDVQQJEwAxCTAHBgNVBBETADEOMAwGA1UEChMFZmxh
dG8xCTAHBgNVBAsTADEOMAwGA1UEAxMFbm9kZTIxCzAJBgNVBAYTAlpIMQ4wDAYD
VQQqEwVlY2VydDBWMBAGByqGSM49AgEGBSuBBAAKA0IABBI3ewNK21vHNOPG6U3X
mKJohSNNz72QKDxUpRt0fCJHwaGYfSvY4cnqkbliclfckUTpCkFSRr4cqN6PURCF
zkWjeTB3MA4GA1UdDwEB/wQEAwIChDAmBgNVHSUEHzAdBggrBgEFBQcDAgYIKwYB
BQUHAwEGAioDBgOBCwEwDwYDVR0TAQH/BAUwAwEB/zANBgNVHQ4EBgQEAQIDBDAP
BgNVHSMECDAGgAQBAgMEMAwGAypWAQQFZWNlcnQwCgYIKoZIzj0EAwIDQgD6Dzzv
31kMiIlYtQRQjjs5m9pSvMZtmq2vOJW6/5J3kBuUkjTJfawqDdoxVh4yw06F/IBQ
gSu97EZSaseY9hweAA==
-----END CERTIFICATE-----`,
        },
        {
            Hostname: &quot;node2&quot;,
            CertContent: `-----BEGIN CERTIFICATE-----
MIICSTCCAfWgAwIBAgIBATAKBggqhkjOPQQDAjB0MQkwBwYDVQQIEwAxCTAHBgNV
BAcTADEJMAcGA1UECRMAMQkwBwYDVQQREwAxDjAMBgNVBAoTBWZsYXRvMQkwBwYD
VQQLEwAxDjAMBgNVBAMTBW5vZGUyMQswCQYDVQQGEwJaSDEOMAwGA1UEKhMFZWNl
cnQwIBcNMjAwNTIxMDU1MTE0WhgPMjEyMDA0MjcwNjUxMTRaMHQxCTAHBgNVBAgT
ADEJMAcGA1UEBxMAMQkwBwYDVQQJEwAxCTAHBgNVBBETADEOMAwGA1UEChMFZmxh
dG8xCTAHBgNVBAsTADEOMAwGA1UEAxMFbm9kZTExCzAJBgNVBAYTAlpIMQ4wDAYD
VQQqEwVlY2VydDBWMBAGByqGSM49AgEGBSuBBAAKA0IABBI3ewNK21vHNOPG6U3X
mKJohSNNz72QKDxUpRt0fCJHwaGYfSvY4cnqkbliclfckUTpCkFSRr4cqN6PURCF
zkWjeTB3MA4GA1UdDwEB/wQEAwIChDAmBgNVHSUEHzAdBggrBgEFBQcDAgYIKwYB
BQUHAwEGAioDBgOBCwEwDwYDVR0TAQH/BAUwAwEB/zANBgNVHQ4EBgQEAQIDBDAP
BgNVHSMECDAGgAQBAgMEMAwGAypWAQQFZWNlcnQwCgYIKoZIzj0EAwIDQgB3Cfo8
/Vdzzlz+MW+MIVuYQkcNkACY/yU/IXD1sHDGZQWcGKr4NR7FHJgsbjGpbUiCofw4
4rK6biAEEAOcv1BQAA==
-----END CERTIFICATE-----`,
        },
        {
            Hostname: &quot;node3&quot;,
            CertContent: `-----BEGIN CERTIFICATE-----
MIICRjCCAfKgAwIBAgIBATAKBggqhkjOPQQDAjB0MQkwBwYDVQQIEwAxCTAHBgNV
BAcTADEJMAcGA1UECRMAMQkwBwYDVQQREwAxDjAMBgNVBAoTBWZsYXRvMQkwBwYD
VQQLEwAxDjAMBgNVBAMTBW5vZGUzMQswCQYDVQQGEwJaSDEOMAwGA1UEKhMFZWNl
cnQwIBcNMjAwNTIxMDU1MTQ0WhgPMjEyMDA0MjcwNjUxNDRaMHQxCTAHBgNVBAgT
ADEJMAcGA1UEBxMAMQkwBwYDVQQJEwAxCTAHBgNVBBETADEOMAwGA1UEChMFZmxh
dG8xCTAHBgNVBAsTADEOMAwGA1UEAxMFbm9kZTExCzAJBgNVBAYTAlpIMQ4wDAYD
VQQqEwVlY2VydDBWMBAGByqGSM49AgEGBSuBBAAKA0IABBI3ewNK21vHNOPG6U3X
mKJohSNNz72QKDxUpRt0fCJHwaGYfSvY4cnqkbliclfckUTpCkFSRr4cqN6PURCF
zkWjdjB0MA4GA1UdDwEB/wQEAwIChDAmBgNVHSUEHzAdBggrBgEFBQcDAgYIKwYB
BQUHAwEGAioDBgOBCwEwDAYDVR0TAQH/BAIwADANBgNVHQ4EBgQEAQIDBDAPBgNV
HSMECDAGgAQBAgMEMAwGAypWAQQFZWNlcnQwCgYIKoZIzj0EAwIDQgCalJzkOAqk
IU4AMQGeWzFmdtRYJXZiElyqfrCn7Zg08Ssx14ZMO8K2cRsCncO+c/a/0IqwObEO
wL4C2ich1g5bAA==
-----END CERTIFICATE-----`,
        },
        {
            Hostname: &quot;node4&quot;,
            CertContent: `-----BEGIN CERTIFICATE-----
MIICSTCCAfWgAwIBAgIBATAKBggqhkjOPQQDAjB0MQkwBwYDVQQIEwAxCTAHBgNV
BAcTADEJMAcGA1UECRMAMQkwBwYDVQQREwAxDjAMBgNVBAoTBWZsYXRvMQkwBwYD
VQQLEwAxDjAMBgNVBAMTBW5vZGU0MQswCQYDVQQGEwJaSDEOMAwGA1UEKhMFZWNl
cnQwIBcNMjAwNTIxMDU1MzI0WhgPMjEyMDA0MjcwNjUzMjRaMHQxCTAHBgNVBAgT
ADEJMAcGA1UEBxMAMQkwBwYDVQQJEwAxCTAHBgNVBBETADEOMAwGA1UEChMFZmxh
dG8xCTAHBgNVBAsTADEOMAwGA1UEAxMFbm9kZTExCzAJBgNVBAYTAlpIMQ4wDAYD
VQQqEwVlY2VydDBWMBAGByqGSM49AgEGBSuBBAAKA0IABBI3ewNK21vHNOPG6U3X
mKJohSNNz72QKDxUpRt0fCJHwaGYfSvY4cnqkbliclfckUTpCkFSRr4cqN6PURCF
zkWjeTB3MA4GA1UdDwEB/wQEAwIChDAmBgNVHSUEHzAdBggrBgEFBQcDAgYIKwYB
BQUHAwEGAioDBgOBCwEwDwYDVR0TAQH/BAUwAwEB/zANBgNVHQ4EBgQEAQIDBDAP
BgNVHSMECDAGgAQBAgMEMAwGAypWAQQFZWNlcnQwCgYIKoZIzj0EAwIDQgATn17d
VxBI7s/4D/KNU0T3wvQeNrj6ZYmiNRjB/JIwPH7MhM5cTeJx0rs0K27rM/pFZtbq
+0W3ll/JfjQ6WxAAAQ==
-----END CERTIFICATE-----`,
        },
      },
  })
  payload := bvm.EncodeOperation(operation)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id46">
<h4>4.2.4 账户的使用<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h4>
<p><strong>4.2.4.1 账户注册</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewAccountRegisterOperation</span><span class="p">(</span><span class="n">address</span> <span class="n">string</span><span class="p">,</span> <span class="n">cert</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 合约地址</p></li>
<li><p>参数2 ： 证书byte数组</p></li>
<li></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>addr := &quot;0x42a815e75604dd69707ba4aa9d350a59d1e530e7&quot;
cert1 := []byte(`-----BEGIN CERTIFICATE-----
MIICMTCCAd2gAwIBAgIIcB4Bo1m3X4wwCgYIKoZIzj0EAwIwdDEJMAcGA1UECBMA
MQkwBwYDVQQHEwAxCTAHBgNVBAkTADEJMAcGA1UEERMAMQ4wDAYDVQQKEwVmbGF0
bzEJMAcGA1UECxMAMQ4wDAYDVQQDEwVub2RlMTELMAkGA1UEBhMCWkgxDjAMBgNV
BCoTBWVjZXJ0MB4XDTIwMTAxOTAwMDAwMFoXDTIwMTAxOTAwMDAwMFowPTELMAkG
A1UEBhMCQ04xDjAMBgNVBAoTBWZsYXRvMQ4wDAYDVQQDEwVub2RlMTEOMAwGA1UE
KhMFZWNlcnQwVjAQBgcqhkjOPQIBBgUrgQQACgNCAASN1aGLwcwb/1c4NCaT6vAY
A38Z5394RgUES1SlmrYWFCxwpOkpozPgMqZ+tS5PhFRt857ChrUujXzb6PWi6XVh
o4GSMIGPMA4GA1UdDwEB/wQEAwIB7jAxBgNVHSUEKjAoBggrBgEFBQcDAgYIKwYB
BQUHAwEGCCsGAQUFBwMDBggrBgEFBQcDBDAMBgNVHRMBAf8EAjAAMB0GA1UdDgQW
BBSl7MAm0apBmKIN7fyBLcS7Y/w6hTAPBgNVHSMECDAGgAQBAgMEMAwGAypWAQQF
ZWNlcnQwCgYIKoZIzj0EAwIDQgDJ3kJ3uX/23BM9JqCwlDpympv6Eu0OPriz4KgG
72Hr7xRJOrmZ14waO/I4jAvba7+J1uaNIv0K6EDjJplNzvPEAA==
-----END CERTIFICATE-----
`)

bvm.NewAccountRegisterOperation(addr, cert1)
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.4.2 删除账户</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewAccountAbandonOperation</span><span class="p">(</span><span class="n">address</span> <span class="n">string</span><span class="p">,</span> <span class="n">sdkCert</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1 ： 合约地址</p></li>
<li><p>参数2 ： 证书byte数组</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>addr := &quot;0x42a815e75604dd69707ba4aa9d350a59d1e530e7&quot;
cert1 := []byte(`-----BEGIN CERTIFICATE-----
MIICMTCCAd2gAwIBAgIIcB4Bo1m3X4wwCgYIKoZIzj0EAwIwdDEJMAcGA1UECBMA
MQkwBwYDVQQHEwAxCTAHBgNVBAkTADEJMAcGA1UEERMAMQ4wDAYDVQQKEwVmbGF0
bzEJMAcGA1UECxMAMQ4wDAYDVQQDEwVub2RlMTELMAkGA1UEBhMCWkgxDjAMBgNV
BCoTBWVjZXJ0MB4XDTIwMTAxOTAwMDAwMFoXDTIwMTAxOTAwMDAwMFowPTELMAkG
A1UEBhMCQ04xDjAMBgNVBAoTBWZsYXRvMQ4wDAYDVQQDEwVub2RlMTEOMAwGA1UE
KhMFZWNlcnQwVjAQBgcqhkjOPQIBBgUrgQQACgNCAASN1aGLwcwb/1c4NCaT6vAY
A38Z5394RgUES1SlmrYWFCxwpOkpozPgMqZ+tS5PhFRt857ChrUujXzb6PWi6XVh
o4GSMIGPMA4GA1UdDwEB/wQEAwIB7jAxBgNVHSUEKjAoBggrBgEFBQcDAgYIKwYB
BQUHAwEGCCsGAQUFBwMDBggrBgEFBQcDBDAMBgNVHRMBAf8EAjAAMB0GA1UdDgQW
BBSl7MAm0apBmKIN7fyBLcS7Y/w6hTAPBgNVHSMECDAGgAQBAgMEMAwGAypWAQQF
ZWNlcnQwCgYIKoZIzj0EAwIDQgDJ3kJ3uX/23BM9JqCwlDpympv6Eu0OPriz4KgG
72Hr7xRJOrmZ14waO/I4jAvba7+J1uaNIv0K6EDjJplNzvPEAA==
-----END CERTIFICATE-----
`)

bvm.NewAccountAbandonOperation(addr, cert1)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id47">
<h4>4.2.5 证书的使用<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h4>
<p><strong>4.2.5.1 证书吊销</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewCertRevokeOperation</span><span class="p">(</span><span class="n">cert</span><span class="p">,</span> <span class="n">priv</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="p">(</span><span class="n">BuiltinOperation</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： 证书byte数组</p></li>
<li><p>参数2  ： 证书私钥byte数组</p></li>
<li><p>返回值1 ： 内置合约操作BuiltinOperation</p></li>
<li><p>返回值2 ： error</p></li>
</ul>
<p>说明：</p>
<ul class="simple">
<li><p>当ca模式为`center` 时，删除节点后需要链级管理员手动吊销节点的证书，此时证书私钥可传`nil` 。</p></li>
<li><p>当ca模式为`none` 时，不可进行证书吊销操作。</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ecert</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">byte</span><span class="p">(</span><span class="s2">&quot;-----BEGIN CERTIFICATE-----</span><span class="se">\n</span><span class="s2">MIICHzCCAcSgAwIBAgIIapt5s0h7G4owCgYIKoEcz1UBg3UwPTELMAkGA1UEBhMC</span><span class="se">\n</span><span class="s2">Q04xEzARBgNVBAoTCkh5cGVyY2hhaW4xDjAMBgNVBAMTBW5vZGUxMQkwBwYDVQQq</span><span class="se">\n</span><span class="s2">EwAwIBcNMjEwMzI1MDAwMDAwWhgPMjEyMTAzMjUwMDAwMDBaMEQxCzAJBgNVBAYT</span><span class="se">\n</span><span class="s2">AkNOMRMwEQYDVQQKEwpIeXBlcmNoYWluMQ4wDAYDVQQDEwVub2RlNTEQMA4GA1UE</span><span class="se">\n</span><span class="s2">KhMHc2RrY2VydDBZMBMGByqGSM49AgEGCCqBHM9VAYItA0IABG401JscKfKj0rT3</span><span class="se">\n</span><span class="s2">xN8Dwyen8mVCnXC3GBNkaENJEnqOO4jw0wT331CcX47bHMcSMRfpprbbv4cUj8cV</span><span class="se">\n</span><span class="s2">cXNa9J6jgaQwgaEwDgYDVR0PAQH/BAQDAgHuMDEGA1UdJQQqMCgGCCsGAQUFBwMC</span><span class="se">\n</span><span class="s2">BggrBgEFBQcDAQYIKwYBBQUHAwMGCCsGAQUFBwMEMAwGA1UdEwEB/wQCMAAwHQYD</span><span class="se">\n</span><span class="s2">VR0OBBYEFPT6cvqWN9MBuhhlnmPrCQZG2iKoMB8GA1UdIwQYMBaAFJq1kzm0Q76P</span><span class="se">\n</span><span class="s2">xf84+ZRlfrWBKy27MA4GAypWAQQHc2RrY2VydDAKBggqgRzPVQGDdQNJADBGAiEA</span><span class="se">\n</span><span class="s2">3vcQvDi91E5GTsvV/IhKqrfuLkrnudN+3+QtocUX2IMCIQC6Ct1CS4c60SaE59tI</span><span class="se">\n</span><span class="s2">3a/wjXSyWIYGN6Rwt0k0KFbF+w==</span><span class="se">\n</span><span class="s2">-----END CERTIFICATE-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">priv</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">byte</span><span class="p">(</span><span class="s2">&quot;-----BEGIN EC PRIVATE KEY-----</span><span class="se">\n</span><span class="s2">MHgCAQECIQClNEoZsGgZLfdMgYyMCWH8I0PLZynFp2U+wnsSzJ6z+6AKBggqgRzP</span><span class="se">\n</span><span class="s2">VQGCLaFEA0IABG401JscKfKj0rT3xN8Dwyen8mVCnXC3GBNkaENJEnqOO4jw0wT3</span><span class="se">\n</span><span class="s2">31CcX47bHMcSMRfpprbbv4cUj8cVcXNa9J4=</span><span class="se">\n</span><span class="s2">-----END EC PRIVATE KEY-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">operation</span><span class="p">,</span> <span class="n">ferr</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewCertRevokeOperation</span><span class="p">(</span><span class="n">ecert</span><span class="p">,</span> <span class="n">priv</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.5.2 证书冻结</strong></p>
<p>text
func NewCertFreezeOperation(cert, priv []byte) (BuiltinOperation, error)</p>
<ul class="simple">
<li><p>参数1  ： 证书byte数组</p></li>
<li><p>参数2  ： 证书私钥byte数组</p></li>
<li><p>返回值1 ： 内置合约操作BuiltinOperation</p></li>
<li><p>返回值2 ： error</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ecert</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">byte</span><span class="p">(</span><span class="s2">&quot;-----BEGIN CERTIFICATE-----</span><span class="se">\n</span><span class="s2">MIICHzCCAcSgAwIBAgIIapt5s0h7G4owCgYIKoEcz1UBg3UwPTELMAkGA1UEBhMC</span><span class="se">\n</span><span class="s2">Q04xEzARBgNVBAoTCkh5cGVyY2hhaW4xDjAMBgNVBAMTBW5vZGUxMQkwBwYDVQQq</span><span class="se">\n</span><span class="s2">EwAwIBcNMjEwMzI1MDAwMDAwWhgPMjEyMTAzMjUwMDAwMDBaMEQxCzAJBgNVBAYT</span><span class="se">\n</span><span class="s2">AkNOMRMwEQYDVQQKEwpIeXBlcmNoYWluMQ4wDAYDVQQDEwVub2RlNTEQMA4GA1UE</span><span class="se">\n</span><span class="s2">KhMHc2RrY2VydDBZMBMGByqGSM49AgEGCCqBHM9VAYItA0IABG401JscKfKj0rT3</span><span class="se">\n</span><span class="s2">xN8Dwyen8mVCnXC3GBNkaENJEnqOO4jw0wT331CcX47bHMcSMRfpprbbv4cUj8cV</span><span class="se">\n</span><span class="s2">cXNa9J6jgaQwgaEwDgYDVR0PAQH/BAQDAgHuMDEGA1UdJQQqMCgGCCsGAQUFBwMC</span><span class="se">\n</span><span class="s2">BggrBgEFBQcDAQYIKwYBBQUHAwMGCCsGAQUFBwMEMAwGA1UdEwEB/wQCMAAwHQYD</span><span class="se">\n</span><span class="s2">VR0OBBYEFPT6cvqWN9MBuhhlnmPrCQZG2iKoMB8GA1UdIwQYMBaAFJq1kzm0Q76P</span><span class="se">\n</span><span class="s2">xf84+ZRlfrWBKy27MA4GAypWAQQHc2RrY2VydDAKBggqgRzPVQGDdQNJADBGAiEA</span><span class="se">\n</span><span class="s2">3vcQvDi91E5GTsvV/IhKqrfuLkrnudN+3+QtocUX2IMCIQC6Ct1CS4c60SaE59tI</span><span class="se">\n</span><span class="s2">3a/wjXSyWIYGN6Rwt0k0KFbF+w==</span><span class="se">\n</span><span class="s2">-----END CERTIFICATE-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">priv</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">byte</span><span class="p">(</span><span class="s2">&quot;-----BEGIN EC PRIVATE KEY-----</span><span class="se">\n</span><span class="s2">MHgCAQECIQClNEoZsGgZLfdMgYyMCWH8I0PLZynFp2U+wnsSzJ6z+6AKBggqgRzP</span><span class="se">\n</span><span class="s2">VQGCLaFEA0IABG401JscKfKj0rT3xN8Dwyen8mVCnXC3GBNkaENJEnqOO4jw0wT3</span><span class="se">\n</span><span class="s2">31CcX47bHMcSMRfpprbbv4cUj8cVcXNa9J4=</span><span class="se">\n</span><span class="s2">-----END EC PRIVATE KEY-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">operation</span><span class="p">,</span> <span class="n">ferr</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewCertFreezeOperation</span><span class="p">(</span><span class="n">ecert</span><span class="p">,</span> <span class="n">priv</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.5.3 证书解冻</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewCertUnfreezeOperation</span><span class="p">(</span><span class="n">cert</span><span class="p">,</span> <span class="n">priv</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="p">(</span><span class="n">BuiltinOperation</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： 证书byte数组</p></li>
<li><p>参数2  ： 证书私钥byte数组</p></li>
<li><p>返回值1 ： 内置合约操作BuiltinOperation</p></li>
<li><p>返回值2 ： error</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ecert</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">byte</span><span class="p">(</span><span class="s2">&quot;-----BEGIN CERTIFICATE-----</span><span class="se">\n</span><span class="s2">MIICHzCCAcSgAwIBAgIIapt5s0h7G4owCgYIKoEcz1UBg3UwPTELMAkGA1UEBhMC</span><span class="se">\n</span><span class="s2">Q04xEzARBgNVBAoTCkh5cGVyY2hhaW4xDjAMBgNVBAMTBW5vZGUxMQkwBwYDVQQq</span><span class="se">\n</span><span class="s2">EwAwIBcNMjEwMzI1MDAwMDAwWhgPMjEyMTAzMjUwMDAwMDBaMEQxCzAJBgNVBAYT</span><span class="se">\n</span><span class="s2">AkNOMRMwEQYDVQQKEwpIeXBlcmNoYWluMQ4wDAYDVQQDEwVub2RlNTEQMA4GA1UE</span><span class="se">\n</span><span class="s2">KhMHc2RrY2VydDBZMBMGByqGSM49AgEGCCqBHM9VAYItA0IABG401JscKfKj0rT3</span><span class="se">\n</span><span class="s2">xN8Dwyen8mVCnXC3GBNkaENJEnqOO4jw0wT331CcX47bHMcSMRfpprbbv4cUj8cV</span><span class="se">\n</span><span class="s2">cXNa9J6jgaQwgaEwDgYDVR0PAQH/BAQDAgHuMDEGA1UdJQQqMCgGCCsGAQUFBwMC</span><span class="se">\n</span><span class="s2">BggrBgEFBQcDAQYIKwYBBQUHAwMGCCsGAQUFBwMEMAwGA1UdEwEB/wQCMAAwHQYD</span><span class="se">\n</span><span class="s2">VR0OBBYEFPT6cvqWN9MBuhhlnmPrCQZG2iKoMB8GA1UdIwQYMBaAFJq1kzm0Q76P</span><span class="se">\n</span><span class="s2">xf84+ZRlfrWBKy27MA4GAypWAQQHc2RrY2VydDAKBggqgRzPVQGDdQNJADBGAiEA</span><span class="se">\n</span><span class="s2">3vcQvDi91E5GTsvV/IhKqrfuLkrnudN+3+QtocUX2IMCIQC6Ct1CS4c60SaE59tI</span><span class="se">\n</span><span class="s2">3a/wjXSyWIYGN6Rwt0k0KFbF+w==</span><span class="se">\n</span><span class="s2">-----END CERTIFICATE-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">priv</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">byte</span><span class="p">(</span><span class="s2">&quot;-----BEGIN EC PRIVATE KEY-----</span><span class="se">\n</span><span class="s2">MHgCAQECIQClNEoZsGgZLfdMgYyMCWH8I0PLZynFp2U+wnsSzJ6z+6AKBggqgRzP</span><span class="se">\n</span><span class="s2">VQGCLaFEA0IABG401JscKfKj0rT3xN8Dwyen8mVCnXC3GBNkaENJEnqOO4jw0wT3</span><span class="se">\n</span><span class="s2">31CcX47bHMcSMRfpprbbv4cUj8cVcXNa9J4=</span><span class="se">\n</span><span class="s2">-----END EC PRIVATE KEY-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">operation</span><span class="p">,</span> <span class="n">ferr</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewCertUnfreezeOperation</span><span class="p">(</span><span class="n">ecert</span><span class="p">,</span> <span class="n">priv</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.5.4 证书检查</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewCertCheckOperation</span><span class="p">(</span><span class="n">cert</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： 证书byte数组</p></li>
<li><p>返回值1 ： 内置合约操作BuiltinOperation</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ecert</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">byte</span><span class="p">(</span><span class="s2">&quot;-----BEGIN CERTIFICATE-----</span><span class="se">\n</span><span class="s2">MIICHzCCAcSgAwIBAgIIapt5s0h7G4owCgYIKoEcz1UBg3UwPTELMAkGA1UEBhMC</span><span class="se">\n</span><span class="s2">Q04xEzARBgNVBAoTCkh5cGVyY2hhaW4xDjAMBgNVBAMTBW5vZGUxMQkwBwYDVQQq</span><span class="se">\n</span><span class="s2">EwAwIBcNMjEwMzI1MDAwMDAwWhgPMjEyMTAzMjUwMDAwMDBaMEQxCzAJBgNVBAYT</span><span class="se">\n</span><span class="s2">AkNOMRMwEQYDVQQKEwpIeXBlcmNoYWluMQ4wDAYDVQQDEwVub2RlNTEQMA4GA1UE</span><span class="se">\n</span><span class="s2">KhMHc2RrY2VydDBZMBMGByqGSM49AgEGCCqBHM9VAYItA0IABG401JscKfKj0rT3</span><span class="se">\n</span><span class="s2">xN8Dwyen8mVCnXC3GBNkaENJEnqOO4jw0wT331CcX47bHMcSMRfpprbbv4cUj8cV</span><span class="se">\n</span><span class="s2">cXNa9J6jgaQwgaEwDgYDVR0PAQH/BAQDAgHuMDEGA1UdJQQqMCgGCCsGAQUFBwMC</span><span class="se">\n</span><span class="s2">BggrBgEFBQcDAQYIKwYBBQUHAwMGCCsGAQUFBwMEMAwGA1UdEwEB/wQCMAAwHQYD</span><span class="se">\n</span><span class="s2">VR0OBBYEFPT6cvqWN9MBuhhlnmPrCQZG2iKoMB8GA1UdIwQYMBaAFJq1kzm0Q76P</span><span class="se">\n</span><span class="s2">xf84+ZRlfrWBKy27MA4GAypWAQQHc2RrY2VydDAKBggqgRzPVQGDdQNJADBGAiEA</span><span class="se">\n</span><span class="s2">3vcQvDi91E5GTsvV/IhKqrfuLkrnudN+3+QtocUX2IMCIQC6Ct1CS4c60SaE59tI</span><span class="se">\n</span><span class="s2">3a/wjXSyWIYGN6Rwt0k0KFbF+w==</span><span class="se">\n</span><span class="s2">-----END CERTIFICATE-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">operation</span><span class="p">,</span> <span class="n">ferr</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewCertCheckOperation</span><span class="p">(</span><span class="n">ecert</span><span class="p">,</span> <span class="n">priv</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id48">
<h4>4.2.6 DID的使用<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h4>
<p><strong>4.2.6.1 设置chainId</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewDIDSetChainIDOperation</span><span class="p">(</span><span class="n">chainID</span> <span class="n">string</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<p>说明：通过创世账户来设置链的chainId，来激活DID服务</p>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>accountJson := `{&quot;address&quot;:&quot;0xfbca6a7e9e29728773b270d3f00153c75d04e1ad&quot;,&quot;version&quot;:&quot;4.0&quot;,&quot;algo&quot;:&quot;0x13&quot;,&quot;publicKey&quot;:&quot;049c330d0aea3d9c73063db339b4a1a84d1c3197980d1fb9585347ceeb40a5d262166ee1e1cb0c29fd9b2ef0e4f7a7dfb1be6c5e759bf411c520a616863ee046a4&quot;,&quot;privateKey&quot;:&quot;5f0a3ea6c1d3eb7733c3170f2271c10c1206bc49b6b2c7e550c9947cb8f098e3&quot;}`
key, _ := account.GenKeyFromAccountJson(accountJson, &quot;&quot;)
opt := bvm.NewDIDSetChainIDOperation(&quot;chainID_01&quot;)
payload := bvm.EncodeOperation(opt)
// 发送交易
tx := rpc.NewTransaction(key.(account.Key).GetAddress().Hex()).Invoke(opt.Address(), payload).VMType(BVM)
rpc.SignAndInvokeContract(tx, key)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="mpc">
<h4>4.2.7 MPC的使用<a class="headerlink" href="#mpc" title="Permalink to this headline">¶</a></h4>
<p><strong>4.2.7.1 获取mpc历史记录</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewMPCHistoryOperation</span><span class="p">(</span><span class="n">ct</span> <span class="n">string</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<p>： 参数1  ： mcp使用的曲线类型
： 返回值1 ： 内置合约操作BuiltinOperation</p>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>accountJson := `{&quot;address&quot;:&quot;0xfbca6a7e9e29728773b270d3f00153c75d04e1ad&quot;,&quot;version&quot;:&quot;4.0&quot;,&quot;algo&quot;:&quot;0x13&quot;,&quot;publicKey&quot;:&quot;049c330d0aea3d9c73063db339b4a1a84d1c3197980d1fb9585347ceeb40a5d262166ee1e1cb0c29fd9b2ef0e4f7a7dfb1be6c5e759bf411c520a616863ee046a4&quot;,&quot;privateKey&quot;:&quot;5f0a3ea6c1d3eb7733c3170f2271c10c1206bc49b6b2c7e550c9947cb8f098e3&quot;}`
key, _ := account.GenKeyFromAccountJson(accountJson, &quot;&quot;)
opt := bvm.NewMPCHistoryOperation(common.CurveNameSM9)
payload := bvm.EncodeOperation(opt)
// 发送交易
tx := NewTransaction(key.GetAddress().Hex()).Invoke(opt.Address(), payload).VMType(BVM)
res, serr := rpc.SignAndInvokeContract(tx, key)
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.7.2 获取mpc某一记录具体信息</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewMPCInfoOperation</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">ct</span> <span class="n">string</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： 该记录指定tag，填空值””默认获取最新记录信息</p></li>
<li><p>参数2  ： mcp使用的曲线类型</p></li>
<li><p>返回值1 ： 内置合约操作BuiltinOperation</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>accountJson := `{&quot;address&quot;:&quot;0xfbca6a7e9e29728773b270d3f00153c75d04e1ad&quot;,&quot;version&quot;:&quot;4.0&quot;,&quot;algo&quot;:&quot;0x13&quot;,&quot;publicKey&quot;:&quot;049c330d0aea3d9c73063db339b4a1a84d1c3197980d1fb9585347ceeb40a5d262166ee1e1cb0c29fd9b2ef0e4f7a7dfb1be6c5e759bf411c520a616863ee046a4&quot;,&quot;privateKey&quot;:&quot;5f0a3ea6c1d3eb7733c3170f2271c10c1206bc49b6b2c7e550c9947cb8f098e3&quot;}`
key, _ := account.GenKeyFromAccountJson(accountJson, &quot;&quot;)
opt := bvm.NewMPCInfoOperation(&quot;&quot;, common.CurveNameBN254)
payload := bvm.EncodeOperation(opt)
// 发送交易
tx := NewTransaction(key.GetAddress().Hex()).Invoke(opt.Address(), payload).VMType(BVM)
res, serr := rpc.SignAndInvokeContract(tx, key)
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.7.3 新增mpc记录</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewMPCBeaconOperation</span><span class="p">(</span><span class="n">ptau</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： 使用zkp工具生成的contribution内容</p></li>
<li><p>返回值1 ： 内置合约操作BuiltinOperation</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>const srsCon1Base = &quot;AQAAAAwAAAAAAAAAYm4yNTQAAAAFAAAAAgAAAMAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAiD8NbtSTbhAjF7a2A1plNW1QWXGdQ4DqhexXq5tlSGTKHghqdiaB3pDAKrvpsQWR2j+OHusYAS0Lb7ip9b5RBcZA/2JvyFhTikl1sL9PBepE0t4TXZsdzZbwgUL73/rDyn1pS+YmHh8v/LaoC/zmmYXvGaAaO+d3oBzI2FJ9d6wDeQwUd8e8RtfcygPyWMpncmtJRjp+MXRQKHWvHSM4+Al2VVG6lWD4WSSF0B3olCI9jSlibST8WVsulHf0Su6dxKM9kF6RrY4Td+iRSfe9ibz4hYEXN4O6CNMGgafKwQBGLZPRFL8MpRSzp/Vgml6X6JI5k1pnKXkClocTnODfNkcXuoeBYr3vvPfgcuDleDpUnFH3075qrJk1xrwCRohIxATXum9/HhDwarrYVpQrMppWvu7hFDgNT/RIyYEKqmDGJAgobdR5iIyUrJiDB7g7ecfWshIYMq12v0rcQCcbycJ9HPKseMnBAltRoasrB6QVGBCbRHGRItUVTDCrUU4LCrHxyk4ZIuxyW545kd02CI4LhIHUvwPJQSretdNiFjpIu58BVibxTWUj7tCj34ZmiZqwB9I0YFL0oFuRltkdtkm0DQc+ReY91YQvpkKo97Y2OFFXV9c+GjCHw7IrtWGhRjq6P4VK65ps97g7FXUjaR082Hdp2EdFBs9xVM8dwfyLI+IVyXZnNhyfo6ZEI+Ex1caaqUL2wfd4WO7g/Qm+wEvVP4DwPzOIcvQNuJp32kW8J8rxkrA7NkR9vYaX90IcxqaZLXVi26GjWk5mZSHlynfmhKtdFjrkhFe3i34wmHGCAG0G24Q21uIZRQIgvXWt6jDKnFK1YG4Mw625aNiXgQeezebBzslzNTuyejEwVYs2EbGlNNk14j6klcPaWd5cimRLN+9iS8TR1EMnfVcBxV6A0SWIg9BY+bebql4CIFMAAmueybmv7x8R1DAv/1D+T+NwDf07+YNLf6pLTVC+YYmbbYVKWH+DFrzyvWKut/O6HewUFVK9vlyIB0kjENNVy2feKk8GVyD96sSrJD4ORqfGlad6T/tivmJa9Lzg3GGL+Vo27lslYx9iNG8KcgiUveJHaaWtASw1o75HgNtI8wSPDCt0nRLSx7YRM5psFcNZPDwgoPBc+Twtgfl+xXLuSEvF2YrjC7XMbey/mIWys8lSFc9XxWEv5RfhNzufRa9DK7yZl4e2QuQAahnOGsLWyQuw4iU1+ODfyQSWbEnTm0GHUr+y4F4lNz5AZ5idRNqJtY+sMyZuMoYRs20L7zKTwG66l1Tfbb9G5iLjB/5CWLR9pgTvpD2QUUUYijw0pFeJ4cDfPRCiPwHGkwWgJxMQsGGnVrskHKUmpRj5BOKWIoN3voTQtBasjRdYNkzhWhXX71m9x6Z186Q6nBGwZgR2RAJ6xYubF+Wi/g73TmeQ6b716owx8iri+xVyCAUDaqVLnbQgUMcM9hq+Bn+4jOGR3wnOngaeUOsPgM7GoI1unEmZZ9mjlArSGcRE0BQh50aCCneTCLQUY08lPrDb3FhcRWBYz/JYxM4HM8DObkwQyIPUatU5fWIedaDI38+EHygAkEZtCGLoKz/NdJcVJK/HJ1veIEu+4LRqSwIKzTDkYgC80K9WGHNtbNv3Tluy6nHgZNp0gGaaf1y2Vu7Ob/sfQlfaTyfBJfqpGzCG2jOA7nunh88tXPprQyWlqSte1TuGDefeCgkYPg+OHDV7DdyWsWw16PAaoqUrerlJnvvNwEh4DUEsNvw7Q+WuFtIMydZuA3WN5wRe6E3RB8d/fDcDx7AU9q13LOczxxhglETSMCnfuSqYfiXQ94/Wk0TByUMEOTeGnCnUsixZaIHDbX7bAcs6880QfhjjHeejtfzJMwsqJU1z81QFSV8eQZge4ljYU7Qqy++1cLNOxWbBmIFnSQg0Sw1Kg0P/cOUv0a2/AmtkbL29Y968PlSju29DCJ8Ilajp7ZO2wJRZkyI19yvJvLFMbdasGBJ959ox8zR3KII87IfOZm9tvoOlbuuhxWDu8scDntqPg8gSx9FpNYTpBHAFOczCIxV9r7FUOja7sL+P6BNy/nmXEa4YCHoovACMFtjt9yHrNKxCMHmkzpICutDAkA3LKd9IgpjMKlvE4wGHVvXBmyn0RYhyqdO+Di1zjpj8eQ3Cokfj+Q3tqf4FRC+lP8XjuV8FGzskRNpuP650ZTGXl7g9c8ZvBywSI7iAmqdhrLm4iqJ0s0lIjLqQ52XW0f8wmYU6oXmcrVhOKMf14sK0X/pgFU4P3G4dn/1UOrospLhy3QVOmKXuvhhARNvdRs3BFibQYDr+9xMgAQKFVioh3sK1iptxtN5FixSEN0YKqBffhQ684ROeTsiKH7Z/EDVulaK97JLjCPCcEgfooCCY895nE9Ec5I4yxoAHltTiHi9I8U42g7QaKvuVRckgeuXtW9aH7Rfj+WPDZJzkV5izj0Z7PoUHcK3KCrNHeOlSbCJEaR7oN8q20RTwDnWYHK2BIoI009oRQTV1RsSwCE3HSI6eVwMpZEgJwueTw3bjathP4COMBSJEp5xSgcooc6tZyC6y41ywrzV6xAt2pce6H9tGkCscySGTPIrEqK2vwQdOXDCOwSP3bhzJ3QfEXvHjpj/fi3RXtDQ+pEFk/M9onUX9gkOKvsBJjiuoHJt3ZV7kHi3IZ/8iyMO5hiv52giyJBmeuYEa/InIVSnICK/ByXi7l4DxqF5FzWXIedvKRpStsGlBf99PuLPptSJrSmLaaLCKw+Ij50RxU4dj4Ia5S9YGP36KkQ7UrydQG9SdzHnqSBxUvR55fv1RwLx/4jI1N9ykTaHARu40THb9f2fRVcTnHz2yLSdd1t2J4BzB5nw4xURrbDWPp4Mxeme59p8RVEZpL/ZqM2sMQsMSvyGpDUd5BPDOlCBOe2I36YOqdB65HmuvdPYVDpuWQF7EZHP2N2DiuZjY1loamlufeHKFywoIuVeTV/q8hNfCBK5M5de+EG+ki/u/qtmwMaxV+lWXIOxPkD9MHBGapgTIRdPhPHReT0m50K3KW7dMb0ovOYl5fcQKmN8siVhXQSO0eEyJXASEUDowOGlDO96FYIiuTgjuH7zUlFZFiAwLrvfoWODRmEAEGIzR2B4C25ehCLwdNtZOPBudyYZlaUOSosQIDJn9GZL6yta3wVN9laApBDQgQtHBKO6By4w9iIUzuWcbbxVltdzYhr19Pi7KnTWJaFxdbP0gzfycxJxKguEsXGbfmKpA0kBhUPvowAnRmKZgeVcPVQKTCZDy24U683n3MIOC4KnKEVFTU96I+tM5UYrJ3TkfwhWIJxjnQUgAcDGUBhaFCUH+KZ3lEeCegu2xCYPGvi0uanpPkkCJcgab85f3AU9u+AtaUBlHZnxYGmKCjo/XgWwgVnVT+Iuiyfvd2HNP/vrYb0r1OqUM/TsM4n+CbdqROovGbfwowbi+gBYATJ3y9XIJyN1YHJyOr5s9AoxCz3hyr8NnTQxDkSxKrx73MxvpIbb1gde2hz6W5nWfCiEWswipQAc2L0BnsaBl2XKYoZcf5fXyQoJmN/Ffen6kAYVGsVqSt59aRXG56skZdyK6XS/6n/KciLUESuXCkqPDwEPpFLJXudiENfQz0OswmQed9mw9ImO1GkrpEQpwRWoLLePrMUdiGQoLnoIiyTZAa+4J0FVa/q0/27OgUH2EZi8BlFWH4F6dAvkjt5f3fZ2ut7UM/UXvenSW15iRfT770aZDFiVjBKADc5D2W3qFFT2iGT2Iv3gDhaBNIkEU/vHcWCktZ2x8q4NcDrJ+P7X+Pmg+xzxk9KbS+Vwg9hakeeMQxp4mxsdlSVAlzAfJRjtKZK/3xqes84Q8JgJ+9M31CoI2QC2PdB/ILd1bVeLAvG28UkCKQRqic74fWSK7uDIlelQVu03c14J/6cI8R4m3qJszrCGLEoH3hH9RsawN2ACC7H19QjP3BkLuDKjVcQMqm/QrwkbKAAKx1Xtj4EjXh4Zl3Nq4TMAFrfVmvSS68lU1z8+6vXD3/wFlnpRChBlNhzBN2xrMz0F5Y+aFVJkqFtW99hFAwjCMnA2SZ5R565jIZ2BZR/YPAL8rOiz4IevGqb3eyaXjSrp0CEQNoHY5TV0D+PYUFigByzDCYHYw0IWgRPHFRZyVgM2xIKWIeOdevNhEqU32oop2wPYYjb1IKw80eIdEmgMznruA/ZZQl5QY6MYe+yo3jALxCB7IEoOCTOWptG4Y3WPi4NynsexoF3fo80OzyzkCw9CHcWOnlPVYKpf3IAfzVpMd6TIQjCYpuK2UQkMomQPiLzU1m8UQw7REWjCA8FEvfW5uuupcJ2J5u07/L8wbAI8YvclWQoJ/2tGQaJnOiPp+Jz3dzBl82/BfxTXpACqLo6Gon6xoham5BIjwkcw0Y+P6B4KgfOk8eh658qnw1IrZ6e73hdRFpnejuzcKKnh6Gmo3xt72mx+eQUg7Ex5cwE/ThiDz/whB90jCRDIXLW0hmhVE1ycfh3jvS84ZcDiAFwrV3+9macEoaaFTmb0rnHn3h9kr3MkzH7li14lA5IEny0N3/F6KdY8MqC0USOF61YlmwSwvb01fFNtNccW9htYZgO3PGmdYpbhBXJ02qS1QLb5FO/5XC1bS61cQIiMLZP81U1ntApsbhTsqy22k7p5CrhRPDbskBcjt0PfNp0T+aTXzYnfTyFdRZCAkqm5OAUbdkY1EHe4lmNX+qfhGxXLgi8zM3cD5NXNKeT1jdkVIlbx9SbPHQDF46fKNcYmGgjjEZHM08J25J/dQss4sg135HMoZEokiCPQA2S1spMlJ1/Nwv0ausUNAbynzs6lVZClGhVSCIUiIfUGpqyRbRPEqeRtHZHQA71HdVA2FLLQTTMEJcuhx2vFerWMtcffEU4govaTkFbMSUrJTFijzUFP4dxaW1iNtNUqwTd8nNYZb18ttgQ/G7497cBz5fRXOggbtwEkKMc6YOCmrjEt8BAf7bUr7pdEko+/fYw355QdD9HpWRcUgH0IAeMxDeR4E0b8sSeCZavb2VcNmuj91HwJAfcXg/0L2RVqhQ1vp4sX44wgm1tIG9rMltVHymydKx694S7MnyhkAvQNounUiCkSnru+ZJVVTd+afQwAbhjBICa+VYi75+zzoicecmJuC7P2Q3eY5rR6Doiq0OSr/MiGH/pkM+1IhUJ3sLnoAdQVflcGpb3Qp/0qrrgMxJQ2SmXnyyI+SwSFdm86yvfcaBWAF+ZzeU7A15MajMdM5QK6xs2sNyICdYBgg71CqfXrAwAAAAABAAAAAAAAGY6Tk5INSDpyYL+3MftdJfGqSTM1qecSl+SFt67zEsIYAN7vEh8edkJqAGZeXER5Z0Mi1Pde2t1G3r1c2ZL27QkGidBYX/B17J6ZrWkMM5W8SzEzcLOO81Ws2tzRIpdbEshepduMbetKq3GAjctAj+PR52kMQ9N7TObMAWb6faoDQSJmp9+U7qYpJTmOfnKQQPgJtxzexEkjqZI0Xlsn3B+0j0sfmZ8DeryxfIvOflg0eB2E0pEbxW131BcRf9hcDjd30953YKwGKJbePsoUDJZFQiCelPUPg+ckWBhM4u4gI3jmqpSNnrpZRwn13fEnF69P+jDBX+FlmGVGx7SW+QQAAACWAgAAAAAAAJICAAAAAAAAAAAAAAYAAAAxX2NvbjENwnw9D5tibZwnkQWSspX1dcQWVKW/8kjdVg56eHACaRZWuXzNdxdrB7qFg2T2yWoHdd6/jknrqndkAtXMOBJgB7fjVdMygKDkfEPzwZaMuiFopueSbaPu2dLnx1EUpV4WbMtCx5iJHvBQ8ajbDQY0UsDXvHvRPC9/91uYT/qryieewE9mkPbqU4amOhF6wJbPdSZLL92jgZI7ZBdns3p6KeoXBNYxzX4lFMTUTuSoozWHK1tCMoeLwoPruqyvky8rcQLT5oaGlSAgHouHy4x5Eo40tGFkEse+Mi+WkfMyyBqvMppk5RWIytuo7nSBe2Mbcv7jl5nJSdhEpXlE6vLcKOCLBETiM7rLUN4W6GqDMaOSV28XRwTyHGE7zm2KgdAwLXpWbqi73/lsjz3hFKinrZGGP3XcF/zpcVphoXVXvhAqFLfJZGX0tTQq1Kx+ST6ZKq2FOiqiTwg02jxUx+dZBwVAwPw/18U0pUypd69zNnxJvI1q8tHghMAlk9OFS0Mg/DW7Uk24QIxe2tgNaZTVtUFlxnUOA6oXsV6ubZUhkyh4IanYmgd6QwCq76bEFkdo/jh7rGAEtC2+4qfW+UQXA0EiZqfflO6mKSU5jn5ykED4Cbcc3sRJI6mSNF5bJ9wftI9LH5mfA3q8sXyLzn5YNHgdhNKRG8Vtd9QXEX/YXA43d9Ped2CsBiiW3j7KFAyWRUIgnpT1D4PnJFgYTOLuICN45qqUjZ66WUcJ9d3xJxevT/owwV/hZZhlRse0lvnHmL98fHd4DXMZEV0xjUTBYta5spLdDU5oEXsaVX7vLRwXXXieRiPb16SKlPZhXx7x1s5UVFLKEflMF/f23K5I&quot;

accountJson := `{&quot;address&quot;:&quot;0xfbca6a7e9e29728773b270d3f00153c75d04e1ad&quot;,&quot;version&quot;:&quot;4.0&quot;,&quot;algo&quot;:&quot;0x13&quot;,&quot;publicKey&quot;:&quot;049c330d0aea3d9c73063db339b4a1a84d1c3197980d1fb9585347ceeb40a5d262166ee1e1cb0c29fd9b2ef0e4f7a7dfb1be6c5e759bf411c520a616863ee046a4&quot;,&quot;privateKey&quot;:&quot;5f0a3ea6c1d3eb7733c3170f2271c10c1206bc49b6b2c7e550c9947cb8f098e3&quot;}`
key, _ := account.GenKeyFromAccountJson(accountJson, &quot;&quot;)
resb, err := base64.StdEncoding.DecodeString(srsCon1Base)
opt := bvm.NewMPCBeaconOperation(resb)
payload := bvm.EncodeOperation(opt)
// 发送交易
tx := NewTransaction(key.GetAddress().Hex()).Invoke(opt.Address(), payload).VMType(BVM)
res, serr := rpc.SignAndInvokeContract(tx, key)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="root-ca">
<h4>4.2.8 Root CA的使用<a class="headerlink" href="#root-ca" title="Permalink to this headline">¶</a></h4>
<p><strong>4.2.8.1 新增root ca</strong></p>
<p>当ca模式为`center` 时，链级管理员可以新增root ca。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewRootCAAddOperation</span><span class="p">(</span><span class="n">rootCA</span> <span class="n">string</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： 新增加的root ca内容</p></li>
<li><p>返回值1 ： 内置合约操作BuiltinOperation</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>accountJson := `{&quot;address&quot;:&quot;0xfbca6a7e9e29728773b270d3f00153c75d04e1ad&quot;,&quot;version&quot;:&quot;4.0&quot;,&quot;algo&quot;:&quot;0x13&quot;,&quot;publicKey&quot;:&quot;049c330d0aea3d9c73063db339b4a1a84d1c3197980d1fb9585347ceeb40a5d262166ee1e1cb0c29fd9b2ef0e4f7a7dfb1be6c5e759bf411c520a616863ee046a4&quot;,&quot;privateKey&quot;:&quot;5f0a3ea6c1d3eb7733c3170f2271c10c1206bc49b6b2c7e550c9947cb8f098e3&quot;}`
key, _ := account.GenKeyFromAccountJson(accountJson, &quot;&quot;)
rootCA := `-----BEGIN CERTIFICATE-----
MIICODCCAeSgAwIBAgIBATAKBggqhkjOPQQDAjB0MQkwBwYDVQQIEwAxCTAHBgNV
BAcTADEJMAcGA1UECRMAMQkwBwYDVQQREwAxDjAMBgNVBAoTBWZsYXRvMQkwBwYD
VQQLEwAxDjAMBgNVBAMTBW5vZGU1MQswCQYDVQQGEwJaSDEOMAwGA1UEKhMFZWNl
cnQwIBcNMjAwNTIyMDUyNTQ4WhgPMjEyMDA0MjgwNjI1NDhaMHQxCTAHBgNVBAgT
ADEJMAcGA1UEBxMAMQkwBwYDVQQJEwAxCTAHBgNVBBETADEOMAwGA1UEChMFZmxh
dG8xCTAHBgNVBAsTADEOMAwGA1UEAxMFbm9kZTUxCzAJBgNVBAYTAlpIMQ4wDAYD
VQQqEwVlY2VydDBWMBAGByqGSM49AgEGBSuBBAAKA0IABLs/ih4HBDxs0nHNliXt
sZKAaW2fdgi51H07eMNtHib/8R55GYFinvjmeJa9OvbyYsWAbCTQsBu3LV7aPpOT
0QGjaDBmMA4GA1UdDwEB/wQEAwIChDAmBgNVHSUEHzAdBggrBgEFBQcDAgYIKwYB
BQUHAwEGAioDBgOBCwEwDwYDVR0TAQH/BAUwAwEB/zANBgNVHQ4EBgQEAQIDBDAM
BgMqVgEEBWVjZXJ0MAoGCCqGSM49BAMCA0IA/9MkrtXUMni8THIhym5t2manIffB
xpW51rRuxPjB/0wZvgKPDWuOcq8eqsOOX/d4wFtMwJ4e7MqLZu6RWSc2MQA=
-----END CERTIFICATE-----
`
opt := bvm.NewRootCAAddOperation(rootCA)
payload := bvm.EncodeOperation(opt)
// 发送交易
tx := NewTransaction(key.GetAddress().Hex()).Invoke(opt.Address(), payload).VMType(BVM)
res, serr := rpc.SignAndInvokeContract(tx, key)
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.8.2 查询root ca</strong></p>
<p>当ca模式为`center` 时，可以查询root ca。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewRootCAGetOperation</span><span class="p">()</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>返回值1 ： 内置合约操作BuiltinOperation</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>accountJson := `{&quot;address&quot;:&quot;0xfbca6a7e9e29728773b270d3f00153c75d04e1ad&quot;,&quot;version&quot;:&quot;4.0&quot;,&quot;algo&quot;:&quot;0x13&quot;,&quot;publicKey&quot;:&quot;049c330d0aea3d9c73063db339b4a1a84d1c3197980d1fb9585347ceeb40a5d262166ee1e1cb0c29fd9b2ef0e4f7a7dfb1be6c5e759bf411c520a616863ee046a4&quot;,&quot;privateKey&quot;:&quot;5f0a3ea6c1d3eb7733c3170f2271c10c1206bc49b6b2c7e550c9947cb8f098e3&quot;}`
key, _ := account.GenKeyFromAccountJson(accountJson, &quot;&quot;)
opt := bvm.NewRootCAGetOperation()
payload := bvm.EncodeOperation(opt)
// 发送交易
tx := NewTransaction(key.GetAddress().Hex()).Invoke(opt.Address(), payload).VMType(BVM)
res, serr := rpc.SignAndInvokeContract(tx, key)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id49">
<h4>4.2.9 跨分区交易<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h4>
<p>（暂不开放）</p>
</div>
<div class="section" id="id50">
<h4>4.2.10 hash类型查询<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h4>
<p><strong>4.2.10.1 获取目前支持的算法类型</strong></p>
<ul class="simple">
<li><p>vm类型：BVM</p></li>
<li><p>合约地址：“0x0000000000000000000000000000000000ffff0d”</p></li>
<li><p>API接口：contract_invokeContract</p></li>
<li><p>目标分区：global</p></li>
<li><p>合约内容构造函数：</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewHashGetSupportOperation</span><span class="p">()</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>当前功能合约调用具体参数：</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NewHashGetSupportOperation</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>返回值1 ： 内置合约操作BuiltinOperation</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">operation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewHashGetSupportOperation</span><span class="p">()</span>
<span class="n">payload</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">EncodeOperation</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
<span class="n">tx</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">operation</span><span class="o">.</span><span class="n">Address</span><span class="p">(),</span> <span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">BVM</span><span class="p">)</span>
<span class="n">rpc1</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">NewRPC</span><span class="p">()</span><span class="o">.</span><span class="n">Namespace</span><span class="p">(</span><span class="s2">&quot;global&quot;</span><span class="p">)</span>
<span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">rpc1</span><span class="o">.</span><span class="n">SignAndInvokeContract</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.10.2 获取已变更的算法记录</strong></p>
<ul class="simple">
<li><p>vm类型：BVM</p></li>
<li><p>合约地址：“0x0000000000000000000000000000000000ffff0d”</p></li>
<li><p>API接口：contract_invokeContract</p></li>
<li><p>目标分区：global</p></li>
<li><p>合约内容构造函数：</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewHashGetAlgoOperation</span><span class="p">()</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>当前功能合约调用具体参数：</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NewHashGetAlgoOperation</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>返回值1 ： 内置合约操作BuiltinOperation</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">operation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewHashGetAlgoOperation</span><span class="p">()</span>
<span class="n">payload</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">EncodeOperation</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
<span class="n">tx</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">operation</span><span class="o">.</span><span class="n">Address</span><span class="p">(),</span> <span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">BVM</span><span class="p">)</span>
<span class="n">rpc1</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">NewRPC</span><span class="p">()</span><span class="o">.</span><span class="n">Namespace</span><span class="p">(</span><span class="s2">&quot;global&quot;</span><span class="p">)</span>
<span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">rpc1</span><span class="o">.</span><span class="n">SignAndInvokeContract</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.2.10.3 变更算法</strong></p>
<ul class="simple">
<li><p>vm类型：BVM</p></li>
<li><p>合约地址：“0x0000000000000000000000000000000000ffff0d”</p></li>
<li><p>API接口：contract_invokeContract</p></li>
<li><p>目标分区：global</p></li>
<li><p>合约内容构造函数：</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewHashChangeHashAlgo</span><span class="p">(</span><span class="n">data</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>当前功能合约调用具体参数：</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NewHashGetAlgoOperation</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>返回值1 ： 内置合约操作BuiltinOperation</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ha</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">AlgoSet</span><span class="p">{</span>
    <span class="n">HashAlgo</span><span class="p">:</span> <span class="s2">&quot;SHA2_512&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">data</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">json</span><span class="o">.</span><span class="n">Marshal</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span>
<span class="n">operation</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">NewHashChangeHashAlgo</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">:=</span> <span class="n">bvm</span><span class="o">.</span><span class="n">EncodeOperation</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span>
<span class="n">tx</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">operation</span><span class="o">.</span><span class="n">Address</span><span class="p">(),</span> <span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">BVM</span><span class="p">)</span>
<span class="n">rpc1</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">NewRPC</span><span class="p">()</span><span class="o">.</span><span class="n">Namespace</span><span class="p">(</span><span class="s2">&quot;global&quot;</span><span class="p">)</span>
<span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">rpc1</span><span class="o">.</span><span class="n">SignAndInvokeContract</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="balance">
<h4>4.2.11 Balance管理<a class="headerlink" href="#balance" title="Permalink to this headline">¶</a></h4>
<p><strong>4.2.11.1 设置balance</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">NewIssueBalanceSetOperation</span><span class="p">(</span><span class="n">addr</span> <span class="n">string</span><span class="p">,</span> <span class="n">value</span> <span class="n">int64</span><span class="p">)</span> <span class="n">BuiltinOperation</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>addr  ： 用户地址</p></li>
<li><p>value ： 用户balance</p></li>
<li><p>返回值1  ： 内置合约操作BuiltinOperation</p></li>
<li><p>返回值2  ： error</p></li>
</ul>
</div>
</div>
<div class="section" id="hvm">
<h3>4.3 HVM<a class="headerlink" href="#hvm" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id51">
<h4>4.3.1 abi解析<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h4>
<p>abi解析后的结构如下</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>type BeanAbi struct {
  BeanVersion Version  `json:&quot;version&quot;`
  BeanName    string   `json:&quot;beanName&quot;`
  Inputs      []Entry  `json:&quot;inputs&quot;`
  Output      Entry    `json:&quot;output&quot;`
  ClassBytes  string   `json:&quot;classBytes&quot;`
  Structs     []Entry  `json:&quot;structs&quot;`
  BeanType    BeanType `json:&quot;beanType&quot;`
}

type Entry struct {
  Name       string  `json:&quot;name&quot;`
  EntryType  Type    `json:&quot;type&quot;`
  Properties []Entry `json:&quot;properties,omitempty&quot;`
  StructName string  `json:&quot;structName,omitempty&quot;`
}
</pre></div>
</div>
</div></blockquote>
<p><strong>4.3.1.1 通过abiJson字符串解析合约</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">GenAbi</span><span class="p">(</span><span class="n">abiJson</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="n">Abi</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abiPath</span> <span class="o">:=</span> <span class="s2">&quot;../hvmtestfile/fibonacci/hvm.abi&quot;</span>
<span class="n">abiJson</span><span class="p">,</span> <span class="n">rerr</span> <span class="o">:=</span> <span class="n">common</span><span class="o">.</span><span class="n">ReadFileAsString</span><span class="p">(</span><span class="n">abiPath</span><span class="p">)</span>
<span class="n">abi</span><span class="p">,</span> <span class="n">gerr</span> <span class="o">:=</span> <span class="n">hvm</span><span class="o">.</span><span class="n">GenAbi</span><span class="p">(</span><span class="n">abiJson</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.3.1.2 获取待调用的方法</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">abi</span> <span class="n">Abi</span><span class="p">)</span> <span class="n">GetBeanAbi</span><span class="p">(</span><span class="n">beanName</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">BeanAbi</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>参数1  ： 方法在abi中的名字</p></li>
<li><p>返回值1 ： beanAbi结构体</p></li>
<li><p>返回值2 ： error</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">methodInvokeAbi</span> <span class="o">:=</span> <span class="s2">&quot;../hvmtestfile/methodInvoke/hvm.abi&quot;</span>
<span class="n">abiJson</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">common</span><span class="o">.</span><span class="n">ReadFileAsString</span><span class="p">(</span><span class="n">methodInvokeAbi</span><span class="p">)</span>
<span class="n">abi</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">hvm</span><span class="o">.</span><span class="n">GenAbi</span><span class="p">(</span><span class="n">abiJson</span><span class="p">)</span>
<span class="n">easyBean</span> <span class="o">:=</span> <span class="s2">&quot;invoke.InvokeFibonacci&quot;</span>
<span class="n">beanAbi</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">abi</span><span class="o">.</span><span class="n">GetBeanAbi</span><span class="p">(</span><span class="n">easyBean</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><a href="#id52"><span class="problematic" id="id53">**</span></a><a href="#id54"><span class="problematic" id="id55">*</span></a></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">abi</span> <span class="n">Abi</span><span class="p">)</span> <span class="n">GetMethodAbi</span><span class="p">(</span><span class="n">methodName</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">BeanAbi</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： 合约方法签名</p></li>
<li><p>返回值1 ： beanAbi结构体</p></li>
<li><p>返回值2 ： error</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">methodInvokeAbi</span> <span class="o">:=</span> <span class="s2">&quot;../hvmtestfile/methodInvoke/hvm.abi&quot;</span>
<span class="n">abiJson</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">common</span><span class="o">.</span><span class="n">ReadFileAsString</span><span class="p">(</span><span class="n">methodInvokeAbi</span><span class="p">)</span>
<span class="n">abi</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">hvm</span><span class="o">.</span><span class="n">GenAbi</span><span class="p">(</span><span class="n">abiJson</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">abi</span><span class="o">.</span><span class="n">GetMethodAbi</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="n">methodAbi3</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">abi</span><span class="o">.</span><span class="n">GetMethodAbi</span><span class="p">(</span><span class="s2">&quot;Hello(java.lang.String)&quot;</span><span class="p">)</span>
<span class="n">methodAbi4</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">abi</span><span class="o">.</span><span class="n">GetMethodAbi</span><span class="p">(</span><span class="s2">&quot;Hello(int,java.lang.String)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.3.1.3 编码beanAbi</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">GenPayload</span><span class="p">(</span><span class="n">beanAbi</span> <span class="o">*</span><span class="n">BeanAbi</span><span class="p">,</span> <span class="n">params</span> <span class="o">...</span><span class="n">interface</span><span class="p">{})</span> <span class="p">([]</span><span class="n">byte</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  ： beanAbi的实例</p></li>
<li><p>参数2  ： beanAbi对应的合约方法的参数</p></li>
<li><p>返回值1 ： 编码后的beanAbi</p></li>
<li><p>返回值2 ： error</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">methodInvokeAbi</span> <span class="o">:=</span> <span class="s2">&quot;../hvmtestfile/methodInvoke/hvm.abi&quot;</span>
<span class="n">abiJson</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">common</span><span class="o">.</span><span class="n">ReadFileAsString</span><span class="p">(</span><span class="n">methodInvokeAbi</span><span class="p">)</span>
<span class="n">abi</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">hvm</span><span class="o">.</span><span class="n">GenAbi</span><span class="p">(</span><span class="n">abiJson</span><span class="p">)</span>
<span class="n">easyBean</span> <span class="o">:=</span> <span class="s2">&quot;invoke.InvokeFibonacci&quot;</span>
<span class="n">beanAbi</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">abi</span><span class="o">.</span><span class="n">GetBeanAbi</span><span class="p">(</span><span class="n">easyBean</span><span class="p">)</span>
<span class="n">payload</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">hvm</span><span class="o">.</span><span class="n">GenPayload</span><span class="p">(</span><span class="n">beanAbi</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.3.1.4 payload解码</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>type PayLoad struct {
  InvokeBeanName string   `json:&quot;invokeBeanName&quot;`
  InvokeArgs     string   `json:&quot;invokeArgs&quot;`
  InvokeMethods  []string `json:&quot;invokeMethods&quot;`
}


func DecodePayload(pl string) (*PayLoad, error)
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : payload的十六进制字符串</p></li>
<li><p>返回值1 : PayLoad结构体</p></li>
<li><p>返回值2 : error</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">hvm</span><span class="o">.</span><span class="n">DecodePayload</span><span class="p">(</span><span class="s2">&quot;0xfefffbce00087472616e736665720010000000036a6176612e6c616e672e537472696e674141410010000000036a6176612e6c616e672e537472696e674242420004000000036c6f6e67313030&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="jar">
<h4>4.3.2 jar包部署<a class="headerlink" href="#jar" title="Permalink to this headline">¶</a></h4>
<p>jar包部署合约需要对jar包进行编码</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">DecompressFromJar</span><span class="p">(</span><span class="n">filepath</span> <span class="n">string</span><span class="p">)</span> <span class="p">([]</span><span class="n">byte</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : jar包文件路径</p></li>
<li><p>返回值1 ： 编码后的byte数组</p></li>
<li><p>返回值2 ： error</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">jarPath</span> <span class="o">:=</span> <span class="s2">&quot;../hvmtestfile/hvm-first-1.0.jar&quot;</span>
<span class="n">payload</span><span class="p">,</span> <span class="n">sysErr</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">DecompressFromJar</span><span class="p">(</span><span class="n">jarPath</span><span class="p">)</span>
<span class="n">transaction</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">NewTransaction</span><span class="p">(</span><span class="n">ecKey</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">Deploy</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">Bytes2Hex</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">rpc</span><span class="o">.</span><span class="n">HVM</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="id56">
<h3>4.4 KVSQL<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id57">
<h4>4.4.1 回执解码<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">ResultSet</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">columnCount</span>  <span class="n">uint32</span>
  <span class="n">lastInsertID</span> <span class="n">uint64</span>
  <span class="n">updatedCount</span> <span class="n">uint32</span>

  <span class="n">rowNumber</span>  <span class="nb">int</span> <span class="o">//</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">rows</span>
  <span class="n">resChunk</span>   <span class="o">*</span><span class="n">resultChunk</span>
  <span class="n">columnInfo</span> <span class="p">[]</span><span class="o">*</span><span class="n">Field</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.4.1.1 解回执为ResultSet</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">DecodeRecordSet</span><span class="p">(</span><span class="n">buf</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="o">*</span><span class="n">ResultSet</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>参数1  : 交易回执的ret字段解码成byte数组</p></li>
<li><p>返回值1 : sql执行结果的结构体实例</p></li>
</ul>
<p>应用实例</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">hexutil</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">Ret</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">:=</span> <span class="n">kvsql</span><span class="o">.</span><span class="n">DecodeRecordSet</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.4.1.2 获取列数</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func (c ResultSet) ColumnCount() uint32`
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">answer</span> <span class="o">:=</span> <span class="s2">&quot;0x0035000000053654333354053654333354066175746f4964066175746f49643f000b000000030502000536543333540536543333540574797065300574797065303f000b000000030300000536543333540536543333540574797065310574797065313f000a000000032000000536543333540536543333540574797065320574797065323f0014000000080000000536543333540536543333540574797065330574797065333f0014000000082800000536543333540536543333540574797065340574797065343f000c0000000408001f0536543333540536543333540574797065350574797065353f00ff0000000408001e0536543333540536543333540574797065360574797065363f00ff0000000408001e0536543333540536543333540574797065370574797065373f00160000000508001f0536543333540536543333540574797065380574797065383f00ff0000000500001e0536543333540536543333540574797065390574797065393f000b000000f600000005365433335405365433335406747970653130067479706531303f0020000000f600001e05365433335405365433335406747970653131067479706531313f000b000000f600000005365433335405365433335406747970653132067479706531323f0016000000f600001405365433335405365433335406747970653133067479706531333f00090000000900000005365433335405365433335406747970653134067479706531343f00080000000920000005365433335405365433335406747970653135067479706531353f00060000000200000005365433335405365433335406747970653136067479706531363f00040000000100000005365433335405365433335406747970653137067479706531373f00030000000120000005365433335405365433335406747970653138067479706531383f00050000000220000005365433335405365433335406747970653139067479706531393f000a0000000a80000005365433335405365433335406747970653230067479706532303f00130000000c80000005365433335405365433335406747970653231067479706532313f000a0000000b80000005365433335405365433335406747970653232067479706532323f00130000000780000005365433335405365433335406747970653233067479706532333f00040000000d60000005365433335405365433335406747970653234067479706532342e0000000000fe00000005365433335405365433335406747970653235067479706532352e0004000000fe00000005365433335405365433335406747970653236067479706532362e00fc030000fe00000005365433335405365433335406747970653237067479706532372e0000000000fd00000005365433335405365433335406747970653238067479706532382e0004000000fd00000005365433335405365433335406747970653239067479706532392e00fc030000fd00000005365433335405365433335406747970653330067479706533303f0000000000fe80000005365433335405365433335406747970653331067479706533313f0001000000fe80000005365433335405365433335406747970653332067479706533323f00ff000000fe80000005365433335405365433335406747970653333067479706533333f00ffff0000fc80000005365433335405365433335406747970653334067479706533343f00ff000000f980000005365433335405365433335406747970653335067479706533353f00ffffff00fa80000005365433335405365433335406747970653336067479706533362e0058020000fc00000005365433335405365433335406747970653337067479706533372e00fcffff03fa00000005365433335405365433335406747970653338067479706533383f0001000000fd80000005365433335405365433335406747970653339067479706533392e0000000000fe00000005365433335405365433335406747970653430067479706534302e0004000000fe00000005365433335405365433335406747970653431067479706534312e0010000000fe00000005365433335405365433335406747970653432067479706534322e0000000000fe00000005365433335405365433335406747970653433067479706534332e0004000000fe00000005365433335405365433335406747970653434067479706534342e00d4030000fe00000005365433335405365433335406747970653435067479706534353f00010000001020000005365433335405365433335406747970653436067479706534363f00400000001020000005365433335405365433335406747970653437067479706534373f00010000000100000005365433335405365433335406747970653438067479706534382e00fcffff03fa00000005365433335405365433335406747970653439067479706534392e00fcffff03fa00000005365433335405365433335406747970653530067479706535302e0004000000fe00000005365433335405365433335406747970653531067479706535312e0004000000fd00000001000000040907000001010100000000049e732b7b010101000000000415d0870701010100000000083aa1ffffffffffff010101000000000871575519bfcd04020101010000000004ba0f9f3e01010100000000044d6d6e3f0101010000000004d66cc3be0101010000000008a4a6c8fae881e83f0101010000000008aba76123a72be63f01010100000000052d313731340101020000000005000000212d302e3233363530303030303030303030303030303030303030303030303030300101020000000021000000062d3531343132010102000000000600000016302e383433303030303030303030303030303030303001010200000000160000000453d955000101010000000004c3d1180001010100000000024b2d0101010000000001660101010000000001170101010000000002282d01010100000000080e0000000054c91d0101010000000008000000287342f21d0101010000000008001ef1cdf239000001010100000000080100007524a8b01f0101010000000002770701010100000000000101020000000000000000013001010200000000010000006436383036323439363639373332383534303836393332373339363837343432383138343539323234343837313936333534323934343333343031373936333438363830353736303134373133383232343632323236353730393639323939303039353035010102000000006400000000010102000000000000000001640101020000000001000000fcff007a4f3979704e654c456e63684f69784944304b527637704134794e6638346e6649317076333252367a737a6246486a34527479447645574e644772557738715161576573774552307464454f50746b4d5a506b50673669564c585551445464486d71674e6736487351665639637134636772735436686e557063736463416e3041584f684f596c65636f34426a44464c7a62424e5276516c6c644632684b413355636c4a7350757738726c616363517872763663655851556c74427a414861773264456b4c4252597a53444e4d5a3033735534456b52666e6a48454e564e6730416f6c5a66355356753059486a426768563148355930654b4b7661735a473101010200000000ff000000000101020000000000000000012a0101020000000001000000fcff00ccd82dbce2a48abe65f391308024cff5bb3971c2aa2761f10c52476cc9e3235206b47528a36eb3767dc50852ed3ebfa5b17a0b47ed2a5a2b56ead26c5b96c805ca65e22eaabbc7af1560e71e57ca734ca952ed17f54285d4feecd11c0d5ba0e679c464cf1196373f427c41a8e9f5c157f78834f2e57c06aa5d5af0682504349f796518eca8f4f33dbf53a9dfa30e1f4232106825d8695817ae992d70fc0a30c8b4f9d232701d948d6a9199acd8e5ce94b5aa50af5929555b91f124167fde826315ba922120d8d4f6c5d1fcbdb08708521f9f91a7e84366f08b90bccbb18186660fe49d5ca270dbe476b3f4c7a7418b51d37cf38c7c55e5c784257dde277a4f01010200000000ff00000064279e9d01d72ec83ad3ae46ce057466371ba263f62a726018347135ec8619bc835e5f215431902b181ff2e41c6a28115a1e01b50ed33faad7601416032c3d2911b00b25e051f1f3676b082aa98d618f251c5b984976c4a89f7ed84ad8ef0ff22cdf05f1c50101020000000064000000189bc7836679d2fb8bf55d01daa0c7b7791a01b2d9359ec8ea010102000000001800000064892df41245164975050a48fdc2a262b012f29e95763cb507bd5df48b339d1539a988202f99d31cfe072df1696a58529b7813d848a4edcf9133bdbe67b4449b0718b07839471e35a6a798f9f17d6db70aee9b989e88d19dc9e363fc5906c4abb7d1bae32a0101020000000064000000143635363636373638363937303731373237333734010102000000001400000014363836393730373137323733373437353736373701010200000000140000000116010102000000000100000000010002000000000000000001610101020000000001000000046132373501010200000000040000000001000200000000000000000001000200000000000000000c61302c61312c61322c613630010102000000000c00000001000101020000000001000000087fffffffffffffff01010200000000080000000150010101000000001437323733373437353736373737383739383038310101020000000014000000143635363636373638363937303731373237333734010102000000001400000001390101020000000001000000016b0101020000000001000000&quot;</span>
<span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">hexutil</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">:=</span> <span class="n">kvsql</span><span class="o">.</span><span class="n">DecodeRecordSet</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">ColumnCount</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.4.1.3 获取lastInsertId</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func (c ResultSet) LastInsertID() uint64`
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">answer</span> <span class="o">:=</span> <span class="s2">&quot;0x0035000000053654333354053654333354066175746f4964066175746f49643f000b000000030502000536543333540536543333540574797065300574797065303f000b000000030300000536543333540536543333540574797065310574797065313f000a000000032000000536543333540536543333540574797065320574797065323f0014000000080000000536543333540536543333540574797065330574797065333f0014000000082800000536543333540536543333540574797065340574797065343f000c0000000408001f0536543333540536543333540574797065350574797065353f00ff0000000408001e0536543333540536543333540574797065360574797065363f00ff0000000408001e0536543333540536543333540574797065370574797065373f00160000000508001f0536543333540536543333540574797065380574797065383f00ff0000000500001e0536543333540536543333540574797065390574797065393f000b000000f600000005365433335405365433335406747970653130067479706531303f0020000000f600001e05365433335405365433335406747970653131067479706531313f000b000000f600000005365433335405365433335406747970653132067479706531323f0016000000f600001405365433335405365433335406747970653133067479706531333f00090000000900000005365433335405365433335406747970653134067479706531343f00080000000920000005365433335405365433335406747970653135067479706531353f00060000000200000005365433335405365433335406747970653136067479706531363f00040000000100000005365433335405365433335406747970653137067479706531373f00030000000120000005365433335405365433335406747970653138067479706531383f00050000000220000005365433335405365433335406747970653139067479706531393f000a0000000a80000005365433335405365433335406747970653230067479706532303f00130000000c80000005365433335405365433335406747970653231067479706532313f000a0000000b80000005365433335405365433335406747970653232067479706532323f00130000000780000005365433335405365433335406747970653233067479706532333f00040000000d60000005365433335405365433335406747970653234067479706532342e0000000000fe00000005365433335405365433335406747970653235067479706532352e0004000000fe00000005365433335405365433335406747970653236067479706532362e00fc030000fe00000005365433335405365433335406747970653237067479706532372e0000000000fd00000005365433335405365433335406747970653238067479706532382e0004000000fd00000005365433335405365433335406747970653239067479706532392e00fc030000fd00000005365433335405365433335406747970653330067479706533303f0000000000fe80000005365433335405365433335406747970653331067479706533313f0001000000fe80000005365433335405365433335406747970653332067479706533323f00ff000000fe80000005365433335405365433335406747970653333067479706533333f00ffff0000fc80000005365433335405365433335406747970653334067479706533343f00ff000000f980000005365433335405365433335406747970653335067479706533353f00ffffff00fa80000005365433335405365433335406747970653336067479706533362e0058020000fc00000005365433335405365433335406747970653337067479706533372e00fcffff03fa00000005365433335405365433335406747970653338067479706533383f0001000000fd80000005365433335405365433335406747970653339067479706533392e0000000000fe00000005365433335405365433335406747970653430067479706534302e0004000000fe00000005365433335405365433335406747970653431067479706534312e0010000000fe00000005365433335405365433335406747970653432067479706534322e0000000000fe00000005365433335405365433335406747970653433067479706534332e0004000000fe00000005365433335405365433335406747970653434067479706534342e00d4030000fe00000005365433335405365433335406747970653435067479706534353f00010000001020000005365433335405365433335406747970653436067479706534363f00400000001020000005365433335405365433335406747970653437067479706534373f00010000000100000005365433335405365433335406747970653438067479706534382e00fcffff03fa00000005365433335405365433335406747970653439067479706534392e00fcffff03fa00000005365433335405365433335406747970653530067479706535302e0004000000fe00000005365433335405365433335406747970653531067479706535312e0004000000fd00000001000000040907000001010100000000049e732b7b010101000000000415d0870701010100000000083aa1ffffffffffff010101000000000871575519bfcd04020101010000000004ba0f9f3e01010100000000044d6d6e3f0101010000000004d66cc3be0101010000000008a4a6c8fae881e83f0101010000000008aba76123a72be63f01010100000000052d313731340101020000000005000000212d302e3233363530303030303030303030303030303030303030303030303030300101020000000021000000062d3531343132010102000000000600000016302e383433303030303030303030303030303030303001010200000000160000000453d955000101010000000004c3d1180001010100000000024b2d0101010000000001660101010000000001170101010000000002282d01010100000000080e0000000054c91d0101010000000008000000287342f21d0101010000000008001ef1cdf239000001010100000000080100007524a8b01f0101010000000002770701010100000000000101020000000000000000013001010200000000010000006436383036323439363639373332383534303836393332373339363837343432383138343539323234343837313936333534323934343333343031373936333438363830353736303134373133383232343632323236353730393639323939303039353035010102000000006400000000010102000000000000000001640101020000000001000000fcff007a4f3979704e654c456e63684f69784944304b527637704134794e6638346e6649317076333252367a737a6246486a34527479447645574e644772557738715161576573774552307464454f50746b4d5a506b50673669564c585551445464486d71674e6736487351665639637134636772735436686e557063736463416e3041584f684f596c65636f34426a44464c7a62424e5276516c6c644632684b413355636c4a7350757738726c616363517872763663655851556c74427a414861773264456b4c4252597a53444e4d5a3033735534456b52666e6a48454e564e6730416f6c5a66355356753059486a426768563148355930654b4b7661735a473101010200000000ff000000000101020000000000000000012a0101020000000001000000fcff00ccd82dbce2a48abe65f391308024cff5bb3971c2aa2761f10c52476cc9e3235206b47528a36eb3767dc50852ed3ebfa5b17a0b47ed2a5a2b56ead26c5b96c805ca65e22eaabbc7af1560e71e57ca734ca952ed17f54285d4feecd11c0d5ba0e679c464cf1196373f427c41a8e9f5c157f78834f2e57c06aa5d5af0682504349f796518eca8f4f33dbf53a9dfa30e1f4232106825d8695817ae992d70fc0a30c8b4f9d232701d948d6a9199acd8e5ce94b5aa50af5929555b91f124167fde826315ba922120d8d4f6c5d1fcbdb08708521f9f91a7e84366f08b90bccbb18186660fe49d5ca270dbe476b3f4c7a7418b51d37cf38c7c55e5c784257dde277a4f01010200000000ff00000064279e9d01d72ec83ad3ae46ce057466371ba263f62a726018347135ec8619bc835e5f215431902b181ff2e41c6a28115a1e01b50ed33faad7601416032c3d2911b00b25e051f1f3676b082aa98d618f251c5b984976c4a89f7ed84ad8ef0ff22cdf05f1c50101020000000064000000189bc7836679d2fb8bf55d01daa0c7b7791a01b2d9359ec8ea010102000000001800000064892df41245164975050a48fdc2a262b012f29e95763cb507bd5df48b339d1539a988202f99d31cfe072df1696a58529b7813d848a4edcf9133bdbe67b4449b0718b07839471e35a6a798f9f17d6db70aee9b989e88d19dc9e363fc5906c4abb7d1bae32a0101020000000064000000143635363636373638363937303731373237333734010102000000001400000014363836393730373137323733373437353736373701010200000000140000000116010102000000000100000000010002000000000000000001610101020000000001000000046132373501010200000000040000000001000200000000000000000001000200000000000000000c61302c61312c61322c613630010102000000000c00000001000101020000000001000000087fffffffffffffff01010200000000080000000150010101000000001437323733373437353736373737383739383038310101020000000014000000143635363636373638363937303731373237333734010102000000001400000001390101020000000001000000016b0101020000000001000000&quot;</span>
<span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">hexutil</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">:=</span> <span class="n">kvsql</span><span class="o">.</span><span class="n">DecodeRecordSet</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">LastInsertID</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.4.1.4 获取修改的行数</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func (c ResultSet) UpdatedCount() uint32`
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">answer</span> <span class="o">:=</span> <span class="s2">&quot;0x0035000000053654333354053654333354066175746f4964066175746f49643f000b000000030502000536543333540536543333540574797065300574797065303f000b000000030300000536543333540536543333540574797065310574797065313f000a000000032000000536543333540536543333540574797065320574797065323f0014000000080000000536543333540536543333540574797065330574797065333f0014000000082800000536543333540536543333540574797065340574797065343f000c0000000408001f0536543333540536543333540574797065350574797065353f00ff0000000408001e0536543333540536543333540574797065360574797065363f00ff0000000408001e0536543333540536543333540574797065370574797065373f00160000000508001f0536543333540536543333540574797065380574797065383f00ff0000000500001e0536543333540536543333540574797065390574797065393f000b000000f600000005365433335405365433335406747970653130067479706531303f0020000000f600001e05365433335405365433335406747970653131067479706531313f000b000000f600000005365433335405365433335406747970653132067479706531323f0016000000f600001405365433335405365433335406747970653133067479706531333f00090000000900000005365433335405365433335406747970653134067479706531343f00080000000920000005365433335405365433335406747970653135067479706531353f00060000000200000005365433335405365433335406747970653136067479706531363f00040000000100000005365433335405365433335406747970653137067479706531373f00030000000120000005365433335405365433335406747970653138067479706531383f00050000000220000005365433335405365433335406747970653139067479706531393f000a0000000a80000005365433335405365433335406747970653230067479706532303f00130000000c80000005365433335405365433335406747970653231067479706532313f000a0000000b80000005365433335405365433335406747970653232067479706532323f00130000000780000005365433335405365433335406747970653233067479706532333f00040000000d60000005365433335405365433335406747970653234067479706532342e0000000000fe00000005365433335405365433335406747970653235067479706532352e0004000000fe00000005365433335405365433335406747970653236067479706532362e00fc030000fe00000005365433335405365433335406747970653237067479706532372e0000000000fd00000005365433335405365433335406747970653238067479706532382e0004000000fd00000005365433335405365433335406747970653239067479706532392e00fc030000fd00000005365433335405365433335406747970653330067479706533303f0000000000fe80000005365433335405365433335406747970653331067479706533313f0001000000fe80000005365433335405365433335406747970653332067479706533323f00ff000000fe80000005365433335405365433335406747970653333067479706533333f00ffff0000fc80000005365433335405365433335406747970653334067479706533343f00ff000000f980000005365433335405365433335406747970653335067479706533353f00ffffff00fa80000005365433335405365433335406747970653336067479706533362e0058020000fc00000005365433335405365433335406747970653337067479706533372e00fcffff03fa00000005365433335405365433335406747970653338067479706533383f0001000000fd80000005365433335405365433335406747970653339067479706533392e0000000000fe00000005365433335405365433335406747970653430067479706534302e0004000000fe00000005365433335405365433335406747970653431067479706534312e0010000000fe00000005365433335405365433335406747970653432067479706534322e0000000000fe00000005365433335405365433335406747970653433067479706534332e0004000000fe00000005365433335405365433335406747970653434067479706534342e00d4030000fe00000005365433335405365433335406747970653435067479706534353f00010000001020000005365433335405365433335406747970653436067479706534363f00400000001020000005365433335405365433335406747970653437067479706534373f00010000000100000005365433335405365433335406747970653438067479706534382e00fcffff03fa00000005365433335405365433335406747970653439067479706534392e00fcffff03fa00000005365433335405365433335406747970653530067479706535302e0004000000fe00000005365433335405365433335406747970653531067479706535312e0004000000fd00000001000000040907000001010100000000049e732b7b010101000000000415d0870701010100000000083aa1ffffffffffff010101000000000871575519bfcd04020101010000000004ba0f9f3e01010100000000044d6d6e3f0101010000000004d66cc3be0101010000000008a4a6c8fae881e83f0101010000000008aba76123a72be63f01010100000000052d313731340101020000000005000000212d302e3233363530303030303030303030303030303030303030303030303030300101020000000021000000062d3531343132010102000000000600000016302e383433303030303030303030303030303030303001010200000000160000000453d955000101010000000004c3d1180001010100000000024b2d0101010000000001660101010000000001170101010000000002282d01010100000000080e0000000054c91d0101010000000008000000287342f21d0101010000000008001ef1cdf239000001010100000000080100007524a8b01f0101010000000002770701010100000000000101020000000000000000013001010200000000010000006436383036323439363639373332383534303836393332373339363837343432383138343539323234343837313936333534323934343333343031373936333438363830353736303134373133383232343632323236353730393639323939303039353035010102000000006400000000010102000000000000000001640101020000000001000000fcff007a4f3979704e654c456e63684f69784944304b527637704134794e6638346e6649317076333252367a737a6246486a34527479447645574e644772557738715161576573774552307464454f50746b4d5a506b50673669564c585551445464486d71674e6736487351665639637134636772735436686e557063736463416e3041584f684f596c65636f34426a44464c7a62424e5276516c6c644632684b413355636c4a7350757738726c616363517872763663655851556c74427a414861773264456b4c4252597a53444e4d5a3033735534456b52666e6a48454e564e6730416f6c5a66355356753059486a426768563148355930654b4b7661735a473101010200000000ff000000000101020000000000000000012a0101020000000001000000fcff00ccd82dbce2a48abe65f391308024cff5bb3971c2aa2761f10c52476cc9e3235206b47528a36eb3767dc50852ed3ebfa5b17a0b47ed2a5a2b56ead26c5b96c805ca65e22eaabbc7af1560e71e57ca734ca952ed17f54285d4feecd11c0d5ba0e679c464cf1196373f427c41a8e9f5c157f78834f2e57c06aa5d5af0682504349f796518eca8f4f33dbf53a9dfa30e1f4232106825d8695817ae992d70fc0a30c8b4f9d232701d948d6a9199acd8e5ce94b5aa50af5929555b91f124167fde826315ba922120d8d4f6c5d1fcbdb08708521f9f91a7e84366f08b90bccbb18186660fe49d5ca270dbe476b3f4c7a7418b51d37cf38c7c55e5c784257dde277a4f01010200000000ff00000064279e9d01d72ec83ad3ae46ce057466371ba263f62a726018347135ec8619bc835e5f215431902b181ff2e41c6a28115a1e01b50ed33faad7601416032c3d2911b00b25e051f1f3676b082aa98d618f251c5b984976c4a89f7ed84ad8ef0ff22cdf05f1c50101020000000064000000189bc7836679d2fb8bf55d01daa0c7b7791a01b2d9359ec8ea010102000000001800000064892df41245164975050a48fdc2a262b012f29e95763cb507bd5df48b339d1539a988202f99d31cfe072df1696a58529b7813d848a4edcf9133bdbe67b4449b0718b07839471e35a6a798f9f17d6db70aee9b989e88d19dc9e363fc5906c4abb7d1bae32a0101020000000064000000143635363636373638363937303731373237333734010102000000001400000014363836393730373137323733373437353736373701010200000000140000000116010102000000000100000000010002000000000000000001610101020000000001000000046132373501010200000000040000000001000200000000000000000001000200000000000000000c61302c61312c61322c613630010102000000000c00000001000101020000000001000000087fffffffffffffff01010200000000080000000150010101000000001437323733373437353736373737383739383038310101020000000014000000143635363636373638363937303731373237333734010102000000001400000001390101020000000001000000016b0101020000000001000000&quot;</span>
<span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">hexutil</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">:=</span> <span class="n">kvsql</span><span class="o">.</span><span class="n">DecodeRecordSet</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">UpdatedCount</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.4.1.5 获取列</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func (c ResultSet) Columns() []string`
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">answer</span> <span class="o">:=</span> <span class="s2">&quot;0x0035000000053654333354053654333354066175746f4964066175746f49643f000b000000030502000536543333540536543333540574797065300574797065303f000b000000030300000536543333540536543333540574797065310574797065313f000a000000032000000536543333540536543333540574797065320574797065323f0014000000080000000536543333540536543333540574797065330574797065333f0014000000082800000536543333540536543333540574797065340574797065343f000c0000000408001f0536543333540536543333540574797065350574797065353f00ff0000000408001e0536543333540536543333540574797065360574797065363f00ff0000000408001e0536543333540536543333540574797065370574797065373f00160000000508001f0536543333540536543333540574797065380574797065383f00ff0000000500001e0536543333540536543333540574797065390574797065393f000b000000f600000005365433335405365433335406747970653130067479706531303f0020000000f600001e05365433335405365433335406747970653131067479706531313f000b000000f600000005365433335405365433335406747970653132067479706531323f0016000000f600001405365433335405365433335406747970653133067479706531333f00090000000900000005365433335405365433335406747970653134067479706531343f00080000000920000005365433335405365433335406747970653135067479706531353f00060000000200000005365433335405365433335406747970653136067479706531363f00040000000100000005365433335405365433335406747970653137067479706531373f00030000000120000005365433335405365433335406747970653138067479706531383f00050000000220000005365433335405365433335406747970653139067479706531393f000a0000000a80000005365433335405365433335406747970653230067479706532303f00130000000c80000005365433335405365433335406747970653231067479706532313f000a0000000b80000005365433335405365433335406747970653232067479706532323f00130000000780000005365433335405365433335406747970653233067479706532333f00040000000d60000005365433335405365433335406747970653234067479706532342e0000000000fe00000005365433335405365433335406747970653235067479706532352e0004000000fe00000005365433335405365433335406747970653236067479706532362e00fc030000fe00000005365433335405365433335406747970653237067479706532372e0000000000fd00000005365433335405365433335406747970653238067479706532382e0004000000fd00000005365433335405365433335406747970653239067479706532392e00fc030000fd00000005365433335405365433335406747970653330067479706533303f0000000000fe80000005365433335405365433335406747970653331067479706533313f0001000000fe80000005365433335405365433335406747970653332067479706533323f00ff000000fe80000005365433335405365433335406747970653333067479706533333f00ffff0000fc80000005365433335405365433335406747970653334067479706533343f00ff000000f980000005365433335405365433335406747970653335067479706533353f00ffffff00fa80000005365433335405365433335406747970653336067479706533362e0058020000fc00000005365433335405365433335406747970653337067479706533372e00fcffff03fa00000005365433335405365433335406747970653338067479706533383f0001000000fd80000005365433335405365433335406747970653339067479706533392e0000000000fe00000005365433335405365433335406747970653430067479706534302e0004000000fe00000005365433335405365433335406747970653431067479706534312e0010000000fe00000005365433335405365433335406747970653432067479706534322e0000000000fe00000005365433335405365433335406747970653433067479706534332e0004000000fe00000005365433335405365433335406747970653434067479706534342e00d4030000fe00000005365433335405365433335406747970653435067479706534353f00010000001020000005365433335405365433335406747970653436067479706534363f00400000001020000005365433335405365433335406747970653437067479706534373f00010000000100000005365433335405365433335406747970653438067479706534382e00fcffff03fa00000005365433335405365433335406747970653439067479706534392e00fcffff03fa00000005365433335405365433335406747970653530067479706535302e0004000000fe00000005365433335405365433335406747970653531067479706535312e0004000000fd00000001000000040907000001010100000000049e732b7b010101000000000415d0870701010100000000083aa1ffffffffffff010101000000000871575519bfcd04020101010000000004ba0f9f3e01010100000000044d6d6e3f0101010000000004d66cc3be0101010000000008a4a6c8fae881e83f0101010000000008aba76123a72be63f01010100000000052d313731340101020000000005000000212d302e3233363530303030303030303030303030303030303030303030303030300101020000000021000000062d3531343132010102000000000600000016302e383433303030303030303030303030303030303001010200000000160000000453d955000101010000000004c3d1180001010100000000024b2d0101010000000001660101010000000001170101010000000002282d01010100000000080e0000000054c91d0101010000000008000000287342f21d0101010000000008001ef1cdf239000001010100000000080100007524a8b01f0101010000000002770701010100000000000101020000000000000000013001010200000000010000006436383036323439363639373332383534303836393332373339363837343432383138343539323234343837313936333534323934343333343031373936333438363830353736303134373133383232343632323236353730393639323939303039353035010102000000006400000000010102000000000000000001640101020000000001000000fcff007a4f3979704e654c456e63684f69784944304b527637704134794e6638346e6649317076333252367a737a6246486a34527479447645574e644772557738715161576573774552307464454f50746b4d5a506b50673669564c585551445464486d71674e6736487351665639637134636772735436686e557063736463416e3041584f684f596c65636f34426a44464c7a62424e5276516c6c644632684b413355636c4a7350757738726c616363517872763663655851556c74427a414861773264456b4c4252597a53444e4d5a3033735534456b52666e6a48454e564e6730416f6c5a66355356753059486a426768563148355930654b4b7661735a473101010200000000ff000000000101020000000000000000012a0101020000000001000000fcff00ccd82dbce2a48abe65f391308024cff5bb3971c2aa2761f10c52476cc9e3235206b47528a36eb3767dc50852ed3ebfa5b17a0b47ed2a5a2b56ead26c5b96c805ca65e22eaabbc7af1560e71e57ca734ca952ed17f54285d4feecd11c0d5ba0e679c464cf1196373f427c41a8e9f5c157f78834f2e57c06aa5d5af0682504349f796518eca8f4f33dbf53a9dfa30e1f4232106825d8695817ae992d70fc0a30c8b4f9d232701d948d6a9199acd8e5ce94b5aa50af5929555b91f124167fde826315ba922120d8d4f6c5d1fcbdb08708521f9f91a7e84366f08b90bccbb18186660fe49d5ca270dbe476b3f4c7a7418b51d37cf38c7c55e5c784257dde277a4f01010200000000ff00000064279e9d01d72ec83ad3ae46ce057466371ba263f62a726018347135ec8619bc835e5f215431902b181ff2e41c6a28115a1e01b50ed33faad7601416032c3d2911b00b25e051f1f3676b082aa98d618f251c5b984976c4a89f7ed84ad8ef0ff22cdf05f1c50101020000000064000000189bc7836679d2fb8bf55d01daa0c7b7791a01b2d9359ec8ea010102000000001800000064892df41245164975050a48fdc2a262b012f29e95763cb507bd5df48b339d1539a988202f99d31cfe072df1696a58529b7813d848a4edcf9133bdbe67b4449b0718b07839471e35a6a798f9f17d6db70aee9b989e88d19dc9e363fc5906c4abb7d1bae32a0101020000000064000000143635363636373638363937303731373237333734010102000000001400000014363836393730373137323733373437353736373701010200000000140000000116010102000000000100000000010002000000000000000001610101020000000001000000046132373501010200000000040000000001000200000000000000000001000200000000000000000c61302c61312c61322c613630010102000000000c00000001000101020000000001000000087fffffffffffffff01010200000000080000000150010101000000001437323733373437353736373737383739383038310101020000000014000000143635363636373638363937303731373237333734010102000000001400000001390101020000000001000000016b0101020000000001000000&quot;</span>
<span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">hexutil</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">:=</span> <span class="n">kvsql</span><span class="o">.</span><span class="n">DecodeRecordSet</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">Columns</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.4.1.6 获取行数</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func (c ResultSet) RowNumber() int`
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">answer</span> <span class="o">:=</span> <span class="s2">&quot;0x0035000000053654333354053654333354066175746f4964066175746f49643f000b000000030502000536543333540536543333540574797065300574797065303f000b000000030300000536543333540536543333540574797065310574797065313f000a000000032000000536543333540536543333540574797065320574797065323f0014000000080000000536543333540536543333540574797065330574797065333f0014000000082800000536543333540536543333540574797065340574797065343f000c0000000408001f0536543333540536543333540574797065350574797065353f00ff0000000408001e0536543333540536543333540574797065360574797065363f00ff0000000408001e0536543333540536543333540574797065370574797065373f00160000000508001f0536543333540536543333540574797065380574797065383f00ff0000000500001e0536543333540536543333540574797065390574797065393f000b000000f600000005365433335405365433335406747970653130067479706531303f0020000000f600001e05365433335405365433335406747970653131067479706531313f000b000000f600000005365433335405365433335406747970653132067479706531323f0016000000f600001405365433335405365433335406747970653133067479706531333f00090000000900000005365433335405365433335406747970653134067479706531343f00080000000920000005365433335405365433335406747970653135067479706531353f00060000000200000005365433335405365433335406747970653136067479706531363f00040000000100000005365433335405365433335406747970653137067479706531373f00030000000120000005365433335405365433335406747970653138067479706531383f00050000000220000005365433335405365433335406747970653139067479706531393f000a0000000a80000005365433335405365433335406747970653230067479706532303f00130000000c80000005365433335405365433335406747970653231067479706532313f000a0000000b80000005365433335405365433335406747970653232067479706532323f00130000000780000005365433335405365433335406747970653233067479706532333f00040000000d60000005365433335405365433335406747970653234067479706532342e0000000000fe00000005365433335405365433335406747970653235067479706532352e0004000000fe00000005365433335405365433335406747970653236067479706532362e00fc030000fe00000005365433335405365433335406747970653237067479706532372e0000000000fd00000005365433335405365433335406747970653238067479706532382e0004000000fd00000005365433335405365433335406747970653239067479706532392e00fc030000fd00000005365433335405365433335406747970653330067479706533303f0000000000fe80000005365433335405365433335406747970653331067479706533313f0001000000fe80000005365433335405365433335406747970653332067479706533323f00ff000000fe80000005365433335405365433335406747970653333067479706533333f00ffff0000fc80000005365433335405365433335406747970653334067479706533343f00ff000000f980000005365433335405365433335406747970653335067479706533353f00ffffff00fa80000005365433335405365433335406747970653336067479706533362e0058020000fc00000005365433335405365433335406747970653337067479706533372e00fcffff03fa00000005365433335405365433335406747970653338067479706533383f0001000000fd80000005365433335405365433335406747970653339067479706533392e0000000000fe00000005365433335405365433335406747970653430067479706534302e0004000000fe00000005365433335405365433335406747970653431067479706534312e0010000000fe00000005365433335405365433335406747970653432067479706534322e0000000000fe00000005365433335405365433335406747970653433067479706534332e0004000000fe00000005365433335405365433335406747970653434067479706534342e00d4030000fe00000005365433335405365433335406747970653435067479706534353f00010000001020000005365433335405365433335406747970653436067479706534363f00400000001020000005365433335405365433335406747970653437067479706534373f00010000000100000005365433335405365433335406747970653438067479706534382e00fcffff03fa00000005365433335405365433335406747970653439067479706534392e00fcffff03fa00000005365433335405365433335406747970653530067479706535302e0004000000fe00000005365433335405365433335406747970653531067479706535312e0004000000fd00000001000000040907000001010100000000049e732b7b010101000000000415d0870701010100000000083aa1ffffffffffff010101000000000871575519bfcd04020101010000000004ba0f9f3e01010100000000044d6d6e3f0101010000000004d66cc3be0101010000000008a4a6c8fae881e83f0101010000000008aba76123a72be63f01010100000000052d313731340101020000000005000000212d302e3233363530303030303030303030303030303030303030303030303030300101020000000021000000062d3531343132010102000000000600000016302e383433303030303030303030303030303030303001010200000000160000000453d955000101010000000004c3d1180001010100000000024b2d0101010000000001660101010000000001170101010000000002282d01010100000000080e0000000054c91d0101010000000008000000287342f21d0101010000000008001ef1cdf239000001010100000000080100007524a8b01f0101010000000002770701010100000000000101020000000000000000013001010200000000010000006436383036323439363639373332383534303836393332373339363837343432383138343539323234343837313936333534323934343333343031373936333438363830353736303134373133383232343632323236353730393639323939303039353035010102000000006400000000010102000000000000000001640101020000000001000000fcff007a4f3979704e654c456e63684f69784944304b527637704134794e6638346e6649317076333252367a737a6246486a34527479447645574e644772557738715161576573774552307464454f50746b4d5a506b50673669564c585551445464486d71674e6736487351665639637134636772735436686e557063736463416e3041584f684f596c65636f34426a44464c7a62424e5276516c6c644632684b413355636c4a7350757738726c616363517872763663655851556c74427a414861773264456b4c4252597a53444e4d5a3033735534456b52666e6a48454e564e6730416f6c5a66355356753059486a426768563148355930654b4b7661735a473101010200000000ff000000000101020000000000000000012a0101020000000001000000fcff00ccd82dbce2a48abe65f391308024cff5bb3971c2aa2761f10c52476cc9e3235206b47528a36eb3767dc50852ed3ebfa5b17a0b47ed2a5a2b56ead26c5b96c805ca65e22eaabbc7af1560e71e57ca734ca952ed17f54285d4feecd11c0d5ba0e679c464cf1196373f427c41a8e9f5c157f78834f2e57c06aa5d5af0682504349f796518eca8f4f33dbf53a9dfa30e1f4232106825d8695817ae992d70fc0a30c8b4f9d232701d948d6a9199acd8e5ce94b5aa50af5929555b91f124167fde826315ba922120d8d4f6c5d1fcbdb08708521f9f91a7e84366f08b90bccbb18186660fe49d5ca270dbe476b3f4c7a7418b51d37cf38c7c55e5c784257dde277a4f01010200000000ff00000064279e9d01d72ec83ad3ae46ce057466371ba263f62a726018347135ec8619bc835e5f215431902b181ff2e41c6a28115a1e01b50ed33faad7601416032c3d2911b00b25e051f1f3676b082aa98d618f251c5b984976c4a89f7ed84ad8ef0ff22cdf05f1c50101020000000064000000189bc7836679d2fb8bf55d01daa0c7b7791a01b2d9359ec8ea010102000000001800000064892df41245164975050a48fdc2a262b012f29e95763cb507bd5df48b339d1539a988202f99d31cfe072df1696a58529b7813d848a4edcf9133bdbe67b4449b0718b07839471e35a6a798f9f17d6db70aee9b989e88d19dc9e363fc5906c4abb7d1bae32a0101020000000064000000143635363636373638363937303731373237333734010102000000001400000014363836393730373137323733373437353736373701010200000000140000000116010102000000000100000000010002000000000000000001610101020000000001000000046132373501010200000000040000000001000200000000000000000001000200000000000000000c61302c61312c61322c613630010102000000000c00000001000101020000000001000000087fffffffffffffff01010200000000080000000150010101000000001437323733373437353736373737383739383038310101020000000014000000143635363636373638363937303731373237333734010102000000001400000001390101020000000001000000016b0101020000000001000000&quot;</span>
<span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">hexutil</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">:=</span> <span class="n">kvsql</span><span class="o">.</span><span class="n">DecodeRecordSet</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">RowNumber</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.4.1.7 获取指定行数据</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`func (rs *ResultSet) GetRow(rowIndex int) Row`
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">answer</span> <span class="o">:=</span> <span class="s2">&quot;0x0035000000053654333354053654333354066175746f4964066175746f49643f000b000000030502000536543333540536543333540574797065300574797065303f000b000000030300000536543333540536543333540574797065310574797065313f000a000000032000000536543333540536543333540574797065320574797065323f0014000000080000000536543333540536543333540574797065330574797065333f0014000000082800000536543333540536543333540574797065340574797065343f000c0000000408001f0536543333540536543333540574797065350574797065353f00ff0000000408001e0536543333540536543333540574797065360574797065363f00ff0000000408001e0536543333540536543333540574797065370574797065373f00160000000508001f0536543333540536543333540574797065380574797065383f00ff0000000500001e0536543333540536543333540574797065390574797065393f000b000000f600000005365433335405365433335406747970653130067479706531303f0020000000f600001e05365433335405365433335406747970653131067479706531313f000b000000f600000005365433335405365433335406747970653132067479706531323f0016000000f600001405365433335405365433335406747970653133067479706531333f00090000000900000005365433335405365433335406747970653134067479706531343f00080000000920000005365433335405365433335406747970653135067479706531353f00060000000200000005365433335405365433335406747970653136067479706531363f00040000000100000005365433335405365433335406747970653137067479706531373f00030000000120000005365433335405365433335406747970653138067479706531383f00050000000220000005365433335405365433335406747970653139067479706531393f000a0000000a80000005365433335405365433335406747970653230067479706532303f00130000000c80000005365433335405365433335406747970653231067479706532313f000a0000000b80000005365433335405365433335406747970653232067479706532323f00130000000780000005365433335405365433335406747970653233067479706532333f00040000000d60000005365433335405365433335406747970653234067479706532342e0000000000fe00000005365433335405365433335406747970653235067479706532352e0004000000fe00000005365433335405365433335406747970653236067479706532362e00fc030000fe00000005365433335405365433335406747970653237067479706532372e0000000000fd00000005365433335405365433335406747970653238067479706532382e0004000000fd00000005365433335405365433335406747970653239067479706532392e00fc030000fd00000005365433335405365433335406747970653330067479706533303f0000000000fe80000005365433335405365433335406747970653331067479706533313f0001000000fe80000005365433335405365433335406747970653332067479706533323f00ff000000fe80000005365433335405365433335406747970653333067479706533333f00ffff0000fc80000005365433335405365433335406747970653334067479706533343f00ff000000f980000005365433335405365433335406747970653335067479706533353f00ffffff00fa80000005365433335405365433335406747970653336067479706533362e0058020000fc00000005365433335405365433335406747970653337067479706533372e00fcffff03fa00000005365433335405365433335406747970653338067479706533383f0001000000fd80000005365433335405365433335406747970653339067479706533392e0000000000fe00000005365433335405365433335406747970653430067479706534302e0004000000fe00000005365433335405365433335406747970653431067479706534312e0010000000fe00000005365433335405365433335406747970653432067479706534322e0000000000fe00000005365433335405365433335406747970653433067479706534332e0004000000fe00000005365433335405365433335406747970653434067479706534342e00d4030000fe00000005365433335405365433335406747970653435067479706534353f00010000001020000005365433335405365433335406747970653436067479706534363f00400000001020000005365433335405365433335406747970653437067479706534373f00010000000100000005365433335405365433335406747970653438067479706534382e00fcffff03fa00000005365433335405365433335406747970653439067479706534392e00fcffff03fa00000005365433335405365433335406747970653530067479706535302e0004000000fe00000005365433335405365433335406747970653531067479706535312e0004000000fd00000001000000040907000001010100000000049e732b7b010101000000000415d0870701010100000000083aa1ffffffffffff010101000000000871575519bfcd04020101010000000004ba0f9f3e01010100000000044d6d6e3f0101010000000004d66cc3be0101010000000008a4a6c8fae881e83f0101010000000008aba76123a72be63f01010100000000052d313731340101020000000005000000212d302e3233363530303030303030303030303030303030303030303030303030300101020000000021000000062d3531343132010102000000000600000016302e383433303030303030303030303030303030303001010200000000160000000453d955000101010000000004c3d1180001010100000000024b2d0101010000000001660101010000000001170101010000000002282d01010100000000080e0000000054c91d0101010000000008000000287342f21d0101010000000008001ef1cdf239000001010100000000080100007524a8b01f0101010000000002770701010100000000000101020000000000000000013001010200000000010000006436383036323439363639373332383534303836393332373339363837343432383138343539323234343837313936333534323934343333343031373936333438363830353736303134373133383232343632323236353730393639323939303039353035010102000000006400000000010102000000000000000001640101020000000001000000fcff007a4f3979704e654c456e63684f69784944304b527637704134794e6638346e6649317076333252367a737a6246486a34527479447645574e644772557738715161576573774552307464454f50746b4d5a506b50673669564c585551445464486d71674e6736487351665639637134636772735436686e557063736463416e3041584f684f596c65636f34426a44464c7a62424e5276516c6c644632684b413355636c4a7350757738726c616363517872763663655851556c74427a414861773264456b4c4252597a53444e4d5a3033735534456b52666e6a48454e564e6730416f6c5a66355356753059486a426768563148355930654b4b7661735a473101010200000000ff000000000101020000000000000000012a0101020000000001000000fcff00ccd82dbce2a48abe65f391308024cff5bb3971c2aa2761f10c52476cc9e3235206b47528a36eb3767dc50852ed3ebfa5b17a0b47ed2a5a2b56ead26c5b96c805ca65e22eaabbc7af1560e71e57ca734ca952ed17f54285d4feecd11c0d5ba0e679c464cf1196373f427c41a8e9f5c157f78834f2e57c06aa5d5af0682504349f796518eca8f4f33dbf53a9dfa30e1f4232106825d8695817ae992d70fc0a30c8b4f9d232701d948d6a9199acd8e5ce94b5aa50af5929555b91f124167fde826315ba922120d8d4f6c5d1fcbdb08708521f9f91a7e84366f08b90bccbb18186660fe49d5ca270dbe476b3f4c7a7418b51d37cf38c7c55e5c784257dde277a4f01010200000000ff00000064279e9d01d72ec83ad3ae46ce057466371ba263f62a726018347135ec8619bc835e5f215431902b181ff2e41c6a28115a1e01b50ed33faad7601416032c3d2911b00b25e051f1f3676b082aa98d618f251c5b984976c4a89f7ed84ad8ef0ff22cdf05f1c50101020000000064000000189bc7836679d2fb8bf55d01daa0c7b7791a01b2d9359ec8ea010102000000001800000064892df41245164975050a48fdc2a262b012f29e95763cb507bd5df48b339d1539a988202f99d31cfe072df1696a58529b7813d848a4edcf9133bdbe67b4449b0718b07839471e35a6a798f9f17d6db70aee9b989e88d19dc9e363fc5906c4abb7d1bae32a0101020000000064000000143635363636373638363937303731373237333734010102000000001400000014363836393730373137323733373437353736373701010200000000140000000116010102000000000100000000010002000000000000000001610101020000000001000000046132373501010200000000040000000001000200000000000000000001000200000000000000000c61302c61312c61322c613630010102000000000c00000001000101020000000001000000087fffffffffffffff01010200000000080000000150010101000000001437323733373437353736373737383739383038310101020000000014000000143635363636373638363937303731373237333734010102000000001400000001390101020000000001000000016b0101020000000001000000&quot;</span>
<span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">hexutil</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">:=</span> <span class="n">kvsql</span><span class="o">.</span><span class="n">DecodeRecordSet</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">rs</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.4.1.8 解具体的列(字段)的值</strong></p>
<p>解具体字段的值，需要弄清楚自己定义的**表字段类型**以及希望获取的字段**下标，<strong>并调用以下方法与之**一一对应</strong>。比如字符串类型字段调用GetString(index)来解。若类型对应错误会导致解出来的值不对，更严重的会导致panic。</p>
<ul class="simple">
<li><p>tinyint                   : GetInt8</p></li>
<li><p>tinyint unsigned          : GetUint8</p></li>
<li><p>smallint                  : GetInt16</p></li>
<li><p>smallint unsigned         : GetUint16</p></li>
<li><p>int                       : GetInt32</p></li>
<li><p>unsigned int              : GetUint32</p></li>
<li><p>bigint                    : GetInt64</p></li>
<li><p>unsigned bigint           : GetUint64</p></li>
<li><p>float                     : GetFloat32</p></li>
<li><p>dobule                    : GetFloat64</p></li>
<li><p>decimal                   : GetDecimal</p></li>
<li><p>varchar                   : GetString</p></li>
<li><p>bit, blob(字节类型)        : GetBytes</p></li>
<li><p>DateTime, timestamp, date : GetTime</p></li>
<li><p>time                      : GetDuration</p></li>
<li><p>enum                      : GetEnum</p></li>
<li><p>set                       : GetSet</p></li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetInt8</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">int8</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetUint8</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">uint8</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetInt16</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">int16</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetUint16</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">uint16</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetInt32</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">int32</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetUint32</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">uint32</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetInt64</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">int64</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetUint64</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">uint64</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetFloat32</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">float32</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetFloat64</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">float64</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetString</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">string</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetBytes</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="p">[]</span><span class="n">byte</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetTime</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">types</span><span class="o">.</span><span class="n">Time</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetDuration</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">,</span> <span class="n">fillFsp</span> <span class="nb">int</span><span class="p">)</span> <span class="n">types</span><span class="o">.</span><span class="n">Duration</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetEnum</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">types</span><span class="o">.</span><span class="n">Enum</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">IsNull</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">bool</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetDecimal</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="o">*</span><span class="n">types</span><span class="o">.</span><span class="n">MyDecimal</span>
<span class="n">func</span> <span class="p">(</span><span class="n">r</span> <span class="n">Row</span><span class="p">)</span> <span class="n">GetSet</span><span class="p">(</span><span class="n">colIdx</span> <span class="nb">int</span><span class="p">)</span> <span class="n">types</span><span class="o">.</span><span class="n">Set</span>
</pre></div>
</div>
</div></blockquote>
<p>示例：</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">answer</span> <span class="o">:=</span> <span class="s2">&quot;0x0035000000053654333354053654333354066175746f4964066175746f49643f000b000000030502000536543333540536543333540574797065300574797065303f000b000000030300000536543333540536543333540574797065310574797065313f000a000000032000000536543333540536543333540574797065320574797065323f0014000000080000000536543333540536543333540574797065330574797065333f0014000000082800000536543333540536543333540574797065340574797065343f000c0000000408001f0536543333540536543333540574797065350574797065353f00ff0000000408001e0536543333540536543333540574797065360574797065363f00ff0000000408001e0536543333540536543333540574797065370574797065373f00160000000508001f0536543333540536543333540574797065380574797065383f00ff0000000500001e0536543333540536543333540574797065390574797065393f000b000000f600000005365433335405365433335406747970653130067479706531303f0020000000f600001e05365433335405365433335406747970653131067479706531313f000b000000f600000005365433335405365433335406747970653132067479706531323f0016000000f600001405365433335405365433335406747970653133067479706531333f00090000000900000005365433335405365433335406747970653134067479706531343f00080000000920000005365433335405365433335406747970653135067479706531353f00060000000200000005365433335405365433335406747970653136067479706531363f00040000000100000005365433335405365433335406747970653137067479706531373f00030000000120000005365433335405365433335406747970653138067479706531383f00050000000220000005365433335405365433335406747970653139067479706531393f000a0000000a80000005365433335405365433335406747970653230067479706532303f00130000000c80000005365433335405365433335406747970653231067479706532313f000a0000000b80000005365433335405365433335406747970653232067479706532323f00130000000780000005365433335405365433335406747970653233067479706532333f00040000000d60000005365433335405365433335406747970653234067479706532342e0000000000fe00000005365433335405365433335406747970653235067479706532352e0004000000fe00000005365433335405365433335406747970653236067479706532362e00fc030000fe00000005365433335405365433335406747970653237067479706532372e0000000000fd00000005365433335405365433335406747970653238067479706532382e0004000000fd00000005365433335405365433335406747970653239067479706532392e00fc030000fd00000005365433335405365433335406747970653330067479706533303f0000000000fe80000005365433335405365433335406747970653331067479706533313f0001000000fe80000005365433335405365433335406747970653332067479706533323f00ff000000fe80000005365433335405365433335406747970653333067479706533333f00ffff0000fc80000005365433335405365433335406747970653334067479706533343f00ff000000f980000005365433335405365433335406747970653335067479706533353f00ffffff00fa80000005365433335405365433335406747970653336067479706533362e0058020000fc00000005365433335405365433335406747970653337067479706533372e00fcffff03fa00000005365433335405365433335406747970653338067479706533383f0001000000fd80000005365433335405365433335406747970653339067479706533392e0000000000fe00000005365433335405365433335406747970653430067479706534302e0004000000fe00000005365433335405365433335406747970653431067479706534312e0010000000fe00000005365433335405365433335406747970653432067479706534322e0000000000fe00000005365433335405365433335406747970653433067479706534332e0004000000fe00000005365433335405365433335406747970653434067479706534342e00d4030000fe00000005365433335405365433335406747970653435067479706534353f00010000001020000005365433335405365433335406747970653436067479706534363f00400000001020000005365433335405365433335406747970653437067479706534373f00010000000100000005365433335405365433335406747970653438067479706534382e00fcffff03fa00000005365433335405365433335406747970653439067479706534392e00fcffff03fa00000005365433335405365433335406747970653530067479706535302e0004000000fe00000005365433335405365433335406747970653531067479706535312e0004000000fd00000001000000040907000001010100000000049e732b7b010101000000000415d0870701010100000000083aa1ffffffffffff010101000000000871575519bfcd04020101010000000004ba0f9f3e01010100000000044d6d6e3f0101010000000004d66cc3be0101010000000008a4a6c8fae881e83f0101010000000008aba76123a72be63f01010100000000052d313731340101020000000005000000212d302e3233363530303030303030303030303030303030303030303030303030300101020000000021000000062d3531343132010102000000000600000016302e383433303030303030303030303030303030303001010200000000160000000453d955000101010000000004c3d1180001010100000000024b2d0101010000000001660101010000000001170101010000000002282d01010100000000080e0000000054c91d0101010000000008000000287342f21d0101010000000008001ef1cdf239000001010100000000080100007524a8b01f0101010000000002770701010100000000000101020000000000000000013001010200000000010000006436383036323439363639373332383534303836393332373339363837343432383138343539323234343837313936333534323934343333343031373936333438363830353736303134373133383232343632323236353730393639323939303039353035010102000000006400000000010102000000000000000001640101020000000001000000fcff007a4f3979704e654c456e63684f69784944304b527637704134794e6638346e6649317076333252367a737a6246486a34527479447645574e644772557738715161576573774552307464454f50746b4d5a506b50673669564c585551445464486d71674e6736487351665639637134636772735436686e557063736463416e3041584f684f596c65636f34426a44464c7a62424e5276516c6c644632684b413355636c4a7350757738726c616363517872763663655851556c74427a414861773264456b4c4252597a53444e4d5a3033735534456b52666e6a48454e564e6730416f6c5a66355356753059486a426768563148355930654b4b7661735a473101010200000000ff000000000101020000000000000000012a0101020000000001000000fcff00ccd82dbce2a48abe65f391308024cff5bb3971c2aa2761f10c52476cc9e3235206b47528a36eb3767dc50852ed3ebfa5b17a0b47ed2a5a2b56ead26c5b96c805ca65e22eaabbc7af1560e71e57ca734ca952ed17f54285d4feecd11c0d5ba0e679c464cf1196373f427c41a8e9f5c157f78834f2e57c06aa5d5af0682504349f796518eca8f4f33dbf53a9dfa30e1f4232106825d8695817ae992d70fc0a30c8b4f9d232701d948d6a9199acd8e5ce94b5aa50af5929555b91f124167fde826315ba922120d8d4f6c5d1fcbdb08708521f9f91a7e84366f08b90bccbb18186660fe49d5ca270dbe476b3f4c7a7418b51d37cf38c7c55e5c784257dde277a4f01010200000000ff00000064279e9d01d72ec83ad3ae46ce057466371ba263f62a726018347135ec8619bc835e5f215431902b181ff2e41c6a28115a1e01b50ed33faad7601416032c3d2911b00b25e051f1f3676b082aa98d618f251c5b984976c4a89f7ed84ad8ef0ff22cdf05f1c50101020000000064000000189bc7836679d2fb8bf55d01daa0c7b7791a01b2d9359ec8ea010102000000001800000064892df41245164975050a48fdc2a262b012f29e95763cb507bd5df48b339d1539a988202f99d31cfe072df1696a58529b7813d848a4edcf9133bdbe67b4449b0718b07839471e35a6a798f9f17d6db70aee9b989e88d19dc9e363fc5906c4abb7d1bae32a0101020000000064000000143635363636373638363937303731373237333734010102000000001400000014363836393730373137323733373437353736373701010200000000140000000116010102000000000100000000010002000000000000000001610101020000000001000000046132373501010200000000040000000001000200000000000000000001000200000000000000000c61302c61312c61322c613630010102000000000c00000001000101020000000001000000087fffffffffffffff01010200000000080000000150010101000000001437323733373437353736373737383739383038310101020000000014000000143635363636373638363937303731373237333734010102000000001400000001390101020000000001000000016b0101020000000001000000&quot;</span>
<span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">hexutil</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">:=</span> <span class="n">kvsql</span><span class="o">.</span><span class="n">DecodeRecordSet</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">row</span> <span class="o">:=</span> <span class="n">rs</span><span class="o">.</span><span class="n">GetRow</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">row</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="mi">49</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="fvm">
<h3>4.5 FVM<a class="headerlink" href="#fvm" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id58">
<h4>4.5.1 abi编解码<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h4>
<p><strong>规约</strong></p>
<p>虚拟机内部所有的abi类型均实现接口Compact</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Compact</span> <span class="n">compact</span> <span class="n">mode</span>
<span class="nb">type</span> <span class="n">Compact</span> <span class="n">interface</span> <span class="p">{</span>
  <span class="n">Encode</span><span class="p">()</span> <span class="p">([]</span><span class="n">byte</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
  <span class="n">Decode</span><span class="p">(</span><span class="n">val</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
  <span class="n">GetVal</span><span class="p">()</span> <span class="n">interface</span><span class="p">{}</span>
  <span class="n">GetType</span><span class="p">()</span> <span class="n">TypeString</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>目前FVM针对rust合约，类型映射关系如下</p>
<ul class="simple">
<li><p>FixI8         : i8</p></li>
<li><p>FixU8         : u8</p></li>
<li><p>FixI16        : i16</p></li>
<li><p>FixU16        : u16</p></li>
<li><p>FixI32        : i32</p></li>
<li><p>FixU32        : u32</p></li>
<li><p>FixI64        : i64</p></li>
<li><p>FixU64        : u64</p></li>
<li><p>FixI128       : i128</p></li>
<li><p>FixU128       : u128</p></li>
<li><p>CompactU8     : Compact&lt;u8&gt;(暂不支持)</p></li>
<li><p>CompactU16    : Compact&lt;u16&gt;(暂不支持)</p></li>
<li><p>CompactU32    : Compact&lt;u32&gt;(暂不支持)</p></li>
<li><p>CompactU64    : Compact&lt;u64&gt;(暂不支持)</p></li>
<li><p>CompactU128   : Compact&lt;u128&gt;(暂不支持)</p></li>
<li><p>CompactString : str</p></li>
<li><p>CompactVec    : vec</p></li>
<li><p>CompactArray  : array([; 3])</p></li>
<li><p>CompactStruct : struct</p></li>
<li><p>CompactBool   : bool</p></li>
</ul>
<p><strong>需要特殊说明的是:</strong></p>
<ol class="arabic simple">
<li><p><strong>128位的整数由于go原生不支持，这里利用big.Int(16位byte)来表示与编解码</strong></p></li>
</ol>
<ol class="arabic simple">
<li><p><strong>CompactVec, CompactArray， 由于存在可能的嵌套，我们必须要指定NextTypeList, 表明其嵌套的深度，例如vec&lt;vec&lt;string&gt;&gt;, 他的NextTypeList为[]TypeString{VecName, String}</strong></p></li>
</ol>
<ol class="arabic simple">
<li><p><strong>不要出现循环引用的结构</strong></p></li>
</ol>
<p><strong>**规约部分仅作了解，我们的真实使用使用请使用以下方法**</strong></p>
<p>示例结构体</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#[derive(TypeInfo)]</span>
<span class="n">pub</span> <span class="n">struct</span> <span class="n">Student</span> <span class="p">{</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">u32</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span>
    <span class="nb">list</span><span class="p">:</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1">#[derive(TypeInfo)]</span>
<span class="n">pub</span> <span class="n">struct</span> <span class="n">Info</span> <span class="p">{</span>
    <span class="n">ages</span><span class="p">:</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="p">[</span><span class="n">Student</span><span class="p">;</span> <span class="mi">10</span><span class="p">]</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>示例abi</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;contract&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;MyContract&quot;</span><span class="p">,</span>
    <span class="s2">&quot;constructor&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;methods&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;add&quot;</span><span class="p">,</span>
      <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;make_student&quot;</span><span class="p">,</span>
      <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">6</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;types&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;primitive&quot;</span><span class="p">,</span>
      <span class="s2">&quot;primitive&quot;</span><span class="p">:</span> <span class="s2">&quot;u64&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;struct&quot;</span><span class="p">,</span>
      <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">2</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">3</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">4</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;primitive&quot;</span><span class="p">,</span>
      <span class="s2">&quot;primitive&quot;</span><span class="p">:</span> <span class="s2">&quot;u32&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;primitive&quot;</span><span class="p">,</span>
      <span class="s2">&quot;primitive&quot;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vec&quot;</span><span class="p">,</span>
      <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">5</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vec&quot;</span><span class="p">,</span>
      <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">3</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;struct&quot;</span><span class="p">,</span>
      <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">7</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vec&quot;</span><span class="p">,</span>
      <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">8</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span>
      <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;type_id&quot;</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="s2">&quot;array_len&quot;</span><span class="p">:</span> <span class="mi">10</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.5.1.1 解析abi文件</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">GenAbi</span><span class="p">(</span><span class="n">reader</span> <span class="n">io</span><span class="o">.</span><span class="n">Reader</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">scale</span><span class="o">.</span><span class="n">Abi</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">currentABI</span> <span class="n">为abi的字符串</span>
<span class="n">a</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">fvm</span><span class="o">.</span><span class="n">GenAbi</span><span class="p">(</span><span class="n">strings</span><span class="o">.</span><span class="n">NewReader</span><span class="p">(</span><span class="n">currentABI</span><span class="p">))</span>
<span class="o">//</span> <span class="n">path</span> <span class="n">为abi文件路径</span>
<span class="n">by</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">JSON</span><span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="n">NewReader</span><span class="p">(</span><span class="n">by</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.5.1.2 获取payload</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">Encode</span><span class="p">(</span><span class="n">abi</span> <span class="o">*</span><span class="n">scale</span><span class="o">.</span><span class="n">Abi</span><span class="p">,</span> <span class="n">method</span> <span class="n">string</span><span class="p">,</span> <span class="n">params</span> <span class="o">...</span><span class="n">interface</span><span class="p">{})</span> <span class="p">([]</span><span class="n">byte</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>特别注意：</strong></p>
<p><strong>1.对于params的值严格按照abi文件对应的参数顺序，以及各个参数的格式进行传参</strong></p>
<p><strong>2.对于结构体类型，按照其每个属性的值以及顺序组成一个[]interface{}进行传输</strong></p>
<p><strong>3.对于数组按照顺序组成一个[]interface{}进行传输</strong></p>
<p><strong>4.对于整数，可以方便的传int或者字符串（我们依据abi文件对其正确性做了校验），但如果开发者自己指定类型，例如uint16(1), 这个时候我们会对该数字做严格的类型校验(开发者应该明白，uint16(1)与uint8(1)是不同的)</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fvm</span><span class="o">.</span><span class="n">Encode</span><span class="p">(</span><span class="n">abi</span><span class="p">,</span> <span class="s2">&quot;make_student&quot;</span><span class="p">,</span> <span class="p">[]</span><span class="n">interface</span><span class="p">{}{</span>
      <span class="n">uint32</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
      <span class="s2">&quot;test&quot;</span><span class="p">,</span>
      <span class="p">[]</span><span class="n">interface</span><span class="p">{}{</span>
        <span class="p">[]</span><span class="n">interface</span><span class="p">{}{</span>
          <span class="s2">&quot;hello&quot;</span><span class="p">,</span>
          <span class="s2">&quot;world&quot;</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">},</span> <span class="p">[]</span><span class="n">interface</span><span class="p">{}{</span>
      <span class="p">[]</span><span class="n">interface</span><span class="p">{}{},</span>
    <span class="p">})</span>
<span class="n">fvm</span><span class="o">.</span><span class="n">Encode</span><span class="p">(</span><span class="n">abi</span><span class="p">,</span> <span class="s2">&quot;make_student&quot;</span><span class="p">,</span> <span class="p">[]</span><span class="n">interface</span><span class="p">{}{</span>
      <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;test&quot;</span><span class="p">,</span>
      <span class="p">[]</span><span class="n">interface</span><span class="p">{}{</span>
        <span class="p">[]</span><span class="n">interface</span><span class="p">{}{</span>
          <span class="s2">&quot;hello&quot;</span><span class="p">,</span>
          <span class="s2">&quot;world&quot;</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">},</span> <span class="p">[]</span><span class="n">interface</span><span class="p">{}{</span>
      <span class="p">[]</span><span class="n">interface</span><span class="p">{}{},</span>
    <span class="p">})</span>

<span class="n">fvm</span><span class="o">.</span><span class="n">Encode</span><span class="p">(</span><span class="n">abi</span><span class="p">,</span> <span class="s2">&quot;make_student&quot;</span><span class="p">,</span> <span class="p">[]</span><span class="n">interface</span><span class="p">{}{</span>
      <span class="s2">&quot;1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;test&quot;</span><span class="p">,</span>
      <span class="p">[]</span><span class="n">interface</span><span class="p">{}{</span>
        <span class="p">[]</span><span class="n">interface</span><span class="p">{}{</span>
          <span class="s2">&quot;hello&quot;</span><span class="p">,</span>
          <span class="s2">&quot;world&quot;</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">},</span> <span class="p">[]</span><span class="n">interface</span><span class="p">{}{</span>
      <span class="p">[]</span><span class="n">interface</span><span class="p">{}{},</span>
    <span class="p">})</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>4.5.1.3 解析返回值</strong></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>type InvokeBean struct {
  // 方法名
  MethodName string  `json:&quot;method_name&quot;`
  // 返回值列表
  Params     []Compact `json:&quot;params&quot;`
}

func DecodeRet(abi *scale.Abi, method string, val []byte) (*scale.InvokeBean, error)
</pre></div>
</div>
</div></blockquote>
<p><strong>*</strong> 开发者应当自己在应用中定义对应的结构来映射放回值, 对于复杂的嵌套类型，开发者应当自己清楚的知道自己在做什么**</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">Student</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="n">string</span>
  <span class="n">Age</span> <span class="nb">int</span>
  <span class="n">Nums</span> <span class="p">[]</span><span class="nb">int</span>
  <span class="n">Friend</span> <span class="n">Base</span>
<span class="p">}</span>

<span class="nb">type</span> <span class="n">Base</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">Name</span> <span class="n">string</span>
  <span class="n">Age</span> <span class="nb">int</span>
<span class="p">}</span>
<span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">fvm</span><span class="o">.</span><span class="n">DecodeRet</span><span class="p">(</span><span class="n">abi</span><span class="p">,</span> <span class="s2">&quot;make_student&quot;</span><span class="p">,</span> <span class="n">common</span><span class="o">.</span><span class="n">Hex2Bytes</span><span class="p">(</span><span class="s2">&quot;xxx&quot;</span><span class="p">))</span>
<span class="n">var</span> <span class="n">nums</span> <span class="p">[]</span><span class="nb">int</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">res</span><span class="o">.</span><span class="n">Params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">GetVal</span><span class="p">()</span><span class="o">.</span><span class="p">([]</span><span class="n">scale</span><span class="o">.</span><span class="n">Compact</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">nums</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">GetVal</span><span class="p">())</span>
<span class="p">}</span>
<span class="n">friendCompact</span> <span class="o">:=</span> <span class="n">res</span><span class="o">.</span><span class="n">Params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">GetVal</span><span class="p">()</span><span class="o">.</span><span class="p">([]</span><span class="n">scale</span><span class="o">.</span><span class="n">Compact</span><span class="p">)</span>
<span class="n">f</span> <span class="o">:=</span> <span class="n">Base</span><span class="p">{</span>
  <span class="n">Name</span><span class="p">:</span> <span class="n">friendCompact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetVal</span><span class="p">(),</span>
  <span class="n">Age</span><span class="p">:</span> <span class="n">friendComapct</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetVal</span><span class="p">(),</span>
<span class="p">}</span>
<span class="n">newStudent</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">Student</span><span class="p">{</span>
  <span class="n">Name</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">Params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetVal</span><span class="p">(),</span>
  <span class="n">Age</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">Params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">GetVal</span><span class="p">(),</span>
  <span class="n">Nums</span><span class="p">:</span> <span class="n">num</span><span class="p">,</span>
  <span class="n">Friend</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="rpc">
<h2>第五章 RPC 接口<a class="headerlink" href="#rpc" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="grpc">
<h2>第六章 GRPC 接口<a class="headerlink" href="#grpc" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id59">
<h2>第七章 报错说明<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h2>
<p>GoSDK中和网络相关的RPC、grpc调用均返回StdError类型的错误。StdError为一个接口。</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">StdError</span> <span class="n">interface</span> <span class="p">{</span>
  <span class="n">fmt</span><span class="o">.</span><span class="n">Stringer</span>
  <span class="n">error</span>
  <span class="n">Code</span><span class="p">()</span> <span class="nb">int</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>所以，该结构提供三种方法：</p>
<p><cite>func (re *RetError) Error() string</cite></p>
<ul class="simple">
<li><p>说明：实现了error接口。</p></li>
<li><p>返回【返回值1】：返回错误描述。</p></li>
</ul>
<p><cite>func (re *RetError) String() string</cite></p>
<ul class="simple">
<li><p>说明：实现了fmt.Stringer接口。</p></li>
<li><p>返回【返回值1】：将会返回以下格式字符串”error code: %d, error reason: %s”, re.Code(), re.Error()，即错误码加错误描述。</p></li>
</ul>
<p><cite>func (re *RetError) Code() int {</cite></p>
<ul class="simple">
<li><p>说明：返回错误码。</p></li>
<li><p>返回【返回值1】：错误码。错误码表如下。</p></li>
<li><p>0      : 请求成功</p></li>
<li><p>-32700 : 服务端接收到无效的json。该错误发送于服务器尝试解析json文本</p></li>
<li><p>-32600 : 无效的请求（比如非法的JSON格式）</p></li>
<li><p>-32601 : 方法不存在或者无效</p></li>
<li><p>-32602 : 无效的方法参数</p></li>
<li><p>-32603 : JSON-RPC内部错误</p></li>
<li><p>-32605 : cvp在报错前的拦截器</p></li>
<li><p>-32606 : cvp在报错后的拦截器</p></li>
<li><p>-32000 : Hyperchain内部错误或者空指针或者节点未安装solidity环境</p></li>
<li><p>-32001 : 请求的数据不存在</p></li>
<li><p>-32002 : 余额不足</p></li>
<li><p>-32003 : 签名非法</p></li>
<li><p>-32004 : 合约部署出错</p></li>
<li><p>-32005 : 合约调用出错</p></li>
<li><p>-32006 : 系统繁忙</p></li>
<li><p>-32007 : 交易重复</p></li>
<li><p>-32008 : 合约操作权限不够</p></li>
<li><p>-32009 : (合约)账户不存在</p></li>
<li><p>-32010 : namespace不存在</p></li>
<li><p>-32011 : 账本上无区块产生，查询最新区块的时候可能抛出该错误</p></li>
<li><p>-32012 : 订阅不存在</p></li>
<li><p>-32013 : 数据归档、快照相关错误</p></li>
<li><p>-32014 : 未能解锁本地节点帐户</p></li>
<li><p>-32015 : 调用原生合约失败</p></li>
<li><p>-32016 : 无效的参与者节点哈希</p></li>
<li><p>-32017 : 不可用的peer</p></li>
<li><p>-32018 : 不一致的peer</p></li>
<li><p>-32019 : 没有collection信息的非法的私有交易</p></li>
<li><p>-32020 : ACO服务不可用</p></li>
<li><p>-32021 : 废弃的接口</p></li>
<li><p>-32022 : did调用失败</p></li>
<li><p>-32023 : cvp不支持此方法</p></li>
<li><p>-32024 : 共识状态非正常</p></li>
<li><p>-32025 : 进程已满</p></li>
<li><p>-32026 : QPS 受限</p></li>
<li><p>-32027 : simulate受限</p></li>
<li><p>-32028 : sql执行出错</p></li>
<li><p>-32096 : http请求处理超时</p></li>
<li><p>-32097 : Hypercli用户令牌无效</p></li>
<li><p>-32098 : 请求未带cert或者错误cert导致认证失败</p></li>
<li><p>-32099 : 请求tcert失败</p></li>
<li><p>-9995  : 请求失败(通常是请求体过长)</p></li>
<li><p>-9996  : 请求失败(通常是请求消息错误)</p></li>
<li><p>-9997  : 异步请求失败</p></li>
<li><p>-9998  : 请求超时</p></li>
<li><p>-9999  : 获取平台响应失败</p></li>
</ul>
</div>
<div class="section" id="id60">
<h2>第八章 示例<a class="headerlink" href="#id60" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id61">
<h3>8.1 EVM<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id62">
<h4>8.1.1 编写合约代码<a class="headerlink" href="#id62" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pragma</span> <span class="n">solidity</span> <span class="mf">0.8.0</span><span class="p">;</span>

<span class="n">contract</span> <span class="n">SetHash</span><span class="p">{</span>
    <span class="n">mapping</span><span class="p">(</span><span class="n">string</span> <span class="o">=&gt;</span> <span class="n">string</span><span class="p">)</span> <span class="n">hashMapping</span><span class="p">;</span>

    <span class="n">function</span> <span class="n">insert</span><span class="p">(</span><span class="n">string</span> <span class="n">memory</span> <span class="n">key</span><span class="p">,</span><span class="n">string</span> <span class="n">memory</span> <span class="n">value</span><span class="p">)</span> <span class="n">public</span> <span class="p">{</span>
        <span class="n">hashMapping</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">function</span> <span class="n">get</span><span class="p">(</span><span class="n">string</span> <span class="n">memory</span> <span class="n">key</span><span class="p">)</span> <span class="n">public</span> <span class="n">view</span> <span class="n">returns</span><span class="p">(</span><span class="n">string</span> <span class="n">memory</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">hashMapping</span><span class="p">[</span><span class="n">key</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id63">
<h4>8.1.2 编译合约<a class="headerlink" href="#id63" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">abi</span>
<span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;internalType&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;get&quot;</span><span class="p">,</span>
    <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;internalType&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;view&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;internalType&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;internalType&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;insert&quot;</span><span class="p">,</span>
    <span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;stateMutability&quot;</span><span class="p">:</span> <span class="s2">&quot;nonpayable&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span>
  <span class="p">}</span>
<span class="p">]</span>

<span class="o">//</span> <span class="nb">bin</span>
<span class="mi">608060405234801561001057600080</span><span class="n">fd5b5061056a806100206000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c806306e63ff81461003b578063693ec85e14610057575b600080fd5b610055600480360381019061005091906102ba565b610087565b005b610071600480360381019061006c9190610279565b6100be565b60405161007e91906103a7565b60405180910390f35b806000836040516100989190610390565b908152602001604051809103902090805190602001906100b992919061016e565b505050565b60606000826040516100d09190610390565b908152602001604051809103902080546100e990610493565b80601f016020809104026020016040519081016040528092919081815260200182805461011590610493565b80156101625780601f1061013757610100808354040283529160200191610162565b820191906000526020600020905b81548152906001019060200180831161014557829003601f168201915b50505050509050919050565b82805461017a90610493565b90600052602060002090601f01602090048101928261019c57600085556101e3565b82601f106101b557805160ff19168380011785556101e3565b828001600101855582156101e3579182015b828111156101e25782518255916020019190600101906101c7565b5b5090506101f091906101f4565b5090565b5b8082111561020d5760008160009055506001016101f5565b5090565b600061022461021f846103fa565b6103c9565b90508281526020810184848401111561023c57600080fd5b610247848285610451565b509392505050565b600082601f83011261026057600080fd5b8135610270848260208601610211565b91505092915050565b60006020828403121561028b57600080fd5b600082013567ffffffffffffffff8111156102a557600080fd5b6102b18482850161024f565b91505092915050565b600080604083850312156102cd57600080fd5b600083013567ffffffffffffffff8111156102e757600080fd5b6102f38582860161024f565b925050602083013567ffffffffffffffff81111561031057600080fd5b61031c8582860161024f565b9150509250929050565b60006103318261042a565b61033b8185610435565b935061034b818560208601610460565b61035481610523565b840191505092915050565b600061036a8261042a565b6103748185610446565b9350610384818560208601610460565b80840191505092915050565b600061039c828461035f565b915081905092915050565b600060208201905081810360008301526103c18184610326565b905092915050565b6000604051905081810181811067ffffffffffffffff821117156103f0576103ef6104f4565b5b8060405250919050565b600067ffffffffffffffff821115610415576104146104f4565b5b601f19601f8301169050602081019050919050565b600081519050919050565b600082825260208201905092915050565b600081905092915050565b82818337600083830152505050565b60005b8381101561047e578082015181840152602081019050610463565b8381111561048d576000848401525b50505050565b600060028204905060018216806104ab57607f821691505b602082108114156104bf576104be6104c5565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6000601f19601f830116905091905056fea264697066735822122022f216ab2a903b000b9ef84705051fed53aecd3e515879d46fd8372ba6f2cef364736f6c63430008000033</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id64">
<h4>8.1.3 使用gosdk<a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>package main

import (
  &quot;fmt&quot;
  &quot;github.com/hyperchain/gosdk/abi&quot;
  &quot;github.com/hyperchain/gosdk/account&quot;
  &quot;github.com/hyperchain/gosdk/rpc&quot;
  &quot;strings&quot;
)

const (
  abiContract = `[
  {
      &quot;constant&quot;: false,
      &quot;inputs&quot;: [
        {
            &quot;name&quot;: &quot;key&quot;,
            &quot;type&quot;: &quot;string&quot;
        },
        {
            &quot;name&quot;: &quot;value&quot;,
            &quot;type&quot;: &quot;string&quot;
        }
      ],
      &quot;name&quot;: &quot;insert&quot;,
      &quot;outputs&quot;: [],
      &quot;payable&quot;: false,
      &quot;stateMutability&quot;: &quot;nonpayable&quot;,
      &quot;type&quot;: &quot;function&quot;
  },
  {
      &quot;constant&quot;: true,
      &quot;inputs&quot;: [
        {
            &quot;name&quot;: &quot;key&quot;,
            &quot;type&quot;: &quot;string&quot;
        }
      ],
      &quot;name&quot;: &quot;get&quot;,
      &quot;outputs&quot;: [
        {
            &quot;name&quot;: &quot;&quot;,
            &quot;type&quot;: &quot;string&quot;
        }
      ],
      &quot;payable&quot;: false,
      &quot;stateMutability&quot;: &quot;view&quot;,
      &quot;type&quot;: &quot;function&quot;
  }
]`
  binContract = &quot;608060405234801561001057600080fd5b50610444806100206000396000f30060806040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306e63ff814610051578063693ec85e14610100575b600080fd5b34801561005d57600080fd5b506100fe600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290803590602001908201803590602001908080601f01602080910402602001604051908101604052809392919081815260200183838082843782019150505050505091929192905050506101e2565b005b34801561010c57600080fd5b50610167600480360381019080803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509192919290505050610266565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101a757808201518184015260208101905061018c565b50505050905090810190601f1680156101d45780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b806000836040518082805190602001908083835b60208310151561021b57805182526020820191506020810190506020830392506101f6565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390209080519060200190610261929190610373565b505050565b60606000826040518082805190602001908083835b6020831015156102a0578051825260208201915060208101905060208303925061027b565b6001836020036101000a03801982511681845116808217855250505050505090500191505090815260200160405180910390208054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156103675780601f1061033c57610100808354040283529160200191610367565b820191906000526020600020905b81548152906001019060200180831161034a57829003601f168201915b50505050509050919050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106103b457805160ff19168380011785556103e2565b828001600101855582156103e2579182015b828111156103e15782518255916020019190600101906103c6565b5b5090506103ef91906103f3565b5090565b61041591905b808211156104115760008160009055506001016103f9565b5090565b905600a165627a7a7230582001a711c918e9f0c995f05f63b0f98e6ee752d4e014717372d11bab848cbe4bae0029&quot;
)


func main() {
  // new account
  //创建账户
  accountJson, err := account.NewAccountSm2(&quot;123&quot;)
  if err != nil {
      fmt.Println(err)
      return
  }
  fmt.Println(&quot;accountJson:&quot;, accountJson)
  key, err := account.GenKeyFromAccountJson(accountJson, &quot;123&quot;)
  if err != nil {
      fmt.Println(err)
      return
  }
  newAddress := key.(*account.SM2Key).GetAddress()
  fmt.Println(&quot;account address:&quot;, newAddress)
  rpcAPI := rpc.NewRPCWithPath(&quot;./conf&quot;)

  // deploy
  //部署合约
  tranDeploy := rpc.NewTransaction(newAddress.Hex()).Deploy(binContract)
  txDeploy, stdErr := rpcAPI.SignAndDeployContract(tranDeploy, key)
  if stdErr != nil {
      fmt.Println(stdErr)
      return
  }
  fmt.Println(&quot;contract address:&quot;, txDeploy.ContractAddress)
  // invoke contract
  //调用合约
  ABI, _ := abi.JSON(strings.NewReader(abiContract))
  packed, err := ABI.Pack(&quot;insert&quot;, &quot;key1&quot;, &quot;value1&quot;)
  tranInvoke := rpc.NewTransaction(newAddress.Hex()).Invoke(txDeploy.ContractAddress, packed)
  txInvoke, stdErr := rpcAPI.SignAndInvokeContract(tranInvoke, key)
  if stdErr != nil {
      fmt.Println(stdErr)
      return
  }
  fmt.Println(&quot;invoke transaction hash:&quot;, txInvoke.TxHash)
  // invoke contract
  //调用合约
  packed1, err := ABI.Pack(&quot;get&quot;, &quot;key1&quot;)
  tranInvoke1 := rpc.NewTransaction(newAddress.Hex()).Invoke(txDeploy.ContractAddress, packed1)
  txInvoke1, err := rpcAPI.SignAndInvokeContract(tranInvoke1, key)
  if err != nil {
      fmt.Println(err)
      return
  }
  fmt.Println(&quot;invoke transaction hash:&quot;, txInvoke1.TxHash)

  // decode
  //返回值解析
  var result string
  if err = ABI.UnpackResult(&amp;result, &quot;get&quot;, txInvoke1.Ret); err != nil {
      fmt.Println(err)
      return
  }
  fmt.Println(&quot;get返回值:&quot;, result)

}
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="id65">
<h3>8.2 HVM<a class="headerlink" href="#id65" title="Permalink to this headline">¶</a></h3>
<p>本节展示了使用GoSDK操作HVM合约的完整例子。在使用gosdk之前，请到 <a class="reference external" href="http://hvm.internal.hyperchain.cn/](http://hvm.internal.hyperchain.cn/">http://hvm.internal.hyperchain.cn/](http://hvm.internal.hyperchain.cn/</a> 上学习如何编写HVM合约</p>
<p>通过一个SetHash 合约来展示如果通过gosdk 发送hvm合约交易。更多的HVM合约Demo 可参考下面链接中的示例</p>
<p><a class="reference external" href="http://thoughts.hyperchain.cn:8099/workspaces/5b6c3babbe825b41b446a307/docs/5ed787cac98cc900016b726e">http://thoughts.hyperchain.cn:8099/workspaces/5b6c3babbe825b41b446a307/docs/5ed787cac98cc900016b726e</a>,</p>
<p><a class="reference external" href="http://thoughts.hyperchain.cn:8099/workspaces/5b6c3babbe825b41b446a307/docs/5ed787cac98cc900016b726e">http://thoughts.hyperchain.cn:8099/workspaces/5b6c3babbe825b41b446a307/docs/5ed787cac98cc900016b726e</a></p>
<div class="section" id="hvminvokebean">
<h4>8.2.1 HVM合约invokeBean 如下所示<a class="headerlink" href="#hvminvokebean" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">invoke</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">cn.hyperchain.contract.BaseInvoke</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">logic.ISetHash</span><span class="p">;</span>

<span class="o">/**</span>
<span class="o">*</span> <span class="nd">@author</span> <span class="n">Lam</span>
<span class="o">*</span> <span class="nd">@ClassName</span> <span class="n">InvokeSetHash</span>
<span class="o">*</span> <span class="nd">@date</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">11</span>
<span class="o">*/</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">InvokeSetHash</span> <span class="n">implements</span> <span class="n">BaseInvoke</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">ISetHash</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">private</span> <span class="n">String</span> <span class="n">key</span><span class="p">;</span>
    <span class="n">private</span> <span class="n">String</span> <span class="n">value</span><span class="p">;</span>

    <span class="n">public</span> <span class="n">InvokeSetHash</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">InvokeSetHash</span><span class="p">(</span><span class="n">String</span> <span class="n">key</span><span class="p">,</span> <span class="n">String</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">this</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">;</span>
        <span class="n">this</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">invoke</span><span class="p">(</span><span class="n">ISetHash</span> <span class="n">iSetHash</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">iSetHash</span><span class="o">.</span><span class="n">setHash</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id66">
<h4>8.2.2 HVM 合约接口定义以及合约实现如下所示：<a class="headerlink" href="#id66" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">logic</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">cn.hyperchain.contract.BaseContractInterface</span><span class="p">;</span>

<span class="o">/**</span>
<span class="o">*</span> <span class="nd">@author</span> <span class="n">Lam</span>
<span class="o">*</span> <span class="nd">@ClassName</span> <span class="n">ISetHash</span>
<span class="o">*</span> <span class="nd">@date</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">11</span>
<span class="o">*/</span>
<span class="n">public</span> <span class="n">interface</span> <span class="n">ISetHash</span> <span class="n">extends</span> <span class="n">BaseContractInterface</span> <span class="p">{</span>
    <span class="n">void</span> <span class="n">setHash</span><span class="p">(</span><span class="n">String</span> <span class="n">key</span><span class="p">,</span> <span class="n">String</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">logic</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">cn.hyperchain.annotations.StoreField</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">cn.hyperchain.contract.BaseContract</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">cn.hyperchain.core.HyperMap</span><span class="p">;</span>

<span class="o">/**</span>
<span class="o">*</span> <span class="nd">@author</span> <span class="n">Lam</span>
<span class="o">*</span> <span class="nd">@ClassName</span> <span class="n">SetHash</span>
<span class="o">*</span> <span class="nd">@date</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">11</span>
<span class="o">*/</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">SetHash</span> <span class="n">extends</span> <span class="n">BaseContract</span> <span class="n">implements</span> <span class="n">ISetHash</span> <span class="p">{</span>
    <span class="nd">@StoreField</span>
    <span class="n">HyperMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nb">map</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HyperMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>

    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">setHash</span><span class="p">(</span><span class="n">String</span> <span class="n">key</span><span class="p">,</span> <span class="n">String</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">map</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">throw</span> <span class="n">new</span> <span class="n">RuntimeException</span><span class="p">(</span><span class="s2">&quot;error!!!&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">String</span> <span class="n">getHash</span><span class="p">(</span><span class="n">String</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id67">
<h4>8.2.3 合约编译以及ABI生成<a class="headerlink" href="#id67" title="Permalink to this headline">¶</a></h4>
<p>合约编译方式可以参考HVM上述HVM合约使用链接，这里只介绍HVM合约ABI 生成方式。</p>
<p>利用我们提供的HVM ABI 生成maven 插件即可编译生成HVM合约的ABI , 需要在合约项目pom 文件中加入下面的依赖</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;plugin&gt;
    &lt;groupId&gt;cn.hyperchain.hvm&lt;/groupId&gt;
    &lt;artifactId&gt;hvm-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;0.0.2&lt;/version&gt;
    &lt;configuration&gt;
        &lt;jarFile&gt;${project.basedir}/target/sethash-1.0-sethash.jar&lt;/jarFile&gt;
        &lt;invokeBeanPath&gt;${project.basedir}/target/classes&lt;/invokeBeanPath&gt;
        &lt;invokeBeanPackages&gt;
            &lt;param&gt;invoke.InvokeSetHash&lt;/param&gt;
        &lt;/invokeBeanPackages&gt;
        &lt;outputFile&gt;${project.basedir}/target/hvm.abi&lt;/outputFile&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
</pre></div>
</div>
</div></blockquote>
<p>其中</p>
<ul class="simple">
<li><p>&lt;jarFile&gt; 中是hvm合约的jar包</p></li>
<li><p>&lt;invokeBeanPath&gt; 是hvm合约的class字节码文件夹</p></li>
<li><p>&lt;invokeBeanPackages&gt;中包含很多&lt;param&gt;标签，每个&lt;param&gt;标签中都是一个实现*BaseInvoke*接口的类的全路径。</p></li>
<li><p>&lt;outputFile&gt;中存放的是生成的.abi的存放目录</p></li>
</ul>
<p>在合约编译完成后，执行下面的命令，即可生成HVM合约的ABI</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mvn</span> <span class="n">hvm</span><span class="p">:</span><span class="n">abi</span>
</pre></div>
</div>
</div></blockquote>
<p>在生成的hvm.abi中</p>
<ul class="simple">
<li><p>version代表hvm.abi的版本</p></li>
<li><p>beanName代表实现*BaseInvoke*接口的类的名称</p></li>
<li><p>inputs代表invoke方法的参数  其中</p></li>
<li><p>name 代表变量名称</p></li>
<li><p>type代表变量类型</p></li>
<li><p>如果是结构体则structname代表结构体类的名称</p></li>
<li><p>output代表invoke方法的返回值</p></li>
<li><p>structs里面包含HVM合约中的结构体</p></li>
</ul>
<p>示例hvm.abi如下</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="s2">&quot;version&quot;</span><span class="p">:</span><span class="s2">&quot;v1&quot;</span><span class="p">,</span><span class="s2">&quot;beanName&quot;</span><span class="p">:</span><span class="s2">&quot;invoke.InvokeSetHash&quot;</span><span class="p">,</span><span class="s2">&quot;inputs&quot;</span><span class="p">:[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;key&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;String&quot;</span><span class="p">,</span><span class="s2">&quot;structName&quot;</span><span class="p">:</span><span class="s2">&quot;java.lang.String&quot;</span><span class="p">},{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;value&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;String&quot;</span><span class="p">,</span><span class="s2">&quot;structName&quot;</span><span class="p">:</span><span class="s2">&quot;java.lang.String&quot;</span><span class="p">}],</span><span class="s2">&quot;output&quot;</span><span class="p">:{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;java.lang.String&quot;</span><span class="p">,</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;String&quot;</span><span class="p">,</span><span class="s2">&quot;structName&quot;</span><span class="p">:</span><span class="s2">&quot;java.lang.String&quot;</span><span class="p">},</span><span class="s2">&quot;classBytes&quot;</span><span class="p">:</span><span class="s2">&quot;cafebabe0000003400280a0008001e090007001f09000700200b000500210700220a000700230700240700250700260100036b65790100124c6a6176612f6c616e672f537472696e673b01000576616c75650100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100124c6f63616c5661726961626c655461626c65010004746869730100164c696e766f6b652f496e766f6b65536574486173683b010027284c6a6176612f6c616e672f537472696e673b4c6a6176612f6c616e672f537472696e673b2956010006696e766f6b65010024284c6c6f6769632f49536574486173683b294c6a6176612f6c616e672f537472696e673b01000869536574486173680100104c6c6f6769632f49536574486173683b010042284c636e2f6879706572636861696e2f636f6e74726163742f42617365436f6e7472616374496e746572666163653b294c6a6176612f6c616e672f4f626a6563743b0100095369676e61747572650100594c6a6176612f6c616e672f4f626a6563743b4c636e2f6879706572636861696e2f636f6e74726163742f42617365496e766f6b653c4c6a6176612f6c616e672f537472696e673b4c6c6f6769632f49536574486173683b3e3b01000a536f7572636546696c65010012496e766f6b65536574486173682e6a6176610c000d000e0c000a000b0c000c000b0c0027001401000e6c6f6769632f49536574486173680c00150016010014696e766f6b652f496e766f6b65536574486173680100106a6176612f6c616e672f4f626a656374010021636e2f6879706572636861696e2f636f6e74726163742f42617365496e766f6b65010007736574486173680021000700080001000900020002000a000b00000002000c000b000000040001000d000e0001000f0000003300010001000000052ab70001b10000000200100000000a00020000000f0004001000110000000c0001000000050012001300000001000d00140001000f00000059000200030000000f2ab700012a2bb500022a2cb50003b1000000020010000000120004000000120004001300090014000e001500110000002000030000000f0012001300000000000f000a000b00010000000f000c000b00020001001500160001000f0000004800030002000000102b2ab400022ab40003b90004030001b00000000200100000000a000200000019000e001a001100000016000200000010001200130000000000100017001800011041001500190001000f0000003300020002000000092a2bc00005b60006b00000000200100000000600010000000b00110000000c0001000000090012001300000002001a00000002001b001c00000002001d&quot;</span><span class="p">,</span><span class="s2">&quot;structs&quot;</span><span class="p">:[]}]</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id68">
<h4>8.2.4 调用上述合约的 gosdk代码如下所示<a class="headerlink" href="#id68" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

  <span class="o">//</span><span class="n">创建账户</span>
  <span class="n">accountJson</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountSm2</span><span class="p">(</span><span class="s2">&quot;123&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;accountJson:&quot;</span><span class="p">,</span> <span class="n">accountJson</span><span class="p">)</span>
  <span class="n">key</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">GenKeyFromAccountJson</span><span class="p">(</span><span class="n">accountJson</span><span class="p">,</span> <span class="s2">&quot;123&quot;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="n">newAddress</span> <span class="o">:=</span> <span class="n">key</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">account</span><span class="o">.</span><span class="n">SM2Key</span><span class="p">)</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span>
  <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;account address:&quot;</span><span class="p">,</span> <span class="n">newAddress</span><span class="p">)</span>
  <span class="n">rpcAPI</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">NewRPCWithPath</span><span class="p">(</span><span class="s2">&quot;./conf&quot;</span><span class="p">)</span>
  <span class="n">jarPath</span> <span class="o">:=</span> <span class="s2">&quot;./conf/contract/sethash-1.0-sethash.jar&quot;</span>
  <span class="n">payload</span><span class="p">,</span> <span class="n">sysErr</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">DecompressFromJar</span><span class="p">(</span><span class="n">jarPath</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">sysErr</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">sysErr</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="n">transaction</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">NewTransaction</span><span class="p">(</span><span class="n">newAddress</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">Deploy</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">Bytes2Hex</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">rpc</span><span class="o">.</span><span class="n">HVM</span><span class="p">)</span>
  <span class="n">receipt</span><span class="p">,</span> <span class="n">sysErr</span> <span class="o">:=</span> <span class="n">rpcAPI</span><span class="o">.</span><span class="n">SignAndDeployContract</span><span class="p">(</span><span class="n">transaction</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">sysErr</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">sysErr</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;contract address:&quot;</span><span class="p">,</span> <span class="n">receipt</span><span class="o">.</span><span class="n">ContractAddress</span><span class="p">)</span>
  <span class="o">//</span><span class="n">read</span> <span class="n">abi</span>
  <span class="n">abiPath</span> <span class="o">:=</span> <span class="s2">&quot;./conf/contract/hvm.abi&quot;</span>
  <span class="n">abiJson</span><span class="p">,</span> <span class="n">sysErr</span> <span class="o">:=</span> <span class="n">common</span><span class="o">.</span><span class="n">ReadFileAsString</span><span class="p">(</span><span class="n">abiPath</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">sysErr</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">sysErr</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="n">abi</span><span class="p">,</span> <span class="n">sysErr</span> <span class="o">:=</span> <span class="n">hvm</span><span class="o">.</span><span class="n">GenAbi</span><span class="p">(</span><span class="n">abiJson</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">sysErr</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">sysErr</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="n">invokeBean</span> <span class="o">:=</span> <span class="s2">&quot;invoke.InvokeSetHash&quot;</span>
  <span class="n">beanAbi</span><span class="p">,</span> <span class="n">sysErr</span> <span class="o">:=</span> <span class="n">abi</span><span class="o">.</span><span class="n">GetBeanAbi</span><span class="p">(</span><span class="n">invokeBean</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">sysErr</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">sysErr</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="n">invokePayload</span><span class="p">,</span> <span class="n">sysErr</span> <span class="o">:=</span> <span class="n">hvm</span><span class="o">.</span><span class="n">GenPayload</span><span class="p">(</span><span class="n">beanAbi</span><span class="p">,</span> <span class="s2">&quot;key1&quot;</span><span class="p">,</span> <span class="s2">&quot;value1&quot;</span><span class="p">)</span>
  <span class="n">invokeTx</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">NewTransaction</span><span class="p">(</span><span class="n">newAddress</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">receipt</span><span class="o">.</span><span class="n">ContractAddress</span><span class="p">,</span> <span class="n">invokePayload</span><span class="p">)</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">rpc</span><span class="o">.</span><span class="n">HVM</span><span class="p">)</span>
  <span class="n">invokeRe</span><span class="p">,</span> <span class="n">sysErr</span> <span class="o">:=</span> <span class="n">rpcAPI</span><span class="o">.</span><span class="n">SignAndInvokeContract</span><span class="p">(</span><span class="n">invokeTx</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">sysErr</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">sysErr</span><span class="p">)</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;java log 解码前: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">invokeRe</span><span class="o">.</span><span class="n">TxHash</span><span class="p">)</span>
  <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;java log 解码后：</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">java</span><span class="o">.</span><span class="n">DecodeJavaResult</span><span class="p">(</span><span class="n">invokeRe</span><span class="o">.</span><span class="n">Ret</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="id69">
<h3>8.3 KVSQL<a class="headerlink" href="#id69" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hrpc</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">NewRPCWithPath</span><span class="p">(</span><span class="s2">&quot;../conf&quot;</span><span class="p">)</span>
<span class="n">js</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountSm2</span><span class="p">(</span><span class="s2">&quot;12345678&quot;</span><span class="p">)</span>
<span class="n">gmAcc</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">GenKeyFromAccountJson</span><span class="p">(</span><span class="n">js</span><span class="p">,</span> <span class="s2">&quot;12345678&quot;</span><span class="p">)</span>
<span class="n">newAddress</span> <span class="o">:=</span> <span class="n">gmAcc</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">account</span><span class="o">.</span><span class="n">SM2Key</span><span class="p">)</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span>
<span class="n">transaction</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">newAddress</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span>
  <span class="n">VMType</span><span class="p">(</span><span class="n">KVSQL</span><span class="p">)</span><span class="o">.</span>
  <span class="n">Deploy</span><span class="p">(</span><span class="n">hexutil</span><span class="o">.</span><span class="n">Encode</span><span class="p">([]</span><span class="n">byte</span><span class="p">(</span><span class="s2">&quot;KVSQL&quot;</span><span class="p">)))</span>
<span class="o">//</span> <span class="n">建库</span>
<span class="n">txReceipt</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">hrpc</span><span class="o">.</span><span class="n">SignAndDeployContract</span><span class="p">(</span><span class="n">transaction</span><span class="p">,</span> <span class="n">gmAcc</span><span class="p">)</span>

<span class="o">//</span> <span class="n">建表</span>
<span class="nb">str</span> <span class="o">:=</span> <span class="s2">&quot;CREATE TABLE IF NOT EXISTS testTable (id bigint(20) NOT NULL, name varchar(32) NOT NULL, exp bigint(20), money double(16,2) NOT NULL DEFAULT &#39;99&#39;, primary key (id), unique key name (name));&quot;</span>
<span class="n">tranInvoke</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">newAddress</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">InvokeSql</span><span class="p">(</span><span class="n">txReceipt</span><span class="o">.</span><span class="n">ContractAddress</span><span class="p">,</span> <span class="p">[]</span><span class="n">byte</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
<span class="n">tranInvoke</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">KVSQL</span><span class="p">)</span>
<span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">hrpc</span><span class="o">.</span><span class="n">SignAndInvokeContract</span><span class="p">(</span><span class="n">tranInvoke</span><span class="p">,</span> <span class="n">gmAcc</span><span class="p">)</span>

<span class="o">//</span> <span class="n">插入</span>
<span class="ow">in</span> <span class="o">:=</span> <span class="s2">&quot;insert into testTable (id, name, exp, money) values (1, &#39;test&#39;, 1, 1.1);&quot;</span>
<span class="n">tranInvoke2</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">newAddress</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">InvokeSql</span><span class="p">(</span><span class="n">txReceipt</span><span class="o">.</span><span class="n">ContractAddress</span><span class="p">,</span> <span class="p">[]</span><span class="n">byte</span><span class="p">(</span><span class="ow">in</span><span class="p">))</span>
<span class="n">tranInvoke2</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">KVSQL</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">hrpc</span><span class="o">.</span><span class="n">SignAndInvokeContract</span><span class="p">(</span><span class="n">tranInvoke2</span><span class="p">,</span> <span class="n">gmAcc</span><span class="p">)</span>


<span class="o">//</span> <span class="n">获取</span>
<span class="n">sl</span> <span class="o">:=</span> <span class="s2">&quot;select * from testTable where id = 1;&quot;</span>
<span class="n">tranInvoke3</span> <span class="o">:=</span> <span class="n">NewTransaction</span><span class="p">(</span><span class="n">newAddress</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">InvokeSql</span><span class="p">(</span><span class="n">txReceipt</span><span class="o">.</span><span class="n">ContractAddress</span><span class="p">,</span> <span class="p">[]</span><span class="n">byte</span><span class="p">(</span><span class="n">sl</span><span class="p">))</span>
<span class="n">tranInvoke3</span><span class="o">.</span><span class="n">VMType</span><span class="p">(</span><span class="n">KVSQL</span><span class="p">)</span>
<span class="n">res</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">hrpc</span><span class="o">.</span><span class="n">SignAndInvokeContract</span><span class="p">(</span><span class="n">tranInvoke3</span><span class="p">,</span> <span class="n">gmAcc</span><span class="p">)</span>
<span class="n">b</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">hexutil</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">Ret</span><span class="p">)</span>
<span class="n">rs</span> <span class="o">:=</span> <span class="n">kvsql</span><span class="o">.</span><span class="n">DecodeRecordSet</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id70">
<h3>8.4 BVM<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>rpc := NewRPC()
const genesisAccountJson = `{&quot;address&quot;:&quot;0x000f1a7a08ccc48e5d30f80850cf1cf283aa3abd&quot;,&quot;version&quot;:&quot;4.0&quot;, &quot;algo&quot;:&quot;0x03&quot;,&quot;publicKey&quot;:&quot;0400ddbadb932a0d276e257c6df50599a425804a3743f40942d031f806bf14ab0c57aed6977b1ad14646672f9b9ce385f2c98c4581267b611f48f4b7937de386ac&quot;,&quot;privateKey&quot;:&quot;16acbf6b4f09a476a35ebd4c01e337238b5dceceb6ff55ff0c4bd83c4f91e11b&quot;}`
key, _ := account.GenKeyFromAccountJson(genesisAccountJson, &quot;&quot;)
opt := bvm.NewDIDSetChainIDOperation(&quot;chainID_01&quot;)
payload := bvm.EncodeOperation(opt)
tx := NewTransaction(key.(account.Key).GetAddress().Hex()).Invoke(opt.Address(), payload).VMType(BVM)
_, err := rpc.SignAndInvokeContract(tx, key)
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="transfer">
<h3>8.5 TRANSFER<a class="headerlink" href="#transfer" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hrp</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">NewRPC</span><span class="p">()</span>
<span class="n">accountJSON</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">NewAccountSm2</span><span class="p">(</span><span class="s2">&quot;12345678&quot;</span><span class="p">)</span>
<span class="n">aKey</span><span class="p">,</span> <span class="n">syserr</span> <span class="o">:=</span> <span class="n">account</span><span class="o">.</span><span class="n">GenKeyFromAccountJson</span><span class="p">(</span><span class="n">accountJSON</span><span class="p">,</span> <span class="s2">&quot;12345678&quot;</span><span class="p">)</span>
<span class="n">newAddress2</span> <span class="o">:=</span> <span class="n">aKey</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">account</span><span class="o">.</span><span class="n">SM2Key</span><span class="p">)</span><span class="o">.</span><span class="n">GetAddress</span><span class="p">()</span>
<span class="n">transaction1</span> <span class="o">:=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">NewTransaction</span><span class="p">(</span><span class="n">newAddress2</span><span class="o">.</span><span class="n">Hex</span><span class="p">())</span><span class="o">.</span><span class="n">Transfer</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<span class="n">transaction1</span><span class="o">.</span><span class="n">Sign</span><span class="p">(</span><span class="n">aKey</span><span class="p">)</span>
<span class="n">receipt1</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">hrp</span><span class="o">.</span><span class="n">SignAndSendTx</span><span class="p">(</span><span class="n">transaction1</span><span class="p">,</span> <span class="n">aKey</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id71">
<h3>8.6 FVM<a class="headerlink" href="#id71" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>func Demo() {
  const currentABI = `{
  &quot;contract&quot;: {
    &quot;name&quot;: &quot;SetHash&quot;,
    &quot;constructor&quot;: {
      &quot;input&quot;: []
    }
  },
  &quot;methods&quot;: [
    {
      &quot;name&quot;: &quot;set_hash&quot;,
      &quot;input&quot;: [
        {
          &quot;type_id&quot;: 0
        },
        {
          &quot;type_id&quot;: 0
        }
      ],
      &quot;output&quot;: []
    },
    {
      &quot;name&quot;: &quot;get_hash&quot;,
      &quot;input&quot;: [
        {
          &quot;type_id&quot;: 0
        }
      ],
      &quot;output&quot;: [
        {
          &quot;type_id&quot;: 1
        }
      ]
    }
  ],
  &quot;types&quot;: [
    {
      &quot;id&quot;: 0,
      &quot;type&quot;: &quot;primitive&quot;,
      &quot;primitive&quot;: &quot;str&quot;
    },
    {
      &quot;id&quot;: 1,
      &quot;type&quot;: &quot;primitive&quot;,
      &quot;primitive&quot;: &quot;str&quot;
    }
  ]
}`
  rp := rpc.NewRPCWithPath(&quot;../../conf&quot;)
  wasmPath1 := &quot;./wasm/SetHash-gc.wasm&quot;
  buf, err := ioutil.ReadFile(wasmPath1)
  if err != nil {
    return
  }
  guomiPri := &quot;6153af264daa4763490f2a51c9d13417ef9f579229be2141574eb339ee9b9d2a&quot;
  pri := new(gm.SM2PrivateKey)
  pri.FromBytes(common.FromHex(guomiPri), 0)
  guomiKey := &amp;account.SM2Key{
    &amp;gm.SM2PrivateKey{
      K:         pri.K,
      PublicKey: pri.CalculatePublicKey().PublicKey,
    },
  }

  transaction := rpc.NewTransaction(guomiKey.GetAddress().Hex()).Deploy(common.Bytes2Hex(buf)).VMType(rpc.FVM)
  transaction.Sign(guomiKey)
  rep, err := rp.SignAndDeployContract(transaction, guomiKey)
  if err != nil {
    return
  }
  a, err := fvm.GenAbi(strings.NewReader(currentABI))
  if err != nil {
    return
  }
  invokeInput, err := fvm.Encode(a, &quot;set_hash&quot;, &quot;key&quot;, &quot;value&quot;)
  if err != nil {
    return
  }
  invokeTrans := rpc.NewTransaction(guomiKey.GetAddress().Hex()).Invoke(rep.ContractAddress, invokeInput).VMType(rpc.FVM)
  invokeTrans.Sign(guomiKey)
  _, err = rp.SignAndInvokeContract(invokeTrans, guomiKey)
  if err != nil {
    return
  }

  invokeInput2, err := fvm.Encode(a, &quot;get_hash&quot;, &quot;key&quot;)
  if err != nil {
    return
  }
  invokeTrans2 := rpc.NewTransaction(guomiKey.GetAddress().Hex()).Invoke(rep.ContractAddress, invokeInput2).VMType(rpc.FVM)
  invokeTrans2.Sign(guomiKey)
  recipt2, err := rp.SignAndInvokeContract(invokeTrans2, guomiKey)
  if err != nil {
    return
  }

  res, err := fvm.DecodeRet(a, &quot;get_hash&quot;, common.Hex2Bytes(recipt2.Ret))
  if err != nil {
    return
  }
  fmt.Println(res)
}
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016-2023, Hangzhou Hyperchain Technology Co., Ltd..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>