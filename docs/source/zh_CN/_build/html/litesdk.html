

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Litesdk &mdash; hyperchain  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> hyperchain
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">平台介绍:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">平台介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="Version%20information.html">版本信息</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">快速入门:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="General%20Concepts.html">通用概念</a></li>
<li class="toctree-l1"><a class="reference internal" href="Prepare.html">准备工作</a></li>
<li class="toctree-l1"><a class="reference internal" href="Deployedfile.html">部署运维</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">基础协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="consensus%20mechanism.html">共识机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="Networking%20protocol.html">网络协议</a></li>
<li class="toctree-l1"><a class="reference internal" href="execution%20engine.html">执行引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="Storage%20model.html">存储模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="security%20mechanism.html">加密机制</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">扩展协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Architecture%20development.html">架构拓展</a></li>
<li class="toctree-l1"><a class="reference internal" href="Digital%20Service.html">数字服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="Safe%20Privacy.html">隐私保护</a></li>
<li class="toctree-l1"><a class="reference internal" href="Governonce%20and%20audit.html">治理与审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data%20management.html">数据管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Operation%20manage.html">运维管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ecological%20components.html">区块链生态组件</a></li>
<li class="toctree-l1"><a class="reference internal" href="External%20Interface.html">外部接口</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">用户手册:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Chain%20Authority%20Management.html">链级权限管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Node%20and%20zone%20management.html">节点及分区管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Consensus%20related%20user%20manual.html">共识相关使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cross%20domain%20network%20User%20Manual.html">跨域网络使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data%20storage%20and%20management.html">数据存储使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="Password%20related.html">密码学相关</a></li>
<li class="toctree-l1"><a class="reference internal" href="Security%20Audit.html">安全审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="Data%20Monitor.html">数据监控</a></li>
<li class="toctree-l1"><a class="reference internal" href="qulian%20blockchain%20browser.html">趣链区块链浏览器</a></li>
<li class="toctree-l1"><a class="reference internal" href="VM%20Related%20User%20Manual.html">（用户）智能合约使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="Module.html">（用户）组件库</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">应用场景:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="application.html">应用案例</a></li>
<li class="toctree-l1"><a class="reference internal" href="NFT%20and%20contract%20writing.html">数字藏品合约编写</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">更多资源:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Community_Resources.html">社区与资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hyperchain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Litesdk</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/litesdk.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="litesdk">
<span id="id1"></span><h1>Litesdk<a class="headerlink" href="#litesdk" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p><a class="reference external" href="https://upload.filoop.com/RTD-Hyperchain%2FLiteSDK.zip">完整Litesdk使用手册</a></p>
</div></blockquote>
<div class="section" id="id3">
<h2>第一章. 前言<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p><strong>LiteSDK</strong>是一个<strong>轻量JavaSDK工具</strong>，提供与Hyperchain区块链平台交互的接口以及一些处理工具。该文档⾯向Hyperchain区块链平台的应⽤开发者，提供hyperchain
Java SDK的 使⽤指南。</p>
<p>如需尝试SDK的demo，可将项目clone到本地，配置好Java环境(推荐使用1.8)和maven构建工具，可运行对应的发送交易和查询接口，例如合约调用的demo可在<a class="reference external" href="https://github.com/hyperchain/javasdk/tree/master/src/test/java/cn/hyperchain/sdk">此处</a>找到，对应的资源文件和合约demo也在resource文件夹下。</p>
<p>同时如需更好的使用SDK来操作区块链平台发送交易，建议阅读Hyperchain区块链底层平台<a class="reference external" href="http://docs.hyperchain.cn/">介绍文档</a>，如需详细文档介绍可联系运维人员。</p>
<p>同时对于EVM、HVM合约调用，也需详细阅读对应的合约介绍了解相关概念后再使用SDK进行操作。</p>
<p>EVM Solidity合约文档链接：<a class="reference external" href="https://solidity.readthedocs.io/en/latest/">https://solidity.readthedocs.io/en/latest/</a></p>
<p>HVM 合约文档链接见Hyperchain介绍文档。</p>
</div>
<div class="section" id="id4">
<h2>第二章. 初始化<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="section" id="httpprovider">
<h3>2.1 创建HttpProvider对象<a class="headerlink" href="#httpprovider" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">HttpProvider</span></code>是一个接口，负责管理与节点的连接，实现<code class="docutils literal notranslate"><span class="pre">HttpProvider</span></code>接口的类需要提供底层的通信实现，目前<strong>LiteSDK</strong>已有默认的实现类<code class="docutils literal notranslate"><span class="pre">DefaultHttpProvider</span></code>，创建<code class="docutils literal notranslate"><span class="pre">DefaultHttpProvider</span></code>需要通过<strong>Builder</strong>模式创建，示例如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">node1</span> <span class="o">=</span> <span class="s">&quot;localhost:8081&quot;</span><span class="p">;</span>

<span class="c1">// 方式1</span>
<span class="n">HttpProvider</span> <span class="n">httpProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultHttpProvider</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
                <span class="p">.</span><span class="na">setUrl</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
                <span class="p">.</span><span class="na">https</span><span class="p">(</span><span class="n">tlsca</span><span class="p">,</span> <span class="n">tls_peer_cert</span><span class="p">,</span> <span class="n">tls_peer_priv</span><span class="p">)</span>
                <span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="c1">// 方式2，自定义超时时间</span>
<span class="n">HttpProvider</span> <span class="n">httpProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultHttpProvider</span><span class="p">.</span><span class="na">Builder</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                <span class="p">.</span><span class="na">setUrl</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
                <span class="p">.</span><span class="na">https</span><span class="p">(</span><span class="n">tlsca</span><span class="p">,</span> <span class="n">tls_peer_cert</span><span class="p">,</span> <span class="n">tls_peer_priv</span><span class="p">)</span>
                <span class="p">.</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Builder(int</span> <span class="pre">readTimeout,</span> <span class="pre">int</span> <span class="pre">writeTimeout,</span> <span class="pre">int</span> <span class="pre">connectTimeout)</span></code>自定义<strong>https协议</strong>的读取超时时间、写超时时间和连接超时时间，单位为s。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setUrl()</span></code>可以设置连接的节点<strong>URL</strong>（格式为<strong>ip+jsonRPC端口</strong>）;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">https()</span></code>设置启动<strong>https协议</strong>连接并设置使用的证书(需要传的参数类型为输入流)。</p></li>
</ul>
</div>
<div class="section" id="grpcprovider">
<h3>2.2 创建GrpcProvider对象<a class="headerlink" href="#grpcprovider" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">GrpcProvider</span></code>是接口<code class="docutils literal notranslate"><span class="pre">HttpProvider</span></code>的一个实现类，<code class="docutils literal notranslate"><span class="pre">DefaultHttpProvider</span></code>通过jsonrpc与节点进行通信，而<code class="docutils literal notranslate"><span class="pre">GrpcProvider</span></code>通过grpc双向流与节点进行通信，创建<code class="docutils literal notranslate"><span class="pre">GrpcProvider</span></code>需要通过Builder模式创建，示例如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">node1</span> <span class="o">=</span> <span class="s">&quot;localhost:11001&quot;</span><span class="p">;</span>

<span class="c1">// 方式一</span>
<span class="n">GrpcProvider</span> <span class="n">grpcProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GrpcProvider</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
                                                     <span class="p">.</span><span class="na">setUrl</span><span class="p">(</span><span class="s">&quot;localhost:11001&quot;</span><span class="p">)</span>
                                                     <span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="c1">// 方式二</span>
<span class="n">GrpcProvider</span> <span class="n">grpcProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GrpcProvider</span><span class="p">.</span><span class="na">Builder</span><span class="p">(</span><span class="mi">3000</span><span class="p">)</span>
                                                     <span class="p">.</span><span class="na">setUrl</span><span class="p">(</span><span class="s">&quot;localhost:11001&quot;</span><span class="p">)</span>
                                                     <span class="p">.</span><span class="na">setStreamNum</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                                                     <span class="p">.</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Builder(long</span> <span class="pre">time)</span></code>自定义grpc向节点请求的超时时间，单位为ms。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setUrl</span></code>可以设置连接的节点<strong>URL</strong>（格式为<strong>ip+grpc</strong>端口）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">setStreamNum</span></code>设置本连接与节点之间同一种类型的grpc双向流的最大数量，默认值为1，通常来说其值可设置为使用该<code class="docutils literal notranslate"><span class="pre">GrpcProvider</span></code>的线程数量。</p></li>
</ul>
</div>
<div class="section" id="providermanager">
<h3>2.3 创建ProviderManager对象<a class="headerlink" href="#providermanager" title="Permalink to this headline">¶</a></h3>
<p>每个节点的连接都需要一个<code class="docutils literal notranslate"><span class="pre">HttpProvider</span></code>，而<code class="docutils literal notranslate"><span class="pre">ProviderManager</span></code>负责集成、管理这些<code class="docutils literal notranslate"><span class="pre">HttpProvider</span></code>，创建<code class="docutils literal notranslate"><span class="pre">ProviderManager</span></code>有两种方式，一种是通过<code class="docutils literal notranslate"><span class="pre">createManager()</span></code>创建，另一种是和<code class="docutils literal notranslate"><span class="pre">HttpProvider</span></code>一样通过<strong>Builder</strong>模式创建。使用前者创建会使用<code class="docutils literal notranslate"><span class="pre">ProvideManager</span></code>的默认配置参数，而如果想定制更多的属性则需要通过后者的方式创建，示例如下：</p>
<p>另外，每个节点都有一个对应的TxVersion，可通过<code class="docutils literal notranslate"><span class="pre">getTxVersion(nodeId)</span></code>接口获取对应节点的TxVersion，发送到节点的transaction的TxVersion必须与节点一致才能通过验签。<code class="docutils literal notranslate"><span class="pre">providerManager</span></code>对象在创建时会通过<code class="docutils literal notranslate"><span class="pre">TxVersion.setGlobalTxVersion</span></code>设置全局的TxVersion。<code class="docutils literal notranslate"><span class="pre">Transaction</span></code>对象也可通过<code class="docutils literal notranslate"><span class="pre">setTxVersion</span></code>函数设置单次交易的TxVersion。</p>
<p>为全局设置txVersion(不推荐修改)：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">static</span> <span class="p">{</span>
    <span class="n">TxVersion</span><span class="p">.</span><span class="na">setGlobalTxVersion</span><span class="p">(</span><span class="n">TxVersion</span><span class="p">.</span><span class="na">TxVersion10</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>或者为单个交易设置txVersion：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">HVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">deploy</span><span class="p">(</span><span class="n">payload</span><span class="p">).</span><span class="na">txVersion</span><span class="p">(</span><span class="n">TxVersion</span><span class="p">.</span><span class="na">TxVersion10</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>一般而言，使用新版本LiteSDK访问hyperchain默认txVersion为1.0，对于hyperchain2.0来说，sdk将自动识别平台txVersion，<strong>不需要手动进行设置</strong>。</p>
<p>节点平台与TxVersion对应关系如下：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 55%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>平台使用版本</p></th>
<th class="head"><p>TxVersion版本</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>hyperchain 1.x</p></td>
<td><p>1.0</p></td>
</tr>
<tr class="row-odd"><td><p>hyperchain 2.0.0</p></td>
<td><p>2.3</p></td>
</tr>
</tbody>
</table>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// 方式1</span>
<span class="n">ProviderManager</span> <span class="n">providerManager</span> <span class="o">=</span> <span class="n">ProviderManager</span><span class="p">.</span><span class="na">createManager</span><span class="p">(</span><span class="n">HttpProvider</span><span class="p">);</span>

<span class="c1">// 方式2</span>
<span class="n">providerManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProviderManager</span><span class="p">.</span><span class="na">Builder</span><span class="p">()</span>
                <span class="p">.</span><span class="na">namespace</span><span class="p">(</span><span class="s">&quot;global&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="na">providers</span><span class="p">(</span><span class="n">httpProvider1</span><span class="p">,</span> <span class="n">httpProvider2</span><span class="p">,</span> <span class="n">httpProvider3</span><span class="p">,</span> <span class="n">httpProvider4</span><span class="p">)</span>
                                                     <span class="p">.</span><span class="na">grpcProviders</span><span class="p">(</span><span class="n">grpcProvider1</span><span class="p">,</span> <span class="n">grpcProvider2</span><span class="p">,</span> <span class="n">grpcProvider3</span><span class="p">,</span> <span class="n">grpcProvider4</span><span class="p">)</span>
                <span class="p">.</span><span class="na">enableTCert</span><span class="p">(</span><span class="n">sdkcert_cert</span><span class="p">,</span> <span class="n">sdkcert_priv</span><span class="p">,</span> <span class="n">unique_pub</span><span class="p">,</span> <span class="n">unique_priv</span><span class="p">)</span>
                <span class="p">.</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>方式1：</p>
<p>只需要传<code class="docutils literal notranslate"><span class="pre">HttpProvider</span></code>对象，其他都使用<code class="docutils literal notranslate"><span class="pre">ProvideManager</span></code>的默认配置，如不启用证书、使用的<strong>namespace</strong>配置项为<strong>global</strong>。</p>
<p>方式2： * <code class="docutils literal notranslate"><span class="pre">namespace()</span></code>可以设置对应的<strong>namespace名</strong>; *
<code class="docutils literal notranslate"><span class="pre">providers()</span></code>设置需要管理的<code class="docutils literal notranslate"><span class="pre">HttpProvider</span></code>对象们; *
<code class="docutils literal notranslate"><span class="pre">grpcProviders</span></code>设置需要管理的<code class="docutils literal notranslate"><span class="pre">GrpcProvider</span></code>对象； *
<code class="docutils literal notranslate"><span class="pre">enableTCert()</span></code>设置使用的证书(<strong>需要传的参数类型为输入流)</strong>。注：例子中未出现的方法还有一个<code class="docutils literal notranslate"><span class="pre">cfca(InputStream</span> <span class="pre">sdkCert,</span> <span class="pre">InputStream</span> <span class="pre">sdkCertPriv)</span></code>，功能与<code class="docutils literal notranslate"><span class="pre">enableTCert()</span></code>相同，两者的区别是证书校验是否通过<strong>cfca机构</strong>，且在创建<code class="docutils literal notranslate"><span class="pre">ProvideManager</span></code>对象过程中两个方法只能使用其中一个。</p>
<p>注：enableTcert里面的sdkcert_cert，sdkcert_priv，unique_pub，unique_priv，分别对应证书目录下的sdkcert_cert，key_priv，unique_pub，unique_priv文件。</p>
</div>
<div class="section" id="id5">
<h3>2.4 创建服务<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>相关的一类服务集合由一个专门的<code class="docutils literal notranslate"><span class="pre">Service</span></code>接口管理，并通过对应的实现类实现具体的创建过程（如封装发送请求需要附带的参数）。<strong>LiteSDK</strong>通过<code class="docutils literal notranslate"><span class="pre">ServiceManager</span></code>类负责管理创建所有的<code class="docutils literal notranslate"><span class="pre">Service</span></code>对象，以下是一个创建获取节点信息的服务的例子：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// 将ProviderManager对象作为参数，通过getNodeService()创建NodeService类型的对象</span>
<span class="c1">// NodeService为声明的接口， 实际类型为NodeServiceImpl</span>
<span class="n">NodeService</span> <span class="n">nodeService</span> <span class="o">=</span> <span class="n">ServiceManager</span><span class="p">.</span><span class="na">getNodeService</span><span class="p">(</span><span class="n">providerManager</span><span class="p">);</span>

<span class="c1">// 通过调用NodeService提供的方法创建相应的服务，类型为Request&lt;NodeResponse&gt;</span>
<span class="n">NodeRequest</span> <span class="n">nodeRequest</span> <span class="o">=</span> <span class="n">nodeService</span><span class="p">.</span><span class="na">getNodes</span><span class="p">();</span>
</pre></div>
</div>
<p>实际上每个服务创建对应创建一个请求，这个请求都继承了共同的父类——<code class="docutils literal notranslate"><span class="pre">Request</span></code>，<strong>LiteSDK</strong>将根据不同的<code class="docutils literal notranslate"><span class="pre">Service</span></code>接口，返回不同<code class="docutils literal notranslate"><span class="pre">Request</span></code>子类，同时将用户调用接口的参数<code class="docutils literal notranslate"><span class="pre">params</span></code>封装到<code class="docutils literal notranslate"><span class="pre">Request</span></code>请求中，而在创建<code class="docutils literal notranslate"><span class="pre">Request</span></code>的过程中会附带一个具体的响应类型的声明，该响应类型也将根据不同的<code class="docutils literal notranslate"><span class="pre">Service</span></code>接口与<code class="docutils literal notranslate"><span class="pre">Request</span></code>绑定。</p>
<p><code class="docutils literal notranslate"><span class="pre">Request</span></code>拥有<code class="docutils literal notranslate"><span class="pre">send()</span></code>和<code class="docutils literal notranslate"><span class="pre">sendAsync()</span></code>同步发送和异步发送两个方法：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">send()</span></code>:
同步发送返回<code class="docutils literal notranslate"><span class="pre">Request</span></code>根据不同接口绑定的<code class="docutils literal notranslate"><span class="pre">Response</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sendAsync()</span></code>:
异步发送返回<code class="docutils literal notranslate"><span class="pre">Request</span></code>根据不同接口绑定了<code class="docutils literal notranslate"><span class="pre">Response</span></code>的<code class="docutils literal notranslate"><span class="pre">Future</span></code>接口</p></li>
</ul>
</div>
<div class="section" id="id6">
<h3>2.5 获取结果<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>同样地，响应也都继承了共同的父类——<code class="docutils literal notranslate"><span class="pre">Response</span></code>，通过调用<code class="docutils literal notranslate"><span class="pre">Request</span></code>的<code class="docutils literal notranslate"><span class="pre">send()</span></code>方法得到，<strong>LitesSDK</strong>会将不同的返回结果<code class="docutils literal notranslate"><span class="pre">result</span></code>根据接口封装成不同的<code class="docutils literal notranslate"><span class="pre">Response</span></code>子类，如
<strong>2.3</strong>
所说<code class="docutils literal notranslate"><span class="pre">Response</span></code>类型在生成<code class="docutils literal notranslate"><span class="pre">Request</span></code>时绑定。<code class="docutils literal notranslate"><span class="pre">Response</span></code>可以获取状态码、状态消息等，而不同的<code class="docutils literal notranslate"><span class="pre">Response</span></code>可以获取到不同的结果，有时也需要进一步获取到更具体的信息。示例如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">NodeResponse</span> <span class="n">nodeResponse</span> <span class="o">=</span> <span class="n">nodeRequest</span><span class="p">.</span><span class="na">send</span><span class="p">();</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">nodeResponse</span><span class="p">.</span><span class="na">getResult</span><span class="p">());</span>
</pre></div>
</div>
<p>当<code class="docutils literal notranslate"><span class="pre">ProvideManager</span></code>管理多个节点连接时，返回的节点信息应该是一个数组，这时就需要调用示例中的<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法将返回结果转换成更准确的类型。</p>
</div>
</div>
<div class="section" id="id7">
<h2>第三章. 交易<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p><strong>LiteSDK</strong>的交易接口需要用到交易体，交易体的应用场景分为两类：一类<strong>是普通的转账交易，不涉及虚拟机</strong>，一类是<strong>合约交易，和虚拟机相关</strong>。两者虽然都名为交易，但实际执行的功能和应用场景都不同，且转账交易的实现由<code class="docutils literal notranslate"><span class="pre">TxService</span></code>提供，合约交易的实现由<code class="docutils literal notranslate"><span class="pre">ContractService</span></code>提供。</p>
<div class="section" id="id8">
<h3>合约接口<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>以交易体结构为核心的交易主要应用在合约交易上，即将想要执行的操作和数据封装成一笔交易体，再调用合约服务(<code class="docutils literal notranslate"><span class="pre">ContractService</span></code>)的接口去执行。</p>
<p>绑定合约接口的<code class="docutils literal notranslate"><span class="pre">Response</span></code>子类只有<code class="docutils literal notranslate"><span class="pre">TxHashResponse</span></code>和<code class="docutils literal notranslate"><span class="pre">ReceiptResponse</span></code>，前者封装了<code class="docutils literal notranslate"><span class="pre">ReceiptResponse</span></code>类型的参数，实际是<strong>tx
hash</strong>，拿到<code class="docutils literal notranslate"><span class="pre">TxHashResponse</span></code>后调用<strong>polling</strong>方法可通过<strong>tx
hash</strong>去查找获取真正的交易回执；后者<code class="docutils literal notranslate"><span class="pre">ReceiptResponse</span></code>即为交易回执，无需再调用<strong>polling</strong>查询。</p>
<p><code class="docutils literal notranslate"><span class="pre">TxHashResponse</span></code>的主要方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * 通过交易hash获取交易回执.</span>
<span class="cm"> *</span>
<span class="cm"> * @return 返回 ReceiptResponse</span>
<span class="cm"> * @throws RequestException -</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="n">ReceiptResponse</span> <span class="nf">polling</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">RequestException</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * 获取交易hash.</span>
<span class="cm"> *</span>
<span class="cm"> * @return 交易hash</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">getTxHash</span><span class="p">();</span>
</pre></div>
</div>
<p>LiteSDK的合约接口较特殊，交易相关的接口目前提供了<strong>部署合约、调用合约、管理合约、通过投票管理合约</strong>四种接口。其中以grpc开头的接口表示该接口只有在创建<code class="docutils literal notranslate"><span class="pre">ProviderManager</span></code>对象时，设置了<code class="docutils literal notranslate"><span class="pre">GrpcProvider</span></code>与节点通信才可使用，且绑定了<code class="docutils literal notranslate"><span class="pre">ReceiptResponse</span></code>。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ContractService</span> <span class="p">{</span>
    <span class="c1">// 部署合约</span>
    <span class="n">Request</span><span class="o">&lt;</span><span class="n">TxHashResponse</span><span class="o">&gt;</span> <span class="nf">deploy</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

    <span class="c1">// 调用合约</span>
    <span class="n">Request</span><span class="o">&lt;</span><span class="n">TxHashResponse</span><span class="o">&gt;</span> <span class="nf">invoke</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

    <span class="c1">// 管理合约，包括升级，冻结，解冻</span>
    <span class="n">Request</span><span class="o">&lt;</span><span class="n">TxHashResponse</span><span class="o">&gt;</span> <span class="nf">maintain</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">TxHashResponse</span><span class="o">&gt;</span> <span class="nf">manageContractByVote</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

     <span class="n">Request</span><span class="o">&lt;</span><span class="n">ReceiptResponse</span><span class="o">&gt;</span> <span class="nf">grpcDeployReturnReceipt</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

     <span class="n">Request</span><span class="o">&lt;</span><span class="n">ReceiptResponse</span><span class="o">&gt;</span> <span class="nf">grpcInvokeReturnReceipt</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">ReceiptResponse</span><span class="o">&gt;</span> <span class="nf">grpcMaintainReturnReceipt</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">ReceiptResponse</span><span class="o">&gt;</span> <span class="nf">grpcManageContractByVoteReturnReceipt</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<p>根据要创建的合约服务不同，封装的<code class="docutils literal notranslate"><span class="pre">Transaction</span></code>交易体也会不同。<strong>并且LiteSDK支持HVM、EVM、BVM、FVM三种形式的合约</strong>，这几种也会影响到交易体的创建。</p>
</div>
<div class="section" id="id9">
<h3>转账交易<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>转账交易的实现主要是TxService提供，主要有三个接口。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxHashResponse</span><span class="o">&gt;</span> <span class="nf">sendTx</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">TxHashesResponse</span><span class="o">&gt;</span> <span class="nf">sendBatchTxs</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Transaction</span><span class="o">&gt;</span> <span class="n">transactions</span><span class="p">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">methods</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">ReceiptResponse</span><span class="o">&gt;</span> <span class="nf">grpcSendTxReturnReceipt</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>前两个接口分别绑定了<code class="docutils literal notranslate"><span class="pre">TxHashResponse</span></code>和<code class="docutils literal notranslate"><span class="pre">TxHashesResponse</span></code>，当拿到这两个响应时调用<code class="docutils literal notranslate"><span class="pre">polling()</span></code>方法就可以获取真正的交易回执，前者返回<code class="docutils literal notranslate"><span class="pre">ReceiptResponse</span></code>，后者返回<code class="docutils literal notranslate"><span class="pre">ArrayList&lt;ReceiptResponse&gt;</span></code>。第三个接口<code class="docutils literal notranslate"><span class="pre">grpcSendTxReturnReceipt</span></code>绑定了<code class="docutils literal notranslate"><span class="pre">ReceiptResponse</span></code>，即可以直接获得交易回执。转账交易和合约接口类似，主要的不同在于交易体的创建，转账交易通过内部类<code class="docutils literal notranslate"><span class="pre">Builder</span></code>调用<code class="docutils literal notranslate"><span class="pre">transfer()</span></code>方法创建。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Builder</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">Builder</span> <span class="nf">transfer</span><span class="p">(</span><span class="n">String</span> <span class="n">to</span><span class="p">,</span> <span class="kt">long</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// example:</span>
<span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">Builder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">transfer</span><span class="p">(</span><span class="s">&quot;794BF01AB3D37DF2D1EA1AA4E6F4A0E988F4DEA5&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p><strong>创建交易体并调用服务的具体流程如下。</strong></p>
<div class="section" id="id10">
<h4>创建账户<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>这个过程分为两步，先创建<code class="docutils literal notranslate"><span class="pre">AccountService</span></code>对象，再利用该对象创建账户，示例如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">AccountService</span> <span class="n">accountService</span> <span class="o">=</span> <span class="n">ServiceManager</span><span class="p">.</span><span class="na">getAccountService</span><span class="p">(</span><span class="n">providerManager</span><span class="p">);</span>
<span class="n">Account</span> <span class="n">account</span> <span class="o">=</span> <span class="n">accountService</span><span class="p">.</span><span class="na">genAccount</span><span class="p">(</span><span class="n">Algo</span><span class="p">.</span><span class="na">SMRAW</span><span class="p">);</span>
</pre></div>
</div>
<p>如第二章所说，创建<code class="docutils literal notranslate"><span class="pre">Service</span></code>对象需要指定<code class="docutils literal notranslate"><span class="pre">ProviderManager</span></code>对象，且使用<code class="docutils literal notranslate"><span class="pre">genAccount()</span></code>创建账户时需要指定加密算法，如示例中使用<strong>SMRAW算法</strong>（只有<strong>ECRAW</strong>、<strong>SMRAW</strong>、<strong>ED25519RAW</strong>不需要密码参数，其余的加密算法需要手动设置<strong>password</strong>）。另外，对于要使用<strong>PKI算法</strong>创建的账户，需要传入其使用的<strong>PFX证书</strong>的输入流以及该证书对应的密码。原因是PFX证书内包含生成其的私钥，解密该私钥需要对应密码。</p>
<p><code class="docutils literal notranslate"><span class="pre">AccountService</span></code>提供的接口如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AccountService</span> <span class="p">{</span>
    <span class="n">Account</span> <span class="nf">genAccount</span><span class="p">(</span><span class="n">Algo</span> <span class="n">algo</span><span class="p">);</span>

    <span class="n">Account</span> <span class="nf">genAccount</span><span class="p">(</span><span class="n">Algo</span> <span class="n">algo</span><span class="p">,</span> <span class="n">String</span> <span class="n">password</span><span class="p">);</span>

    <span class="n">Account</span> <span class="nf">genAccount</span><span class="p">(</span><span class="n">Algo</span> <span class="n">algo</span><span class="p">,</span> <span class="n">String</span> <span class="n">password</span><span class="p">,</span> <span class="n">FileInputStream</span> <span class="n">input</span><span class="p">);</span>

    <span class="n">Account</span> <span class="nf">fromAccountJson</span><span class="p">(</span><span class="n">String</span> <span class="n">accountJson</span><span class="p">);</span>

    <span class="n">Account</span> <span class="nf">fromAccountJson</span><span class="p">(</span><span class="n">String</span> <span class="n">accountJson</span><span class="p">,</span> <span class="n">String</span> <span class="n">password</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">BalanceResponse</span><span class="o">&gt;</span> <span class="nf">getBalance</span><span class="p">(</span><span class="n">String</span> <span class="n">address</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">RolesResponse</span><span class="o">&gt;</span> <span class="nf">getRoles</span><span class="p">(</span><span class="n">String</span> <span class="n">address</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">AccountsByRoleResponse</span><span class="o">&gt;</span> <span class="nf">getAccountsByRole</span><span class="p">(</span><span class="n">String</span> <span class="n">role</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">StatusResponse</span><span class="o">&gt;</span> <span class="nf">getStatus</span><span class="p">(</span><span class="n">String</span> <span class="n">address</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>前五个接口是用于生成账户。余下接口是查询账户相关信息，其说明如下：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getBalance</span></code>方法则可以查询该账户所有的余额，需要传一个<strong>合约地址</strong>为参数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getRoles</span></code>方法则可以查询该账户所有的角色，需要传一个<strong>合约地址</strong>为参数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getAccountsByRole</span></code>方法则可以查询具有改角色的账户列表，需要传一个<strong>角色名称</strong>为参数。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getStatus</span></code>
方法则可以查询普通账户的状态，需要穿一个普通<strong>账户地址</strong>为参数。</p></li>
</ul>
<p>目前Account服务支持的所有加密算法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Algo</span> <span class="p">{</span>
    <span class="n">ECDES</span><span class="p">(</span><span class="s">&quot;0x02&quot;</span><span class="p">),</span>
    <span class="n">ECRAW</span><span class="p">(</span><span class="s">&quot;0x03&quot;</span><span class="p">),</span>
    <span class="n">ECAES</span><span class="p">(</span><span class="s">&quot;0x04&quot;</span><span class="p">),</span>
    <span class="n">EC3DES</span><span class="p">(</span><span class="s">&quot;0x05&quot;</span><span class="p">),</span>

    <span class="n">SMSM4</span><span class="p">(</span><span class="s">&quot;0x11&quot;</span><span class="p">),</span>
    <span class="n">SMDES</span><span class="p">(</span><span class="s">&quot;0x12&quot;</span><span class="p">),</span>
    <span class="n">SMRAW</span><span class="p">(</span><span class="s">&quot;0x13&quot;</span><span class="p">),</span>
    <span class="n">SMAES</span><span class="p">(</span><span class="s">&quot;0x14&quot;</span><span class="p">),</span>
    <span class="n">SM3DES</span><span class="p">(</span><span class="s">&quot;0x15&quot;</span><span class="p">),</span>

    <span class="n">ED25519DES</span><span class="p">(</span><span class="s">&quot;0x21&quot;</span><span class="p">),</span>
    <span class="n">ED25519RAW</span><span class="p">(</span><span class="s">&quot;0x22&quot;</span><span class="p">),</span>
    <span class="n">ED25519AES</span><span class="p">(</span><span class="s">&quot;0x23&quot;</span><span class="p">),</span>
    <span class="n">ED255193DES</span><span class="p">(</span><span class="s">&quot;0x24&quot;</span><span class="p">),</span>

    <span class="n">PKI</span><span class="p">(</span><span class="s">&quot;0x41&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h4>交易体创建<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p><strong>LiteSDK</strong>使用<strong>Builder</strong>模式来负责对<code class="docutils literal notranslate"><span class="pre">Transaction</span></code>的创建，通过调用<code class="docutils literal notranslate"><span class="pre">build()</span></code>函数来获取到<code class="docutils literal notranslate"><span class="pre">Transaction</span></code>实例。HVM、EVM、BVM和FVM分别有各自的<strong>Builder</strong>：<code class="docutils literal notranslate"><span class="pre">HVMBuilder</span></code>、<code class="docutils literal notranslate"><span class="pre">EVMBuilder、BVMBuilder</span></code>、<code class="docutils literal notranslate"><span class="pre">FVMBuilder</span></code>，继承同一个父类<code class="docutils literal notranslate"><span class="pre">Builer</span></code>。目前<strong>Builder</strong>模式提供了五种交易体的封装，分别对应<strong>部署合约、调用合约、升级合约、冻结合约、解冻合约</strong>，其中前两个服务的交易体分别定义在HVM、EVM、BVM、FVM各自的<code class="docutils literal notranslate"><span class="pre">Builder</span></code>子类中，后三者都是<strong>管理合约</strong>这一服务的子服务，定义在父类<code class="docutils literal notranslate"><span class="pre">Builder</span></code>中。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Builder</span> <span class="p">{</span>
    <span class="n">Builder</span> <span class="nf">upgrade</span><span class="p">(</span><span class="n">String</span> <span class="n">contractAddress</span><span class="p">,</span> <span class="n">String</span> <span class="n">payload</span><span class="p">);</span>
    <span class="n">Builder</span> <span class="nf">freeze</span><span class="p">(</span><span class="n">String</span> <span class="n">contractAddress</span><span class="p">);</span>
    <span class="n">Builder</span> <span class="nf">unfreeze</span><span class="p">(</span><span class="n">String</span> <span class="n">contractAddress</span><span class="p">);</span>
    <span class="n">Transaction</span> <span class="nf">build</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">HVMBuilder</span> <span class="kd">extends</span> <span class="n">Builder</span> <span class="p">{</span>
    <span class="n">Builder</span> <span class="nf">deploy</span><span class="p">(</span><span class="n">InputStream</span> <span class="n">fis</span><span class="p">);</span>
    <span class="n">Builder</span> <span class="nf">invoke</span><span class="p">(</span><span class="n">String</span> <span class="n">contractAddress</span><span class="p">,</span> <span class="n">BaseInvoke</span> <span class="n">baseInvoke</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">EVMBuilder</span> <span class="kd">extends</span> <span class="n">Builder</span> <span class="p">{</span>
    <span class="c1">// 当合约无构造参数时使用，不需abi参数</span>
    <span class="n">Builder</span> <span class="nf">deploy</span><span class="p">(</span><span class="n">String</span> <span class="n">bin</span><span class="p">);</span>
    <span class="c1">// 当合约需要提供abi解析构造方法参数时使用</span>
    <span class="n">Builder</span> <span class="nf">deploy</span><span class="p">(</span><span class="n">String</span> <span class="n">bin</span><span class="p">,</span> <span class="n">Abi</span> <span class="n">abi</span><span class="p">,</span> <span class="n">FuncParams</span> <span class="n">params</span><span class="p">);</span>
    <span class="n">Builder</span> <span class="nf">invoke</span><span class="p">(</span><span class="n">String</span> <span class="n">contractAddress</span><span class="p">,</span> <span class="n">String</span> <span class="n">methodName</span><span class="p">,</span> <span class="n">Abi</span> <span class="n">abi</span><span class="p">,</span> <span class="n">FuncParams</span> <span class="n">params</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">BVMBuilder</span> <span class="kd">extends</span> <span class="n">Builder</span> <span class="p">{</span>
    <span class="n">Builder</span> <span class="nf">invoke</span><span class="p">(</span><span class="n">BuiltinOperation</span> <span class="n">opt</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>下面是创建各个服务的交易体<code class="docutils literal notranslate"><span class="pre">Transaction</span></code>的实例。</p>
</div>
<div class="section" id="id12">
<h4>部署合约<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
</div>
</div>
<div class="section" id="hvm">
<h3>HVM<a class="headerlink" href="#hvm" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">InputStream</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">FileUtil</span><span class="p">.</span><span class="na">readFileAsStream</span><span class="p">(</span><span class="s">&quot;hvm-jar/hvmbasic-1.0.0-student.jar&quot;</span><span class="p">);</span>

<span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">HVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">deploy</span><span class="p">(</span><span class="n">payload</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定要<strong>部署的jar包(封装成流)</strong>。</p>
</div>
<div class="section" id="evm">
<h3>EVM<a class="headerlink" href="#evm" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">InputStream</span> <span class="n">inputStream1</span> <span class="o">=</span> <span class="n">FileUtil</span><span class="p">.</span><span class="na">readFileAsStream</span><span class="p">(</span><span class="s">&quot;solidity/sol2/TestContract_sol_TypeTestContract.bin&quot;</span><span class="p">);</span>
<span class="n">InputStream</span> <span class="n">inputStream2</span> <span class="o">=</span> <span class="n">FileUtil</span><span class="p">.</span><span class="na">readFileAsStream</span><span class="p">(</span><span class="s">&quot;solidity/sol2/TestContract_sol_TypeTestContract.abi&quot;</span><span class="p">);</span>
<span class="n">String</span> <span class="n">bin</span> <span class="o">=</span> <span class="n">FileUtil</span><span class="p">.</span><span class="na">readFile</span><span class="p">(</span><span class="n">inputStream1</span><span class="p">);</span>
<span class="n">String</span> <span class="n">abiStr</span> <span class="o">=</span> <span class="n">FileUtil</span><span class="p">.</span><span class="na">readFile</span><span class="p">(</span><span class="n">inputStream2</span><span class="p">);</span>
<span class="n">Abi</span> <span class="n">abi</span> <span class="o">=</span> <span class="n">Abi</span><span class="p">.</span><span class="na">fromJson</span><span class="p">(</span><span class="n">abiStr</span><span class="p">);</span>

<span class="n">FuncParams</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FuncParams</span><span class="p">();</span>
<span class="n">params</span><span class="p">.</span><span class="na">addParams</span><span class="p">(</span><span class="s">&quot;contract01&quot;</span><span class="p">);</span>
<span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">EVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">deploy</span><span class="p">(</span><span class="n">bin</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">params</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
<span class="c1">// 如果要部署的合约无构造函数，则调用如下</span>
<span class="c1">// Transaction transaction = new Transaction.EVMBuilder(account.getAddress()).deploy(bin).build();</span>
</pre></div>
</div>
<p>创建交易体时需要指定要<strong>部署的合约的bin、abi文件的字符串内容以及合约名</strong>。</p>
</div>
<div class="section" id="fvm">
<h3>FVM<a class="headerlink" href="#fvm" title="Permalink to this headline">¶</a></h3>
<p>待部署的合约构造函数不带参数使用方式如下</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">InputStream</span> <span class="n">inputStream1</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getContextClassLoader</span><span class="p">().</span><span class="na">getResourceAsStream</span><span class="p">(</span><span class="s">&quot;fvm-contract/set_hash/SetHash-gc.wasm&quot;</span><span class="p">);</span>
<span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">FVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">deploy</span><span class="p">(</span><span class="n">inputStream1</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>如果待部署的合约构造函数有参数那么使用方式如下</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">FVMAbi</span> <span class="n">abi</span> <span class="o">=</span> <span class="n">FVMAbi</span><span class="p">.</span><span class="na">fromJson</span><span class="p">(</span><span class="n">abiStr</span><span class="p">);</span>
<span class="n">FuncParams</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FuncParams</span><span class="p">();</span>
<span class="n">params</span><span class="p">.</span><span class="na">addParams</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">FVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">deploy</span><span class="p">(</span><span class="n">inputStream1</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">params</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定要<strong>部署的合约的wasm文件</strong></p>
<div class="section" id="id13">
<h4>调用合约<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
</div>
</div>
<div class="section" id="hvm-1">
<span id="id14"></span><h3>HVM<a class="headerlink" href="#hvm-1" title="Permalink to this headline">¶</a></h3>
<p>hvm调用合约有四种方式：</p>
<ul class="simple">
<li><p><strong>InvokeBean</strong>调用</p></li>
<li><p>直接调用合约方法（类似evm）</p></li>
<li><p>通过hvm-abi文件调用</p></li>
<li><p>通过hvm-abi文件进行并行合约调用</p></li>
</ul>
<ol class="arabic simple">
<li><p>InvokeBean调用如下：</p></li>
</ol>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">HVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">invoke</span><span class="p">(</span><span class="n">receiptResponse</span><span class="p">.</span><span class="na">getContractAddress</span><span class="p">(),</span> <span class="n">invoke</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定<strong>合约地址</strong>和<strong>InvokeBean</strong>(HVM中新提出的概念，请先通过HVM文档了解)。</p>
<ol class="arabic simple" start="2">
<li><p>直接调用合约方法如下：</p></li>
</ol>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">HVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">invokeDirectly</span><span class="p">(</span><span class="n">receiptResponse</span><span class="p">.</span><span class="na">getContractAddress</span><span class="p">(),</span> <span class="n">params</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>params类型为<code class="docutils literal notranslate"><span class="pre">InvokeDirectlyParams</span></code>，具体的构造方式见附录。</p>
<ol class="arabic simple" start="3">
<li><p>通过hvm.abi文件调用合约</p></li>
</ol>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">FileUtil</span><span class="p">.</span><span class="na">readFileAsStream</span><span class="p">(</span><span class="s">&quot;hvm-abi/hvm.abi&quot;</span><span class="p">);</span>
<span class="n">String</span> <span class="n">abiJson</span> <span class="o">=</span> <span class="n">FileUtil</span><span class="p">.</span><span class="na">readFile</span><span class="p">(</span><span class="n">inputStream</span><span class="p">);</span>
<span class="c1">//通过invokeBean调用</span>
<span class="n">InvokeHVMAbiParams</span><span class="p">.</span><span class="na">ParamBuilder</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InvokeHVMAbiParams</span><span class="p">.</span><span class="na">ParamBuilder</span><span class="p">(</span><span class="n">abiJson</span><span class="p">,</span>  <span class="n">HVMBeanAbi</span><span class="p">.</span><span class="na">BeanType</span><span class="p">.</span><span class="na">InvokeBean</span><span class="p">,</span><span class="s">&quot;invoke.InvokeBid&quot;</span><span class="p">);</span>
<span class="n">params</span><span class="p">.</span><span class="na">addParam</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">HVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">invokeByBeanAbi</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">params</span><span class="p">.</span><span class="na">build</span><span class="p">()).</span><span class="na">build</span><span class="p">();</span>

<span class="c1">// MethodBean 通过methodBean调用</span>
<span class="n">InvokeHVMAbiParams</span><span class="p">.</span><span class="na">ParamBuilder</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InvokeHVMAbiParams</span><span class="p">.</span><span class="na">ParamBuilder</span><span class="p">(</span><span class="n">abiJson</span><span class="p">,</span>  <span class="n">HVMBeanAbi</span><span class="p">.</span><span class="na">BeanType</span><span class="p">.</span><span class="na">MethodBean</span><span class="p">,</span><span class="s">&quot;bid&quot;</span><span class="p">);</span>
<span class="n">params</span><span class="p">.</span><span class="na">addParam</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">HVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">invokeByBeanAbi</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">params</span><span class="p">.</span><span class="na">build</span><span class="p">()).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>通过hvm.abi文件进行合约并行调用</p></li>
</ol>
<p>hvm支持区块间的hvm合约调用并行执行，hvm合约并行调用的具体内容请参考HVM使用手册，这里只给出使用示例。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// 事先读取abi文件</span>
<span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">FileUtil</span><span class="p">.</span><span class="na">readFileAsStream</span><span class="p">(</span><span class="s">&quot;hvm-abi/parallel-nestedMap/parallel-contract.abi&quot;</span><span class="p">);</span>
<span class="n">String</span> <span class="n">abiJson</span> <span class="o">=</span> <span class="n">FileUtil</span><span class="p">.</span><span class="na">readFile</span><span class="p">(</span><span class="n">inputStream</span><span class="p">);</span>
<span class="n">HVMAbi</span> <span class="n">hvmAbi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HVMAbi</span><span class="p">(</span><span class="n">abiJson</span><span class="p">);</span>
<span class="c1">// 创建HVMAbiGetter的一个实例，传入调用合约的abi</span>
<span class="n">HVMAbiMap</span> <span class="n">hvmAbiMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HVMAbiMap</span><span class="p">();</span>
<span class="n">hvmAbiMap</span><span class="p">.</span><span class="na">setHVMAbi</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">hvmAbi</span><span class="p">);</span>
<span class="c1">//  基于InvokeHVMAbiParams构建用于并行调用的payload，其中需要将isParallel设置为true</span>
<span class="n">InvokeHVMAbiParams</span><span class="p">.</span><span class="na">ParamBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InvokeHVMAbiParams</span><span class="p">.</span><span class="na">ParamBuilder</span><span class="p">(</span><span class="n">hvmAbiMap</span><span class="p">,</span> <span class="n">contractAddress</span><span class="p">,</span> <span class="n">HVMBeanAbi</span><span class="p">.</span><span class="na">BeanType</span><span class="p">.</span><span class="na">MethodBean</span><span class="p">,</span> <span class="s">&quot;transfer&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="c1">// 传入指定abiBean的参数，构建交易</span>
<span class="n">InvokeHVMAbiParams</span> <span class="n">params</span> <span class="o">=</span> <span class="n">builder</span><span class="p">.</span><span class="na">addParam</span><span class="p">(</span><span class="s">&quot;k1&quot;</span><span class="p">).</span><span class="na">addParam</span><span class="p">(</span><span class="s">&quot;k2&quot;</span><span class="p">).</span><span class="na">addParam</span><span class="p">(</span><span class="mi">100</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
<span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">HVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">invokeByBeanAbi</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">params</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="evm-1">
<span id="id15"></span><h3>EVM<a class="headerlink" href="#evm-1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">FuncParams</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FuncParams</span><span class="p">();</span>
<span class="n">params</span><span class="p">.</span><span class="na">addParams</span><span class="p">(</span><span class="s">&quot;10&quot;</span><span class="p">.</span><span class="na">getBytes</span><span class="p">());</span>
<span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">EVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">invoke</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="s">&quot;TestBytes32(bytes1)&quot;</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">params</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定<strong>调用方法</strong>、<strong>abi文件</strong>和<strong>方法参数</strong>。</p>
</div>
<div class="section" id="fvm-1">
<span id="id16"></span><h3>FVM<a class="headerlink" href="#fvm-1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">InputStream</span> <span class="n">inputStream2</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getContextClassLoader</span><span class="p">().</span><span class="na">getResourceAsStream</span><span class="p">(</span><span class="s">&quot;fvm-contract/set_hash/contract.json&quot;</span><span class="p">);</span>
<span class="n">String</span> <span class="n">abiStr</span> <span class="o">=</span> <span class="n">FileUtil</span><span class="p">.</span><span class="na">readFile</span><span class="p">(</span><span class="n">inputStream2</span><span class="p">);</span>
<span class="n">FVMAbi</span> <span class="n">abi</span> <span class="o">=</span> <span class="n">FVMAbi</span><span class="p">.</span><span class="na">fromJson</span><span class="p">(</span><span class="n">abiStr</span><span class="p">);</span>
<span class="n">FuncParams</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FuncParams</span><span class="p">();</span>
<span class="n">params</span><span class="p">.</span><span class="na">addParams</span><span class="p">(</span><span class="s">&quot;key001&quot;</span><span class="p">);</span>
<span class="n">params</span><span class="p">.</span><span class="na">addParams</span><span class="p">(</span><span class="s">&quot;this is the value of 0001&quot;</span><span class="p">);</span>
<span class="n">Transaction</span> <span class="n">transaction1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">FVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">invoke</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="s">&quot;set_hash&quot;</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">params</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定<strong>调用方法，abi以及参数</strong></p>
<div class="section" id="id17">
<h4>升级合约<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<p>升级合约使用ContractService的maintain接口。</p>
</div>
</div>
<div class="section" id="hvm-2">
<span id="id18"></span><h3>HVM<a class="headerlink" href="#hvm-2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">HVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">upgrade</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">payload</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定<strong>合约地址</strong>和<strong>读取新合约jar包得到的字符串</strong></p>
</div>
<div class="section" id="evm-2">
<span id="id19"></span><h3>EVM<a class="headerlink" href="#evm-2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">EVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">upgrade</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">payload</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定<strong>合约地址</strong>和<strong>升级的新合约的bin文件字符串</strong>。</p>
</div>
<div class="section" id="fvm-2">
<span id="id20"></span><h3>FVM<a class="headerlink" href="#fvm-2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">FVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">upgrade</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">Encoder</span><span class="p">.</span><span class="na">encodeDeployWasm</span><span class="p">(</span><span class="n">inputStream3</span><span class="p">)).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定<strong>合约地址</strong>和<strong>升级的新合约的wasm文件</strong>。</p>
<div class="section" id="id21">
<h4>冻结合约<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<p>冻结合约使用ContractService的maintain接口。</p>
</div>
</div>
<div class="section" id="hvm-3">
<span id="id22"></span><h3>HVM<a class="headerlink" href="#hvm-3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">HVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">freeze</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定<strong>合约地址</strong>。</p>
</div>
<div class="section" id="evm-3">
<span id="id23"></span><h3>EVM<a class="headerlink" href="#evm-3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">EVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">freeze</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定<strong>合约地址</strong>。</p>
</div>
<div class="section" id="fvm-3">
<span id="id24"></span><h3>FVM<a class="headerlink" href="#fvm-3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">FVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">freeze</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定<strong>合约地址</strong>。</p>
<div class="section" id="id25">
<h4>解冻合约<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<p>解冻合约使用ContractService的maintain接口。</p>
</div>
</div>
<div class="section" id="hvm-4">
<span id="id26"></span><h3>HVM<a class="headerlink" href="#hvm-4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">HVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">unfreeze</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定<strong>合约地址</strong>。</p>
</div>
<div class="section" id="evm-4">
<span id="id27"></span><h3>EVM<a class="headerlink" href="#evm-4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">EVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">unfreeze</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定<strong>合约地址</strong>。</p>
</div>
<div class="section" id="fvm-4">
<span id="id28"></span><h3>FVM<a class="headerlink" href="#fvm-4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">FVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">unfreeze</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<p>创建交易体时需要指定<strong>合约地址</strong>。</p>
</div>
<div class="section" id="simulate">
<h3>simulate交易<a class="headerlink" href="#simulate" title="Permalink to this headline">¶</a></h3>
<p>simulate交易执行不会更改区块链的账本状态，这是其和普通交易最大的不同。在使用方式上，两者没有什么区别，只需要在构建simulate交易时设置其<code class="docutils literal notranslate"><span class="pre">simulate</span></code>标志，即可如发送普通交易一样，发送simulate交易。</p>
<p>构建simulate交易示例如下</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">HVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">())</span>
  <span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">receiptResponse</span><span class="p">.</span><span class="na">getContractAddress</span><span class="p">(),</span> <span class="n">invoke</span><span class="p">)</span>
  <span class="p">.</span><span class="na">simulate</span><span class="p">()</span>
  <span class="p">.</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="payload">
<h3>交易体的payload<a class="headerlink" href="#payload" title="Permalink to this headline">¶</a></h3>
<p>在创建交易体时，会根据传入的参数生成payload。如果是HVM合约相关的<code class="docutils literal notranslate"><span class="pre">transaction</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">Decoder</span></code>提供的<code class="docutils literal notranslate"><span class="pre">decodeHVMPayload(String</span> <span class="pre">payload)</span></code>方法对payload进行解析，返回<code class="docutils literal notranslate"><span class="pre">HVMPayload</span></code>对象。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">HVMPayload</span> <span class="nf">decodeHVMPayload</span><span class="p">(</span><span class="n">String</span> <span class="n">payload</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">HVMPayload</span></code>结构如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HVMPayload</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">invokeBeanName</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">invokeArgs</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">invokeMethods</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>其中<code class="docutils literal notranslate"><span class="pre">invokeBeanName</span></code>为调用的HVM合约的名字，<code class="docutils literal notranslate"><span class="pre">invokeArgs</span></code>为调用的参数，<code class="docutils literal notranslate"><span class="pre">invokeMethods</span></code>为调用的合约方法。</p>
<p>如果是BVM合约相关的<code class="docutils literal notranslate"><span class="pre">transaction</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">Decoder</span></code>提供的<code class="docutils literal notranslate"><span class="pre">decodeBVMPayload(String</span> <span class="pre">payload)</span></code>方法对payload进行解析，返回<code class="docutils literal notranslate"><span class="pre">Operation</span></code>对象，从<code class="docutils literal notranslate"><span class="pre">Operation</span></code>中可以获取BVM交易调用的内置合约方法(methodName)和参数(args)。</p>
</div>
<div class="section" id="txversion">
<h3>交易体设置TxVersion<a class="headerlink" href="#txversion" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">transaction</span></code>对象在创建时，其TxVersion属性值默认为全局的TxVersion，也可通过<code class="docutils literal notranslate"><span class="pre">setTxVersion</span></code>函数来设置交易体的TxVersion属性。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">HVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">deploy</span><span class="p">(</span><span class="n">payload</span><span class="p">).</span><span class="na">txVersion</span><span class="p">(</span><span class="n">TxVersion</span><span class="p">.</span><span class="na">TxVersion10</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id29">
<h3>交易体签名<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>通过<code class="docutils literal notranslate"><span class="pre">Transaction</span></code>提供的<code class="docutils literal notranslate"><span class="pre">sign()</span></code>方法，需要指定<code class="docutils literal notranslate"><span class="pre">Account</span></code>对象。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">transaction</span><span class="p">.</span><span class="na">sign</span><span class="p">(</span><span class="n">account</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id30">
<h3>创建请求<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<p>这个过程分为两步，先创建<code class="docutils literal notranslate"><span class="pre">ContractService</span></code>对象，再指定之前构造的交易体调用相应的服务接口，示例如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ContractService</span> <span class="n">contractService</span> <span class="o">=</span> <span class="n">ServiceManager</span><span class="p">.</span><span class="na">getContractService</span><span class="p">(</span><span class="n">providerManager</span><span class="p">);</span>

<span class="c1">//方式一</span>
<span class="n">Request</span><span class="o">&lt;</span><span class="n">TxHashResponse</span><span class="o">&gt;</span> <span class="n">contractRequest</span> <span class="o">=</span> <span class="n">contractService</span><span class="p">.</span><span class="na">deploy</span><span class="p">(</span><span class="n">transaction</span><span class="p">);</span>

<span class="c1">//方式二</span>
<span class="n">Request</span><span class="o">&lt;</span><span class="n">ReceiptResponse</span><span class="o">&gt;</span> <span class="n">contractGrpcRequest</span> <span class="o">=</span> <span class="n">contractService</span><span class="p">.</span><span class="na">grpcDeployReturnReceipt</span><span class="p">(</span><span class="n">transaction</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id31">
<h3>发送交易体<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<p>如果创建请求调用的是普通接口，不是<strong>grpc</strong>的服务接口，那么这个过程实际分为两步，调用<code class="docutils literal notranslate"><span class="pre">send()</span></code>部署合约拿到响应，再对响应解析拿到<code class="docutils literal notranslate"><span class="pre">ReceiptResponse</span></code>（执行结果）。如果创建请求调用的是<strong>grpc</strong>服务接口，只需要调用<code class="docutils literal notranslate"><span class="pre">send()</span></code>方法拿到<code class="docutils literal notranslate"><span class="pre">ReceiptResponse</span></code>响应就结束了。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//方式一</span>
<span class="n">ReceiptResponse</span> <span class="n">receiptResponse</span> <span class="o">=</span> <span class="n">contractRequest</span><span class="p">.</span><span class="na">send</span><span class="p">().</span><span class="na">polling</span><span class="p">();</span>

<span class="c1">//方式二</span>
<span class="n">ReceiptResponse</span> <span class="n">receiptResponse2</span> <span class="o">=</span> <span class="n">contractGrpcRequest</span><span class="p">.</span><span class="na">send</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id32">
<h3>合约辅助接口<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<p>LiteSDK除了提供上述与合约交易相关的接口，还提供了以下编译合约、获取合约状态等查询接口，其响应类型如下：</p>
<ul class="simple">
<li><p>CompileContractResponse</p></li>
<li><p>StringResponse</p></li>
<li><p>DeployerListResponse</p></li>
</ul>
<p><strong>CompileContractResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是内部类<code class="docutils literal notranslate"><span class="pre">CompileCode</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CompileContractResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
     <span class="kd">private</span> <span class="n">CompileCode</span> <span class="n">result</span><span class="p">;</span>
             <span class="kd">public</span> <span class="kd">class</span> <span class="nc">CompileCode</span> <span class="p">{</span>

        <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">abi</span><span class="p">;</span>

        <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">bin</span><span class="p">;</span>

        <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">types</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>StringResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是String，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StringResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>DeployerListResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是List，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DeployerListResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>以下为合约的相关查询接口</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ContractService</span> <span class="p">{</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">CompileContractResponse</span><span class="o">&gt;</span> <span class="nf">compileContract</span><span class="p">(</span><span class="n">String</span> <span class="n">code</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getCode</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getContractCountByAddr</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">DeployerListResponse</span><span class="o">&gt;</span> <span class="nf">getDeployedList</span><span class="p">(</span><span class="n">String</span> <span class="n">address</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getStatus</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getCreator</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getCreateTime</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getStatusByCName</span><span class="p">(</span><span class="n">String</span> <span class="n">cname</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getCreatorByCName</span><span class="p">(</span><span class="n">String</span> <span class="n">cname</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getCreateTimeByCName</span><span class="p">(</span><span class="n">String</span> <span class="n">cname</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="solidity">
<h4>编译Solidity合约<a class="headerlink" href="#solidity" title="Permalink to this headline">¶</a></h4>
<p>参数：</p>
<ul class="simple">
<li><p>code solidity合约源码</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">CompileContractResponse</span><span class="o">&gt;</span> <span class="nf">compileContract</span><span class="p">(</span><span class="n">String</span> <span class="n">code</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id33">
<h4>获取合约源码<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h4>
<p>参数：</p>
<ul class="simple">
<li><p>addr 合约地址</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getCode</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id34">
<h4>获取账户部署的合约数量<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<p>参数：</p>
<ul class="simple">
<li><p>addr 账户地址</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getContractCountByAddr</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id35">
<h4>获取账户部署的合约地址列表<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<p>参数：</p>
<ul class="simple">
<li><p>address 账户地址</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">DeployerListResponse</span><span class="o">&gt;</span> <span class="nf">getDeployedList</span><span class="p">(</span><span class="n">String</span> <span class="n">address</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id36">
<h4>获取合约状态<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h4>
<p>参数：</p>
<ul class="simple">
<li><p>addr 合约地址</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getStatus</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id37">
<h4>获取合约的部署账户<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h4>
<p>参数：</p>
<ul class="simple">
<li><p>addr 合约地址</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getCreator</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id38">
<h4>获取合约的部署时间<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h4>
<p>参数：</p>
<ul class="simple">
<li><p>addr 合约地址</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getCreateTime</span><span class="p">(</span><span class="n">String</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-cname">
<h4>获取合约状态by cname<a class="headerlink" href="#by-cname" title="Permalink to this headline">¶</a></h4>
<p>参数：</p>
<ul class="simple">
<li><p>cname 合约名</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getStatusByCName</span><span class="p">(</span><span class="n">String</span> <span class="n">cname</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id39">
<h4>获取合约的部署账户by cname<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h4>
<p>参数：</p>
<ul class="simple">
<li><p>cname 合约名</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getCreatorByCName</span><span class="p">(</span><span class="n">String</span> <span class="n">cname</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id40">
<h4>获取合约的部署时间by cname<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h4>
<p>参数：</p>
<ul class="simple">
<li><p>cname 合约名</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">StringResponse</span><span class="o">&gt;</span> <span class="nf">getCreateTimeByCName</span><span class="p">(</span><span class="n">String</span> <span class="n">cname</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span><span class="na">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="transaction-txservice">
<h2>第四章. Transaction接口(TxService)<a class="headerlink" href="#transaction-txservice" title="Permalink to this headline">¶</a></h2>
<p><strong>注：该章的Transaction与第三章的交易体概念不同，该章的接口主要主要用于查询之前在链上的执行信息，将返回的信息封装为Transaction结构体。</strong></p>
<p>TxService接口繁多，返回的执行结果根据情况封装共对应五种响应：</p>
<ul class="simple">
<li><p>TxResponse</p></li>
<li><p>TxCountWithTSResponse</p></li>
<li><p>TxCountResponse</p></li>
<li><p>TxAvgTimeResponse</p></li>
<li><p>ReceiptListResponse</p></li>
</ul>
<p>详细结构请参考第十一章</p>
<div class="section" id="by-transaction-hash-gettransactionbyhash">
<h3>4.1 查询交易by transaction hash(getTransactionByHash)<a class="headerlink" href="#by-transaction-hash-gettransactionbyhash" title="Permalink to this headline">¶</a></h3>
<p>参数： * txHash 交易hash * nodeIds 请求向哪些节点发送</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getTxByHash</span><span class="p">(</span><span class="n">String</span> <span class="n">txHash</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-block-hash-gettxbyblockhashandindex">
<h3>4.2 查询交易by block hash(getTxByBlockHashAndIndex)<a class="headerlink" href="#by-block-hash-gettxbyblockhashandindex" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>blockHash 区块哈希值</p></li>
<li><p>index 区块内的交易索引值</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getTxByBlockHashAndIndex</span><span class="p">(</span><span class="n">String</span> <span class="n">blockHash</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-block-number-gettxbyblocknumandindex">
<h3>4.3 查询交易by block number(getTxByBlockNumAndIndex)<a class="headerlink" href="#by-block-number-gettxbyblocknumandindex" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>blockNumber 区块号</p></li>
<li><p>index 区块内的交易索引值</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getTxByBlockNumAndIndex</span><span class="p">(</span><span class="kt">int</span> <span class="n">blockNumber</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getTxByBlockNumAndIndex</span><span class="p">(</span><span class="n">String</span> <span class="n">blockNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">idx</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-time-with-limit-gettransactionsbytimewithlimit">
<h3>4.4 查询交易by time with limit(getTransactionsByTimeWithLimit)<a class="headerlink" href="#by-time-with-limit-gettransactionsbytimewithlimit" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>startTime 起始时间戳</p></li>
<li><p>endTime 结束时间戳</p></li>
<li><p>metaData 分页相关参数</p></li>
<li><p>filter 交易过滤条件</p></li>
<li><p>nodeIds 请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getTransactionsByTimeWithLimit</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">endTime</span><span class="p">,</span> <span class="n">MetaDataParam</span> <span class="n">metaData</span><span class="p">,</span> <span class="n">FilterParam</span> <span class="n">filter</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getTransactionsByTimeWithLimit</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">endTime</span><span class="p">,</span> <span class="n">MetaDataParam</span> <span class="n">metaData</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getTransactionsByTimeWithLimit</span><span class="p">(</span><span class="n">String</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">String</span> <span class="n">endTime</span><span class="p">,</span> <span class="n">MetaDataParam</span> <span class="n">metaData</span><span class="p">,</span> <span class="n">FilterParam</span> <span class="n">filter</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getTransactionsByTimeWithLimit</span><span class="p">(</span><span class="n">String</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">String</span> <span class="n">endTime</span><span class="p">,</span> <span class="n">MetaDataParam</span> <span class="n">metaData</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getTransactionsByTimeWithLimit</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">endTime</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getTransactionsByTimeWithLimit</span><span class="p">(</span><span class="n">String</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">String</span> <span class="n">endTime</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="with-limit-gettxswithlimit">
<h3>4.5 查询交易 with limit(getTxsWithLimit)<a class="headerlink" href="#with-limit-gettxswithlimit" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>from 区块区间起点</p></li>
<li><p>to 区块区间终点</p></li>
<li><p>metaData 分页相关参数</p></li>
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getTxsWithLimit</span><span class="p">(</span><span class="n">String</span> <span class="n">from</span><span class="p">,</span> <span class="n">String</span> <span class="n">to</span><span class="p">,</span> <span class="n">MetaDataParam</span> <span class="n">metaData</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getTxsWithLimit</span><span class="p">(</span><span class="n">String</span> <span class="n">from</span><span class="p">,</span> <span class="n">String</span> <span class="n">to</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="gettxavgtimebyblocknumber">
<h3>4.6 查询指定区块区间交易平均处理时间(getTxAvgTimeByBlockNumber)<a class="headerlink" href="#gettxavgtimebyblocknumber" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>from 区块区间起点</p></li>
<li><p>to 区块区间终点</p></li>
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxAvgTimeResponse</span><span class="o">&gt;</span> <span class="nf">getTxAvgTimeByBlockNumber</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">from</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">to</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxAvgTimeResponse</span><span class="o">&gt;</span> <span class="nf">getTxAvgTimeByBlockNumber</span><span class="p">(</span><span class="n">String</span> <span class="n">from</span><span class="p">,</span> <span class="n">String</span> <span class="n">to</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="gettransactionscount">
<h3>4.7 查询链上所有交易量(getTransactionsCount)<a class="headerlink" href="#gettransactionscount" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxCountWithTSResponse</span><span class="o">&gt;</span> <span class="nf">getTransactionsCount</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-transaction-hash-gettransactionreceipt">
<h3>4.8 查询交易回执信息by transaction hash(getTransactionReceipt)<a class="headerlink" href="#by-transaction-hash-gettransactionreceipt" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>txHash 交易hash。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">ReceiptResponse</span><span class="o">&gt;</span> <span class="nf">getTransactionReceipt</span><span class="p">(</span><span class="n">String</span> <span class="n">txHash</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="getconfirmedtransactionreceipt">
<h3>4.9 查询上链的交易回执信息(getConfirmedTransactionReceipt)<a class="headerlink" href="#getconfirmedtransactionreceipt" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>txHash 交易hash。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">ReceiptResponse</span><span class="o">&gt;</span> <span class="nf">getConfirmedTransactionReceipt</span><span class="p">(</span><span class="n">String</span> <span class="n">txHash</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-block-hash-getblocktxcountbyhash">
<h3>4.10 查询区块交易数量by block hash(getBlockTxCountByHash)<a class="headerlink" href="#by-block-hash-getblocktxcountbyhash" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>blockHash 区块哈希值</p></li>
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxCountWithTSResponse</span><span class="o">&gt;</span> <span class="nf">getBlockTxCountByHash</span><span class="p">(</span><span class="n">String</span> <span class="n">blockHash</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-block-number-getblocktxcountbynumber">
<h3>4.11 查询区块交易数量by block number(getBlockTxCountByNumber)<a class="headerlink" href="#by-block-number-getblocktxcountbynumber" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>blockNumber 区块号。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxCountWithTSResponse</span><span class="o">&gt;</span> <span class="nf">getBlockTxCountByNumber</span><span class="p">(</span><span class="n">String</span> <span class="n">blockNumber</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="gettxversion">
<h3>4.12 查询平台当前的交易版本号(getTxVersion)<a class="headerlink" href="#gettxversion" title="Permalink to this headline">¶</a></h3>
<p>getTxVersion接口会在创建ProviderManager对象时调用，并设置全局的TxVersion。</p>
<p>参数：</p>
<ul class="simple">
<li><p>nodeId 说明请求哪个节点平台的交易版本号</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxVersionResponse</span><span class="o">&gt;</span> <span class="nf">getTxVersion</span><span class="p">(</span><span class="kt">int</span> <span class="n">nodeId</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RequestException</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="getinvalidtransactionscount">
<h3>4.13 查询链上所有非法交易交易量(getInvalidTransactionsCount)<a class="headerlink" href="#getinvalidtransactionscount" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxCountWithTSResponse</span><span class="o">&gt;</span> <span class="nf">getInvalidTransactionsCount</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="getinvalidtxscountbytime">
<h3>4.14 查询链上指定时间段内的非法交易交易量(getInvalidTxsCountByTime)<a class="headerlink" href="#getinvalidtxscountbytime" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>startTime 开始时间</p></li>
<li><p>endTime 截止时间</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxCountResponse</span><span class="o">&gt;</span> <span class="nf">getInvalidTxsCountByTime</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">endTime</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-block-number-getinvalidtxsbyblocknumber">
<h3>4.15 查询一个区块中的所有非法交易 by block number(getInvalidTxsByBlockNumber)<a class="headerlink" href="#by-block-number-getinvalidtxsbyblocknumber" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>blockNumber 区块号</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getInvalidTxsByBlockNumber</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">blockNumber</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-block-hash-getinvalidtxsbyblockhash">
<h3>4.16 查询一个区块中的所有非法交易 by block hash(getInvalidTxsByBlockHash)<a class="headerlink" href="#by-block-hash-getinvalidtxsbyblockhash" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>blockHash 区块哈希</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getInvalidTxsByBlockHash</span><span class="p">(</span><span class="n">String</span> <span class="n">blockHash</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="with-limit-getinvalidtxswithlimit">
<h3>4.17 查询非法交易 with limit(getInvalidTxsWithLimit)<a class="headerlink" href="#with-limit-getinvalidtxswithlimit" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>from 区块区间起点</p></li>
<li><p>to 区块区间终点</p></li>
<li><p>metaData 分页相关参数</p></li>
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getInvalidTxsWithLimit</span><span class="p">(</span><span class="n">String</span> <span class="n">from</span><span class="p">,</span> <span class="n">String</span> <span class="n">to</span><span class="p">,</span> <span class="n">MetaDataParam</span> <span class="n">metaData</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getInvalidTxsWithLimit</span><span class="p">(</span><span class="n">String</span> <span class="n">from</span><span class="p">,</span> <span class="n">String</span> <span class="n">to</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getInvalidTxsWithLimit</span><span class="p">(</span><span class="n">Integer</span> <span class="n">from</span><span class="p">,</span> <span class="n">Integer</span> <span class="n">to</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="getnextpagetransactions">
<h3>4.18 查询下一页交易(getNextPageTransactions)<a class="headerlink" href="#getnextpagetransactions" title="Permalink to this headline">¶</a></h3>
<p>注意：当输入的区块范围较大并且这个范围内符合条件的交易数量非常大时，<strong>请求响应延迟将非常高</strong>。存在服务器资源被该请求处理长时间占用的风险，应尽量
避免使用。</p>
<p>参数：</p>
<ul class="simple">
<li><p>blkNumber 从该区块开始计数。</p></li>
<li><p>txIndex 起始交易在blkNumber号区块的位置偏移量。</p></li>
<li><p>minBlkNumber 截止计数的最小区块号。</p></li>
<li><p>maxBlkNumber 截止计数的最大区块号。</p></li>
<li><p>separated 表示要跳过的交易条数（一般用于跳页查询）。</p></li>
<li><p>pageSize 表示要返回的交易条数。</p></li>
<li><p>containCurrent
true表示返回的结果中包括blkNumber区块中位置为txIndex的交易，如果该条交易不是合约地址为address合约的交易，则不算入。</p></li>
<li><p>address 合约地址。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getNextPageTransactions</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">blkNumber</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">txIndex</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">minBlkNumber</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">maxBlkNumber</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">separated</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">pageSize</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">containCurrent</span><span class="p">,</span> <span class="n">String</span> <span class="n">address</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getNextPageTransactions</span><span class="p">(</span><span class="n">String</span> <span class="n">blkNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">txIndex</span><span class="p">,</span> <span class="n">String</span> <span class="n">minBlkNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">maxBlkNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">separated</span><span class="p">,</span> <span class="n">String</span> <span class="n">pageSize</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">containCurrent</span><span class="p">,</span> <span class="n">String</span> <span class="n">address</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="getprevpagetransactions">
<h3>4.19 查询上一页交易(getPrevPageTransactions)<a class="headerlink" href="#getprevpagetransactions" title="Permalink to this headline">¶</a></h3>
<p>注意：当输入的区块范围较大并且这个范围内符合条件的交易数量非常大时，<strong>请求响应延迟将非常高</strong>。存在服务器资源被该请求处理长时间占用的风险，应尽量
避免使用。</p>
<p>参数：</p>
<ul class="simple">
<li><p>blkNumber 从该区块开始计数。</p></li>
<li><p>txIndex 起始交易在blkNumber号区块的位置偏移量。</p></li>
<li><p>minBlkNumber 截止计数的最小区块号。</p></li>
<li><p>maxBlkNumber 截止计数的最大区块号。</p></li>
<li><p>separated 表示要跳过的交易条数（一般用于跳页查询）。</p></li>
<li><p>pageSize 表示要返回的交易条数。</p></li>
<li><p>containCurrent
true表示返回的结果中包括blkNumber区块中位置为txIndex的交易，如果该条交易不是合约地址为address合约的交易，则不算入。</p></li>
<li><p>address 合约地址。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getPrevPageTransactions</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">blkNumber</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">txIndex</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">minBlkNumber</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">maxBlkNumber</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">separated</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">pageSize</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">containCurrent</span><span class="p">,</span> <span class="n">String</span> <span class="n">address</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getPrevPageTransactions</span><span class="p">(</span><span class="n">String</span> <span class="n">blkNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">txIndex</span><span class="p">,</span> <span class="n">String</span> <span class="n">minBlkNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">maxBlkNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">separated</span><span class="p">,</span> <span class="n">String</span> <span class="n">pageSize</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">containCurrent</span><span class="p">,</span> <span class="n">String</span> <span class="n">address</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="getnextpageinvalidtransactions">
<h3>4.20 查询下一页非法交易(getNextPageInvalidTransactions)<a class="headerlink" href="#getnextpageinvalidtransactions" title="Permalink to this headline">¶</a></h3>
<p>注意：当输入的区块范围较大并且这个范围内符合条件的交易数量非常大时，<strong>请求响应延迟将非常高</strong>。存在服务器资源被该请求处理长时间占用的风险，应尽量
避免使用。</p>
<p>参数：</p>
<ul class="simple">
<li><p>blkNumber 从该区块开始计数。</p></li>
<li><p>txIndex 起始交易在blkNumber号区块的位置偏移量。</p></li>
<li><p>minBlkNumber 截止计数的最小区块号。</p></li>
<li><p>maxBlkNumber 截止计数的最大区块号。</p></li>
<li><p>separated 表示要跳过的交易条数（一般用于跳页查询）。</p></li>
<li><p>pageSize 表示要返回的交易条数。</p></li>
<li><p>containCurrent
true表示返回的结果中包括blkNumber区块中位置为txIndex的交易，如果该条交易不是合约地址为address合约的交易，则不算入。</p></li>
<li><p>address 合约地址。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getNextPageInvalidTransactions</span><span class="p">(</span><span class="n">String</span> <span class="n">blkNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">txIndex</span><span class="p">,</span> <span class="n">String</span> <span class="n">minBlkNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">maxBlkNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">separated</span><span class="p">,</span> <span class="n">String</span> <span class="n">pageSize</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">containCurrent</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getNextPageInvalidTransactions</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">blkNumber</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">txIndex</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">minBlkNumber</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">maxBlkNumber</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">separated</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">pageSize</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">containCurrent</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="getprevpageinvalidtransactions">
<h3>4.21 查询上一页非法交易(getPrevPageInvalidTransactions)<a class="headerlink" href="#getprevpageinvalidtransactions" title="Permalink to this headline">¶</a></h3>
<p>注意：当输入的区块范围较大并且这个范围内符合条件的交易数量非常大时，<strong>请求响应延迟将非常高</strong>。存在服务器资源被该请求处理长时间占用的风险，应尽量
避免使用。</p>
<p>参数：</p>
<ul class="simple">
<li><p>blkNumber 从该区块开始计数。</p></li>
<li><p>txIndex 起始交易在blkNumber号区块的位置偏移量。</p></li>
<li><p>minBlkNumber 截止计数的最小区块号。</p></li>
<li><p>maxBlkNumber 截止计数的最大区块号。</p></li>
<li><p>separated 表示要跳过的交易条数（一般用于跳页查询）。</p></li>
<li><p>pageSize 表示要返回的交易条数。</p></li>
<li><p>containCurrent
true表示返回的结果中包括blkNumber区块中位置为txIndex的交易，如果该条交易不是合约地址为address合约的交易，则不算入。</p></li>
<li><p>address 合约地址。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getPrevPageInvalidTransactions</span><span class="p">(</span><span class="n">String</span> <span class="n">blkNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">txIndex</span><span class="p">,</span> <span class="n">String</span> <span class="n">minBlkNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">maxBlkNumber</span><span class="p">,</span> <span class="n">String</span> <span class="n">separated</span><span class="p">,</span> <span class="n">String</span> <span class="n">pageSize</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">containCurrent</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getPrevPageInvalidTransactions</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">blkNumber</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">txIndex</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">minBlkNumber</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">maxBlkNumber</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">separated</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">pageSize</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">containCurrent</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-contract-address-gettransactionscountbycontractaddr">
<h3>4.22 查询区块区间交易数量by contract address(getTransactionsCountByContractAddr)<a class="headerlink" href="#by-contract-address-gettransactionscountbycontractaddr" title="Permalink to this headline">¶</a></h3>
<p>注意：当输入的区块范围较大并且这个范围内符合条件的交易数量非常大时，<strong>请求响应延迟将非常高</strong>。存在服务器资源被该请求处理长时间占用的风险，应尽量避免使用。</p>
<p>参数：</p>
<ul class="simple">
<li><p>from 起始区块号。</p></li>
<li><p>to 终止区块号。</p></li>
<li><p>address 合约地址。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxCountResponse</span><span class="o">&gt;</span> <span class="nf">getTransactionsCountByContractAddr</span><span class="p">(</span><span class="n">String</span> <span class="n">from</span><span class="p">,</span> <span class="n">String</span> <span class="n">to</span><span class="p">,</span> <span class="n">String</span> <span class="n">address</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxCountResponse</span><span class="o">&gt;</span> <span class="nf">getTransactionsCountByContractAddr</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">from</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">to</span><span class="p">,</span> <span class="n">String</span> <span class="n">address</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="gettxscountbytime">
<h3>4.23 查询指定时间区间内的交易数量(getTxsCountByTime)<a class="headerlink" href="#gettxscountbytime" title="Permalink to this headline">¶</a></h3>
<p>注意：当输入的时间范围较大并且这个范围内的区块较多时，<strong>请求响应延迟将升高</strong>。存在服务器资源被该请求处理长时间占用的风险，应尽量避免使用。</p>
<p>参数：</p>
<ul class="simple">
<li><p>startTime 起起始时间戳(单位ns)。</p></li>
<li><p>endTime 结束时间戳(单位ns)。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getTxsCountByTime</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">endTime</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="extraidby-extraid-gettxsbyextraid">
<h3>4.24 查询指定extraID的交易by extraID(getTxsByExtraID)<a class="headerlink" href="#extraidby-extraid-gettxsbyextraid" title="Permalink to this headline">¶</a></h3>
<p>该接口只要在访问的节点开启数据索引功能时才可用。</p>
<p>参数：</p>
<ul class="simple">
<li><p>mode [可选]
表示本次查询请求的查询模式，目前有0、1、2三个值可选，默认为0。0
表示按序精确查询模式，即筛选出的的交易 extraId
数组的数值和顺序都与查询条件完全一致。1
表示非按序精确查询模式，即筛选出的交易 extraId
数组包含查询条件里指定的全部数值，顺序无要求。2
表示非按序匹配查询模式，即筛选出的交易 extraId
数组包含部分或全部查询条件指定的值，且顺序无要求。。</p></li>
<li><p>detail [可选] 是否返回详细的交易内容，默认为false。</p></li>
<li><p>metaData [可选]
分页相关参数。指定本次查询的起始位置、查询方向以及返回的条数。若未指定，则默认从最新区块开始向前查询，默认返回条数上限是5000条。</p></li>
<li><p>filter [必选] 指定本次查询过滤条件。包括交易extraId和交易接收方地址。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<p>MetaDataParam 结构如下：</p>
<ul class="simple">
<li><p>pagesize [可选] 表示本次查询返回多少
条交易。如果未指定，则pagesize默认
值为5000，如果超过5000，则使用节点默认值5000。如果符合条件的交易数量实际上超过pagesize，则返回结果里hasmore为true。</p></li>
<li><p>bookmark [可选]
表示本次查询的书签位置，即起始位置，返回的结果里不包含用户指定的书签所对应的交易。如果未指定且backward为false，则默认从最新区块开始向前遍历，如果未指定且backward为true，则默认从创世区块开始向后遍历。</p></li>
<li><p>backward [可选]
表示本次查询的方向，false表示以起始位置为起点从高区块往低区块遍历，true表示以起
始位 置为起点从低区块往高区块遍历，默认查询方向为false。</p></li>
</ul>
<p>Bookmark 结构如下：</p>
<ul class="simple">
<li><p>blkNum 交易所在区块号。</p></li>
<li><p>txIndex 交易索引号，即交易在区块内的位置。</p></li>
</ul>
<p>FilterParam 结构如下：</p>
<ul class="simple">
<li><p>extraId [必选]
指定交易extraId的值，类型为数组，数组元素可以为Long或者string。</p></li>
<li><p>txTo [可选] 指定交易接收方的地址。</p></li>
</ul>
<p>客户端可以利用该接口实现区块链的“分页查询”，根据返回结果里的hasmore来判断是否要继续查询剩下的数据。下面对该接口的参数做进一步说明：</p>
<p>如果查询条件未指定 metadata，则 metadata.backward 默认为
false、书签位置默认为最新区块最后一条交易，从书签位置开始往前遍历，limit默认为5000条。</p>
<p>如果查询条件里未指定 metadata.bookmark，若 metadata.backward 为
false，则默认书签位置为最新区块的最后一条交易，若metadata.backward 为
true，则默认书签位置为第一个区块的第一条交易。</p>
<p>如果查询条件里指定的书签位置 metadata.bookmark 位于区块区间 [1, latest]
里，则我们需要根据 metadata.backward 的值来调整遍历的区块区间。如果
metadata.backward 为false，则区块区间调整为 [1,
metadata.bookmark.blkNum]，如果 metadata.backward
为true，则区块区间调整为 [metadata.bookmark.blkNum, latest]。</p>
<p>当 backward 为 false 的时
候，如果指定的书签位置在区块1之前，则接口返回error。当 backward 为 true
的时候，如果指定的书签位置在最新区块之后，则接口返回error。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getTxsByExtraID</span><span class="p">(</span><span class="kt">int</span> <span class="n">mode</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">detail</span><span class="p">,</span> <span class="n">MetaDataParam</span> <span class="n">metaData</span><span class="p">,</span> <span class="n">FilterParam</span> <span class="n">filter</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="filterby-filter-gettxsbyfilter">
<h3>4.25 查询指定filter的交易by filter(getTxsByFilter)<a class="headerlink" href="#filterby-filter-gettxsbyfilter" title="Permalink to this headline">¶</a></h3>
<p>该接口只要在访问的节点开启数据索引功能时才可用。</p>
<p>参数：</p>
<ul class="simple">
<li><p>mode [可选] 表示本次查询请求的查询模式，目前有 0、1
两个值可选，默认为0。0
表示多条件与查询模式，即交易对应字段的值与查询条件里所有指定的字段值都完全一致。1
表示多条件或询模式，即交易对应字段的值至少有一个等于查询条件里指定的字段值。</p></li>
<li><p>detail [可选] 是否返回详细的交易内容，默认为false。</p></li>
<li><p>metaData [可选]
指定本次查询的起始位置、查询方向以及返回的条数。若未指定，则默认从最新区块开始向前查询，默认返回条数上限是5000条。</p></li>
<li><p>filter [必选] 指定本次查询过滤条件。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<p>MetaDataParam 结构如下：</p>
<ul class="simple">
<li><p>pagesize [可选] 表示本次查询返回多少
条交易。如果未指定，则pagesize默认
值为5000，如果超过5000，则使用节点默认值5000。如果符合条件的交易数量实际上超过pagesize，则返回结果里hasmore为true。</p></li>
<li><p>bookmark [可选]
表示本次查询的书签位置，即起始位置，返回的结果里不包含用户指定的书签所对应的交易。如果未指定且backward为false，则默认从最新区块开始向前遍历，如果未指定且backward为true，则默认从创世区块开始向后遍历。</p></li>
<li><p>backward [可选]
表示本次查询的方向，false表示以起始位置为起点从高区块往低区块遍历，true表示以起
始位 置为起点从低区块往高区块遍历，默认查询方向为false。</p></li>
</ul>
<p>Bookmark 结构如下：</p>
<ul class="simple">
<li><p>blkNum 交易所在区块号。</p></li>
<li><p>txIndex 交易索引号，即交易在区块内的位置。</p></li>
</ul>
<p>FilterParam 结构如下：</p>
<ul class="simple">
<li><p>txHash [可选] 指定交易的哈希值。</p></li>
<li><p>blkNumber [可选] 指定交易所在的区块号。</p></li>
<li><p>txIndex [可选] 指定交易在区块内的索引位置。</p></li>
<li><p>txFrom [可选] 指定交易发送方的地址。</p></li>
<li><p>txTo [可选] 指定交易接收方的地址。</p></li>
<li><p>extraId [可选]
指定交易extraId的值，类型为数组，数组元素可以为long或者String。</p></li>
</ul>
<p>客户端可以利用该接口实现区块链的“分页查询”，根据返回结果里的 hasmore
来判断是否要继续查询剩下的数据。下面对该接口的参数做进一步说明：</p>
<p>如果查询条件未指定 metadata，则 metadata.backward 默认为
false、书签位置默认为最新区块最后一条交易，从书签位置开始往前遍历，limit默认为5000条。</p>
<p>如果查询条件里未指定 metadata.bookmark，若 metadata.backward 为
false，则默认书签位置为最新区块的最后一条交易，若 metadata.backward 为
true，则默认书签位置为第一个区块的第一条交易。</p>
<p>如果查询条件里指定的书签位置 metadata.bookmark 位于区块区间 [1, latest]
里， 则我们需要根据 metadata.backward 的值来调整遍历的区块区间。如果
metadata.backward 为false，则区块区间调整为 [1,
metadata.bookmark.blkNum]，如果 metadata.backward
为true，则区块区间调整为 [metadata.bookmark.blkNum, latest]。</p>
<p>当 backward 为 false
的时候，如果指定的书签位置在区块1之前，则接口返回error。当 backward 为
true 的时候，如果指定的书签位置在最新区块之后，则接口返回error。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxLimitResponse</span><span class="o">&gt;</span> <span class="nf">getTxsByFilter</span><span class="p">(</span><span class="kt">int</span> <span class="n">mode</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">detail</span><span class="p">,</span> <span class="n">MetaDataParam</span> <span class="n">metaData</span><span class="p">,</span> <span class="n">FilterParam</span> <span class="n">filter</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-hash-list-getbatchtxbyhash">
<h3>4.26 查询批量交易by hash list(getBatchTxByHash)<a class="headerlink" href="#by-hash-list-getbatchtxbyhash" title="Permalink to this headline">¶</a></h3>
<p>注意：当输入的交易哈希非常多时，<strong>请求响应延迟将升高</strong>。如果返回的数据量超过节点所在服务器内存大小时，将导致处理查询请求的节点出现<strong>OOM（Out
Of Memory）</strong>风险，可使用 <strong>tx_getTransactionByHash</strong> 接口替代。</p>
<p>参数：</p>
<ul class="simple">
<li><p>txHashList 交易的哈希数组, 哈希值为32字节的十六进制字符串。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxResponse</span><span class="o">&gt;</span> <span class="nf">getBatchTxByHash</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">txHashList</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-hash-list-getbatchreceipt">
<h3>4.27 查询批量回执by hash list(getBatchReceipt)<a class="headerlink" href="#by-hash-list-getbatchreceipt" title="Permalink to this headline">¶</a></h3>
<p>注意：当输入的交易哈希非常多时，<strong>请求响应延迟将升高</strong>。如果返回的数据量超过节点所在服务器内存大小时，将导致处理查询请求的节点出现<strong>OOM（Out
Of Memory）</strong>风险，可使用 <strong>tx_getTransactionReceipt</strong> 接口替代。</p>
<p>参数：</p>
<ul class="simple">
<li><p>txHashList 交易的哈希数组, 哈希值为32字节的十六进制字符串。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">ReceiptListResponse</span><span class="o">&gt;</span> <span class="nf">getBatchReceipt</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">txHashList</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="blockservice">
<h2>第五章. BlockService相关接口<a class="headerlink" href="#blockservice" title="Permalink to this headline">¶</a></h2>
<p>BlockService接口与TxService相似，只是获取的对象是区块信息。同样地，BlockService对象也有很多对应的响应类型：</p>
<ul class="simple">
<li><p>BlockResponse</p></li>
<li><p>BlockNumberResponse</p></li>
<li><p>BlockAvgTimeResponse</p></li>
<li><p>BlockCountResponse</p></li>
</ul>
<p>详细结构请参考第十章。</p>
<div class="section" id="getlastestblock">
<h3>5.1 获取最新区块(getLastestBlock)<a class="headerlink" href="#getlastestblock" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getLastestBlock</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-block-hash-getblockbyhash">
<h3>5.2 查询区块by block hash(getBlockByHash)<a class="headerlink" href="#by-block-hash-getblockbyhash" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>blockHash 区块的哈希值,32字节的十六进制字符串。</p></li>
<li><p>isPlain (可选)
默认为false，表示返回的区块<strong>包括</strong>区块内的交易信息，如果指定为true，表示返回的区块<strong>不包括</strong>区块内的交易。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getBlockByHash</span><span class="p">(</span><span class="n">String</span> <span class="n">blockHash</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getBlockByHash</span><span class="p">(</span><span class="n">String</span> <span class="n">blockHash</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">isPlain</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-block-number-getblockbynum">
<h3>5.3 查询区块by block number(getBlockByNum)<a class="headerlink" href="#by-block-number-getblockbynum" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>blockNumber 区块号。</p></li>
<li><p>isPlain (可选)
默认为false，表示返回的区块<strong>包括</strong>区块内的交易信息，如果指定为true，表示返回的区块<strong>不包括</strong>区块内的交易。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getBlockByNum</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">blockNumber</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getBlockByNum</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">blockNumber</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">isPlain</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getBlockByNum</span><span class="p">(</span><span class="n">String</span> <span class="n">blockNumber</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getBlockByNum</span><span class="p">(</span><span class="n">String</span> <span class="n">blockNumber</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">isPlain</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="getavggeneratetimebyblocknumber">
<h3>5.4 查询区块平均生成时间(getAvgGenerateTimeByBlockNumber)<a class="headerlink" href="#getavggeneratetimebyblocknumber" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>from 起始区块号。</p></li>
<li><p>to 终止区块号。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockAvgTimeResponse</span><span class="o">&gt;</span> <span class="nf">getAvgGenerateTimeByBlockNumber</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">from</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">to</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockAvgTimeResponse</span><span class="o">&gt;</span> <span class="nf">getAvgGenerateTimeByBlockNumber</span><span class="p">(</span><span class="n">String</span> <span class="n">from</span><span class="p">,</span> <span class="n">String</span> <span class="n">to</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="getchainheight">
<h3>5.5 查询最新区块号，即链高(getChainHeight)<a class="headerlink" href="#getchainheight" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockNumberResponse</span><span class="o">&gt;</span> <span class="nf">getChainHeight</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="getgenesisblock">
<h3>5.6 查询创世区块号(getGenesisBlock)<a class="headerlink" href="#getgenesisblock" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockNumberResponse</span><span class="o">&gt;</span> <span class="nf">getGenesisBlock</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="with-limit-getblockswithlimit">
<h3>5.7 查询指定区间区块with limit(getBlocksWithLimit)<a class="headerlink" href="#with-limit-getblockswithlimit" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>from 起始区块号。</p></li>
<li><p>to 终止区块号。</p></li>
<li><p>size 查询的区块数量</p></li>
<li><p>isPlain
(可选)，默认为false，表示返回的区块<strong>包括</strong>区块内的交易信息，如果指定为true，表示返回的区块<strong>不包括</strong>区块内的交易。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockLimitResponse</span><span class="o">&gt;</span> <span class="nf">getBlocksWithLimit</span><span class="p">(</span><span class="n">String</span> <span class="n">from</span><span class="p">,</span> <span class="n">String</span> <span class="n">to</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">isPlain</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockLimitResponse</span><span class="o">&gt;</span> <span class="nf">getBlocksWithLimit</span><span class="p">(</span><span class="n">String</span> <span class="n">from</span><span class="p">,</span> <span class="n">String</span> <span class="n">to</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">isPlain</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="getblocksbytime">
<h3>5.8 查询指定时间区间内的区块数量(getBlocksByTime)<a class="headerlink" href="#getblocksbytime" title="Permalink to this headline">¶</a></h3>
<p>注意：当输入的时间范围较大时，<strong>请求响应延迟将升高</strong>。存在服务器资源被该请求处理长时间占用的风险，应尽量避免使用此接口。</p>
<p>参数：</p>
<ul class="simple">
<li><p>startTime 起始时间戳(单位ns)。</p></li>
<li><p>endTime 结束时间戳(单位ns)。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockCountResponse</span><span class="o">&gt;</span> <span class="nf">getBlocksByTime</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">BigInteger</span> <span class="n">endTime</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockCountResponse</span><span class="o">&gt;</span> <span class="nf">getBlocksByTime</span><span class="p">(</span><span class="n">String</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">String</span> <span class="n">endTime</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-block-hash-list-getbatchblocksbyhash">
<h3>5.9 查询批量区块by block hash list(getBatchBlocksByHash)<a class="headerlink" href="#by-block-hash-list-getbatchblocksbyhash" title="Permalink to this headline">¶</a></h3>
<p>注意：当输入的区块哈希非常多时，<strong>请求响应延迟将升高</strong>。如果返回的数据量超过节点所在服务器内存大小时，将导致处理查询请求的节点出现<strong>OOM（Out
Of Memory）</strong>风险，可使用 <strong>tx_getBlockByHash</strong> 接口替代。</p>
<p>参数：</p>
<ul class="simple">
<li><p>blockHashList 要查询的区块哈希数组，哈希值为32字节的十六进制字符串。</p></li>
<li><p>isPlain (可选)
默认为false，表示返回的区块<strong>包括</strong>区块内的交易信息，如果指定为true，表示返回的区块<strong>不包括</strong>区块内的交易。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getBatchBlocksByHash</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">blockHashList</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getBatchBlocksByHash</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">blockHashList</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">isPlain</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="by-block-number-list-getbatchblocksbynum">
<h3>5.10 查询批量区块by block number list(getBatchBlocksByNum)<a class="headerlink" href="#by-block-number-list-getbatchblocksbynum" title="Permalink to this headline">¶</a></h3>
<p>注意：当输入的区块号非常多时，<strong>请求响应延迟将升高</strong>。如果返回的数据量超过节点所在服务器内存大小时，将导致处理查询请求的节点出现<strong>OOM（Out
Of Memory）</strong>风险，可使用 <strong>tx_getBlockByNumber</strong> 接口替代。</p>
<p>参数：</p>
<ul class="simple">
<li><p>blockNumberList 要查询的区块号数组。</p></li>
<li><p>isPlain (可选)
默认为false，表示返回的区块<strong>包括</strong>区块内的交易信息，如果指定为true，表示返回的区块<strong>不包括</strong>区块内的交易。</p></li>
<li><p>nodeIds 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getBatchBlocksByNum</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">blockNumberList</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getBatchBlocksByNum</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">blockNumberList</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">isPlain</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>重载方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getBatchBlocksByStrNum</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">blockNumberList</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">BlockResponse</span><span class="o">&gt;</span> <span class="nf">getBatchBlocksByStrNum</span><span class="p">(</span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">blockNumberList</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">isPlain</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="node-nodeservice">
<h2>第六章. Node相关接口（NodeService）<a class="headerlink" href="#node-nodeservice" title="Permalink to this headline">¶</a></h2>
<p>NodeService接口用于获取节点信息。NodeService对象对应的响应类型如下：</p>
<ul class="simple">
<li><p>NodeResponse</p></li>
<li><p>NodeHashResponse</p></li>
<li><p>NodeStateResponse</p></li>
</ul>
<p>分别对应的结构如下。</p>
<p><strong>NodeResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是内部类<code class="docutils literal notranslate"><span class="pre">Node</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NodeResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Node</span> <span class="p">{</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">ip</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">port</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">namespace</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">hash</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">hostname</span><span class="p">;</span>
        <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isPrimary</span><span class="p">;</span>
        <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">isvp</span><span class="p">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">delay</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">private</span> <span class="n">JsonElement</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>NodeHashResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是<code class="docutils literal notranslate"><span class="pre">String</span></code></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NodeHashResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>NodeStateResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是内部类<code class="docutils literal notranslate"><span class="pre">NodeState</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NodeStateResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">NodeState</span> <span class="p">{</span>
        <span class="nd">@Expose</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
             <span class="nd">@Expose</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">hostname</span><span class="p">;</span>
        <span class="nd">@Expose</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">hash</span><span class="p">;</span>
        <span class="nd">@Expose</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">status</span><span class="p">;</span>
        <span class="nd">@Expose</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">view</span><span class="p">;</span>
             <span class="nd">@Expose</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">epoch</span><span class="p">;</span>
             <span class="nd">@Expose</span>
        <span class="kd">private</span> <span class="kt">int</span> <span class="n">checkpoint</span><span class="p">;</span>
        <span class="nd">@Expose</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">blockHeight</span><span class="p">;</span>
        <span class="nd">@Expose</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">blockHash</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">private</span> <span class="n">JsonElement</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="id41">
<h3>6.1 获取节点信息<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>ids 说明请求向哪些节点发送。</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">NodeResponse</span><span class="o">&gt;</span> <span class="nf">getNodes</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">ids</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id42">
<h3>6.2 获取节点哈希<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>nodeIds 节点ID</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">NodeHashResponse</span><span class="o">&gt;</span> <span class="nf">getNodeHash</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="n">Request</span><span class="o">&lt;</span><span class="n">NodeHashResponse</span><span class="o">&gt;</span> <span class="nf">getNodeHashByID</span><span class="p">(</span><span class="kt">int</span> <span class="n">nodeId</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id43">
<h3>6.3 获取节点状态信息<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">NodeStateResponse</span><span class="o">&gt;</span> <span class="nf">getNodeStates</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mq-mqservice">
<h2>第七章. MQ相关接口(MQService)<a class="headerlink" href="#mq-mqservice" title="Permalink to this headline">¶</a></h2>
<p>MQService接口用于与<strong>RabbitMQ</strong>进行交互。由于开发时间较早，<code class="docutils literal notranslate"><span class="pre">MQService</span></code>对应的响应类型只有<code class="docutils literal notranslate"><span class="pre">MQResponse</span></code>一种，这与之前提到的接口都不太相同：</p>
<p><code class="docutils literal notranslate"><span class="pre">MQResponse</span></code>接口结构如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MQResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">JsonElement</span> <span class="n">result</span><span class="p">;</span>
     <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getQueueNames</span><span class="p">();</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getExchanger</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="mq">
<h3>7.1 通知MQ服务器正常工作<a class="headerlink" href="#mq" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>nodeIds 说明请求向某个节点发送，nodeIds有且只能有一个</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQResponse</span><span class="o">&gt;</span> <span class="nf">informNormal</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id44">
<h3>7.2 注册队列<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>from 调用该接口的账户地址</p></li>
<li><p>queueName 队列名称</p></li>
<li><p>routingkeys 想要订阅的消息类型</p></li>
<li><p>isVerbose 推送区块时是否推送交易列表，true表示是</p></li>
<li><p>nodeIds 说明请求向某个节点发送，nodeIds有且只能有一个</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQResponse</span><span class="o">&gt;</span> <span class="nf">registerQueue</span><span class="p">(</span><span class="n">String</span> <span class="n">from</span><span class="p">,</span> <span class="n">String</span> <span class="n">queueName</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">routingkeys</span><span class="p">,</span> <span class="n">Boolean</span> <span class="n">isVerbose</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="with-mqparam">
<h3>7.3 注册队列(with mqParam)<a class="headerlink" href="#with-mqparam" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>mqParam
注册队列所需参数，除了7.2中的参数外，新增了合约event事件的相关过滤参数</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQResponse</span><span class="o">&gt;</span> <span class="nf">registerQueue</span><span class="p">(</span><span class="n">MQParam</span> <span class="n">mqParam</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id45">
<h3>7.4 注销队列<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>from 调用该接口的账户地址</p></li>
<li><p>queueName 队列名称</p></li>
<li><p>exchangerName exchanger 名称</p></li>
<li><p>nodeIds 说明请求向某个节点发送，nodeIds有且只能有一个</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQResponse</span><span class="o">&gt;</span> <span class="nf">unRegisterQueue</span><span class="p">(</span><span class="n">String</span> <span class="n">from</span><span class="p">,</span> <span class="n">String</span> <span class="n">queueName</span><span class="p">,</span> <span class="n">String</span> <span class="n">exchangerName</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id46">
<h3>7.5 获取所有队列名称<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h3>
<p>参数</p>
<ul class="simple">
<li><p>nodeIds 说明请求向某个节点发送，nodeIds有且只能有一个</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQResponse</span><span class="o">&gt;</span> <span class="nf">getAllQueueNames</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="exchanger">
<h3>7.6 获取所有exchanger名称<a class="headerlink" href="#exchanger" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>nodeIds 说明请求向某个节点发送，nodeIds有且只能有一个</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQResponse</span><span class="o">&gt;</span> <span class="nf">getExchangerName</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id47">
<h3>7.7 删除exchanger<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>exchangerName exchanger名称</p></li>
<li><p>nodeIds 说明请求向某个节点发送，nodeIds有且只能有一个</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQResponse</span><span class="o">&gt;</span> <span class="nf">deleteExchanger</span><span class="p">(</span><span class="n">String</span> <span class="n">exchangerName</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mqgrpcservice">
<h2>第八章. MQGrpcService相关接口<a class="headerlink" href="#mqgrpcservice" title="Permalink to this headline">¶</a></h2>
<p>MQGrpcService依赖grpc服务提供MQ相关功能，无需依赖第三方软件进行消息推送。MQGrpcService的响应类型沿用了MQService的<code class="docutils literal notranslate"><span class="pre">MQResponse</span></code>，同时新增了<code class="docutils literal notranslate"><span class="pre">MQGrpcConsumeResponse</span></code>作为消费接口的响应类型。</p>
<p>注意：在使用此服务时，创建ProviderManager对象时，必须提供grpcProvider。</p>
<p>MQResponse为注册队列、注销队列、获取队列名称、停止消费接口的响应类型</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MQResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="n">JsonElement</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">MQGrpcConsumeResponse</span></code>为消费MQ信息接口的响应类型，仅提供一个<code class="docutils literal notranslate"><span class="pre">getResult</span></code>方法，返回值为实现了Iterator接口的<code class="docutils literal notranslate"><span class="pre">ServerStreamManager</span></code>对象。用户可以通过<code class="docutils literal notranslate"><span class="pre">next</span></code>方法不停的获取来自平台的MQ消息，如果平台没有新的消息产生，则next方法会阻塞。MQ消息可通过<code class="docutils literal notranslate"><span class="pre">Decoder.decodeMQMessage</span></code>方法进行解析。</p>
<p>注意：队列A，在同一时刻，只能被一个客户端消费。即对于在一号节点注册的队列A，如果客户端甲已经调用consume接口消费了该队列，那么在这个时刻，客户端乙将无法同时消费队列A。只有当客户端甲调用stopConsume接口，停止消费队列A之后，客户端乙才可以消费队列A。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MQGrpcConsumeResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">ServerStreamManager</span> <span class="n">manager</span><span class="p">;</span>
    <span class="kd">public</span> <span class="n">ServerStreamManager</span> <span class="nf">getResult</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerStreamManager</span> <span class="kd">extends</span> <span class="n">Manager</span> <span class="kd">implements</span> <span class="n">Iterator</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">Transaction</span><span class="p">.</span><span class="na">CommonRes</span><span class="o">&gt;</span> <span class="n">commonResIterator</span><span class="p">;</span>
     <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasNext</span><span class="p">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">next</span><span class="p">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// mq消费示例</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testMQ_GRPC_Consume</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">RequestException</span> <span class="p">{</span>
             <span class="n">Request</span><span class="o">&lt;</span><span class="n">MQGrpcConsumeResponse</span><span class="o">&gt;</span> <span class="n">request</span> <span class="o">=</span> <span class="n">mqGrpcService</span><span class="p">.</span><span class="na">consume</span><span class="p">(</span><span class="s">&quot;queueName&quot;</span><span class="p">,</span> <span class="n">nodeId</span><span class="p">);</span>
    <span class="n">MQGrpcConsumeResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="na">send</span><span class="p">();</span>
    <span class="n">ServerStreamManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="na">getResult</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">manager</span><span class="p">.</span><span class="na">hasNext</span><span class="p">())</span> <span class="p">{</span>
     <span class="n">String</span> <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">manager</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Decoder</span><span class="p">.</span><span class="na">decodeMQMessage</span><span class="p">(</span><span class="n">res</span><span class="p">));</span>
      <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Decoder</span><span class="p">.</span><span class="na">decodeMQMessage</span><span class="p">(</span><span class="n">res</span><span class="p">).</span><span class="na">getBody</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="id48">
<span id="id49"></span><h3>8.1 注册队列<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>from 调用该接口的账户地址</p></li>
<li><p>queueName 队列名称</p></li>
<li><p>routingkeys 想要订阅的消息类型</p></li>
<li><p>isVerbose 推送区块时是否推送交易列表，true表示是</p></li>
<li><p>nodeIds 说明请求向某个节点发送，nodeIds有且只能有一个</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQResponse</span><span class="o">&gt;</span> <span class="nf">registerQueue</span><span class="p">(</span><span class="n">String</span> <span class="n">from</span><span class="p">,</span> <span class="n">String</span> <span class="n">queueName</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">routingkeys</span><span class="p">,</span> <span class="n">Boolean</span> <span class="n">isVerbose</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
<p>参数：</p>
<ul class="simple">
<li><p>mqParam
注册队列所需参数，除了上述方法中的参数外，新增了合约event事件的相关过滤参数</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQResponse</span><span class="o">&gt;</span> <span class="nf">registerQueue</span><span class="p">(</span><span class="n">MQParam</span> <span class="n">mqParam</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id50">
<span id="id51"></span><h3>8.2 注销队列<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>from 调用该接口的账户地址</p></li>
<li><p>queueName 队列名称</p></li>
<li><p>exchangerName exchanger 名称</p></li>
<li><p>nodeIds 说明请求向某个节点发送，nodeIds有且只能有一个</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQResponse</span><span class="o">&gt;</span> <span class="nf">unRegisterQueue</span><span class="p">(</span><span class="n">String</span> <span class="n">queueName</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id52">
<span id="id53"></span><h3>8.3 获取所有队列名称<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h3>
<p>参数</p>
<ul class="simple">
<li><p>nodeIds 说明请求向某个节点发送，nodeIds有且只能有一个</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQResponse</span><span class="o">&gt;</span> <span class="nf">getAllQueueNames</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id54">
<h3>8.4 消费MQ信息<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h3>
<p>注意：本消费接口使用完之后，应及时调用停止消费MQ信息接口，不然该队列无法被再次消费。</p>
<p>参数</p>
<ul class="simple">
<li><p>queueName 队列名称</p></li>
<li><p>nodeIds 说明请求向某个节点发送，nodeIds有且只能有一个</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQGrpcConsumeResponse</span><span class="o">&gt;</span> <span class="nf">consume</span><span class="p">(</span><span class="n">String</span> <span class="n">queueName</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id55">
<h3>8.5 停止消费MQ信息<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h3>
<p>参数</p>
<ul class="simple">
<li><p>queueName 队列名称</p></li>
<li><p>nodeIds 说明请求向某个节点发送，nodeIds有且只能有一个</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">MQResponse</span><span class="o">&gt;</span> <span class="nf">stopConsume</span><span class="p">(</span><span class="n">String</span> <span class="n">queueName</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="archiveservice">
<h2>第九章. ArchiveService相关接口<a class="headerlink" href="#archiveservice" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ArchiveService</span></code>接口用于快照和归档相关工作，对应的响应类型如下：</p>
<ul class="simple">
<li><p>ArchiveResponse</p></li>
<li><p>ArchiveFilterIdResponse</p></li>
<li><p>ArchiveBoolResponse</p></li>
<li><p>ArchiveStringResponse</p></li>
</ul>
<p>详细结构请参考第十章。</p>
<div class="section" id="id56">
<h3>9.1 列出所有快照<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">ArchiveResponse</span><span class="o">&gt;</span> <span class="nf">listSnapshot</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id57">
<h3>9.2 数据归档（直接归档）<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>blkNumber 区块号</p></li>
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">ArchiveStringResponse</span><span class="o">&gt;</span> <span class="nf">archiveNoPredict</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">blkNumber</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id58">
<h3>9.3 查询归档数据状态<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>filterId 快照id</p></li>
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">ArchiveStringResponse</span><span class="o">&gt;</span> <span class="nf">queryArchive</span><span class="p">(</span><span class="n">String</span> <span class="n">filterId</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id59">
<h3>9.4 查询归档数据是否存在<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>filterId 快照id</p></li>
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">ArchiveBoolResponse</span><span class="o">&gt;</span> <span class="nf">queryArchiveExist</span><span class="p">(</span><span class="n">String</span> <span class="n">filterId</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id60">
<h3>9.5 查询最近一次归档的进度<a class="headerlink" href="#id60" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">ArchiveLatestResponse</span><span class="o">&gt;</span> <span class="nf">queryLatestArchive</span><span class="p">(</span><span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id61">
<h3>9.6 制作快照<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>blockNumber 区块号</p></li>
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">ArchiveFilterIdResponse</span><span class="o">&gt;</span> <span class="nf">snapshot</span><span class="p">(</span><span class="n">BigInteger</span> <span class="n">blockNumber</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sqlservice">
<h2>第十章. SqlService相关接口<a class="headerlink" href="#sqlservice" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sql">
<h3>10.1 创建SQL交易体<a class="headerlink" href="#sql" title="Permalink to this headline">¶</a></h3>
<p><strong>LiteSDK</strong>使用<strong>Builder</strong>模式来负责对<code class="docutils literal notranslate"><span class="pre">Transaction</span></code>的创建，通过调用<code class="docutils literal notranslate"><span class="pre">build()</span></code>函数来获取到<code class="docutils literal notranslate"><span class="pre">Transaction</span></code>实例。SQL交易体由SQLBuilder负责创建，其提供了5种SQL交易体的封装，包括<strong>创建数据库</strong>、<strong>冻结数据库</strong>、<strong>解冻数据库</strong>、<strong>删除数据库</strong>、<strong>调用SQL</strong>。</p>
<p><strong>创建数据库</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">SQLBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span>
  <span class="n">create</span><span class="p">().</span>
  <span class="n">build</span><span class="p">();</span>
</pre></div>
</div>
<p><strong>冻结数据库</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">SQLBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span>
  <span class="n">freeze</span><span class="p">(</span><span class="n">databaseAddr</span><span class="p">).</span>
  <span class="n">build</span><span class="p">();</span>
</pre></div>
</div>
<p><strong>解冻数据库</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">SQLBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span>
  <span class="n">unfreeze</span><span class="p">(</span><span class="n">databaseAddr</span><span class="p">).</span>
  <span class="n">build</span><span class="p">();</span>
</pre></div>
</div>
<p><strong>删除数据库</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">SQLBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span>
  <span class="n">destroy</span><span class="p">(</span><span class="n">databaseAddr</span><span class="p">).</span>
  <span class="n">build</span><span class="p">();</span>
</pre></div>
</div>
<p><strong>调用SQL</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">SQLBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span>
  <span class="n">invoke</span><span class="p">(</span><span class="n">databaseAddr</span><span class="p">,</span> <span class="n">SQLStr</span><span class="p">).</span>
  <span class="n">build</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id62">
<h3>10.2 创建数据库<a class="headerlink" href="#id62" title="Permalink to this headline">¶</a></h3>
<p>创建数据库交易成功后，可通过交易回执查询创建的数据库地址。</p>
<p>参数：</p>
<ul class="simple">
<li><p>transaction 创建数据库的交易体</p></li>
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//方式一</span>
<span class="n">Request</span><span class="o">&lt;</span><span class="n">TxHashResponse</span><span class="o">&gt;</span> <span class="nf">create</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="c1">//方式二（设置GrpcProvider方可使用）</span>
<span class="n">Request</span><span class="o">&lt;</span><span class="n">ReceiptResponse</span><span class="o">&gt;</span> <span class="nf">grpcInvokeReturnReceipt</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id63">
<h3>10.3 管理数据库生命周期<a class="headerlink" href="#id63" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>transaction
管理数据库生命周期的交易体，即冻结数据库、解冻数据库或者删除数据库的交易体</p></li>
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//方式一</span>
<span class="n">Request</span><span class="o">&lt;</span><span class="n">TxHashResponse</span><span class="o">&gt;</span> <span class="nf">maintain</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="c1">//方式二（设置GrpcProvider方可使用）</span>
<span class="n">Request</span><span class="o">&lt;</span><span class="n">ReceiptResponse</span><span class="o">&gt;</span> <span class="nf">grpcMaintainReturnReceipt</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id64">
<h3>10.4 调用SQL<a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h3>
<p>参数：</p>
<ul class="simple">
<li><p>transaction 调用SQL的交易体</p></li>
<li><p>nodeIds 说明请求向哪些节点发送</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//方式一</span>
<span class="n">Request</span><span class="o">&lt;</span><span class="n">TxHashResponse</span><span class="o">&gt;</span> <span class="nf">invoke</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>

<span class="c1">//方式二（设置GrpcProvider方可使用）</span>
<span class="n">Request</span><span class="o">&lt;</span><span class="n">ReceiptResponse</span><span class="o">&gt;</span> <span class="nf">grpcInvokeReturnReceipt</span><span class="p">(</span><span class="n">Transaction</span> <span class="n">transaction</span><span class="p">,</span> <span class="kt">int</span><span class="p">...</span> <span class="n">nodeIds</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id65">
<h3>10.5 SQL执行结果解码<a class="headerlink" href="#id65" title="Permalink to this headline">¶</a></h3>
<p>类似于HVM，SQL的执行结果解码方法在Decoder类中</p>
<p>参数：</p>
<ul class="simple">
<li><p>encode sql的执行结果，即sql交易的回执</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">Chunk</span> <span class="nf">decodeKVSQL</span><span class="p">(</span><span class="n">String</span> <span class="n">encode</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="chunk">
<h3>10.6 Chunk结构的使用<a class="headerlink" href="#chunk" title="Permalink to this headline">¶</a></h3>
<p>chunk结构保存了sql的执行结果，使用方法类似于jdbc的ResultSet</p>
<p><strong>10.6.1 DML语句</strong></p>
<p>对于DML语句，通过getUpdateCount方法可以获得sql语句对应的修改行数</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">long</span> <span class="nf">getUpdateCount</span><span class="p">();</span>
</pre></div>
</div>
<p>也可以通过getLastInsertID获得插入的自增键</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">long</span> <span class="nf">getLastInsertID</span><span class="p">();</span>
</pre></div>
</div>
<p><strong>10.6.2 DQL语句</strong></p>
<p>对于DQL语句，chunk的使用方法类似于jdbc的ResultSet</p>
<p>调用next接口将游标移动到查询结果的下一行，游标初始位置为第一行之前。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">next</span><span class="p">();</span>
</pre></div>
</div>
<p>如果返回结果为false表示游标已经移动到最后一行之后了。</p>
<p>调用getValue接口将获得游标指向的当前行以及参数对应列所指向的数据的值。返回结果的类型取决于该列在数据库表中的数据类型。</p>
<p>参数</p>
<ul class="simple">
<li><p>columnIdex 列坐标，范围为[0,n-1]，n为列的数量</p></li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">Object</span> <span class="nf">getValue</span><span class="p">(</span><span class="kt">int</span> <span class="n">columnIndex</span><span class="p">);</span>
</pre></div>
</div>
<p>chunk同时也提供指定类型的数据获取的方法，对应方法如下，XXX表示类型，如getFloat，getTime等。该类使用方法与getValue一致，不过需要注意的是，XXX类型必须和数据库表中该列的类型一致或者能过相互转换，否则无法获得正确的结果或者会抛出异常。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">XXX</span> <span class="nf">getXXX</span><span class="p">(</span><span class="kt">int</span> <span class="n">columnIndex</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id66">
<h2>第十一章. 接口响应类型结构体介绍<a class="headerlink" href="#id66" title="Permalink to this headline">¶</a></h2>
<div class="section" id="txservice">
<h3>11.1 TxService接口对应的响应类型<a class="headerlink" href="#txservice" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>TxResponse</p></li>
<li><p>TxCountWithTSResponse</p></li>
<li><p>TxCountResponse</p></li>
<li><p>TxAvgTimeResponse</p></li>
<li><p>ReceiptListResponse</p></li>
</ul>
<p>分别对应的结构如下：</p>
<p><strong>TxResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际结构是内部类<code class="docutils literal notranslate"><span class="pre">Transaction</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TxResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Transaction</span> <span class="p">{</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">version</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">hash</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">blockNumber</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">blockHash</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">txIndex</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">from</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">to</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">amount</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">timestamp</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">nonce</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">extra</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">executeTime</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">payload</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">signature</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">blockTimestamp</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">blockWriteTime</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">private</span> <span class="n">JsonElement</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>TxCountWithTSResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是内部类<code class="docutils literal notranslate"><span class="pre">TxCount</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TxCountWithTSResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TxCount</span> <span class="p">{</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">count</span><span class="p">;</span>
        <span class="kd">private</span> <span class="kt">long</span> <span class="n">timestamp</span><span class="p">;</span>
             <span class="kd">private</span> <span class="n">String</span> <span class="n">lastIndex</span><span class="p">;</span>
             <span class="kd">private</span> <span class="n">String</span> <span class="n">lastBlockNum</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">protected</span> <span class="n">JsonElement</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>TxCountResponse</strong></p>
<p>继承<code class="docutils literal notranslate"><span class="pre">TxCountWithTSResponse</span></code>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是<code class="docutils literal notranslate"><span class="pre">TxCount</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TxCountResponse</span> <span class="kd">extends</span> <span class="n">TxCountWithTSResponse</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>TxAvgTimeResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是<code class="docutils literal notranslate"><span class="pre">String</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TxAvgTimeResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>ReceiptListResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是内部类<code class="docutils literal notranslate"><span class="pre">Receipt</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReceiptListResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">ReceiptResponse</span><span class="p">.</span><span class="na">Receipt</span><span class="o">&gt;</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Receipt</span></code>结构如下</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Receipt</span> <span class="p">{</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">contractAddress</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">ret</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">txHash</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">EventLog</span><span class="o">[]</span> <span class="n">log</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">vmType</span><span class="p">;</span>
        <span class="kd">private</span> <span class="kt">long</span> <span class="n">gasUsed</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">version</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id67">
<h3>11.2 BlockService接口对应的响应类型<a class="headerlink" href="#id67" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>BlockResponse</p></li>
<li><p>BlockNumberResponse</p></li>
<li><p>BlockAvgTimeResponse</p></li>
<li><p>BlockCountResponse</p></li>
</ul>
<p>分别对应的结构如下。</p>
<p><strong>BlockResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是内部类<code class="docutils literal notranslate"><span class="pre">Block</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlockResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Block</span> <span class="p">{</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">version</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">number</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">hash</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">parentHash</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">writeTime</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">avgTime</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">txcounts</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">merkleRoot</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">private</span> <span class="n">JsonElement</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>BlockNumberResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是<code class="docutils literal notranslate"><span class="pre">String</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlockNumberResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>BlockAvgTimeResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是<code class="docutils literal notranslate"><span class="pre">String</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlockAvgTimeResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="nd">@Expose</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>BlockCountResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际类型是内部类<code class="docutils literal notranslate"><span class="pre">BlockCount</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlockCountResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlockCount</span> <span class="p">{</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">sumOfBlocks</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">startBlock</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">endBlock</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">private</span> <span class="n">BlockCount</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id68">
<h3>11.3 ArchiveService接口对应的响应类型<a class="headerlink" href="#id68" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>ArchiveResponse</p></li>
<li><p>ArchiveFilterIdResponse</p></li>
<li><p>ArchiveBoolResponse</p></li>
<li><p>ArchiveStringResponse</p></li>
</ul>
<p>分别对应的结构如下：</p>
<p><strong>ArchiveResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际结构是内部类<code class="docutils literal notranslate"><span class="pre">Archive</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArchiveResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Archive</span> <span class="p">{</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">height</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">hash</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">filterId</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">merkleRoot</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">date</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">namespace</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="n">JsonElement</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>ArchiveFilterIdResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际结构是<code class="docutils literal notranslate"><span class="pre">String</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArchiveFilterIdResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>ArchiveBoolResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际结构是<code class="docutils literal notranslate"><span class="pre">Boolean</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArchiveBoolResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">Boolean</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>ArchiveStringResponse</strong></p>
<p>通过<code class="docutils literal notranslate"><span class="pre">result</span></code>接收返回结果，<code class="docutils literal notranslate"><span class="pre">result</span></code>实际结构是<code class="docutils literal notranslate"><span class="pre">String</span></code>，可通过<code class="docutils literal notranslate"><span class="pre">getResult()</span></code>方法得到。</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArchiveBoolResponse</span> <span class="kd">extends</span> <span class="n">Response</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id69">
<h2>附录<a class="headerlink" href="#id69" title="Permalink to this headline">¶</a></h2>
<div class="section" id="a-solidityjava">
<h3>附录 A Solidity与Java的编码解码<a class="headerlink" href="#a-solidityjava" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id70">
<h4>类型对应<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h4>
<p>当使用<strong>LiteSDK</strong>编译solidity合约时，由于java和solidity本身类型的不兼容，所以在调用solidity方法传参数的时候需要对java类型进行相应的编码解码，LiteSDK内部的<code class="docutils literal notranslate"><span class="pre">Abi</span></code>类，<strong>与solidity的abi文件对应，用来提供solidity合约的函数入参、返回值等信息</strong>，方便我们对solidity类型和java类型做转换，目前Litesdk支持的对应类型如下：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 36%" />
<col style="width: 64%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>JAVA</p></th>
<th class="head"><p>SOLIDITY</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">boolean/Boolean</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">BigInteger</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int、int8、int16……int256</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">BigInteger</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">uint、uint8、uint16……uint256</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">String</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">byte[]/Byte[]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bytes、bytes1、bytes2……bytes32</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">address</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Array</span></code>/<code class="docutils literal notranslate"><span class="pre">List</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">array</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id71">
<h4>编码<a class="headerlink" href="#id71" title="Permalink to this headline">¶</a></h4>
<p>编码时需要提供以下信息：</p>
<ul class="simple">
<li><p>solidity合约对应的abi对象，</p></li>
<li><p>调用方法名</p></li>
<li><p>封装后的java参数</p></li>
</ul>
<p>实现java与solidity之间的类型转换。（注：如果是部署需要提供bin文件，具体参照<a class="reference external" href="#部署合约">部署合约</a>一节）</p>
</div>
</div>
<div class="section" id="abi">
<h3>Abi对象<a class="headerlink" href="#abi" title="Permalink to this headline">¶</a></h3>
<p>通过<strong>LiteSDK</strong>提供的<code class="docutils literal notranslate"><span class="pre">FileUtil</span></code>工具类读取文件内容得到abi字符串，并利用<code class="docutils literal notranslate"><span class="pre">Abi</span></code>类的<code class="docutils literal notranslate"><span class="pre">fromJson</span></code>方法生成封装的Abi对象，使用方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">InputStream</span> <span class="n">abiIs</span> <span class="o">=</span> <span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getContextClassLoader</span><span class="p">().</span><span class="na">getResourceAsStream</span><span class="p">(</span><span class="s">&quot;xxx.abi&quot;</span><span class="p">);</span>
<span class="n">String</span> <span class="n">abiStr</span> <span class="o">=</span> <span class="n">FileUtil</span><span class="p">.</span><span class="na">readFile</span><span class="p">(</span><span class="n">abiIs</span><span class="p">);</span>
<span class="n">Abi</span> <span class="n">abi</span> <span class="o">=</span> <span class="n">Abi</span><span class="p">.</span><span class="na">fromJson</span><span class="p">(</span><span class="n">abiStr</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="id72">
<h3>调用方法名<a class="headerlink" href="#id72" title="Permalink to this headline">¶</a></h3>
<p>调用方法名需要按格式<code class="docutils literal notranslate"><span class="pre">$(method_name)(type1[,type2…])</span></code>填，假如solidity的函数签名为</p>
<div class="highlight-solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">function</span><span class="w"> </span><span class="nv">TestUint</span><span class="p">(</span><span class="kt">uint8</span><span class="w"> </span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">return</span><span class="w"> </span>a<span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>则我们提供的调用方法名为<code class="docutils literal notranslate"><span class="pre">TestUint(uint8)</span></code>，如果函数多个参数，则调用方法名的类型之间用<strong>,</strong>分隔。</p>
</div>
<div class="section" id="java">
<h3>封装的java参数<a class="headerlink" href="#java" title="Permalink to this headline">¶</a></h3>
<p><strong>LiteSDK</strong>提供了<code class="docutils literal notranslate"><span class="pre">FuncParams</span></code>工具类封装<strong>需要转换成solidity类型的java参数</strong>，使用方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">FuncParams</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FuncParams</span><span class="p">();</span>
<span class="c1">// param 是类型对应表里对应的java参数</span>
<span class="n">params</span><span class="p">.</span><span class="na">addParams</span><span class="p">(</span><span class="n">param1</span><span class="p">);</span>
<span class="n">params</span><span class="p">.</span><span class="na">addParams</span><span class="p">(</span><span class="n">param2</span><span class="p">);</span>

<span class="c1">// 构造交易时将构造好的FuncParams对象传进去</span>
<span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span><span class="na">EVMBuilder</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span><span class="na">invoke</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">method_name</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">abi</span><span class="p">,</span> <span class="n">params</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
<div class="section" id="id73">
<h4>解码<a class="headerlink" href="#id73" title="Permalink to this headline">¶</a></h4>
<p>解码与编码类似，需要提供<strong>Abi对象、方法名和编码的solidity结果</strong>，具体可见<a class="reference external" href="#编码">编码</a>一节。</p>
<p>调用evm合约得到交易回执<code class="docutils literal notranslate"><span class="pre">ReceiptResponse</span></code>后，需要对solidity合约的返回值进行解析，使用方法如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">receiptResponse</span><span class="p">.</span><span class="na">getRet</span><span class="p">();</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">fromHex</span> <span class="o">=</span> <span class="n">ByteUtil</span><span class="p">.</span><span class="na">fromHex</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>

<span class="c1">// 通过abi的方法名解码，由于返回值可能有多个，所以解码得到的其实是一个List&lt;?&gt;，当中的每个对象</span>
<span class="c1">// 对应一个返回值。如该例子返回值为 int256，在java中对应的是BigInter，所以对返回的decodeResult</span>
<span class="c1">// 遍历强转为BigInteger</span>
<span class="n">List</span><span class="o">&lt;?&gt;</span> <span class="n">decodeResult</span> <span class="o">=</span> <span class="n">abi</span><span class="p">.</span><span class="na">getFunction</span><span class="p">(</span><span class="s">&quot;TestInt(int256)&quot;</span><span class="p">).</span><span class="na">decodeResult</span><span class="p">(</span><span class="n">fromHex</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="n">Object</span> <span class="n">result</span> <span class="p">:</span> <span class="n">decodeResult</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getClass</span><span class="p">());</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(((</span><span class="n">BigInteger</span><span class="p">)</span> <span class="n">result</span><span class="p">).</span><span class="na">toString</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="b-hvm">
<h3>附录B HVM合约相关使用方式<a class="headerlink" href="#b-hvm" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id74">
<h4>直接调用HVM合约方法的参数封装<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h4>
<p>直接调用HVM合约方法封装参数需要用到类<code class="docutils literal notranslate"><span class="pre">InvokeDirectlyParams</span></code>。</p>
<p>示例如下：</p>
<p>假设调用合约方法<code class="docutils literal notranslate"><span class="pre">add(int</span> <span class="pre">a,</span> <span class="pre">int</span> <span class="pre">b)</span></code>，传入参数（10，100）；</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// 构造函数传入想要调用的方法名</span>
<span class="n">InvokeDirectlyParams</span><span class="p">.</span><span class="na">ParamBuilder</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InvokeDirectlyParams</span><span class="p">.</span><span class="na">ParamBuilder</span><span class="p">(</span><span class="s">&quot;add&quot;</span><span class="p">);</span>
<span class="c1">// 方法addxxx分别构造不同类型的参数</span>
<span class="n">params</span><span class="p">.</span><span class="na">addint</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="n">params</span><span class="p">.</span><span class="na">addint</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="n">InvokeDirectlyParams</span><span class="p">.</span><span class="na">params</span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="id75">
<h4>HVM合约交易回执解码<a class="headerlink" href="#id75" title="Permalink to this headline">¶</a></h4>
<p>调用HVM（Java）合约后，获取到的交易回执可以使用`Decoder.decodeHVM进行解码。</p>
<p>示例如下：</p>
<p>假设调用合约方法<code class="docutils literal notranslate"><span class="pre">public</span> <span class="pre">Integer</span> <span class="pre">add(int</span> <span class="pre">a,</span> <span class="pre">int</span> <span class="pre">b)</span></code>，返回值类型是Integer；</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ReceiptResponse</span> <span class="n">receiptResponse</span> <span class="o">=</span> <span class="n">contractService</span><span class="p">.</span><span class="na">deploy</span><span class="p">(</span><span class="n">transaction</span><span class="p">).</span><span class="na">send</span><span class="p">().</span><span class="na">polling</span><span class="p">();</span>
<span class="n">Integer</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Decoder</span><span class="p">.</span><span class="na">decodeHVM</span><span class="p">(</span><span class="n">receiptResponse</span><span class="p">.</span><span class="na">getRet</span><span class="p">(),</span> <span class="n">Integer</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="c1">//传入合约方法的返回值类型</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="c">
<h3>附录C 平台错误码和对应原因<a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 88%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>code</strong></p></th>
<th class="head"><p><strong>含义</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>请求成功</p></td>
</tr>
<tr class="row-odd"><td><p>-32700</p></td>
<td><p>服务端接收到无效的json。该错误发送于服务器尝试解析json文本</p></td>
</tr>
<tr class="row-even"><td><p>-32600</p></td>
<td><p>无效的请求（比如非法的JSON格式）</p></td>
</tr>
<tr class="row-odd"><td><p>-32601</p></td>
<td><p>方法不存在或者无效</p></td>
</tr>
<tr class="row-even"><td><p>-32602</p></td>
<td><p>无效的方法参数</p></td>
</tr>
<tr class="row-odd"><td><p>-32000</p></td>
<td><p>Hyperchain内部错误或者空指针或者节点未安装solidity环境</p></td>
</tr>
<tr class="row-even"><td><p>-32001</p></td>
<td><p>查询的数据不存在</p></td>
</tr>
<tr class="row-odd"><td><p>-32002</p></td>
<td><p>余额不足</p></td>
</tr>
<tr class="row-even"><td><p>-32003</p></td>
<td><p>签名非法</p></td>
</tr>
<tr class="row-odd"><td><p>-32004</p></td>
<td><p>合约部署出错</p></td>
</tr>
<tr class="row-even"><td><p>-32005</p></td>
<td><p>合约调用出错</p></td>
</tr>
<tr class="row-odd"><td><p>-32006</p></td>
<td><p>系统繁忙(平台需要处理交易量达到限制)</p></td>
</tr>
<tr class="row-even"><td><p>-32007</p></td>
<td><p>交易重复</p></td>
</tr>
<tr class="row-odd"><td><p>-32008</p></td>
<td><p>合约操作权限不够</p></td>
</tr>
<tr class="row-even"><td><p>-32009</p></td>
<td><p>账户不存在</p></td>
</tr>
<tr class="row-odd"><td><p>-32010</p></td>
<td><p>namespace不存在</p></td>
</tr>
<tr class="row-even"><td><p>-32011</p></td>
<td><p>账本上无区块产生，查询最新区块的时候可能抛出该错误</p></td>
</tr>
<tr class="row-odd"><td><p>-32012</p></td>
<td><p>订阅不存在</p></td>
</tr>
<tr class="row-even"><td><p>-32013</p></td>
<td><p>数据归档、快照相关错误</p></td>
</tr>
<tr class="row-odd"><td><p>-32021</p></td>
<td><p>过时接口</p></td>
</tr>
<tr class="row-even"><td><p>-32097</p></td>
<td><p>Hypercli用户令牌无效</p></td>
</tr>
<tr class="row-odd"><td><p>-32098</p></td>
<td><p>请求未带cert或者错误cert导致认证失败</p></td>
</tr>
<tr class="row-even"><td><p>-32099</p></td>
<td><p>请求tcert失败</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>参数错误(指定节点发送时，指定index错误)</p></td>
</tr>
<tr class="row-even"><td><p>-9993</p></td>
<td><p>文件下载失败</p></td>
</tr>
<tr class="row-odd"><td><p>-9994</p></td>
<td><p>FileMgrHttpProvider不支持的request类型请求</p></td>
</tr>
<tr class="row-even"><td><p>-9995</p></td>
<td><p>请求失败(通常是请求体过长)</p></td>
</tr>
<tr class="row-odd"><td><p>-9996</p></td>
<td><p>请求失败(通常是请求消息错误)</p></td>
</tr>
<tr class="row-even"><td><p>-9997</p></td>
<td><p>异步请求失败</p></td>
</tr>
<tr class="row-odd"><td><p>-9998</p></td>
<td><p>请求超时(轮询结束未获得回执)</p></td>
</tr>
<tr class="row-even"><td><p>-9999</p></td>
<td><p>获取平台响应失败</p></td>
</tr>
</tbody>
</table>
<p>上述为平台api和sdk接口可能返回的状态码的说明，其中-999x的状态码为sdk对平台返回状态码或网络请求结果的封装，简化上层处理逻辑；其余状态码为平台api接口的原生返回结果。</p>
<p>在通过LiteSDK调用查询接口时，例如查询交易Hash对应的交易回执或者通过区块号查询区块内容时，LiteSDK将不会对查询接口进行交易状态码的封装，返回原生状态码，查询结果即为平台返回结果；当发生网络断连问题导致查询接口无法获得Response时，将返回-999x状态码。</p>
<p>当通过LiteSDK发送交易时，由于平台执行交易为异步执行，通过先返回交易Hash，在通过交易Hash查询回执的方式，所以LiteSDK将发送交易和查询交易回执进行了拆分，一个完整的发送交易并获得回执过程如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Request</span><span class="o">&lt;</span><span class="n">TxHashResponse</span><span class="o">&gt;</span> <span class="n">request</span> <span class="o">=</span> <span class="n">sendTxService</span><span class="p">.</span><span class="na">sendTx</span><span class="p">(</span><span class="n">transaction</span><span class="p">);</span>
<span class="n">TxHashResponse</span> <span class="n">txHashResponse</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="na">send</span><span class="p">();</span>
<span class="n">ReceiptResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">txHashResponse</span><span class="p">.</span><span class="na">polling</span><span class="p">();</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>通过调用<code class="docutils literal notranslate"><span class="pre">request.send()</span></code>将交易发送到链上，</p>
<ol class="arabic simple">
<li><p>返回状态码为0并获取交易Hash表示交易已成功上链</p></li>
<li><p>当出现-9995或者-9996时表示请求返送失败，交易未上链</p></li>
<li><p><strong>当出现-9999时表示网络出现断连，此时无法确定是交易还未发送成功还是获取Response时出现错误，不明确错误原因</strong></p></li>
<li><p>其余情况均为平台返回交易上链失败错误，交易未上链</p></li>
</ol>
</li>
<li><p>通过调用<code class="docutils literal notranslate"><span class="pre">txHashResponse.polling()</span></code>可以
通过交易Hash获取交易回执：</p>
<ol class="arabic simple">
<li><p>返回状态码为0时表示查找回执成功，交易执行成功</p></li>
<li><p><strong>由于轮询查找回执时可能平台尚未完成交易执行(-32001)、平台达到流量限制(-32006)或网络抖动(-9996,-9999)等原因，轮询过程将持续到轮询次数结束，此时若任未获取到回执，将抛出-9998的错误，此时表示轮询查询回执不成功，可能平台尚未执行完该笔交易，不明确错误原因</strong></p></li>
<li><p>其余情况下轮询获取到回执均表示查找回执成功，但交易执行失败，成为非法交易</p></li>
</ol>
</li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016-2023, Hangzhou Hyperchain Technology Co., Ltd..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>