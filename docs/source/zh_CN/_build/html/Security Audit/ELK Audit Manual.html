

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>ELK 审计使用手册 &mdash; hyperchain  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> hyperchain
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">平台介绍:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">平台介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Version%20information.html">版本信息</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">快速入门:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../General%20Concepts.html">通用概念</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Prepare.html">准备工作</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Deployedfile.html">部署运维</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">基础协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../consensus%20mechanism.html">共识机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Networking%20protocol.html">网络协议</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution%20engine.html">执行引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Storage%20model.html">存储模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security%20mechanism.html">加密机制</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">扩展协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Architecture%20development.html">架构拓展</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Digital%20Service.html">数字服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Safe%20Privacy.html">隐私保护</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Governonce%20and%20audit.html">治理与审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data%20management.html">数据管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Operation%20manage.html">运维管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ecological%20components.html">区块链生态组件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../External%20Interface.html">外部接口</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">用户手册:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Chain%20Authority%20Management.html">链级权限管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Node%20and%20zone%20management.html">节点及分区管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Consensus%20related%20user%20manual.html">共识相关使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Cross%20domain%20network%20User%20Manual.html">跨域网络使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data%20storage%20and%20management.html">数据存储使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Password%20related.html">密码学相关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Security%20Audit.html">安全审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data%20Monitor.html">数据监控</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qulian%20blockchain%20browser.html">趣链区块链浏览器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VM%20Related%20User%20Manual.html">（用户）智能合约使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Module.html">（用户）组件库</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">应用场景:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../application.html">应用案例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NFT%20and%20contract%20writing.html">数字藏品合约编写</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">更多资源:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Community_Resources.html">社区与资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperchain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>ELK 审计使用手册</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/Security Audit/ELK Audit Manual.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="elk">
<span id="elk-audit-manual"></span><h1>ELK 审计使用手册<a class="headerlink" href="#elk" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>1. 引言<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>1.1 编写目的<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>本文档主要是说明Hyperchain用户如何使用elk作为审计后端。在Hyperchain配置文件开启审计后，以及配置好审计后端为elk即可使用elk作为审计后端。</p>
<p>本文档将会详细的说明如何安装部署使用elk，以及一些可能遇到的注意事项。</p>
</div>
<div class="section" id="id3">
<h3>1.2背景<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>ELK是三个开源软件的缩写，分别表示：Elasticsearch , Logstash(本系统采用更加轻量的filebeat 替代), Kibana , 它们都是开源软件。新增了一个FileBeat，它是一个轻量级的日志收集处理工具(Agent)，Filebeat占用资源少，适合于在各个服务器上搜集日志后传输给Logstash，官方也推荐此工具。</p>
</div></blockquote>
</div>
<div class="section" id="id4">
<h3>1.3术语<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p><strong>ELK Stack</strong> :elasticsearch+filebeat+kibana</p>
</div>
<div class="section" id="id5">
<h3>1.4参考文献<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>[ELK介绍] <a href="#id17"><span class="problematic" id="id18">`https://www.elastic.co/cn/what-is/elk-stack&lt;https://www.elastic.co/cn/what-is/elk-stack&gt;`_</span></a></p>
<p>[elasticsearch 参考文档] <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</a></p>
<p>[kibana 参考文档] <a class="reference external" href="https://www.elastic.co/guide/en/kibana/current/index.html">https://www.elastic.co/guide/en/kibana/current/index.html</a></p>
<p>[filebeat参考文档] <a class="reference external" href="https://www.elastic.co/guide/en/beats/filebeat/7.9/index.html">https://www.elastic.co/guide/en/beats/filebeat/7.9/index.html</a></p>
</div>
</div>
<div class="section" id="id6">
<h2>2. 安装和初始化<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>elk 安装部署一般分为单机版部署和集群版部署。</p>
<p>单机版部署足以应对日常的审计使用，集群版部署主要是为了更好地发挥elasticsearch的性能，主要是适用于大数据分析，本文档不推荐使用集群部署elk</p>
<div class="section" id="id7">
<h3>2.1单机版部署<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>单机版部署将elasticsearch、filbeat、kibana都放在一台服务器进行设置和使用,推荐使用单机部署，节省服务器资源以及节约时间成本。</p>
<p>默认情况下，用户无需从elastic.io官方网站下载ELK平台进行部署配置，我们提供已经配置好的elasticsearch、filbeat、kibana 压缩包供用户下载使用，这么做的目的是为了简化用户对于这三个组件的配置修改，方便快速使用审计功能。</p>
<div class="section" id="id8">
<h4>2.1.1 安装说明<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>(elasticsearch-filbeat-kibana.tar.gz.zip附件可联系平台运维人员获取)</p>
<ol class="arabic simple">
<li><p>下载上述的附件，得到 elasticsearch-filbeat-kibana.tar.gz.zip 压缩包(为了节省空间，使用了两次压缩)，然后使用下面命令进行解压得到 elasticsearch-7.7.0、filebeat-7.7.0-linux-x86_64、kibana-7.7.0-linux-x86_64 三个组件目录</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unzip</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="n">filbeat</span><span class="o">-</span><span class="n">kibana</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span><span class="o">.</span><span class="n">zip</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">xvf</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="n">filbeat</span><span class="o">-</span><span class="n">kibana</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>接下来分别进入三个组件的目录修改配置文件，首先修改elasticsearch的配置文件，进入elasticsearch-7.7.0目录，配置文件在config目录下, 进入config目录，可以看到如下的配置文件目录：</p></li>
</ol>
<p><img alt="image0" src="../_images/ELK1.png" /></p>
<ol class="arabic simple" start="3">
<li><p>上述的配置文件大多数时候默认即可，不需要修改。但是为了更好的发挥机器性能，可以修改jvm.options，将jvm的最大堆内存和最小堆内存调整为合适大小（默认堆内存为1G大小。最大设置为机器物理内存的一半，不能超过32G）。 本文介绍使用的机器配置为16G内存，设置为堆内存为4g</p></li>
</ol>
<p><img alt="image1" src="../_images/ELK2.png" /></p>
<ol class="arabic simple" start="4">
<li><p>接下来进入filebeat-7.7.0-linux-x86_64目录，修改filebeat-7.7.0-linux-x86_64的配置文件。filebeat-7.7.0-linux-x86_64目录文件如下图所示：</p></li>
</ol>
<p><img alt="image2" src="../_images/ELK3.png" /></p>
<ol class="arabic simple" start="5">
<li><p>filebeat的配置文件为filebeat.yml文件，一般提供的压缩包已经配置好了，用户无需再次配置，如果要更改filebeat端口或者更改其他的配置可以编辑此文件。【请注意：如果修改了filebeat配置文件的端口和ip，那么hyperchain平台对应的发送审计的ip也要改】</p></li>
<li><p>接下来进入kibana-7.7.0-linux-x86_64 目录，kibana 的配置文件在config文件夹中，只有一个kibana.yml文件，如下图所示：</p></li>
</ol>
<p><img alt="image3" src="../_images/ELK4.png" /></p>
<p>kibana.yml文件里面可以配置访问elasticsearch的用户名和密码以及elasticsearch的链接地址，因为我们是三个组件在同一台机器，所以无需修改该 配置。</p>
<p>用户名：elastic 密码：hyperchain</p>
<p>完成上述步骤后，就完成了ELK的基本配置，如果有更高级的配置需要，请参考ELK的配置介绍文档。</p>
</div>
<div class="section" id="id9">
<h4>2.1.2 启动说明<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>es因为安全问题拒绝使用root用户启动，所以需要添加一个非root用户来启动elasticsearch</p>
<p>添加用户组:es，用户:es,she，设置密码</p>
<p>添加目录拥有权限</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">groupadd</span> <span class="n">es</span>
<span class="n">useradd</span> <span class="n">es</span> <span class="o">-</span><span class="n">g</span> <span class="n">es</span> <span class="o">-</span><span class="n">p</span> <span class="n">password</span> <span class="c1"># -g 指定组 -p 密码</span>
<span class="n">chown</span> <span class="n">es</span><span class="p">:</span><span class="n">es</span> <span class="o">-</span><span class="n">R</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="mf">7.10.0</span><span class="o">/</span> <span class="c1"># -R 处理指定目录以及其子目录下的所有文件</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple">
<li><p>切换到es用户，启动elasticsearch，进入elasticsearch-7.7.0目录, 执行下面的命令。-d 参数表示启动elasticsearch 使用后台启动的方式</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">su</span> <span class="n">es</span>
<span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">elasticsearch</span> <span class="o">-</span><span class="n">d</span>
</pre></div>
</div>
</div></blockquote>
<p>执行完成上述命令后， elasticsearch就会在后台启动了，可以使用下面的命令查看elasticsearch 进程是否存在，如果存在说明启动成功，如果不存在说明启动失败，可以查看logs文件夹下的elasticsearch.log 文件，通过日志判断错误类型然后根据下面的注意事项查找解决方案:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">-</span><span class="n">ef</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">elasticsearch</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>接下来启动kibana, 进入kibana-7.7.0-linux-x86_64 目录， 执行下面的命令即可</p></li>
</ol>
<blockquote>
<div><p>nohup ./bin/kibana &gt;&gt; kibana.log 2&gt;&amp;1 &amp;</p>
</div></blockquote>
<p>执行完成上述命令后， elasticsearch就会在后台启动了</p>
<ol class="arabic simple" start="3">
<li><p>接下来启动filebeat, 进入filebeat-7.7.0-linux-x86_64， 执行下面的命令即可:</p></li>
</ol>
<blockquote>
<div><p>nohup ./filebeat -e &gt;&gt; filebeat.log 2&gt;&amp;1 &amp;</p>
</div></blockquote>
<p>做完上述操作后，ELK审计平台就已经启动完成了，接下来可以访问kibana页面进行查看审计数据。</p>
</div>
<div class="section" id="id10">
<h4>2.1.3 启动完成检查<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>在网页上访问http://127.0.0.1:5601， ip地址是kibana平台所部署的服务器地址,端口是kibana默认端口为5601，可以看到如下界面，提示登录</p></li>
</ol>
<p><img alt="image4" src="../_images/ELK5.png" /></p>
<p>输入用户名: elastic 和密码：hyperchain进行登录。</p>
<ol class="arabic simple" start="2">
<li><p>登录后即可进入kibana界面查看审计数据。点击图标所示按钮，即可浏览实时的审计日志。关于kibana 的详细使用说明，用户可以自行查看kibana介绍文档。</p></li>
</ol>
<p><img alt="image5" src="../_images/ELK6.png" /></p>
<p>ELK单机部署和使用说明至此结束。</p>
</div>
</div>
<div class="section" id="id11">
<h3>2.2 集群部署<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>集群部署比较麻烦，而且没有固定的架构和服务器组合模式，一切都需要根据实际的资源情况以及业务量决定，这里为了简单说明起见，推荐使用3filebeat + 3节点elasticsearch + 3 kibana的架构模式。</p>
<p>假设我们部署的区块链平台为4个节点，那么我们就可以使用4个filebeat 对接每个hyperchain节点，然后这些filebeat节点再配置elasticsearch集群其中的一台elasticsearch 节点作为数据发送节点。</p>
<div class="section" id="id12">
<h4>2.2.1 安装说明<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p>下载得到 elasticsearch-filbeat-kibana.tar 压缩包，将该压缩包分别放入三台不同机器上。然后在每个机器上使用下面命令进行解压得到 elasticsearch-7.7.0、filebeat-7.7.0-linux-x86_64、kibana-7.7.0-linux-x86_64 三个组件目录。</p></li>
<li><p>分别修改elasticsearch 的配置文件，需要修改的项如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1号elasticsearch节点配置，1号节点默认为主节点</span>
<span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">node</span><span class="o">-</span><span class="mi">1</span>
<span class="n">discovery</span><span class="o">.</span><span class="n">seed_hosts</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;172.22.67.52:9300&quot;</span><span class="p">,</span><span class="s2">&quot;172.22.67.53:9300&quot;</span><span class="p">,</span><span class="s2">&quot;172.22.67.54:9300&quot;</span><span class="p">]</span>

<span class="c1"># 2号elasticsearch节点配置，2号节点默认为主节点</span>
<span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">node</span><span class="o">-</span><span class="mi">2</span>
<span class="n">discovery</span><span class="o">.</span><span class="n">seed_hosts</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;172.22.67.52:9300&quot;</span><span class="p">,</span><span class="s2">&quot;172.22.67.53:9300&quot;</span><span class="p">,</span><span class="s2">&quot;172.22.67.54:9300&quot;</span><span class="p">]</span>

<span class="c1"># 3号elasticsearch节点配置，3号节点默认为主节点</span>
<span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">node</span><span class="o">-</span><span class="mi">1</span>
<span class="n">discovery</span><span class="o">.</span><span class="n">seed_hosts</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;172.22.67.52:9300&quot;</span><span class="p">,</span><span class="s2">&quot;172.22.67.53:9300&quot;</span><span class="p">,</span><span class="s2">&quot;172.22.67.54:9300&quot;</span><span class="p">]</span>
</pre></div>
</div>
</li>
</ol>
<p>需要注意的是ip地址需要修改为自己服务器对应的ip端口，确保所有的elasticsearch能够互联成功。</p>
<ol class="arabic simple" start="3">
<li><p>filebeat 无需做任何修改。</p></li>
<li><p>kibana也无需做任何修改</p></li>
</ol>
</div>
<div class="section" id="id13">
<h4>2.2.2 启动说明<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>配置修改完成后, 就可以启动了，首先启动elasticsearch， 启动方式跟启动单机版一致。</p></li>
<li><p>接下来启动kibana，启动方式跟单机版也是一致的</p></li>
<li><p>然后启动filebeat，启动方式跟单机版一致</p></li>
</ol>
<p>做完上述操作后，ELK审计集群平台就已经启动完成了。接下来可以访问kibana页面进行查看审计数据，查看数据的方式跟单机版是一致的，这里不再赘述。</p>
<p>需要注意的是，在elasticsearch集群的模式下，区块链平台的配置文件也要对应修改为filebeat的多节点配置</p>
<p><img alt="image6" src="../_images/ELK7.png" /></p>
</div>
</div>
</div>
<div class="section" id="id14">
<h2>3.注意事项<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>启动elasticsearch 的时候出现下面的提示，这说明我们配置的java8环境不符合elasticsearch7.7的要求，需要至少jdk11版本。有两种方式可以解决该问题，第一种是取消我们配置的JAVA_HOME 环境变量， 因为elasticsearch默认自带了JDK，使用它的即可。另外一个方式就是配置JDK11以上的环境变量。(取消配置的JAVA_HOME 环境变量之后，需要重新连接服务器，才不会出现该提示。）</p></li>
</ol>
<p><img alt="image7" src="../_images/ELK8.png" /></p>
<ol class="arabic simple" start="2">
<li><p>启动elasticsearch 出现下面的错误信息，这种情况一般是上一次elasticsearch没有停止，而我们又去启动elasticsearch,造成重复启动。</p></li>
</ol>
<p><img alt="image8" src="../_images/ELK9.png" /></p>
<p>解决办法：结束进程重新启动elasticsearch即可。</p>
<ol class="arabic simple" start="3">
<li><p>使用kibana发现审计日志有些数据前面有感叹号。如下图所示：</p></li>
</ol>
<p><img alt="image9" src="../_images/ELK10.png" /></p>
<p>解决方案：</p>
<p>点击左下角齿轮按钮，然后点击index Parrterns, 出现下图所示页面</p>
<p><img alt="image10" src="../_images/ELK11.png" /></p>
<p>点击filebeat-<a href="#id15"><span class="problematic" id="id16">*</span></a>索引，出现下图所示，点击刷新按钮即可</p>
<p><img alt="image11" src="../_images/ELK12.png" /></p>
<p>4.vm.max_map_count is too low</p>
<p><img alt="image12" src="../_images/ELK13.png" /></p>
<p>出现这个错误的原因是因为linux系统的最大句柄数默认为65530， 而elasticsearch 所需要的文件句柄数超过了该限制，所以需要修改linux系统的最大的句柄数，修改方法如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<p>在最后一行添加一行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vm</span><span class="o">.</span><span class="n">max_map_count</span><span class="o">=</span><span class="mi">262144</span>
</pre></div>
</div>
<p>然后执行 下面的命令重新载入配置文件</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">sysctl</span> <span class="o">-</span><span class="n">p</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016-2023, Hangzhou Hyperchain Technology Co., Ltd..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>