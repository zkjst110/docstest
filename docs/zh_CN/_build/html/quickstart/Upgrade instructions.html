

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>升级说明 &mdash; hyperchain  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> hyperchain
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">平台介绍:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">平台介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Version%20information.html">版本信息</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">快速入门:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../General%20Concepts.html">通用概念</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Prepare.html">准备工作</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Deployedfile.html">部署运维</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">基础协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../consensus%20mechanism.html">共识机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Networking%20protocol.html">网络协议</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution%20engine.html">执行引擎</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Storage%20model.html">存储模型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security%20mechanism.html">加密机制</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">扩展协议:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Architecture%20development.html">架构拓展</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Digital%20Service.html">数字服务</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Safe%20Privacy.html">隐私保护</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Governonce%20and%20audit.html">治理与审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data%20management.html">数据管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Operation%20manage.html">运维管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ecological%20components.html">区块链生态组件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../External%20Interface.html">外部接口</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">用户手册:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Chain%20Authority%20Management.html">链级权限管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Node%20and%20zone%20management.html">节点及分区管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Consensus%20related%20user%20manual.html">共识相关使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Cross%20domain%20network%20User%20Manual.html">跨域网络使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data%20storage%20and%20management.html">数据存储使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Password%20related.html">密码学相关</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Security%20Audit.html">安全审计</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data%20Monitor.html">数据监控</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qulian%20blockchain%20browser.html">趣链区块链浏览器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VM%20Related%20User%20Manual.html">（用户）智能合约使用手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Module.html">（用户）组件库</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">应用场景:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../application.html">应用案例</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NFT%20and%20contract%20writing.html">数字藏品合约编写</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">更多资源:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Community_Resources.html">社区与资源</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hyperchain</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>升级说明</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/quickstart/Upgrade instructions.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="upgrade-instructions">
<span id="id1"></span><h1>升级说明<a class="headerlink" href="#upgrade-instructions" title="Permalink to this headline">¶</a></h1>
<p>本文是v1.8.x 或2.1.0以前到 v2.7.0的版本升级说明文档</p>
<p>低版本升级至高版本需注意应用侧也需要升级对应的sdk版本</p>
<p>参照《SDK&amp;版本对应关系》文档</p>
<div class="section" id="v1-8-xv2-7-0">
<h2>1. v1.8.x到v2.7.0的版本升级<a class="headerlink" href="#v1-8-xv2-7-0" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>1.1 节点等信息上链<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>在hyperchain还在运行的状态下，提前准备好配置中的genesis账户配置信息、当前所有节点的节点名及其对应的证书文件。</p>
<p>通过sdk发送交易将上述信息上链，以litesdk为例：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSetGenesisInfo</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="c1">// 准备创世账户、创世节点信息</span>
        <span class="c1">// 需要按照实际情况准备创世账户、创世节点以及节点证书</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">genesisAccount</span><span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="n">genesisAccount</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;0x000f1a7a08ccc48e5d30f80850cf1cf283aa3abd&quot;</span><span class="p">,</span> <span class="s">&quot;1000000000&quot;</span><span class="p">);</span>
        <span class="n">genesisAccount</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;e93b92f1da08f925bdee44e91e7768380ae83307&quot;</span><span class="p">,</span> <span class="s">&quot;1000000000&quot;</span><span class="p">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">GenesisNode</span><span class="o">&gt;</span> <span class="n">genesisNodes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
        <span class="n">String</span> <span class="n">node1Cert</span> <span class="o">=</span> <span class="s">&quot;node1 cert content&quot;</span><span class="p">;</span>
        <span class="n">genesisNodes</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">GenesisNode</span><span class="p">(</span><span class="s">&quot;node1&quot;</span><span class="p">,</span> <span class="n">node1Cert</span><span class="p">));</span>
        <span class="n">GenesisInfo</span> <span class="n">genesisInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GenesisInfo</span><span class="p">(</span><span class="n">genesisAccount</span><span class="p">,</span> <span class="n">genesisNodes</span><span class="p">);</span>
        <span class="c1">// 发送交易将创世信息上链</span>
        <span class="n">Account</span> <span class="n">ac</span> <span class="o">=</span> <span class="n">accountService</span><span class="p">.</span><span class="na">fromAccountJson</span><span class="p">(</span><span class="n">accountJson</span><span class="p">);</span>
        <span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span>
                <span class="nf">BVMBuilder</span><span class="p">(</span><span class="n">ac</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span>
                <span class="n">invoke</span><span class="p">(</span><span class="k">new</span> <span class="n">HashOperation</span><span class="p">.</span><span class="na">HashBuilder</span><span class="p">().</span><span class="na">setGenesisInfoForHpc</span><span class="p">(</span><span class="n">genesisInfo</span><span class="p">).</span><span class="na">build</span><span class="p">()).</span>
                <span class="c1">// 注意，向hyperchain发交易，txVersion需要设置成1.0</span>
                <span class="n">txVersion</span><span class="p">(</span><span class="n">TxVersion</span><span class="p">.</span><span class="na">TxVersion10</span><span class="p">).</span>
                <span class="n">build</span><span class="p">();</span>
        <span class="n">transaction</span><span class="p">.</span><span class="na">sign</span><span class="p">(</span><span class="n">ac</span><span class="p">);</span>
        <span class="n">ReceiptResponse</span> <span class="n">receiptResponse</span> <span class="o">=</span> <span class="n">contractService</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">transaction</span><span class="p">).</span><span class="na">send</span><span class="p">().</span><span class="na">polling</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">receiptResponse</span><span class="p">.</span><span class="na">getRet</span><span class="p">());</span>
        <span class="n">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Decoder</span><span class="p">.</span><span class="na">decodeBVM</span><span class="p">(</span><span class="n">receiptResponse</span><span class="p">.</span><span class="na">getRet</span><span class="p">());</span>
        <span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">isSuccess</span><span class="p">());</span>

        <span class="c1">// 查询上链的创世信息</span>
        <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span>
                <span class="nf">BVMBuilder</span><span class="p">(</span><span class="n">ac</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span>
                <span class="n">invoke</span><span class="p">(</span><span class="k">new</span> <span class="n">HashOperation</span><span class="p">.</span><span class="na">HashBuilder</span><span class="p">().</span><span class="na">getGenesisInfoForHpc</span><span class="p">().</span><span class="na">build</span><span class="p">()).</span>
                <span class="c1">// 注意，向hyperchain发交易，txVersion需要设置成1.0</span>
                <span class="n">txVersion</span><span class="p">(</span><span class="n">TxVersion</span><span class="p">.</span><span class="na">TxVersion10</span><span class="p">).</span>
                <span class="n">build</span><span class="p">();</span>
        <span class="n">transaction</span><span class="p">.</span><span class="na">sign</span><span class="p">(</span><span class="n">ac</span><span class="p">);</span>
        <span class="n">receiptResponse</span> <span class="o">=</span> <span class="n">contractService</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">transaction</span><span class="p">).</span><span class="na">send</span><span class="p">().</span><span class="na">polling</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">receiptResponse</span><span class="p">.</span><span class="na">getRet</span><span class="p">());</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">Decoder</span><span class="p">.</span><span class="na">decodeBVM</span><span class="p">(</span><span class="n">receiptResponse</span><span class="p">.</span><span class="na">getRet</span><span class="p">());</span>
        <span class="n">Assert</span><span class="p">.</span><span class="na">assertTrue</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">isSuccess</span><span class="p">());</span>
        <span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="p">();</span>
        <span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="n">genesisInfo</span><span class="p">),</span> <span class="n">result</span><span class="p">.</span><span class="na">getRet</span><span class="p">());</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3>1.2 进行数据备份<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>升级之前先停止当前hyperchain进程，将旧版本数据备份，若升级失败可以及时恢复，并将数据打包，供迁移使用：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 检查当前​磁盘空间是否足够，如磁盘空间不足需额外挂载磁盘</span>
$ df

<span class="c1"># 停止旧版本进程，按照实际安装路径以及安装包名称替换</span>
$ <span class="nb">cd</span> /path/to/hyperchain-1.8.6
$ ./stop.sh
​

<span class="c1"># 备份旧目录</span>
$ tar zcvf /path/to/hyperchain-1.8.6-backup.tar.gz /path/to/hyperchain-1.8.6
</pre></div>
</div>
</div>
<div class="section" id="flato">
<h3>1.3. 部署Flato<a class="headerlink" href="#flato" title="Permalink to this headline">¶</a></h3>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># 在flato安装文件目录执行deploy_local脚本
$ ./deploy-local.sh -d /flato-1.0.0
</pre></div>
</div>
<p>之后请参考《平台部署手册》对所有节点的网络配置进行修改。</p>
</div>
<div class="section" id="flato-dbcli">
<h3>1.4. 使用flato-dbcli进行数据升级<a class="headerlink" href="#flato-dbcli" title="Permalink to this headline">¶</a></h3>
<p>dbcli是升级数据、保证数据格式在大版本之间兼容的命令行工具。dbcli和flato的版本对应关系如下表所示：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 14%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>dbcli</p></th>
<th class="head"><p>flato</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>版本</p></td>
<td><p>1.1.1</p></td>
<td><p>1.0.6</p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>1.1.3</p></td>
<td><p>1.0.8（包含）-1.1.0（包含）</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>1.2.0</p></td>
<td><p>1.2.0及以上</p></td>
</tr>
</tbody>
</table>
<p><strong>请通过</strong> <cite>./flato-dbcli –version</cite> <strong>确认版本，请勿使用上表以外的版本进行升级。</strong></p>
<p>dbcli是升级数据、保证数据格式在大版本之间兼容的命令行工具。dbcli的输入参数列表以及相应的说明如下：</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 49%" />
<col style="width: 22%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>参数名
(逗号前后两者等效)</p></th>
<th class="head"><p>介绍</p></th>
<th class="head"><p>Required /
Optional</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>hpcConfig,hc</p></td>
<td><p>hyperchain的配置文件路径，如
namespace.toml</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-odd"><td><p>fl
atoArchivePath,fap</p></td>
<td><p>清洗线下数据完
成后归档/快照数据的目标路径，如
“archive”</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p>flatoConfig,fcp</p></td>
<td><p>flato的配置文件目录，即flato安
装包中的整个configuration目录；</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-odd"><td><p>namespace,ns</p></td>
<td><p>hyperchain的分区名，如”global”</p></td>
<td><p>Required</p></td>
</tr>
<tr class="row-even"><td><p>flatoDBPath,fp</p></td>
<td><p>升级后flato的数据目录</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td><p>onlineBlockDB,ob</p></td>
<td><p>hyperchain线上区块数
据目录，如”data/filelog/block”</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-even"><td><p>onlineJournalDB,oj</p></td>
<td><p>hyperchain线上journal数据
目录，如”data/filelog/journal”</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td><p>onli
neBlockChainDB,obc</p></td>
<td><p>hyperchain线上blockchain目
录，如”data/leveldb/blockchain”</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-even"><td><p>mqPath,mq</p></td>
<td><p>hyperchain
线上MQ目录，如”data/leveldb/MQ”</p></td>
<td><p>Option
al,仅当使用过
MQ功能时需要</p></td>
</tr>
<tr class="row-odd"><td><p>snapshotDBDir,sd</p></td>
<td><p>hyperchain的快照db目录，如”d
ata/leveldb/snapshots/“注意此处
需要的不是单个snapshotdb的目录</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-even"><td><p>snapshotMeta,sm</p></td>
<td><p>记录快照的snapshot.meta</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td><p>filterID,fid</p></td>
<td><p>快照的filter id</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-even"><td><p>archiveMeta,am</p></td>
<td><p>记录归档的archive.meta</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td><p>offlineBlockDB,ofb</p></td>
<td><p>hyperchain线下区块数
据目录，如”data/filelog/backup”</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-even"><td><p>of
flineJournalDB,ofj</p></td>
<td><p>hyperchain线下journal数据目录，
如”data/filelog/journal_backup”</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-odd"><td><p>of
flineArchiveDB,ofa</p></td>
<td><p>hyperchain线下archiv
e目录，如”data/leveldb/archive”</p></td>
<td><p>Optional</p></td>
</tr>
<tr class="row-even"><td><p>log</p></td>
<td><p>日志级别，可选
deb
ug,info,notice,warning,error,cr
itical,默认notice，大小写不敏感</p></td>
<td><p>Optional</p></td>
</tr>
</tbody>
</table>
<p>dbcli同时支持已归档的线下数据的升级与未归档的线上数据的升级，并且会根据输入的参数自动选择升级的模式。</p>
<p>需要注意flato-dbcli工具不支持断点续传，如数据升级中途退出则需要从头开始。</p>
<p>为避免此问题 需要在工具命令前加上 nohup 命令锁定进程，在命令的最后加上
&amp;&gt;/dev/null &amp; 使进程后台运行。<strong>（非常重要！！！）</strong></p>
<p>示例：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>nohup ./flato-dbcli migrate \
 -ns global \
 -fp /flato-1.5.0/namespaces/global/data/public/ \
 -fap /flato-1.5.0/namespaces/global/data/archive \
 -fcp /flato-1.5.0/configuration/ \
 -hc /hyperchain-1.8.6/namespaces/global/config/namespace.toml \
 -ob /hyperchain-1.8.6/namespaces/global/data/filelog/block \
 -oj /hyperchain-1.8.6/namespaces/global/data/filelog/journal \
 -obc /hyperchain-1.8.6/namespaces/global/data/leveldb/blockchain \
 -log debug \
 &amp;&gt;/dev/null &amp;
</pre></div>
</div>
<div class="section" id="id4">
<h4>1.4.1 未归档的线上数据<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>在这种场景下，除了需要提供上述<strong>Required</strong>的参数之外，还<strong>至少</strong>需要提供以下参数：</p>
<ol class="arabic simple">
<li><p>-fp:
升级后flato数据的目标目录，在完成升级之后需要将该目录拷贝至flato节点下；</p></li>
<li><p>-ob:
hyperchain中的区块数据目录，在默认配置下，这个路径为data/filelog/block；</p></li>
<li><p>-oj:
hyperchain中的journal数据目录，在默认配置下，这个路径为data/filelog/journal；</p></li>
<li><p>-obc:
hyperchain中的账本数据目录，在默认配置下，这个路径为data/leveldb/blockchain；</p></li>
</ol>
<p>具体的使用示例如下：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>nohup ./flato-dbcli migrate <span class="se">\</span>
 -ns global <span class="se">\</span>
 -fp /flato-1.5.0/namespaces/global/data/public/ <span class="se">\</span>
 -fap /flato-1.5.0/namespaces/global/data/archive <span class="se">\</span>
 -fcp /flato-1.5.0/configuration/ <span class="se">\</span>
 -hc /hyperchain-1.8.6/namespaces/global/config/namespace.toml <span class="se">\</span>
 -ob /hyperchain-1.8.6/namespaces/global/data/filelog/block <span class="se">\</span>
 -oj /hyperchain-1.8.6/namespaces/global/data/filelog/journal <span class="se">\</span>
 -obc /hyperchain-1.8.6/namespaces/global/data/leveldb/blockchain <span class="se">\</span>
 -log debug <span class="se">\</span>
 <span class="p">&amp;</span>&gt;/dev/null <span class="p">&amp;</span>
</pre></div>
</div>
<p><strong>若使用过MQ功能，则需要指定mq数据库路径，请参考参数列表。</strong></p>
<p>在执行为上述指令后，flato目标目录(即上例子的-fp路径)会呈现如下结构：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>. &lt;- /flato-1.0.8/namespaces/global/data/
├── archive
│   ├── 0xaf57419bd97530d5384debe86e24eec6
│   ├── archive.meta
│   ├── archive.record
│   └── snapshot.meta
└── public
    ├── accountdb
    ├── blockdb
    ├── cadb
    ├── chaindb
    ├── consensusdb
    ├── invalidtx
    ├── journaldb
    ├── minifile
    ├── mqdb
    ├── radardb
    ├── receiptdb
    ├── statedb
    ├── sync_chain.meta
     ├── config.meta
     └── rollback.meta
</pre></div>
</div>
<p><strong>值得注意的是，若曾进行过归档操作，则必须提供archive.meta文件，并且确保归档点小于最近的检查点之前，即若Hyperchain中的区块高度为58，那么不能在[51,58]进行归档，示例：</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nohup ./flato-dbcli migrate <span class="se">\</span>
 -ns global <span class="se">\</span>
 -fp /flato-1.0.8/namespaces/global/data/public/ <span class="se">\</span>
 -fap /flato-1.0.8/namespaces/global/data/archive <span class="se">\</span>
 -fcp /flato-1.0.8/configuration/ <span class="se">\</span>
 -hc /hyperchain-1.8.6/namespaces/global/config/namespace.toml <span class="se">\</span>
 -ob /hyperchain-1.8.6/namespaces/global/data/filelog/block <span class="se">\</span>
 -oj /hyperchain-1.8.6/namespaces/global/data/filelog/journal <span class="se">\</span>
 -obc /hyperchain-1.8.6/namespaces/global/data/leveldb/blockchain
 -am /hyperchain-1.8.6/namespaces/global/data/archive.meta <span class="c1">##必须提供\</span>
 <span class="p">&amp;</span>&gt;/dev/null <span class="p">&amp;</span>
</pre></div>
</div>
<p>若未做过归档，那么请忽略该参数。</p>
</div>
<div class="section" id="id5">
<h4>1.4.2 已归档的线下数据<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>若要升级已归档的线下数据，除了要提供参数表格中<strong>Required</strong>的参数，还需要提供以下参数：</p>
<ol class="arabic simple">
<li><p>-ofb:
需要升级的归档区块数据库，默认配置下，路径为/hyperchain-1.8.6/namespaces/global/data/filelog/backup；</p></li>
<li><p>-ofj:
需要升级的归档journal数据库，默认配置下，路径为/hyperchain-1.8.6/namespaces/global/data/filelog/journal_backup；</p></li>
<li><p>-ofa:
需要升级的归档账本数据库，默认配置下，路径为/hyperchain-1.8.6/namespaces/global/data/leveldb/archive；</p></li>
<li><p>-am:
归档记录archive.meta,默认配置下，路径为/hyperchain-1.8.6/namespaces/global/data/archive.meta；</p></li>
<li><p>-sm:
归档产生的snapshot.meta文件路径，默认配置下，路径为/hyperchain-1.8.6/namespaces/global/data/snapshot.meta；</p></li>
<li><p>-sd:
快照数据库目录，默认配置下，路径为/hyperchain-1.8.6/namespaces/global/data/leveldb/snapshots；</p></li>
<li><p>-fid: 归档快照对应的filter
id，在调用归档接口之后可以从返回结果中查询到该值。</p></li>
</ol>
<p>具体的使用示例如下：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>nohup ./flato-dbcli migrate <span class="se">\</span>
 -ns global <span class="se">\</span>
 -fap /flato-1.0.0/namespaces/global/data/archive <span class="se">\</span>
 -fcp /flato-1.0.0/configuration/ <span class="se">\</span>
 -hc /hyperchain-1.8.6/namespaces/global/config/namespace.toml <span class="se">\</span>
 -ofb /hyperchain-1.8.6/namespaces/global/data/filelog/backup <span class="se">\</span>
 -ofj /hyperchain-1.8.6/namespaces/global/data/filelog/journal_backup <span class="se">\</span>
 -ofa /hyperchain-1.8.6/namespaces/global/data/leveldb/archive <span class="se">\</span>
 -sm /hyperchain-1.8.6/namespaces/global/data/snapshot.meta <span class="se">\</span>
 -sd /hyperchain-1.8.6/namespaces/global/data/leveldb/snapshots <span class="se">\</span>
 -fid 0xdcbb0bd0b2cc9c746f476f7bbd031ad0 <span class="se">\</span>
 -am /hyperchain-1.8.6/namespaces/global/data/archive.meta <span class="se">\</span>
 -log debug <span class="se">\</span>
 <span class="p">&amp;</span>&gt;/dev/null <span class="p">&amp;</span>
</pre></div>
</div>
<p>升级成功后的数据目录如下：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>. &lt;- /flato-1.0.8/namespaces/global/data/
└── archive
    ├── 0x7d6d371262caef0fb21f417dae92254d
    │   ├── accountdb
    │   ├── blockdb
    │   ├── chaindb
    │   ├── journaldb
    │   ├── receiptdb
    │   └── statedb
    ├── archive.meta
    ├── archive.record
    └── snapshot.meta
</pre></div>
</div>
<p>通过我们的archive-reader组件可以进行归档数据的查询。</p>
</div>
</div>
<div class="section" id="id6">
<h3>1.5. 启动Flato并验证状态<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>在升级完线上数据、完成数据的替换之后，就可以启动Flato进程了：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 启动flato节点</span>
/flato-1.0.8/start.sh

检查节点状态
$ ./status.sh

<span class="c1"># 检查namespace日志确认是否启动成功</span>
$ tail -300f namespaces/global/data/logs/最新的log文件
</pre></div>
</div>
<p>若节点启动成功，则说明本次版本升级成功。</p>
<p>在进行下一步操作之前，请启动所有的区块链节点，并确保所有节点都输出如下日志，代表节点共识恢复成功：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>+==============================================+
 |                                              |
 |            RBFT Recovery Finished            |
 |                                              |
 +==============================================+
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3>1.6. 失败恢复<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>若数据升级过程发生失败，或flato节点启动失败，可通过备份的数据恢复hyperchain节点：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 关闭节点</span>
$ <span class="nb">cd</span> /flato-1.0.8/
$ ./stop.sh

<span class="c1"># 删除或重命名原先的文件</span>
$ rm -rf /flato-1.0.8

<span class="c1"># 解压备份的数据</span>
$ <span class="nb">cd</span> /hyperchain-1.8.6
$ tar zxvf hyperchain-1.8.6-backup.tar.gz
<span class="c1"># 待四个节点均复原后启动平台</span>
$ <span class="nb">cd</span> /hyperchain-1.8.6/hyperchain-1.8.6
$ ./start.sh

<span class="c1"># 检查恢复日志</span>
$ tail -300f namespaces/global/data/logs/最新的log文件
</pre></div>
</div>
</div>
</div>
<div class="section" id="v2-0-0-v2-3-0v2-7-0">
<h2>2. 从v2.0.0~v2.3.0版本升级到v2.7.0+<a class="headerlink" href="#v2-0-0-v2-3-0v2-7-0" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id8">
<h3>2.1 节点初始化<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>在升级前，需要确保已经进行过节点初始化，若没有进行，需要先进行节点初始化。</p>
<p>检查是否进行过节点初始化：(自行替换ip及端口)</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>curl 127.0.0.1:8081 --data &#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;namespace&quot;:&quot;global&quot;,&quot;method&quot;:&quot;config_getVSet&quot;,&quot;params&quot;:[&quot;&quot;],&quot;id&quot;:1}&#39;
</pre></div>
</div>
<p>若返回的结果如下，则表示进行过初始化。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
    &quot;jsonrpc&quot;:&quot;2.0&quot;,
    &quot;namespace&quot;:&quot;global&quot;,
    &quot;id&quot;:1,
    &quot;code&quot;:0,
    &quot;message&quot;:&quot;SUCCESS&quot;,
    &quot;result&quot;:[
        &quot;node1&quot;,
        &quot;node2&quot;,
        &quot;node3&quot;,
        &quot;node4&quot;
    ]
}
</pre></div>
</div>
<p>若返回的结果如下，则表示没有进行过初始化，需要进行节点初始化。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
    &quot;jsonrpc&quot;:&quot;2.0&quot;,
    &quot;namespace&quot;:&quot;global&quot;,
    &quot;id&quot;:1,
    &quot;code&quot;:-32001,
    &quot;message&quot;:&quot;DB not found: not found VSet&quot;
}
</pre></div>
</div>
<p>通过Litesdk进行节点初始化的示例如下：</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// 每个字符串为ns_genesis.toml中的genesis.alloc配置的每个账户私钥，用于创建提案、提案投票等</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span><span class="o">[]</span> <span class="n">accountJsons</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span><span class="p">{</span>
            <span class="s">&quot;&quot;</span>
            <span class="p">,</span> <span class="s">&quot;&quot;</span>
            <span class="p">,</span> <span class="s">&quot;&quot;</span>
            <span class="p">,</span> <span class="s">&quot;&quot;</span>
            <span class="p">,</span> <span class="s">&quot;&quot;</span>
            <span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">};</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testInit</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">RequestException</span> <span class="p">{</span>

    <span class="c1">// 准备创世节点的hostname以及对应节点的公钥</span>
     <span class="c1">// 替换nodex为对应节点的hostname，pubx为对应节点的公钥</span>

    <span class="c1">// create、vote and execute proposal for init nodes</span>
    <span class="n">completeProposal</span><span class="p">(</span><span class="k">new</span> <span class="n">ProposalOperation</span><span class="p">.</span><span class="na">ProposalBuilder</span><span class="p">().</span><span class="na">createForNode</span><span class="p">(</span>
            <span class="k">new</span> <span class="n">NodeOperation</span><span class="p">.</span><span class="na">NodeBuilder</span><span class="p">().</span><span class="na">addNode</span><span class="p">(</span><span class="s">&quot;pub1&quot;</span><span class="p">,</span> <span class="s">&quot;node1&quot;</span><span class="p">,</span><span class="s">&quot;vp&quot;</span><span class="p">,</span> <span class="s">&quot;global&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">(),</span>
            <span class="k">new</span> <span class="n">NodeOperation</span><span class="p">.</span><span class="na">NodeBuilder</span><span class="p">().</span><span class="na">addVP</span><span class="p">(</span><span class="s">&quot;node1&quot;</span><span class="p">,</span><span class="s">&quot;global&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">(),</span>
            <span class="k">new</span> <span class="n">NodeOperation</span><span class="p">.</span><span class="na">NodeBuilder</span><span class="p">().</span><span class="na">addNode</span><span class="p">(</span><span class="s">&quot;pub2&quot;</span><span class="p">,</span> <span class="s">&quot;node2&quot;</span><span class="p">,</span><span class="s">&quot;vp&quot;</span><span class="p">,</span> <span class="s">&quot;global&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">(),</span>
            <span class="k">new</span> <span class="n">NodeOperation</span><span class="p">.</span><span class="na">NodeBuilder</span><span class="p">().</span><span class="na">addVP</span><span class="p">(</span><span class="s">&quot;node2&quot;</span><span class="p">,</span><span class="s">&quot;global&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">(),</span>
            <span class="k">new</span> <span class="n">NodeOperation</span><span class="p">.</span><span class="na">NodeBuilder</span><span class="p">().</span><span class="na">addNode</span><span class="p">(</span><span class="s">&quot;pub3&quot;</span><span class="p">,</span> <span class="s">&quot;node3&quot;</span><span class="p">,</span><span class="s">&quot;vp&quot;</span><span class="p">,</span> <span class="s">&quot;global&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">(),</span>
            <span class="k">new</span> <span class="n">NodeOperation</span><span class="p">.</span><span class="na">NodeBuilder</span><span class="p">().</span><span class="na">addVP</span><span class="p">(</span><span class="s">&quot;node3&quot;</span><span class="p">,</span><span class="s">&quot;global&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">(),</span>
            <span class="k">new</span> <span class="n">NodeOperation</span><span class="p">.</span><span class="na">NodeBuilder</span><span class="p">().</span><span class="na">addNode</span><span class="p">(</span><span class="s">&quot;pub4&quot;</span><span class="p">,</span> <span class="s">&quot;node4&quot;</span><span class="p">,</span><span class="s">&quot;vp&quot;</span><span class="p">,</span> <span class="s">&quot;global&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">(),</span>
            <span class="k">new</span> <span class="n">NodeOperation</span><span class="p">.</span><span class="na">NodeBuilder</span><span class="p">().</span><span class="na">addVP</span><span class="p">(</span><span class="s">&quot;node4&quot;</span><span class="p">,</span><span class="s">&quot;global&quot;</span><span class="p">).</span><span class="na">build</span><span class="p">()</span>
    <span class="p">).</span><span class="na">build</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="n">String</span> <span class="nf">completeProposal</span><span class="p">(</span><span class="n">BuiltinOperation</span> <span class="n">opt</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RequestException</span> <span class="p">{</span>
    <span class="c1">// create</span>
    <span class="n">invokeBVMContract</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">accountService</span><span class="p">.</span><span class="na">fromAccountJson</span><span class="p">(</span><span class="n">accountJsons</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">));</span>

    <span class="n">Request</span><span class="o">&lt;</span><span class="n">ProposalResponse</span><span class="o">&gt;</span> <span class="n">proposal</span> <span class="o">=</span> <span class="n">configService</span><span class="p">.</span><span class="na">getProposal</span><span class="p">();</span>
    <span class="n">ProposalResponse</span> <span class="n">proposalResponse</span> <span class="o">=</span> <span class="n">proposal</span><span class="p">.</span><span class="na">send</span><span class="p">();</span>
    <span class="n">ProposalResponse</span><span class="p">.</span><span class="na">Proposal</span> <span class="n">prop</span> <span class="o">=</span> <span class="n">proposalResponse</span><span class="p">.</span><span class="na">getProposal</span><span class="p">();</span>

    <span class="c1">// vote</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">accountJsons</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">invokeBVMContract</span><span class="p">(</span><span class="k">new</span> <span class="n">ProposalOperation</span><span class="p">.</span><span class="na">ProposalBuilder</span><span class="p">().</span><span class="na">vote</span><span class="p">(</span><span class="n">prop</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span> <span class="kc">true</span><span class="p">).</span><span class="na">build</span><span class="p">(),</span> <span class="n">accountService</span><span class="p">.</span><span class="na">fromAccountJson</span><span class="p">(</span><span class="n">accountJsons</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">// execute</span>
    <span class="n">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="n">invokeBVMContract</span><span class="p">(</span><span class="k">new</span> <span class="n">ProposalOperation</span><span class="p">.</span><span class="na">ProposalBuilder</span><span class="p">().</span><span class="na">execute</span><span class="p">(</span><span class="n">prop</span><span class="p">.</span><span class="na">getId</span><span class="p">()).</span><span class="na">build</span><span class="p">(),</span> <span class="n">accountService</span><span class="p">.</span><span class="na">fromAccountJson</span><span class="p">(</span><span class="n">accountJsons</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="na">assertEquals</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="na">getErr</span><span class="p">());</span>

    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getRet</span><span class="p">());</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">OperationResult</span><span class="o">&gt;</span> <span class="n">resultList</span> <span class="o">=</span> <span class="n">Decoder</span><span class="p">.</span><span class="na">decodeBVMResult</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getRet</span><span class="p">());</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">OperationResult</span> <span class="n">or</span> <span class="p">:</span> <span class="n">resultList</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">or</span><span class="p">.</span><span class="na">getCode</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">resultList</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">resultList</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getMsg</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="n">Result</span> <span class="nf">invokeBVMContract</span><span class="p">(</span><span class="n">BuiltinOperation</span> <span class="n">opt</span><span class="p">,</span> <span class="n">Account</span> <span class="n">acc</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RequestException</span> <span class="p">{</span>
    <span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transaction</span><span class="p">.</span>
            <span class="nf">BVMBuilder</span><span class="p">(</span><span class="n">acc</span><span class="p">.</span><span class="na">getAddress</span><span class="p">()).</span>
            <span class="n">invoke</span><span class="p">(</span><span class="n">opt</span><span class="p">).</span>
            <span class="n">build</span><span class="p">();</span>
    <span class="n">transaction</span><span class="p">.</span><span class="na">sign</span><span class="p">(</span><span class="n">acc</span><span class="p">);</span>

    <span class="n">ReceiptResponse</span> <span class="n">receiptResponse</span> <span class="o">=</span> <span class="n">contractService</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">transaction</span><span class="p">).</span><span class="na">send</span><span class="p">().</span><span class="na">polling</span><span class="p">();</span>
    <span class="n">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Decoder</span><span class="p">.</span><span class="na">decodeBVM</span><span class="p">(</span><span class="n">receiptResponse</span><span class="p">.</span><span class="na">getRet</span><span class="p">());</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="gensis">
<h3>2.2 配置文件（2.1.0之后的版本需要新增<code class="docutils literal notranslate"><span class="pre">[gensis]</span></code>模块）<a class="headerlink" href="#gensis" title="Permalink to this headline">¶</a></h3>
<p>新增配置文件ns_genesis.toml</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">[</span><span class="nv">genesis</span><span class="p p-Indicator">]</span>
<span class="l l-Scalar l-Scalar-Plain">ca_mode = &quot;Center&quot;</span> <span class="c1"># ca模式，配置后不支持修改。支持的ca模式有：中心化ca，即Center；分布式ca，即Distributed；无ca，即none</span>
<span class="l l-Scalar l-Scalar-Plain">root_ca = [&quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
<span class="l l-Scalar l-Scalar-Plain">MIICODCCAeSgAwIBAgIBATAKBggqhkjOPQQDAjB0MQkwBwYDVQQIEwAxCTAHBgNV</span>
<span class="l l-Scalar l-Scalar-Plain">BAcTADEJMAcGA1UECRMAMQkwBwYDVQQREwAxDjAMBgNVBAoTBWZsYXRvMQkwBwYD</span>
<span class="l l-Scalar l-Scalar-Plain">VQQLEwAxDjAMBgNVBAMTBW5vZGUxMQswCQYDVQQGEwJaSDEOMAwGA1UEKhMFZWNl</span>
<span class="l l-Scalar l-Scalar-Plain">cnQwIBcNMjAwNTIxMDQyNTQ0WhgPMjEyMDA0MjcwNTI1NDRaMHQxCTAHBgNVBAgT</span>
<span class="l l-Scalar l-Scalar-Plain">ADEJMAcGA1UEBxMAMQkwBwYDVQQJEwAxCTAHBgNVBBETADEOMAwGA1UEChMFZmxh</span>
<span class="l l-Scalar l-Scalar-Plain">dG8xCTAHBgNVBAsTADEOMAwGA1UEAxMFbm9kZTExCzAJBgNVBAYTAlpIMQ4wDAYD</span>
<span class="l l-Scalar l-Scalar-Plain">VQQqEwVlY2VydDBWMBAGByqGSM49AgEGBSuBBAAKA0IABDoBjgQsvY4xhyIy3aWh</span>
<span class="l l-Scalar l-Scalar-Plain">4HLOTTY6te1VbmZaH5EZnKzqjU1f436bVsfi9HLE3/MCeZD6ISe1U5giM5NuwF6T</span>
<span class="l l-Scalar l-Scalar-Plain">ZEOjaDBmMA4GA1UdDwEB/wQEAwIChDAmBgNVHSUEHzAdBggrBgEFBQcDAgYIKwYB</span>
<span class="l l-Scalar l-Scalar-Plain">BQUHAwEGAioDBgOBCwEwDwYDVR0TAQH/BAUwAwEB/zANBgNVHQ4EBgQEAQIDBDAM</span>
<span class="l l-Scalar l-Scalar-Plain">BgMqVgEEBWVjZXJ0MAoGCCqGSM49BAMCA0IAuVuDqguvjPPveimWruESBYqMJ1qq</span>
<span class="l l-Scalar l-Scalar-Plain">ryhXiMhlYwzH1FgUz0TcayuY+4KebRhFhb14ZDXBBPXcn9CYdtbbSxXTogE=</span>
<span class="l l-Scalar l-Scalar-Plain">-----END CERTIFICATE-----</span>
<span class="l l-Scalar l-Scalar-Plain">&quot;&quot;&quot;]</span> <span class="c1"># 当ca模式问中心化ca，即Center时，需要配置中心化ca使用的root ca，其他模式下无需配置</span>
<span class="p p-Indicator">[</span><span class="nv">genesis.alloc</span><span class="p p-Indicator">]</span> <span class="c1"># 创世账户，用户需用自己生成的账户地址替换创世账户地址，后续妥善保管这些账户的私钥</span>
<span class="s">&quot;000f1a7a08ccc48e5d30f80850cf1cf283aa3abd&quot;</span> <span class="l l-Scalar l-Scalar-Plain">= &quot;1000000000&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">&quot;e93b92f1da08f925bdee44e91e7768380ae83307&quot; = &quot;1000000000&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">&quot;6201cb0448964ac597faf6fdf1f472edf2a22b89&quot; = &quot;1000000000&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">&quot;b18c8575e3284e79b92100025a31378feb8100d6&quot; = &quot;1000000000&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">&quot;856E2B9A5FA82FD1B031D1FF6863864DBAC7995D&quot; = &quot;1000000000&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">&quot;fbca6a7e9e29728773b270d3f00153c75d04e1ad&quot; = &quot;1000000000&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">[[genesis.nodes]]</span> <span class="c1"># 创世节点列表</span>
<span class="l l-Scalar l-Scalar-Plain">genesisNode = &quot;node1&quot;</span> <span class="c1"># 创世节点名称，与hostname对应</span>
<span class="l l-Scalar l-Scalar-Plain">certContent = &quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
<span class="l l-Scalar l-Scalar-Plain">MIICSTCCAfWgAwIBAgIBATAKBggqhkjOPQQDAjB0MQkwBwYDVQQIEwAxCTAHBgNV</span>
<span class="l l-Scalar l-Scalar-Plain">BAcTADEJMAcGA1UECRMAMQkwBwYDVQQREwAxDjAMBgNVBAoTBWZsYXRvMQkwBwYD</span>
<span class="l l-Scalar l-Scalar-Plain">VQQLEwAxDjAMBgNVBAMTBW5vZGUxMQswCQYDVQQGEwJaSDEOMAwGA1UEKhMFZWNl</span>
<span class="l l-Scalar l-Scalar-Plain">cnQwIBcNMjAwNTIxMDU1MzU2WhgPMjEyMDA0MjcwNjUzNTZaMHQxCTAHBgNVBAgT</span>
<span class="l l-Scalar l-Scalar-Plain">ADEJMAcGA1UEBxMAMQkwBwYDVQQJEwAxCTAHBgNVBBETADEOMAwGA1UEChMFZmxh</span>
<span class="l l-Scalar l-Scalar-Plain">dG8xCTAHBgNVBAsTADEOMAwGA1UEAxMFbm9kZTIxCzAJBgNVBAYTAlpIMQ4wDAYD</span>
<span class="l l-Scalar l-Scalar-Plain">VQQqEwVlY2VydDBWMBAGByqGSM49AgEGBSuBBAAKA0IABBI3ewNK21vHNOPG6U3X</span>
<span class="l l-Scalar l-Scalar-Plain">mKJohSNNz72QKDxUpRt0fCJHwaGYfSvY4cnqkbliclfckUTpCkFSRr4cqN6PURCF</span>
<span class="l l-Scalar l-Scalar-Plain">zkWjeTB3MA4GA1UdDwEB/wQEAwIChDAmBgNVHSUEHzAdBggrBgEFBQcDAgYIKwYB</span>
<span class="l l-Scalar l-Scalar-Plain">BQUHAwEGAioDBgOBCwEwDwYDVR0TAQH/BAUwAwEB/zANBgNVHQ4EBgQEAQIDBDAP</span>
<span class="l l-Scalar l-Scalar-Plain">BgNVHSMECDAGgAQBAgMEMAwGAypWAQQFZWNlcnQwCgYIKoZIzj0EAwIDQgD6Dzzv</span>
<span class="l l-Scalar l-Scalar-Plain">31kMiIlYtQRQjjs5m9pSvMZtmq2vOJW6/5J3kBuUkjTJfawqDdoxVh4yw06F/IBQ</span>
<span class="l l-Scalar l-Scalar-Plain">gSu97EZSaseY9hweAA==</span>
<span class="l l-Scalar l-Scalar-Plain">-----END CERTIFICATE-----&quot;&quot;&quot;</span> <span class="c1"># 创世节点证书，即此节点的ecert</span>

<span class="p p-Indicator">[[</span><span class="nv">genesis.nodes</span><span class="p p-Indicator">]]</span>
<span class="l l-Scalar l-Scalar-Plain">genesisNode = &quot;node2&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">certContent = &quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
<span class="l l-Scalar l-Scalar-Plain">MIICSTCCAfWgAwIBAgIBATAKBggqhkjOPQQDAjB0MQkwBwYDVQQIEwAxCTAHBgNV</span>
<span class="l l-Scalar l-Scalar-Plain">BAcTADEJMAcGA1UECRMAMQkwBwYDVQQREwAxDjAMBgNVBAoTBWZsYXRvMQkwBwYD</span>
<span class="l l-Scalar l-Scalar-Plain">VQQLEwAxDjAMBgNVBAMTBW5vZGUyMQswCQYDVQQGEwJaSDEOMAwGA1UEKhMFZWNl</span>
<span class="l l-Scalar l-Scalar-Plain">cnQwIBcNMjAwNTIxMDU1MTE0WhgPMjEyMDA0MjcwNjUxMTRaMHQxCTAHBgNVBAgT</span>
<span class="l l-Scalar l-Scalar-Plain">ADEJMAcGA1UEBxMAMQkwBwYDVQQJEwAxCTAHBgNVBBETADEOMAwGA1UEChMFZmxh</span>
<span class="l l-Scalar l-Scalar-Plain">dG8xCTAHBgNVBAsTADEOMAwGA1UEAxMFbm9kZTExCzAJBgNVBAYTAlpIMQ4wDAYD</span>
<span class="l l-Scalar l-Scalar-Plain">VQQqEwVlY2VydDBWMBAGByqGSM49AgEGBSuBBAAKA0IABBI3ewNK21vHNOPG6U3X</span>
<span class="l l-Scalar l-Scalar-Plain">mKJohSNNz72QKDxUpRt0fCJHwaGYfSvY4cnqkbliclfckUTpCkFSRr4cqN6PURCF</span>
<span class="l l-Scalar l-Scalar-Plain">zkWjeTB3MA4GA1UdDwEB/wQEAwIChDAmBgNVHSUEHzAdBggrBgEFBQcDAgYIKwYB</span>
<span class="l l-Scalar l-Scalar-Plain">BQUHAwEGAioDBgOBCwEwDwYDVR0TAQH/BAUwAwEB/zANBgNVHQ4EBgQEAQIDBDAP</span>
<span class="l l-Scalar l-Scalar-Plain">BgNVHSMECDAGgAQBAgMEMAwGAypWAQQFZWNlcnQwCgYIKoZIzj0EAwIDQgB3Cfo8</span>
<span class="l l-Scalar l-Scalar-Plain">/Vdzzlz+MW+MIVuYQkcNkACY/yU/IXD1sHDGZQWcGKr4NR7FHJgsbjGpbUiCofw4</span>
<span class="l l-Scalar l-Scalar-Plain">4rK6biAEEAOcv1BQAA==</span>
<span class="l l-Scalar l-Scalar-Plain">-----END CERTIFICATE-----&quot;&quot;&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">[[genesis.nodes]]</span>
<span class="l l-Scalar l-Scalar-Plain">genesisNode = &quot;node3&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">certContent = &quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
<span class="l l-Scalar l-Scalar-Plain">MIICRjCCAfKgAwIBAgIBATAKBggqhkjOPQQDAjB0MQkwBwYDVQQIEwAxCTAHBgNV</span>
<span class="l l-Scalar l-Scalar-Plain">BAcTADEJMAcGA1UECRMAMQkwBwYDVQQREwAxDjAMBgNVBAoTBWZsYXRvMQkwBwYD</span>
<span class="l l-Scalar l-Scalar-Plain">VQQLEwAxDjAMBgNVBAMTBW5vZGUzMQswCQYDVQQGEwJaSDEOMAwGA1UEKhMFZWNl</span>
<span class="l l-Scalar l-Scalar-Plain">cnQwIBcNMjAwNTIxMDU1MTQ0WhgPMjEyMDA0MjcwNjUxNDRaMHQxCTAHBgNVBAgT</span>
<span class="l l-Scalar l-Scalar-Plain">ADEJMAcGA1UEBxMAMQkwBwYDVQQJEwAxCTAHBgNVBBETADEOMAwGA1UEChMFZmxh</span>
<span class="l l-Scalar l-Scalar-Plain">dG8xCTAHBgNVBAsTADEOMAwGA1UEAxMFbm9kZTExCzAJBgNVBAYTAlpIMQ4wDAYD</span>
<span class="l l-Scalar l-Scalar-Plain">VQQqEwVlY2VydDBWMBAGByqGSM49AgEGBSuBBAAKA0IABBI3ewNK21vHNOPG6U3X</span>
<span class="l l-Scalar l-Scalar-Plain">mKJohSNNz72QKDxUpRt0fCJHwaGYfSvY4cnqkbliclfckUTpCkFSRr4cqN6PURCF</span>
<span class="l l-Scalar l-Scalar-Plain">zkWjdjB0MA4GA1UdDwEB/wQEAwIChDAmBgNVHSUEHzAdBggrBgEFBQcDAgYIKwYB</span>
<span class="l l-Scalar l-Scalar-Plain">BQUHAwEGAioDBgOBCwEwDAYDVR0TAQH/BAIwADANBgNVHQ4EBgQEAQIDBDAPBgNV</span>
<span class="l l-Scalar l-Scalar-Plain">HSMECDAGgAQBAgMEMAwGAypWAQQFZWNlcnQwCgYIKoZIzj0EAwIDQgCalJzkOAqk</span>
<span class="l l-Scalar l-Scalar-Plain">IU4AMQGeWzFmdtRYJXZiElyqfrCn7Zg08Ssx14ZMO8K2cRsCncO+c/a/0IqwObEO</span>
<span class="l l-Scalar l-Scalar-Plain">wL4C2ich1g5bAA==</span>
<span class="l l-Scalar l-Scalar-Plain">-----END CERTIFICATE-----&quot;&quot;&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">[[genesis.nodes]]</span>
<span class="l l-Scalar l-Scalar-Plain">genesisNode = &quot;node4&quot;</span>
<span class="l l-Scalar l-Scalar-Plain">certContent = &quot;&quot;&quot;-----BEGIN CERTIFICATE-----</span>
<span class="l l-Scalar l-Scalar-Plain">MIICSTCCAfWgAwIBAgIBATAKBggqhkjOPQQDAjB0MQkwBwYDVQQIEwAxCTAHBgNV</span>
<span class="l l-Scalar l-Scalar-Plain">BAcTADEJMAcGA1UECRMAMQkwBwYDVQQREwAxDjAMBgNVBAoTBWZsYXRvMQkwBwYD</span>
<span class="l l-Scalar l-Scalar-Plain">VQQLEwAxDjAMBgNVBAMTBW5vZGU0MQswCQYDVQQGEwJaSDEOMAwGA1UEKhMFZWNl</span>
<span class="l l-Scalar l-Scalar-Plain">cnQwIBcNMjAwNTIxMDU1MzI0WhgPMjEyMDA0MjcwNjUzMjRaMHQxCTAHBgNVBAgT</span>
<span class="l l-Scalar l-Scalar-Plain">ADEJMAcGA1UEBxMAMQkwBwYDVQQJEwAxCTAHBgNVBBETADEOMAwGA1UEChMFZmxh</span>
<span class="l l-Scalar l-Scalar-Plain">dG8xCTAHBgNVBAsTADEOMAwGA1UEAxMFbm9kZTExCzAJBgNVBAYTAlpIMQ4wDAYD</span>
<span class="l l-Scalar l-Scalar-Plain">VQQqEwVlY2VydDBWMBAGByqGSM49AgEGBSuBBAAKA0IABBI3ewNK21vHNOPG6U3X</span>
<span class="l l-Scalar l-Scalar-Plain">mKJohSNNz72QKDxUpRt0fCJHwaGYfSvY4cnqkbliclfckUTpCkFSRr4cqN6PURCF</span>
<span class="l l-Scalar l-Scalar-Plain">zkWjeTB3MA4GA1UdDwEB/wQEAwIChDAmBgNVHSUEHzAdBggrBgEFBQcDAgYIKwYB</span>
<span class="l l-Scalar l-Scalar-Plain">BQUHAwEGAioDBgOBCwEwDwYDVR0TAQH/BAUwAwEB/zANBgNVHQ4EBgQEAQIDBDAP</span>
<span class="l l-Scalar l-Scalar-Plain">BgNVHSMECDAGgAQBAgMEMAwGAypWAQQFZWNlcnQwCgYIKoZIzj0EAwIDQgATn17d</span>
<span class="l l-Scalar l-Scalar-Plain">VxBI7s/4D/KNU0T3wvQeNrj6ZYmiNRjB/JIwPH7MhM5cTeJx0rs0K27rM/pFZtbq</span>
<span class="l l-Scalar l-Scalar-Plain">+0W3ll/JfjQ6WxAAAQ==</span>
<span class="l l-Scalar l-Scalar-Plain">-----END CERTIFICATE-----&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>由于在v2.7.0版本开始支持checkpoint上链，对于历史版本，需要指定额外配置来生成初始信任的检查点</p>
</div>
<div class="section" id="id9">
<h3>2.3 停止旧版本集群<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>保证旧版本集群中的所有节点在<strong>同一高度</strong>下停止</p>
<p>例：在集群中所有节点高度都为19时停止节点</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 通过rpc查看集群当前状态</span>
curl &lt;ip地址&gt;:&lt;端口&gt; --data <span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;: &quot;node_getNodeStates&quot;,&quot;id&quot;: 1, &quot;namespace&quot;:&quot;&lt;分区名&gt;&quot;}&#39;</span>
</pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
    <span class="nt">&quot;namespace&quot;</span><span class="p">:</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span>
    <span class="nt">&quot;result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;blockHash&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000013eec2cc0a0866491f8d031283298a9a45a60e55eb65ca58e5&quot;</span><span class="p">,</span>
            <span class="nt">&quot;blockHeight&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
            <span class="nt">&quot;checkpoint&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="nt">&quot;epoch&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;hash&quot;</span><span class="p">:</span> <span class="s2">&quot;fa34664ec14727c34943045bcaba9ef05d2c48e06d294c15effc900a5b4b663a&quot;</span><span class="p">,</span>
            <span class="nt">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;node1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;NORMAL&quot;</span><span class="p">,</span>
            <span class="nt">&quot;view&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;blockHash&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000013eec2cc0a0866491f8d031283298a9a45a60e55eb65ca58e5&quot;</span><span class="p">,</span>
            <span class="nt">&quot;blockHeight&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
            <span class="nt">&quot;checkpoint&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="nt">&quot;epoch&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;hash&quot;</span><span class="p">:</span> <span class="s2">&quot;c82a71a88c58540c62fc119e78306e7fdbe114d9b840c47ab564767cb1c706e2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;node2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;NORMAL&quot;</span><span class="p">,</span>
            <span class="nt">&quot;view&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;blockHash&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000013eec2cc0a0866491f8d031283298a9a45a60e55eb65ca58e5&quot;</span><span class="p">,</span>
            <span class="nt">&quot;blockHeight&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
            <span class="nt">&quot;checkpoint&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="nt">&quot;epoch&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;hash&quot;</span><span class="p">:</span> <span class="s2">&quot;0c89dc7d8bdf45d1fed89fdbac27463d9f144875d3d73795f64f35dc204480fd&quot;</span><span class="p">,</span>
            <span class="nt">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;node3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;NORMAL&quot;</span><span class="p">,</span>
            <span class="nt">&quot;view&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;blockHash&quot;</span><span class="p">:</span> <span class="s2">&quot;0000000000000013eec2cc0a0866491f8d031283298a9a45a60e55eb65ca58e5&quot;</span><span class="p">,</span>
            <span class="nt">&quot;blockHeight&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
            <span class="nt">&quot;checkpoint&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="nt">&quot;epoch&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;hash&quot;</span><span class="p">:</span> <span class="s2">&quot;34d299742260716bab353995fe98727004b5c27bde52489f61de093176e82088&quot;</span><span class="p">,</span>
            <span class="nt">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;node4&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;NORMAL&quot;</span>
             <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h3>2.4 版本升级<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id11">
<h4>2.4.1 二进制文件替换<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>在hyperchain安装目录执行stop.sh脚本</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./stop.sh
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>将安装目录中老版本的hyperchain文件替换为要升级到的版本的hyperchain文件</p></li>
</ol>
</div>
<div class="section" id="upgrade-toml">
<h4>2.4.2 自动生成upgrade.toml<a class="headerlink" href="#upgrade-toml" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>在节点安装目录下，使用命令自动生成<code class="docutils literal notranslate"><span class="pre">upgrade.toml</span></code></p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./hyperchain --gqc configuration
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>查看<code class="docutils literal notranslate"><span class="pre">configuration/&lt;分区名&gt;/upgrade.toml</span></code>文件，确保配置文件已自动生成</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&gt; cat configuration/&lt;分区名&gt;/upgrade.toml

[genesis_checkpoint]
  data = &quot;0ad3031a42124030303030303030303030303030303030636165373565343962356635326231383337623133353430326536636437356231616131353363336666343231316336228c030a610a056e6f64653112583056301006072a8648ce3d020106052b8104000a0342000412377b034adb5bc734e3c6e94dd798a26885234dcfbd90283c54a51b747c2247c1a1987d2bd8e1c9ea91b9627257dc9144e90a415246be1ca8de8f511085ce450a610a056e6f64653212583056301006072a8648ce3d020106052b8104000a0342000412377b034adb5bc734e3c6e94dd798a26885234dcfbd90283c54a51b747c2247c1a1987d2bd8e1c9ea91b9627257dc9144e90a415246be1ca8de8f511085ce450a610a056e6f64653312583056301006072a8648ce3d020106052b8104000a0342000412377b034adb5bc734e3c6e94dd798a26885234dcfbd90283c54a51b747c2247c1a1987d2bd8e1c9ea91b9627257dc9144e90a415246be1ca8de8f511085ce450a610a056e6f64653412583056301006072a8648ce3d020106052b8104000a0342000412377b034adb5bc734e3c6e94dd798a26885234dcfbd90283c54a51b747c2247c1a1987d2bd8e1c9ea91b9627257dc9144e90a415246be1ca8de8f511085ce45&quot;
&gt;
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>在集群所有节点上查看<code class="docutils literal notranslate"><span class="pre">upgrade.toml</span></code>文件，确保<em>genesis_checkpoint</em>配置项<strong>每个节点一致</strong></p></li>
</ol>
</div>
<div class="section" id="id12">
<h4>2.4.3 启动节点<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>使用新版本二进制启动节点。</p>
<p>使用<code class="docutils literal notranslate"><span class="pre">start.sh</span></code>启动hyperchain进程:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#根据实际情况修改/data/hyperchain</span>
<span class="nb">cd</span> /data/hyperchain
./start.sh
<span class="c1">#或者如果上面命令失败，尝试下面这个命令，待服务正常后，再使用脚本重启</span>
./hyperchain
</pre></div>
</div>
</div>
<div class="section" id="ca">
<h4>2.4.4 ca模式管理<a class="headerlink" href="#ca" title="Permalink to this headline">¶</a></h4>
<p>链完成升级后，需要通过提案设置ca模式，如果为中心ca，设置完ca模式后还需要通过新增root
ca的方式将所有使用的root ca上链。具体设置ca模式以及通过新增root
ca的方式将使用的root ca上链的流程详见《ca模式管理》</p>
</div>
</div>
<div class="section" id="id13">
<h3>2.5 版本升级后加入新节点<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>历史版本区块链集群在通过此方式升级至v2.7.0版本后，加入新节点时需要进行的额外操作</p>
<p>（若集群是从v2.7.0才启动的，<strong>不带有历史版本的数据</strong>，则新加入的节点无需以下操作）</p>
<div class="section" id="id14">
<h4>2.5.1 从集群现有节点获取upgrade.toml<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>拷贝集群现有节点安装目录下的<code class="docutils literal notranslate"><span class="pre">configuration/&lt;分区名&gt;/upgrade.toml</span></code>到新节点安装目录下的分区目录<code class="docutils literal notranslate"><span class="pre">configuration/&lt;分区名&gt;/</span></code></p>
</div>
<div class="section" id="ns-static-toml">
<h4>2.5.2 配置ns_static.toml<a class="headerlink" href="#ns-static-toml" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>查询集群现有节点的区块与世代信息</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># 通过rpc查看集群当前状态</span>
curl &lt;ip地址&gt;:&lt;端口&gt; --data <span class="s1">&#39;{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;: &quot;node_getNodeStates&quot;,&quot;id&quot;: 1, &quot;namespace&quot;:&quot;&lt;分区名&gt;&quot;}&#39;</span>
</pre></div>
</div>
<p><strong>例：</strong>当前查询到区块高度<code class="docutils literal notranslate"><span class="pre">blockHeight</span></code>为<em>13</em>，区块哈希<code class="docutils literal notranslate"><span class="pre">blockHash</span></code>为<em>000000000000000dafd619e625e629e4f79d2acf4782220aa030bf411e8aef21</em>，世代<code class="docutils literal notranslate"><span class="pre">epoch</span></code>为<em>2</em></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
    <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;SUCCESS&quot;</span><span class="p">,</span>
    <span class="nt">&quot;namespace&quot;</span><span class="p">:</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span>
    <span class="nt">&quot;result&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;blockHash&quot;</span><span class="p">:</span> <span class="s2">&quot;000000000000000dafd619e625e629e4f79d2acf4782220aa030bf411e8aef21&quot;</span><span class="p">,</span>
            <span class="nt">&quot;blockHeight&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="nt">&quot;checkpoint&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="nt">&quot;epoch&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;hash&quot;</span><span class="p">:</span> <span class="s2">&quot;fa34664ec14727c34943045bcaba9ef05d2c48e06d294c15effc900a5b4b663a&quot;</span><span class="p">,</span>
            <span class="nt">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;node1&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;NORMAL&quot;</span><span class="p">,</span>
            <span class="nt">&quot;view&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;blockHash&quot;</span><span class="p">:</span> <span class="s2">&quot;000000000000000dafd619e625e629e4f79d2acf4782220aa030bf411e8aef21&quot;</span><span class="p">,</span>
            <span class="nt">&quot;blockHeight&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="nt">&quot;checkpoint&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="nt">&quot;epoch&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;hash&quot;</span><span class="p">:</span> <span class="s2">&quot;c82a71a88c58540c62fc119e78306e7fdbe114d9b840c47ab564767cb1c706e2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;node2&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;NORMAL&quot;</span><span class="p">,</span>
            <span class="nt">&quot;view&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;blockHash&quot;</span><span class="p">:</span> <span class="s2">&quot;000000000000000dafd619e625e629e4f79d2acf4782220aa030bf411e8aef21&quot;</span><span class="p">,</span>
            <span class="nt">&quot;blockHeight&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="nt">&quot;checkpoint&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="nt">&quot;epoch&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;hash&quot;</span><span class="p">:</span> <span class="s2">&quot;0c89dc7d8bdf45d1fed89fdbac27463d9f144875d3d73795f64f35dc204480fd&quot;</span><span class="p">,</span>
            <span class="nt">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;node3&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;NORMAL&quot;</span><span class="p">,</span>
            <span class="nt">&quot;view&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;blockHash&quot;</span><span class="p">:</span> <span class="s2">&quot;000000000000000dafd619e625e629e4f79d2acf4782220aa030bf411e8aef21&quot;</span><span class="p">,</span>
            <span class="nt">&quot;blockHeight&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="nt">&quot;checkpoint&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="nt">&quot;epoch&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nt">&quot;hash&quot;</span><span class="p">:</span> <span class="s2">&quot;34d299742260716bab353995fe98727004b5c27bde52489f61de093176e82088&quot;</span><span class="p">,</span>
            <span class="nt">&quot;hostname&quot;</span><span class="p">:</span> <span class="s2">&quot;node4&quot;</span><span class="p">,</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;NORMAL&quot;</span><span class="p">,</span>
            <span class="nt">&quot;view&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>修改<code class="docutils literal notranslate"><span class="pre">configuration/&lt;分区名&gt;/ns_static.toml</span></code></p></li>
</ol>
<p>修改[<strong>sync.target</strong>]配置项：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">将epoch设置为步骤1查询到的epoch</span>

<span class="o">-</span> <span class="n">将height设置为步骤1查询到的blockHeight</span>

<span class="o">-</span> <span class="n">将hash设置为步骤1查询到的blockHash</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[sync]
     [sync.target]
             epoch  = 0
             height = -1
             hash = &quot;&quot;
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h4>2.5.3 启动节点<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>使用新版本二进制启动节点</p>
<p>使用<code class="docutils literal notranslate"><span class="pre">start.sh</span></code>启动hyperchain进程:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#根据实际情况修改/data/hyperchain</span>
<span class="nb">cd</span> /data/hyperchain
./start.sh
<span class="c1">#或者如果上面命令失败，尝试下面这个命令，待服务正常后，再使用脚本重启</span>
./hyperchain
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016-2023, Hangzhou Hyperchain Technology Co., Ltd..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>